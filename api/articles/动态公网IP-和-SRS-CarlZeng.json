{"title":"动态公网IP 和 SRS-CarlZeng","slug":"动态公网IP-和-SRS-CarlZeng","date":"2023-04-13T09:36:00.000Z","updated":"2024-07-12T02:52:56.370Z","comments":true,"path":"api/articles/动态公网IP-和-SRS-CarlZeng.json","excerpt":"动态公网IP和SRS简介以及现实中的应用","covers":["https://img.carlzeng.top:3/i/2024/07/11/668f5c0ad2ad9.png","https://img.carlzeng.top:3/i/2024/07/04/6686268f6a682.png","https://img.carlzeng.top:3/i/2024/07/12/6690991768716.png","https://img.carlzeng.top:3/i/2024/07/12/6690996c68be7.png"],"content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>动态公网IP（Dynamic Public IP）是指由互联网服务提供商（ISP）分配给用户的动态IP地址，该地址是公共的，可以在公共互联网上访问。<br>与静态公网IP不同，动态公网IP是临时分配的，并且在一段时间后可能会更改。这意味着每次重新连接到互联网时，用户可能会被分配一个新的动态公网IP地址。</p>\n<p>动态公网IP通常用于个人用户或小型企业，因为它们相对便宜，而且不需要用户进行任何配置或管理。但是，由于其不稳定性和易变性，动态公网IP可能不适合需要稳定和持久的互联网连接的大型企业或组织。</p>\n<p>联通的adsl用户可以打10010 叫客服打开“动态公网IP” + 路由器桥接。（<a href=\"https://www.mi-d.cn/1590\">缘由：需要动态公网ip做监控或者访问服务</a>）</p>\n<p>开启动态公网IP+路由器桥接以后, 路由器上拨号即可得到一个公网IP.</p>\n<p>OpenWRT 路由器 设置端口映射， 即可将局域网内主机的端口 映射到公网IP的特定上。</p>\n<p>题外话（弯路）：（Padavan的系统，在端口映射是使用单独的工具（socat耗内存）来实现端口数据转发，OpenWrt的iptables更可靠，扎实稳定）</p>\n<p>下面以mac电脑，架设SRS服务器 来：分享流媒体至互联网。</p>\n<p>进度、历史记录与下一步计划</p>\n<ul>\n<li>20240705 开放公测一个月，截至日期20240805；请参见本文底部的‘开放公测’章节</li>\n</ul>\n<h1 id=\"1-安装SRS步骤\"><a href=\"#1-安装SRS步骤\" class=\"headerlink\" title=\"1. 安装SRS步骤\"></a>1. 安装SRS步骤</h1><p>(安装Docker.dmg后, 运行下面的指令)</p>\n<p>SRS文档：<a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">https:&#x2F;&#x2F;</a><a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">ossrs.net&#x2F;lts&#x2F;zh-cn&#x2F;docs&#x2F;v4&#x2F;doc&#x2F;getting-started</a><br>首先要先把安装好的Docker启动，屏幕右上角会出现鲸鱼背楼的图标，确保其正在运行。<br> Steps to run docker: </p>\n<ol>\n<li><p>cd &#x2F;Users&#x2F;abc&#x2F;WebstormProjects&#x2F;srs&#x2F;srs&#x2F;trunk </p>\n</li>\n<li><p>运行：  </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com/ossrs/srs:4 ./objs/srs -c conf/docker.conf </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\">    srs:</span><br><span class=\"line\">        stdin_open: true</span><br><span class=\"line\">        tty: true</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">            - 1935:1935</span><br><span class=\"line\">            - 1985:1985</span><br><span class=\"line\">            - 8113:8080</span><br><span class=\"line\">            - 8000:8000/udp</span><br><span class=\"line\">            - 10080:10080/udp</span><br><span class=\"line\">        image: registry.cn-hangzhou.aliyuncs.com/ossrs/srs:5</span><br></pre></td></tr></table></figure>\n\n\n\n\n</li>\n<li><p>推流（循环读取音视频文件，进行推送）</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -stream_loop -1 -i &#x27;./...&#x27; -c copy -f flv rtmp://localhost/live/livestream</span><br></pre></td></tr></table></figure>\n<p>备注：-stream_loop 中 -1 表示无限循环；0表示 不循环；适合于小文件</p>\n<h1 id=\"4-播放观看\"><a href=\"#4-播放观看\" class=\"headerlink\" title=\"4. 播放观看\"></a>4. 播放观看</h1><p><a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<h1 id=\"5-外网映射\"><a href=\"#5-外网映射\" class=\"headerlink\" title=\"5. 外网映射\"></a>5. 外网映射</h1><p>注意: 映射的时候不能使用8080端口, 建议使用60000以上的端口 (因isp防火墙已封锁这些特殊的端口)<br>建议使用frp，具体的配置方法可参考<a href=\"https://freefrp.net/docs\">https://freefrp.net/docs</a>，<br>或后续的相关文字 ，运行命令：.&#x2F;frpc -c frpc.ini </p>\n<h1 id=\"2-推流方案\"><a href=\"#2-推流方案\" class=\"headerlink\" title=\"2. 推流方案\"></a>2. 推流方案</h1><h2 id=\"使用obs推流\"><a href=\"#使用obs推流\" class=\"headerlink\" title=\"使用obs推流\"></a>使用obs推流</h2><p>下载并安装 obs-studio-29.0.2-macos-arm64.dmg</p>\n<p>Obs 打开后右下角的设置 &gt;直播 &gt;服务选择自定义服务器为rtmp:&#x2F;&#x2F;localhost&#x2F;live&#x2F;, 推流码为1(可以是任意数字和字母，可理解为房间号)<br> 添加内容（音频，视频）后，点击开始直播。</p>\n<p>———播放部分———</p>\n<p>最终得到的 播放地址为： <a href=\"http://localhost:60080/live/1.flv\">http://localhost:60080/live/1.flv</a><br>工具可选用VLC或者网页形式<a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<p>经验：</p>\n<p>使用ffmpeg3流远程m3u8媒体时，经常会容易断流或电脑休眠后会断流， 这时我们最好使用 obs 转播来源为window capture的方案。</p>\n<p>20230419 Update</p>\n<p>问题：那如果我仅仅需要修改镜像文件中的某个特定的html，我要怎么做? 如果您只需要修改镜像文件中的某个特定的 HTML 文件，可以通过以下步骤来实现： 1. 下载 SRS 镜像文件并创建容器。<br>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com&#x2F;ossrs&#x2F;srs:4</p>\n<h3 id=\"2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\"><a href=\"#2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\" class=\"headerlink\" title=\"2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。\"></a>2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。</h3><p>docker exec -it <CONTAINER_ID> &#x2F;bin&#x2F;bash<br>cd &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;</p>\n<h3 id=\"3-使用文本编辑器修改-HTML-文件。\"><a href=\"#3-使用文本编辑器修改-HTML-文件。\" class=\"headerlink\" title=\"3. 使用文本编辑器修改 HTML 文件。\"></a>3. 使用文本编辑器修改 HTML 文件。</h3><p>vi index.html<br>保存修改并退出容器。 </p>\n<h3 id=\"4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\"><a href=\"#4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\" class=\"headerlink\" title=\"4. 使用 docker commit 命令将修改后的容器保存为新的镜像。\"></a>4. 使用 docker commit 命令将修改后的容器保存为新的镜像。</h3><p>docker commit <CONTAINER_ID> <NEW_IMAGE_TAG></p>\n<h3 id=\"5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\"><a href=\"#5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\" class=\"headerlink\" title=\"5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。\"></a>5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。</h3><p>docker push <NEW_IMAGE_TAG></p>\n<h3 id=\"6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\"><a href=\"#6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\" class=\"headerlink\" title=\"6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。\"></a>6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。</h3><p>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <NEW_IMAGE_TAG> 需要注意的是，这种方式只适用于修改镜像中的某个特定的文件。如果您需要对 SRS 的配置文件或者其他文件进行修改，建议使用 Dockerfile 来自定义 SRS 镜像。 ————————————————————————  </p>\n<h2 id=\"使用vMix推流\"><a href=\"#使用vMix推流\" class=\"headerlink\" title=\"使用vMix推流\"></a>使用vMix推流</h2><p>vMix: Live Video Streaming Software</p>\n<p>vMix<br><a href=\"https://www.vmix.com/\">https://www.vmix.com</a><br>vMix is a live streaming and live production software video mixer and switcher for Windows. Easily Produce, Record and Live Stream professional looking …</p>\n<p>VS OBS, it sounds like vMix is better</p>\n<p>状态：待测试</p>\n<h1 id=\"错误及解决方案\"><a href=\"#错误及解决方案\" class=\"headerlink\" title=\"错误及解决方案\"></a>错误及解决方案</h1><p>问题：vi index.html. 提示错误：bash: vi: command not found。 我要怎么办？<br>如果在容器中执行 vi 命令时提示 command not found 错误，说明容器中没有安装 vi 编辑器。</p>\n<p>您可以尝试使用其他文本编辑器来修改 HTML 文件，例如 nano 或者 emacs。这些编辑器通常已经包含在大多数 Linux 发行版中，也可以通过 apt-get 命令进行安装。</p>\n<p>例如，您可以使用以下命令来安装 nano 编辑器：</p>\n<p>apt-get update &amp;&amp; apt-get install -y nano<br>然后，使用 nano 命令来编辑 HTML 文件：</p>\n<p>nano &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;index.html<br>编辑完毕后，使用 CTRL + X 快捷键保存修改并退出编辑器。</p>\n<hr>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://a:a@192.168.6.126:554</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"排查乐橙TP1Z摄像头rtsp流地址\"><a href=\"#排查乐橙TP1Z摄像头rtsp流地址\" class=\"headerlink\" title=\"排查乐橙TP1Z摄像头rtsp流地址\"></a>排查乐橙TP1Z摄像头rtsp流地址</h2><p>个人记录</p>\n<pre><code>rtmp 转化http\n    ffmpeg -re -i rtmp://192.168.6.116:1935/stream/test -c copy -f flv rtmp://192.168.6.116:1985/myapp/testv\n    \n6:30pm 可选：https://github.com/ZLMediaKit/ZLMediaKit\n》6:48am 跑不起来docker, 卡在：Attaching to rtmp-hls-rtmp-hls-1\n\n7:46pm&gt; continue: Docker image for video streaming server that supports RTMP, HLS, and DASH streams.\n\n8:13am send stream to\nffmpeg -i &quot;rtsp://a:a@192.168.6.126:554&quot; -f flv -r 25 -an rtmp://192.168.6.116:1935/live/test\n\n8:28am 网页播放失败；可以rtmp，但是无法网页player播放\n\nhttps://nas.carlzeng.top:3/webman/3rdparty/SurveillanceStation/\n\n8;56am\nadmin:admin@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1\n这个才是正确的串流地址！！！\n\n\nhttps://nas.carlzeng.top:3/webman/3rdparty/SurveillanceStation/\n\n9am \n10am&gt; 内网摄像头如何实现推流到公网，实现WEB播放\nSRS is a simple, high-efficiency, real-time video server supporting RTMP, WebRTC, HLS, HTTP-FLV, SRT, MPEG-DASH, and GB28181.\n\nold: SRS + OBS(heavy)\n10:15am 修复推流命令，优化：\nffmpeg -i &quot;rtsp://admin:a@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1&quot; -f flv -r 25 -an rtmp://192.168.6.116:1935/live/livestream\n\n重新适应SRS\nffmpeg -re -i &quot;rtsp://admin:a@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/livestream\n\n10:32am\n过程直播（无回放）查看步骤 \n1. 浏览器打开播放器 https://www.carlzeng.top/202312081128\n2. 播放URL中输入 http://op.carlzeng.top:18113/live/livestream.m3u8\n\n\n调试：http://192.168.6.116:8113/\n播放http://192.168.6.116:8113/players/srs_player.html?schema=http&amp;port=8113&amp;api=8113\n\n10:55am rtmp.html  works\nhttps://bilibili.github.io/flv.js/demo/\n    [TransmuxingController] &gt; IOException: type = Exception, code = -1, msg = Failed to fetch\n\n\n3:21pm 更改端口转发到新端口：18114\n\n&gt;3:41pm \n无法启动大华的544端口\n台式机无法使用 显示器\n</code></pre>\n<p>admin:<a href=\"mailto:&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#46;&#54;&#x2e;&#x31;&#50;&#54;\">&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#46;&#54;&#x2e;&#x31;&#50;&#54;</a>:554&#x2F;cam&#x2F;realmonitor?channel&#x3D;1&amp;subtype&#x3D;1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">% nc -vz 192.168.6.126 554                                                        </span><br><span class=\"line\">Connection to 192.168.6.126 port 554 [tcp/rtsp] succeeded!</span><br></pre></td></tr></table></figure>\n\n<p>没办法，只能硬件重置这个摄像头；无法连接rtsp了！</p>\n<p>长按摄像头背后的rest按钮15s；语音提示：</p>\n<ul>\n<li><p>重置摄像机成功</p>\n</li>\n<li><p>请开始无线配对</p>\n</li>\n</ul>\n<p>重置以后依然无效，无法连接到554端口</p>\n<p>原来TP1Z要打乐橙的客服电话： 大华400-672-8166; 子公司乐橙400-672-8169</p>\n<p>去流程</p>\n<p>rtsp:&#x2F;&#x2F;admin:<a href=\"mailto:&#97;&#x40;&#x31;&#x39;&#50;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x31;&#x32;&#54;\">&#97;&#x40;&#x31;&#x39;&#50;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x31;&#x32;&#54;</a>:554&#x2F;realmonitor?channel&#x3D;0&amp;subtype&#x3D;0</p>\n<p>默认的IP地址192.168.1.108 （连接IP但是需要插入网线！）</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">【华橙网络】实时监控码流Url 格式：</span><br><span class=\"line\">a、请求实时监控码流Rtsp流媒体服务时，应在Url 中指明请求的通道号、码流类型，如果需要认证信息，还有提供用户名和密码。Url 格式说明如下：rtsp://username:password@ip:port/cam/realmonitor?<span class=\"attr\">channel</span>=<span class=\"number\">1</span>&amp;subtype=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">b、其中:username: 用户名。例如admin。password: 密码。例如admin。ip: 为设备IP。例如 10.7.8.122。port: 端口号默认为554，若为默认可不填写。</span><br><span class=\"line\">channel: 通道号，起始为1。例如通道2，则为<span class=\"attr\">channel</span>=<span class=\"number\">2</span>。</span><br><span class=\"line\">subtype: 码流类型，主码流为0（即<span class=\"attr\">subtype</span>=<span class=\"number\">0</span>），辅码流为<span class=\"number\">1</span>（即subtype=<span class=\"number\">1</span>）。</span><br><span class=\"line\"></span><br><span class=\"line\">例如，请求某设备的通道2的辅码流，Url如下rtsp://admin:admin@10.12.4.84:554/cam/realmonitor?<span class=\"attr\">channel</span>=<span class=\"number\">2</span>&amp;subtype=<span class=\"number\">1</span> 确认相机网页设置，在设置-系统管理-系统服务-RTSP over TLS 选项是否开启，需关闭。 </span><br></pre></td></tr></table></figure>\n\n\n\n<p>打了半天电话：</p>\n<ol>\n<li>重置摄像头，重启摄像头</li>\n<li>升级乐橙APP到最新版8.0.1<ol>\n<li>这个APP不会动摄像头的固件</li>\n</ol>\n</li>\n<li>APP中删除摄像头重新添加</li>\n<li>最后修改了码流地址这些后1，1成功了：</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://admin:a@192.168.6.126:554/realmonitor?channel=1&amp;subtype=1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>刚好IPTV checker的docker中有这个ffmpeg推流工具。</p>\n<p>srs-srs-1， iptvchecker-website-1</p>\n<p>这个docker里面，由于无法访问到外部的‘局域网’而无法给局域网中的摄像头推流。</p>\n<p>运行到NAS中去了：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://admin:a@192.168.6.126:554/cam/realmonitor?channel=1&amp;</span><br><span class=\"line\">subtype=1&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/livestream                                         </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ffmpeg如何让它去后台运行？\"><a href=\"#ffmpeg如何让它去后台运行？\" class=\"headerlink\" title=\"ffmpeg如何让它去后台运行？\"></a>ffmpeg如何让它去后台运行？</h3><p>nohup 运行出错，使用下面的方法（nohup 加 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup ffmpeg -re -i &quot;rtsp://admin:d@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/livestream 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>用 kill -9 8286  这样的命令，杀死那些测试的进程，留下一个运行着的ffmpeg即可（已经nohup并且无输出了）</p>\n<h3 id=\"ffmpeg推流Error-opening-input-Server-returned-401-Unauthorized\"><a href=\"#ffmpeg推流Error-opening-input-Server-returned-401-Unauthorized\" class=\"headerlink\" title=\"ffmpeg推流Error opening input: Server returned 401 Unauthorized\"></a>ffmpeg推流Error opening input: Server returned 401 Unauthorized</h3><p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/11/668f5c0ad2ad9.png\" alt=\"image-20240711121401116\"></p>\n<p>这是一个输入端的错误，无法获取TP1Z的数据流，原因是授权失败；</p>\n<p>用VLC播放验证后确定问题点：用户名或密码错误</p>\n<p>解决：本地尝试推流成功，放到NAS中；下一步：设置为NAS开机自启动</p>\n<h2 id=\"回放取流url\"><a href=\"#回放取流url\" class=\"headerlink\" title=\"回放取流url\"></a>回放取流url</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://admin:d@172.22.0.26:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_07_04_11_50_00</span><br></pre></td></tr></table></figure>\n\n<p>说明：</p>\n<ul>\n<li>playback表示回放</li>\n<li>channel&#x3D;number表示通道号</li>\n<li>subtype&#x3D;0表示主码流</li>\n<li>starttime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放开始时间</li>\n<li>endtime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放结束时间</li>\n</ul>\n<blockquote>\n<p>20240705 实测有效，vlc播放成功。这是一个实用的功能</p>\n<p>可随时查看回放</p>\n</blockquote>\n<h1 id=\"SRS控制台\"><a href=\"#SRS控制台\" class=\"headerlink\" title=\"SRS控制台\"></a>SRS控制台</h1><p>本地局域网查阅控制台后端情况，需要注意这个“连接到您的SRS服务器”配置</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/04/6686268f6a682.png\" alt=\"image-20240704123522227\"></p>\n<p>推流上下点功夫，参数上调整，来提高远程查阅m3u8的速度？</p>\n<p>nohup ffmpeg -re -r 24 -b:v 2000k -bufsize 3000k -i  “rtsp:&#x2F;&#x2F;admin:<a href=\"mailto:&#x64;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#46;&#x36;&#46;&#49;&#50;&#54;\">&#x64;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#46;&#x36;&#46;&#49;&#50;&#54;</a>:554&#x2F;cam&#x2F;realmonitor?channel&#x3D;1&amp;subtype&#x3D;1” -c copy -f flv -y rtmp:&#x2F;&#x2F;192.168.6.116:1935&#x2F;live&#x2F;livestream 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</p>\n<p>其中，可以调整 -r、-b:v 和 -s 等参数来优化视频传输速率，从而缩短推流间隔。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">video bitrate (please use -b:v)) cannot be applied to input url</span><br><span class=\"line\">Option b:v (video bitrate (please use -b:v)) cannot be applied to input url rtsp://admin:d@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1 -- you are trying to apply an input option to an output file or vice versa. Move this option before the file it belongs to.</span><br><span class=\"line\">Error opening input files: Invalid argument</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[in#0/rtsp @ 0x12cf04220] Codec AVOption bufsize (set ratecontrol buffer size (in bits)) is not a decoding opti</span><br><span class=\"line\">on.</span><br></pre></td></tr></table></figure>\n\n<p>-r 25</p>\n<p>-s 640*480</p>\n<p>512x512<br>        600x240<br>        640x512<br>        1024x512 default<br>        hd720</p>\n<p>尝试了各种参数都失败了，</p>\n<h2 id=\"srs-如何使用udp进行传输？\"><a href=\"#srs-如何使用udp进行传输？\" class=\"headerlink\" title=\"srs 如何使用udp进行传输？\"></a>srs 如何使用udp进行传输？</h2><p>待优化</p>\n<p>注意到一个webrtc的低延迟播放方式：</p>\n<p>webrtc:&#x2F;&#x2F;192.168.6.116&#x2F;live&#x2F;livestream</p>\n<p><a href=\"http://192.168.6.116:8113/players/whep.html#\">http://192.168.6.116:8113/players/whep.html#</a></p>\n<p>Enter the WebRTC WHEP URL and click “Play” to start playing.</p>\n<p>不知具体故障点在那里，已开放1935，而未开放其他端口；添加开放：</p>\n<p>SRS Docker open 1985,8000,10080 on 20240705</p>\n<h2 id=\"CDN加速\"><a href=\"#CDN加速\" class=\"headerlink\" title=\"CDN加速\"></a>CDN加速</h2><p>一、基础配置</p>\n<ol>\n<li>设置Cloudflare的域名CNAME，从camc解析到blogcdn的特定指向。</li>\n<li>在blogcdn中，申请camc域名证书和新增网站，设置如下图所示</li>\n</ol>\n<p>二、搭配本地的OpenWrt设置：</p>\n<ol>\n<li>开放OpenWrt的18114指向服务器的8113端口</li>\n<li>然后原先的4443映射到NPM中的一条新纪录cam1（NPM把这个cam1变成https带端口方式，常规设置，可单独测试）</li>\n</ol>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/12/6690991768716.png\" alt=\"image-20240712104642468\"></p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/12/6690996c68be7.png\" alt=\"image-20240712104809021\"></p>\n<h1 id=\"开放公测\"><a href=\"#开放公测\" class=\"headerlink\" title=\"开放公测\"></a>开放公测</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://cam1.carlzeng.top:3/players/srs_player.html?schema=https&port=3&api=3&autostart=true\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<p>请留言或<a href=\"https://ask.carlzeng.top:4443/s/iDYnBV\">提交问卷</a>告知我体验情况（您的ISP，网速，连通情况画面是否卡顿），感谢</p>\n<iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://ask.carlzeng.top:4443/s/iDYnBV\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>动态公网IP（Dynamic Public IP）是指由互联网服务提供商（ISP）分配给用户的动态IP地址，该地址是公共的，可以在公共互联网上访问。<br>与静态公网IP不同，动态公网IP是临时分配的，并且在一段时间后可能会更改。这意味着每次重新连接到互联网时，用户可能会被分配一个新的动态公网IP地址。</p>\n<p>动态公网IP通常用于个人用户或小型企业，因为它们相对便宜，而且不需要用户进行任何配置或管理。但是，由于其不稳定性和易变性，动态公网IP可能不适合需要稳定和持久的互联网连接的大型企业或组织。</p>\n<p>联通的adsl用户可以打10010 叫客服打开“动态公网IP” + 路由器桥接。（<a href=\"https://www.mi-d.cn/1590\">缘由：需要动态公网ip做监控或者访问服务</a>）</p>\n<p>开启动态公网IP+路由器桥接以后, 路由器上拨号即可得到一个公网IP.</p>\n<p>OpenWRT 路由器 设置端口映射， 即可将局域网内主机的端口 映射到公网IP的特定上。</p>\n<p>题外话（弯路）：（Padavan的系统，在端口映射是使用单独的工具（socat耗内存）来实现端口数据转发，OpenWrt的iptables更可靠，扎实稳定）</p>\n<p>下面以mac电脑，架设SRS服务器 来：分享流媒体至互联网。</p>\n<p>进度、历史记录与下一步计划</p>\n<ul>\n<li>20240705 开放公测一个月，截至日期20240805；请参见本文底部的‘开放公测’章节</li>\n</ul>\n<h1 id=\"1-安装SRS步骤\"><a href=\"#1-安装SRS步骤\" class=\"headerlink\" title=\"1. 安装SRS步骤\"></a>1. 安装SRS步骤</h1><p>(安装Docker.dmg后, 运行下面的指令)</p>\n<p>SRS文档：<a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">https:&#x2F;&#x2F;</a><a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">ossrs.net&#x2F;lts&#x2F;zh-cn&#x2F;docs&#x2F;v4&#x2F;doc&#x2F;getting-started</a><br>首先要先把安装好的Docker启动，屏幕右上角会出现鲸鱼背楼的图标，确保其正在运行。<br> Steps to run docker: </p>\n<ol>\n<li><p>cd &#x2F;Users&#x2F;abc&#x2F;WebstormProjects&#x2F;srs&#x2F;srs&#x2F;trunk </p>\n</li>\n<li><p>运行：  </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com/ossrs/srs:4 ./objs/srs -c conf/docker.conf </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\">    srs:</span><br><span class=\"line\">        stdin_open: true</span><br><span class=\"line\">        tty: true</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">            - 1935:1935</span><br><span class=\"line\">            - 1985:1985</span><br><span class=\"line\">            - 8113:8080</span><br><span class=\"line\">            - 8000:8000/udp</span><br><span class=\"line\">            - 10080:10080/udp</span><br><span class=\"line\">        image: registry.cn-hangzhou.aliyuncs.com/ossrs/srs:5</span><br></pre></td></tr></table></figure>\n\n\n\n\n</li>\n<li><p>推流（循环读取音视频文件，进行推送）</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -stream_loop -1 -i &#x27;./...&#x27; -c copy -f flv rtmp://localhost/live/livestream</span><br></pre></td></tr></table></figure>\n<p>备注：-stream_loop 中 -1 表示无限循环；0表示 不循环；适合于小文件</p>\n<h1 id=\"4-播放观看\"><a href=\"#4-播放观看\" class=\"headerlink\" title=\"4. 播放观看\"></a>4. 播放观看</h1><p><a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<h1 id=\"5-外网映射\"><a href=\"#5-外网映射\" class=\"headerlink\" title=\"5. 外网映射\"></a>5. 外网映射</h1><p>注意: 映射的时候不能使用8080端口, 建议使用60000以上的端口 (因isp防火墙已封锁这些特殊的端口)<br>建议使用frp，具体的配置方法可参考<a href=\"https://freefrp.net/docs\">https://freefrp.net/docs</a>，<br>或后续的相关文字 ，运行命令：.&#x2F;frpc -c frpc.ini </p>\n<h1 id=\"2-推流方案\"><a href=\"#2-推流方案\" class=\"headerlink\" title=\"2. 推流方案\"></a>2. 推流方案</h1><h2 id=\"使用obs推流\"><a href=\"#使用obs推流\" class=\"headerlink\" title=\"使用obs推流\"></a>使用obs推流</h2><p>下载并安装 obs-studio-29.0.2-macos-arm64.dmg</p>\n<p>Obs 打开后右下角的设置 &gt;直播 &gt;服务选择自定义服务器为rtmp:&#x2F;&#x2F;localhost&#x2F;live&#x2F;, 推流码为1(可以是任意数字和字母，可理解为房间号)<br> 添加内容（音频，视频）后，点击开始直播。</p>\n<p>———播放部分———</p>\n<p>最终得到的 播放地址为： <a href=\"http://localhost:60080/live/1.flv\">http://localhost:60080/live/1.flv</a><br>工具可选用VLC或者网页形式<a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<p>经验：</p>\n<p>使用ffmpeg3流远程m3u8媒体时，经常会容易断流或电脑休眠后会断流， 这时我们最好使用 obs 转播来源为window capture的方案。</p>\n<p>20230419 Update</p>\n<p>问题：那如果我仅仅需要修改镜像文件中的某个特定的html，我要怎么做? 如果您只需要修改镜像文件中的某个特定的 HTML 文件，可以通过以下步骤来实现： 1. 下载 SRS 镜像文件并创建容器。<br>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com&#x2F;ossrs&#x2F;srs:4</p>\n<h3 id=\"2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\"><a href=\"#2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\" class=\"headerlink\" title=\"2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。\"></a>2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。</h3><p>docker exec -it <CONTAINER_ID> &#x2F;bin&#x2F;bash<br>cd &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;</p>\n<h3 id=\"3-使用文本编辑器修改-HTML-文件。\"><a href=\"#3-使用文本编辑器修改-HTML-文件。\" class=\"headerlink\" title=\"3. 使用文本编辑器修改 HTML 文件。\"></a>3. 使用文本编辑器修改 HTML 文件。</h3><p>vi index.html<br>保存修改并退出容器。 </p>\n<h3 id=\"4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\"><a href=\"#4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\" class=\"headerlink\" title=\"4. 使用 docker commit 命令将修改后的容器保存为新的镜像。\"></a>4. 使用 docker commit 命令将修改后的容器保存为新的镜像。</h3><p>docker commit <CONTAINER_ID> <NEW_IMAGE_TAG></p>\n<h3 id=\"5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\"><a href=\"#5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\" class=\"headerlink\" title=\"5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。\"></a>5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。</h3><p>docker push <NEW_IMAGE_TAG></p>\n<h3 id=\"6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\"><a href=\"#6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\" class=\"headerlink\" title=\"6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。\"></a>6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。</h3><p>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <NEW_IMAGE_TAG> 需要注意的是，这种方式只适用于修改镜像中的某个特定的文件。如果您需要对 SRS 的配置文件或者其他文件进行修改，建议使用 Dockerfile 来自定义 SRS 镜像。 ————————————————————————  </p>\n<h2 id=\"使用vMix推流\"><a href=\"#使用vMix推流\" class=\"headerlink\" title=\"使用vMix推流\"></a>使用vMix推流</h2><p>vMix: Live Video Streaming Software</p>\n<p>vMix<br><a href=\"https://www.vmix.com/\">https://www.vmix.com</a><br>vMix is a live streaming and live production software video mixer and switcher for Windows. Easily Produce, Record and Live Stream professional looking …</p>\n<p>VS OBS, it sounds like vMix is better</p>\n<p>状态：待测试</p>\n<h1 id=\"错误及解决方案\"><a href=\"#错误及解决方案\" class=\"headerlink\" title=\"错误及解决方案\"></a>错误及解决方案</h1><p>问题：vi index.html. 提示错误：bash: vi: command not found。 我要怎么办？<br>如果在容器中执行 vi 命令时提示 command not found 错误，说明容器中没有安装 vi 编辑器。</p>\n<p>您可以尝试使用其他文本编辑器来修改 HTML 文件，例如 nano 或者 emacs。这些编辑器通常已经包含在大多数 Linux 发行版中，也可以通过 apt-get 命令进行安装。</p>\n<p>例如，您可以使用以下命令来安装 nano 编辑器：</p>\n<p>apt-get update &amp;&amp; apt-get install -y nano<br>然后，使用 nano 命令来编辑 HTML 文件：</p>\n<p>nano &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;index.html<br>编辑完毕后，使用 CTRL + X 快捷键保存修改并退出编辑器。</p>\n<hr>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://a:a@192.168.6.126:554</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"排查乐橙TP1Z摄像头rtsp流地址\"><a href=\"#排查乐橙TP1Z摄像头rtsp流地址\" class=\"headerlink\" title=\"排查乐橙TP1Z摄像头rtsp流地址\"></a>排查乐橙TP1Z摄像头rtsp流地址</h2><p>个人记录</p>\n<pre><code>rtmp 转化http\n    ffmpeg -re -i rtmp://192.168.6.116:1935/stream/test -c copy -f flv rtmp://192.168.6.116:1985/myapp/testv\n    \n6:30pm 可选：https://github.com/ZLMediaKit/ZLMediaKit\n》6:48am 跑不起来docker, 卡在：Attaching to rtmp-hls-rtmp-hls-1\n\n7:46pm&gt; continue: Docker image for video streaming server that supports RTMP, HLS, and DASH streams.\n\n8:13am send stream to\nffmpeg -i &quot;rtsp://a:a@192.168.6.126:554&quot; -f flv -r 25 -an rtmp://192.168.6.116:1935/live/test\n\n8:28am 网页播放失败；可以rtmp，但是无法网页player播放\n\nhttps://nas.carlzeng.top:3/webman/3rdparty/SurveillanceStation/\n\n8;56am\nadmin:admin@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1\n这个才是正确的串流地址！！！\n\n\nhttps://nas.carlzeng.top:3/webman/3rdparty/SurveillanceStation/\n\n9am \n10am&gt; 内网摄像头如何实现推流到公网，实现WEB播放\nSRS is a simple, high-efficiency, real-time video server supporting RTMP, WebRTC, HLS, HTTP-FLV, SRT, MPEG-DASH, and GB28181.\n\nold: SRS + OBS(heavy)\n10:15am 修复推流命令，优化：\nffmpeg -i &quot;rtsp://admin:a@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1&quot; -f flv -r 25 -an rtmp://192.168.6.116:1935/live/livestream\n\n重新适应SRS\nffmpeg -re -i &quot;rtsp://admin:a@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/livestream\n\n10:32am\n过程直播（无回放）查看步骤 \n1. 浏览器打开播放器 https://www.carlzeng.top/202312081128\n2. 播放URL中输入 http://op.carlzeng.top:18113/live/livestream.m3u8\n\n\n调试：http://192.168.6.116:8113/\n播放http://192.168.6.116:8113/players/srs_player.html?schema=http&amp;port=8113&amp;api=8113\n\n10:55am rtmp.html  works\nhttps://bilibili.github.io/flv.js/demo/\n    [TransmuxingController] &gt; IOException: type = Exception, code = -1, msg = Failed to fetch\n\n\n3:21pm 更改端口转发到新端口：18114\n\n&gt;3:41pm \n无法启动大华的544端口\n台式机无法使用 显示器\n</code></pre>\n<p>admin:<a href=\"mailto:&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#46;&#54;&#x2e;&#x31;&#50;&#54;\">&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#46;&#54;&#x2e;&#x31;&#50;&#54;</a>:554&#x2F;cam&#x2F;realmonitor?channel&#x3D;1&amp;subtype&#x3D;1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">% nc -vz 192.168.6.126 554                                                        </span><br><span class=\"line\">Connection to 192.168.6.126 port 554 [tcp/rtsp] succeeded!</span><br></pre></td></tr></table></figure>\n\n<p>没办法，只能硬件重置这个摄像头；无法连接rtsp了！</p>\n<p>长按摄像头背后的rest按钮15s；语音提示：</p>\n<ul>\n<li><p>重置摄像机成功</p>\n</li>\n<li><p>请开始无线配对</p>\n</li>\n</ul>\n<p>重置以后依然无效，无法连接到554端口</p>\n<p>原来TP1Z要打乐橙的客服电话： 大华400-672-8166; 子公司乐橙400-672-8169</p>\n<p>去流程</p>\n<p>rtsp:&#x2F;&#x2F;admin:<a href=\"mailto:&#97;&#x40;&#x31;&#x39;&#50;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x31;&#x32;&#54;\">&#97;&#x40;&#x31;&#x39;&#50;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x31;&#x32;&#54;</a>:554&#x2F;realmonitor?channel&#x3D;0&amp;subtype&#x3D;0</p>\n<p>默认的IP地址192.168.1.108 （连接IP但是需要插入网线！）</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">【华橙网络】实时监控码流Url 格式：</span><br><span class=\"line\">a、请求实时监控码流Rtsp流媒体服务时，应在Url 中指明请求的通道号、码流类型，如果需要认证信息，还有提供用户名和密码。Url 格式说明如下：rtsp://username:password@ip:port/cam/realmonitor?<span class=\"attr\">channel</span>=<span class=\"number\">1</span>&amp;subtype=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">b、其中:username: 用户名。例如admin。password: 密码。例如admin。ip: 为设备IP。例如 10.7.8.122。port: 端口号默认为554，若为默认可不填写。</span><br><span class=\"line\">channel: 通道号，起始为1。例如通道2，则为<span class=\"attr\">channel</span>=<span class=\"number\">2</span>。</span><br><span class=\"line\">subtype: 码流类型，主码流为0（即<span class=\"attr\">subtype</span>=<span class=\"number\">0</span>），辅码流为<span class=\"number\">1</span>（即subtype=<span class=\"number\">1</span>）。</span><br><span class=\"line\"></span><br><span class=\"line\">例如，请求某设备的通道2的辅码流，Url如下rtsp://admin:admin@10.12.4.84:554/cam/realmonitor?<span class=\"attr\">channel</span>=<span class=\"number\">2</span>&amp;subtype=<span class=\"number\">1</span> 确认相机网页设置，在设置-系统管理-系统服务-RTSP over TLS 选项是否开启，需关闭。 </span><br></pre></td></tr></table></figure>\n\n\n\n<p>打了半天电话：</p>\n<ol>\n<li>重置摄像头，重启摄像头</li>\n<li>升级乐橙APP到最新版8.0.1<ol>\n<li>这个APP不会动摄像头的固件</li>\n</ol>\n</li>\n<li>APP中删除摄像头重新添加</li>\n<li>最后修改了码流地址这些后1，1成功了：</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://admin:a@192.168.6.126:554/realmonitor?channel=1&amp;subtype=1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>刚好IPTV checker的docker中有这个ffmpeg推流工具。</p>\n<p>srs-srs-1， iptvchecker-website-1</p>\n<p>这个docker里面，由于无法访问到外部的‘局域网’而无法给局域网中的摄像头推流。</p>\n<p>运行到NAS中去了：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://admin:a@192.168.6.126:554/cam/realmonitor?channel=1&amp;</span><br><span class=\"line\">subtype=1&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/livestream                                         </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ffmpeg如何让它去后台运行？\"><a href=\"#ffmpeg如何让它去后台运行？\" class=\"headerlink\" title=\"ffmpeg如何让它去后台运行？\"></a>ffmpeg如何让它去后台运行？</h3><p>nohup 运行出错，使用下面的方法（nohup 加 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup ffmpeg -re -i &quot;rtsp://admin:d@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/livestream 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>用 kill -9 8286  这样的命令，杀死那些测试的进程，留下一个运行着的ffmpeg即可（已经nohup并且无输出了）</p>\n<h3 id=\"ffmpeg推流Error-opening-input-Server-returned-401-Unauthorized\"><a href=\"#ffmpeg推流Error-opening-input-Server-returned-401-Unauthorized\" class=\"headerlink\" title=\"ffmpeg推流Error opening input: Server returned 401 Unauthorized\"></a>ffmpeg推流Error opening input: Server returned 401 Unauthorized</h3><p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/11/668f5c0ad2ad9.png\" alt=\"image-20240711121401116\"></p>\n<p>这是一个输入端的错误，无法获取TP1Z的数据流，原因是授权失败；</p>\n<p>用VLC播放验证后确定问题点：用户名或密码错误</p>\n<p>解决：本地尝试推流成功，放到NAS中；下一步：设置为NAS开机自启动</p>\n<h2 id=\"回放取流url\"><a href=\"#回放取流url\" class=\"headerlink\" title=\"回放取流url\"></a>回放取流url</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://admin:d@172.22.0.26:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_07_04_11_50_00</span><br></pre></td></tr></table></figure>\n\n<p>说明：</p>\n<ul>\n<li>playback表示回放</li>\n<li>channel&#x3D;number表示通道号</li>\n<li>subtype&#x3D;0表示主码流</li>\n<li>starttime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放开始时间</li>\n<li>endtime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放结束时间</li>\n</ul>\n<blockquote>\n<p>20240705 实测有效，vlc播放成功。这是一个实用的功能</p>\n<p>可随时查看回放</p>\n</blockquote>\n<h1 id=\"SRS控制台\"><a href=\"#SRS控制台\" class=\"headerlink\" title=\"SRS控制台\"></a>SRS控制台</h1><p>本地局域网查阅控制台后端情况，需要注意这个“连接到您的SRS服务器”配置</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/04/6686268f6a682.png\" alt=\"image-20240704123522227\"></p>\n<p>推流上下点功夫，参数上调整，来提高远程查阅m3u8的速度？</p>\n<p>nohup ffmpeg -re -r 24 -b:v 2000k -bufsize 3000k -i  “rtsp:&#x2F;&#x2F;admin:<a href=\"mailto:&#x64;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#46;&#x36;&#46;&#49;&#50;&#54;\">&#x64;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#46;&#x36;&#46;&#49;&#50;&#54;</a>:554&#x2F;cam&#x2F;realmonitor?channel&#x3D;1&amp;subtype&#x3D;1” -c copy -f flv -y rtmp:&#x2F;&#x2F;192.168.6.116:1935&#x2F;live&#x2F;livestream 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</p>\n<p>其中，可以调整 -r、-b:v 和 -s 等参数来优化视频传输速率，从而缩短推流间隔。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">video bitrate (please use -b:v)) cannot be applied to input url</span><br><span class=\"line\">Option b:v (video bitrate (please use -b:v)) cannot be applied to input url rtsp://admin:d@192.168.6.126:554/cam/realmonitor?channel=1&amp;subtype=1 -- you are trying to apply an input option to an output file or vice versa. Move this option before the file it belongs to.</span><br><span class=\"line\">Error opening input files: Invalid argument</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[in#0/rtsp @ 0x12cf04220] Codec AVOption bufsize (set ratecontrol buffer size (in bits)) is not a decoding opti</span><br><span class=\"line\">on.</span><br></pre></td></tr></table></figure>\n\n<p>-r 25</p>\n<p>-s 640*480</p>\n<p>512x512<br>        600x240<br>        640x512<br>        1024x512 default<br>        hd720</p>\n<p>尝试了各种参数都失败了，</p>\n<h2 id=\"srs-如何使用udp进行传输？\"><a href=\"#srs-如何使用udp进行传输？\" class=\"headerlink\" title=\"srs 如何使用udp进行传输？\"></a>srs 如何使用udp进行传输？</h2><p>待优化</p>\n<p>注意到一个webrtc的低延迟播放方式：</p>\n<p>webrtc:&#x2F;&#x2F;192.168.6.116&#x2F;live&#x2F;livestream</p>\n<p><a href=\"http://192.168.6.116:8113/players/whep.html#\">http://192.168.6.116:8113/players/whep.html#</a></p>\n<p>Enter the WebRTC WHEP URL and click “Play” to start playing.</p>\n<p>不知具体故障点在那里，已开放1935，而未开放其他端口；添加开放：</p>\n<p>SRS Docker open 1985,8000,10080 on 20240705</p>\n<h2 id=\"CDN加速\"><a href=\"#CDN加速\" class=\"headerlink\" title=\"CDN加速\"></a>CDN加速</h2><p>一、基础配置</p>\n<ol>\n<li>设置Cloudflare的域名CNAME，从camc解析到blogcdn的特定指向。</li>\n<li>在blogcdn中，申请camc域名证书和新增网站，设置如下图所示</li>\n</ol>\n<p>二、搭配本地的OpenWrt设置：</p>\n<ol>\n<li>开放OpenWrt的18114指向服务器的8113端口</li>\n<li>然后原先的4443映射到NPM中的一条新纪录cam1（NPM把这个cam1变成https带端口方式，常规设置，可单独测试）</li>\n</ol>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/12/6690991768716.png\" alt=\"image-20240712104642468\"></p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/12/6690996c68be7.png\" alt=\"image-20240712104809021\"></p>\n<h1 id=\"开放公测\"><a href=\"#开放公测\" class=\"headerlink\" title=\"开放公测\"></a>开放公测</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://cam1.carlzeng.top:3/players/srs_player.html?schema=https&port=3&api=3&autostart=true\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<p>请留言或<a href=\"https://ask.carlzeng.top:4443/s/iDYnBV\">提交问卷</a>告知我体验情况（您的ISP，网速，连通情况画面是否卡顿），感谢</p>\n<iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://ask.carlzeng.top:4443/s/iDYnBV\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n","categories":[{"name":"宽带","path":"api/categories/宽带.json"}],"tags":[{"name":"动态公网IP","path":"api/tags/动态公网IP.json"},{"name":"SRS","path":"api/tags/SRS.json"},{"name":"Obs","path":"api/tags/Obs.json"},{"name":"vMix","path":"api/tags/vMix.json"}]}