{"title":"tor，网，络-CarlZeng","slug":"tor，网，络-CarlZeng","date":"2023-03-05T11:04:00.000Z","updated":"2025-05-23T08:26:30.722Z","comments":true,"path":"api/articles/tor，网，络-CarlZeng.json","excerpt":"如何从Tor Network里面提取使用Socks5代理呢？How to use the socks5 proxy in Tor Network?","covers":null,"content":"<p>如何从Tor Network里面提取使用Socks5代理呢？How to use the socks5 proxy in Tor Network?</p>\n<span id=\"more\"></span>\n\n<h1 id=\"方法-1：Tor-Browser\"><a href=\"#方法-1：Tor-Browser\" class=\"headerlink\" title=\"方法 #1：Tor Browser\"></a>方法 #1：Tor Browser</h1><p>最简单直接的办法就是在电脑或手机中使用Tor Browser浏览器，这样可以直接使用到符合设计初衷的匿名浏览（同时也意味着*墙）。</p>\n<p>手机APP版指导手册：MOBILE TOR <a href=\"https://tb-manual.torproject.org/mobile-tor/#circumvention\">https://tb-manual.torproject.org/mobile-tor/#circumvention</a></p>\n<p>手机端设置要点：下载后打开Tor Browser，</p>\n<p>设置(右上角的齿轮图标) 》</p>\n<p>配置网桥（在Tor网络的页面最下方的扳手图标）》</p>\n<p>选中<strong>snowflake</strong> 并开启‘使用网桥’（2023年3月暂时可用）</p>\n<p>点击 “连接” 按钮，并等待3-5分钟，等待页面出现：“私密浏览”，在页面最下方即可输入网址。</p>\n<p>各种系统的电脑和手机版：<a href=\"https://www.torproject.org/zh-CN/download/\">下载 Tor 浏览器</a> </p>\n<p>以下步骤可以查看到Tor Browser中拓展出来的Socks5代理地址，从而用来配置在除了浏览器以外的应用程序中，来实现VPN的效果。</p>\n<ol>\n<li><p>打开Tor Browser，并等待其成功连接上Tor网络（这样就已实现匿名浏览的效果）</p>\n</li>\n<li><p>打开Tor Browser的设置首选项》连接，或者直接输入地址（并且回车）：about:preferences#connection</p>\n</li>\n<li><p>你需要在连接中选择 snowflake网桥（snowflake bridge）2023年3月，目前这种方式在天朝还是可以正在运作的（能撑多久，未知）</p>\n</li>\n<li><p>你需要找到一个合适的网桥，并连接成功。（需要耐心）</p>\n</li>\n<li><p>在该页面的最底部，找到‘高级选项’》查看Tor日志，页面会弹出一个新的小窗口，里面的日志信息如下（正常成功连接的时候）</p>\n</li>\n<li><ol>\n<li>2023-03-02 15:15:55.247 [NOTICE] New control connection opened from 127.0.0.1.<br>2023-03-02 15:15:55.248 [NOTICE] New control connection opened from 127.0.0.1.<br>2023-03-02 15:15:55.249 [NOTICE] DisableNetwork is set. Tor will not make or accept non-control network connections. Shutting down all existing connections.<br>2023-03-02 15:15:55.252 [NOTICE] Opening Socks listener on 127.0.0.1:9150<br>2023-03-02 15:15:55.252 [NOTICE] Opened Socks listener connection (ready) on 127.0.0.1:9150<br>2023-03-02 15:15:55.252 [WARN] Cannot find maximum file descriptor, assuming: 256<br>2023-03-02 15:15:56.265 [NOTICE] Bootstrapped 1% (conn_pt): Connecting to pluggable transport<br>2023-03-02 15:15:56.265 [NOTICE] Bootstrapped 2% (conn_done_pt): Connected to pluggable transport<br>2023-03-02 15:15:56.267 [NOTICE] Bootstrapped 10% (conn_done): Connected to a relay</li>\n</ol>\n</li>\n<li><p>注意观察这个日志中的 Opening Socks listener on 127.0.0.1:9150；这个就是我们要找的Socks5代理地址。</p>\n</li>\n</ol>\n<p> 如果您无法使用已知的链接来打开下载Tor Browser的话，请发挥您的想象力（施展判断力），比如用搜索引擎搜索一下关键字，条条大路通罗马。</p>\n<h1 id=\"方法-2-不保证-：Clash\"><a href=\"#方法-2-不保证-：Clash\" class=\"headerlink\" title=\"方法 #2(不保证)：Clash\"></a>方法 #2(不保证)：Clash</h1><p>1. 手机端，可以使用手机APP： Clash</p>\n<p>下载：<a href=\"https://github.com/Kr328/ClashForAndroid/releases\">https://github.com/Kr328/ClashForAndroid/releases</a><br> 参考文章：<a href=\"https://clashforandroid.org/clash-for-android-download/\">最新版 Clash</a> <a href=\"https://clashforandroid.org/clash-for-android-download/\">for</a> <a href=\"https://clashforandroid.org/clash-for-android-download/\">Android 下载</a></p>\n<p>配置：仅供朋友测试，v我索取</p>\n<p>2. 如果是Mac电脑端可以使用：ClashX</p>\n<p>3. 如果是Windows电脑端可以使用：Clash for Windows</p>\n<p>下载：<a href=\"https://github.com/yichengchen/clashX/releases\">https://github.com/yichengchen/clashX/releases</a><br>参考文章：<a href=\"https://clashx.org/clashx-download/\">最新版 ClashX 下载</a></p>\n<p>配置：仅供朋友测试，v我索取</p>\n<h1 id=\"方法-3-advance-：运行-tor\"><a href=\"#方法-3-advance-：运行-tor\" class=\"headerlink\" title=\"方法 #3(advance)：运行 tor\"></a>方法 #3(advance)：运行 tor</h1><p>这个方法需要更专业的计算机知识，以下已Mac OSX来举例，简单描述如下（当然首先得先有梯子*墙才能实现）：</p>\n<p>1.  下载mac.zip</p>\n<p>　　我把它改名为：OnionVPNWithSpeedControl_mac.zip，解压缩后里面有我们需要用到的工具</p>\n<p>　　<a href=\"https://github.com/lunu-bounir/onion-vpn\">https://github.com/lunu-bounir/onion-vpn</a></p>\n<p>　　OnionVPNWithSpeedControl_mac.zip is came from above git of name onion-vpn</p>\n<p>　　这步有点奇葩，因为从Tor官方下载的最新版expert bunlde 中的 tor 是无法使用的，一运行就退出了，原因未知。已测试：tor-expert-bundle-12.0.3-macos-aarch64.tar.gz，非常尴尬：tor-expert-bundle-12.0.3-macos-aarch64 里面的tor是不能用的。。。</p>\n<p>2. 安装go语言环境</p>\n<p>　　具体步骤不详细描述了，<a href=\"https://go.dev/dl/\">https://go.dev/dl/</a> 写得非常详细，十分友好。</p>\n<p>3. 下载并编译<a href=\"https://github.com/keroserene/snowflake.git\">https://github.com/keroserene/snowflake.git</a></p>\n<p>　　git clone打开新的Terminal，切换到client目录下，执行</p>\n<p>go get<br>go build</p>\n<p>注意：默认状况下在天朝go get会卡死（我就是遇到这种情况了）报错误：dial tcp 142.251.42.241:443: i&#x2F;o timeout<br>这时需要先执行go env -w GOPROXY&#x3D;<a href=\"https://goproxy.cn/\">https://goproxy.cn</a><br>解决方案来源：<a href=\"https://blog.csdn.net/weixin_45178126/article/details/122097221\">golang 在下载依赖包的时候出现错误：dial tcp 142.251.42.241:443: i&#x2F;o timeout</a></p>\n<p>　　最后会在client目录下生成一个client的Unix可执行文件。</p>\n<p>【可选步骤】4. 自定配置torrc文件，加入已知特定的snowflake bridge</p>\n<p>　　在client目录下有一个默认的torrc文件，这个就是tor运行起来后，我们希望其遵循的配置文件，里面有默认的snowflake bridge</p>\n<p>5. 运行tor</p>\n<p>　　具体命令参考 […client % &#x2F;Users&#x2F;carl&#x2F;Downloads&#x2F;OnionVPNWithSpeedControl_mac&#x2F;assets&#x2F;tor -f torrc</p>\n<p>　　类似的日志参考如下：</p>\n<p>Mar 03 09:36:49.721 [notice] Tor 0.4.4.6 (git-2a8b789ea6f308d0) running on Darwin with Libevent 2.1.11-stable, OpenSSL 1.1.1i, Zlib 1.2.11, Liblzma N&#x2F;A, and Libzstd N&#x2F;A.<br>Mar 03 09:36:49.721 [notice] Tor can’t help you if you use it wrong! Learn how to be safe at <a href=\"https://www.torproject.org/download/download#warning\">https://www.torproject.org/download/download#warning</a><br>Mar 03 09:36:49.722 [notice] Read configuration file “&#x2F;Users&#x2F;carlzeng&#x2F;WebstormProjects&#x2F;snowflake&#x2F;client&#x2F;torrc”.<br>Mar 03 09:36:49.723 [warn] Path for DataDirectory (datadir) is relative and will resolve to &#x2F;Users&#x2F;carl&#x2F;WebstormProjects&#x2F;snowflake&#x2F;client&#x2F;datadir. Is this what you wanted?<br>Mar 03 09:36:49.724 [notice] Opening Socks listener on 127.0.0.1:0<br>Mar 03 09:36:49.724 [notice] Socks listener listening on port 62501.<br>Mar 03 09:36:49.724 [notice] Opened Socks listener on 127.0.0.1:62501<br>Mar 03 09:36:49.000 [warn] Cannot find maximum file descriptor, assuming: 256<br>Mar 03 09:36:49.000 [notice] Bootstrapped 0% (starting): Starting<br>Mar 03 09:36:49.000 [notice] Starting with guard context “bridges”<br>Mar 03 09:36:49.000 [notice] Delaying directory fetches: No running bridges<br>Mar 03 09:36:50.000 [notice] Bootstrapped 1% (conn_pt): Connecting to pluggable transport<br>Mar 03 09:36:50.000 [notice] Bootstrapped 2% (conn_done_pt): Connected to pluggable transport<br>Mar 03 09:36:50.000 [notice] Bootstrapped 10% (conn_done): Connected to a relay<br>Mar 03 09:36:56.000 [notice] Managed proxy “.&#x2F;client”: offer created<br>。。。。<br>Mar 03 09:41:57.000 [notice] Bootstrapped 100% (done): Done  </p>\n<p>　　慢慢等待1-5分钟，一直等到 Mar 03 09:41:57.000 [notice] Bootstrapped 100% (done): Done</p>\n<p>6. 配置应用程序，连接到Socks 127.0.0.1:62501 即可（根据具体的日志信息）</p>\n<p>【可选步骤】7. 检测连接状态：<a href=\"https://check.torproject.org/\">https://check.torproject.org/</a></p>\n<p>祝各位：女神节快乐！～</p>\n<h1 id=\"Run-a-Tor-Relay-in-Docker运行Tor中继节点\"><a href=\"#Run-a-Tor-Relay-in-Docker运行Tor中继节点\" class=\"headerlink\" title=\"Run a Tor Relay in Docker运行Tor中继节点\"></a>Run a Tor Relay in Docker运行Tor中继节点</h1><ol>\n<li><p>创建和启动docker-compose</p>\n<p><a href=\"https://gitlab.torproject.org/torproject/anti-censorship/docker-obfs4-bridge/raw/main/docker-compose.yml\">https://gitlab.torproject.org/torproject/anti-censorship/docker-obfs4-bridge/raw/main/docker-compose.yml</a></p>\n<p><a href=\"https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/raw/main/.env\">https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/raw/main/.env</a></p>\n</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This file assists operators in (re-)deploying an obfs4 bridge Docker</span></span><br><span class=\"line\"><span class=\"comment\"># container.  You need the tool &#x27;docker-compose&#x27; to use this file.  You</span></span><br><span class=\"line\"><span class=\"comment\"># can find it in the Debian package &#x27;docker-compose&#x27;.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># First, you need to create a configuration file, &quot;.env&quot;, in the same directory</span></span><br><span class=\"line\"><span class=\"comment\"># as this file, &quot;docker-compose.yml&quot;.  Add the following environment variables</span></span><br><span class=\"line\"><span class=\"comment\"># to this configuration file.  EMAIL is your email address; OR_PORT is your</span></span><br><span class=\"line\"><span class=\"comment\"># onion routing port; and PT_PORT is your obfs4 port:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   EMAIL=you@example.com</span></span><br><span class=\"line\"><span class=\"comment\">#   OR_PORT=XXX</span></span><br><span class=\"line\"><span class=\"comment\">#   PT_PORT=XXX</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># If needed, you can also activate there an additional variables processing with:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   OBFS4_ENABLE_ADDITIONAL_VARIABLES=1</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># followed by defining desired torrc entries prefixed with OBFS4V_</span></span><br><span class=\"line\"><span class=\"comment\"># For example:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   OBFS4V_AddressDisableIPv6=1</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Next, pull the Docker image, by running:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   docker-compose pull obfs4-bridge</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># And finally, to (re-)deploy the container, run:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   docker-compose up -d obfs4-bridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.4&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">obfs4-bridge:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">thetorproject/obfs4-bridge:latest</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">obfs4_bridge_external_network</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if OR_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">OR_PORT=$&#123;OR_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">OR_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if PT_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PT_PORT=$&#123;PT_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">PT_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if EMAIL is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">EMAIL=$&#123;EMAIL:?Env</span> <span class=\"string\">var</span> <span class=\"string\">EMAIL</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Nickname with default value: &quot;DockerObfs4Bridge&quot;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NICKNAME=$&#123;NICKNAME:-DockerObfs4Bridge&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">env_file:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">.env</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data:/var/lib/tor</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;OR_PORT&#125;:$&#123;OR_PORT&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;PT_PORT&#125;:$&#123;PT_PORT&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">unless-stopped</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">tor-datadir-$&#123;OR_PORT&#125;-$&#123;PT_PORT&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">obfs4_bridge_external_network:</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Set required variables</span><br><span class=\"line\">OR_PORT=9099</span><br><span class=\"line\">PT_PORT=9050</span><br><span class=\"line\">EMAIL=ame@apple.com</span><br><span class=\"line\"># If you want, you could change the nickname of your bridge</span><br><span class=\"line\">#NICKNAME=DockerObfs4Bridge</span><br><span class=\"line\"># If needed, activate additional variables processing</span><br><span class=\"line\">#OBFS4_ENABLE_ADDITIONAL_VARIABLES=1</span><br><span class=\"line\"># and define desired torrc entries prefixed with OBFS4V_</span><br><span class=\"line\"># For example:</span><br><span class=\"line\">#OBFS4V_AddressDisableIPv6=1</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up</span><br><span class=\"line\">WARN[0000] /root/obfs4-bridge/docker-compose.yaml: `version` is obsolete </span><br><span class=\"line\">[+] Running 15/15</span><br><span class=\"line\"> ✔ obfs4-bridge Pulled                                                                      39.3s </span><br><span class=\"line\">   ✔ 04857b38bc21 Pull complete                                                              5.2s </span><br><span class=\"line\">   ✔ e5bfec8939cb Pull complete                                                              1.6s </span><br><span class=\"line\">   ✔ 5f68de6710c4 Pull complete                                                              1.8s </span><br><span class=\"line\">   ✔ b60093912f91 Pull complete                                                              3.2s </span><br><span class=\"line\">   ✔ ab018a71dd54 Pull complete                                                              5.0s </span><br><span class=\"line\">   ✔ 3b96c9cd7341 Pull complete                                                              7.1s </span><br><span class=\"line\">   ✔ 399de59d9384 Pull complete                                                              9.4s </span><br><span class=\"line\">   ✔ 1fd06b5f7332 Pull complete                                                              6.8s </span><br><span class=\"line\">   ✔ 9632961b9f45 Pull complete                                                              9.2s </span><br><span class=\"line\">   ✔ 8887d261ae57 Pull complete                                                              8.7s </span><br><span class=\"line\">   ✔ 702c64636d8d Pull complete                                                             10.3s </span><br><span class=\"line\">   ✔ 0c8449df639a Pull complete                                                             10.7s </span><br><span class=\"line\">   ✔ 5f1156e46d38 Pull complete                                                             11.3s </span><br><span class=\"line\">   ✔ dbc5b9df9780 Pull complete                                                             12.0s </span><br><span class=\"line\">[+] Running 2/1</span><br><span class=\"line\"> ✔ Network obfs4-bridge_obfs4_bridge_external_network  Created                               0.1s </span><br><span class=\"line\"> ✔ Volume &quot;tor-datadir-9099-9050&quot;                      C...                                  0.0s </span><br><span class=\"line\"> ⠋ Container obfs4-bridge-obfs4-bridge-1               Created                               0.0s </span><br><span class=\"line\">Attaching to obfs4-bridge-1</span><br><span class=\"line\">obfs4-bridge-1  | Using NICKNAME=DockerObfs4Bridge, OR_PORT=9099, PT_PORT=9050, and EMAIL=ame@apple.com.</span><br><span class=\"line\">obfs4-bridge-1  | Starting tor.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.842 [notice] Tor 0.4.8.14 running on Linux with Libevent 2.1.12-stable, OpenSSL 3.0.15, Zlib 1.2.13, Liblzma 5.4.1, Libzstd 1.5.4 and Glibc 2.36 as libc.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.842 [notice] Tor can&#x27;t help you if you use it wrong! Learn how to be safe at https://support.torproject.org/faq/staying-anonymous/</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.842 [notice] Read configuration file &quot;/etc/tor/torrc&quot;.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Based on detected system memory, MaxMemInQueues is set to 6296 MB. You can override this by setting MaxMemInQueues by hand.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opening OR listener on 0.0.0.0:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opened OR listener connection (ready) on 0.0.0.0:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opening OR listener on [::]:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opened OR listener connection (ready) on [::]:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opening Extended OR listener on 127.0.0.1:0</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Extended OR listener listening on port 44627.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opened Extended OR listener connection (ready) on 127.0.0.1:44627</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.000 [notice] Parsing GEOIP IPv4 file /usr/share/tor/geoip.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.000 [notice] Parsing GEOIP IPv6 file /usr/share/tor/geoip6.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Configured to measure statistics. Look for the *-stats files that will first be written to the data directory in 24 hours from now.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] You are running a new relay. Thanks for helping the Tor network! If you wish to know what will happen in the upcoming weeks regarding its usage, have a look at https://blog.torproject.org/lifecycle-of-a-new-relay</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] It looks like I need to generate and sign a new medium-term signing key, because I don&#x27;t have one. To do that, I need to load (or create) the permanent master identity key. If the master identity key was not moved or encrypted with a passphrase, this will be done automatically and no further action is required. Otherwise, provide the necessary data using &#x27;tor --keygen&#x27; to do it manually.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Your Tor server&#x27;s identity key fingerprint is &#x27;DockerObfs4Bridge F22790FB5078D507920743B6D6&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Your Tor bridge&#x27;s hashed identity key fingerprint is &#x27;DockerObfs4Bridge 811EBA87EE1ACE2893140B5AC&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Your Tor server&#x27;s identity key ed25519 fingerprint is &#x27;DockerObfs4Bridge YlsH1QKdRNwX70+dDrHQHBoUDDWRMo&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] You can check the status of your bridge relay at https://bridges.torproject.org/status?id=811EBA87EE1ACE2893140</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Bootstrapped 0% (starting): Starting</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Starting with guard context &quot;default&quot;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Registered server transport &#x27;obfs4&#x27; at &#x27;[::]:9050&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:02.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:02.000 [notice] Bootstrapped 5% (conn): Connecting to a relay</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:48:18.000 [warn] Problem bootstrapping. Stuck at 5% (conn): Connecting to a relay. (Connection timed out; TIMEOUT; count 10; recommendation warn; host FA3EC05000800EB7C4 at 94.142.140.158:443)</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:48:18.000 [warn] 9 connections have failed:</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:48:18.000 [warn]  9 connections died in state connect()ing with SSL state (No SSL object)</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>NAT设置 端口转发</li>\n</ol>\n<p>Internet‘s 9050 至 docker机的9050</p>\n<p>Internet‘s 9059 至 docker机的9099</p>\n<h2 id=\"错误排除\"><a href=\"#错误排除\" class=\"headerlink\" title=\"错误排除\"></a>错误排除</h2><h3 id=\"Unable-to-find-IPv4-address-for-ORPort-9099-You-might-want-to-specify-IPv6Only-to-it-or-set-an-explicit-address-or-set-Address\"><a href=\"#Unable-to-find-IPv4-address-for-ORPort-9099-You-might-want-to-specify-IPv6Only-to-it-or-set-an-explicit-address-or-set-Address\" class=\"headerlink\" title=\"Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.\"></a>Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">May 22 08:57:23.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br></pre></td></tr></table></figure>\n\n<p>如何指定一个地址? </p>\n<p>docker-compse.yml中映射出docker容器中的tor配置文件</p>\n<h3 id=\"etc-tor-torrc\"><a href=\"#etc-tor-torrc\" class=\"headerlink\" title=\"/etc/tor/torrc\"></a><code>/etc/tor/torrc</code></h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obfs4-bridge-1  | May 22 11:57:20.345 [warn] Error parsing ServerTransportListenAddr address &#x27;op.c</span><br><span class=\"line\">arlzeng.com:9092&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obfs4-bridge-1  | May 21 07:57:46.000 [notice] Unable to find IPv4 address for ORPort 9099. You mi</span><br><span class=\"line\">ght want to specify IPv6Only to it or set an explicit address or set Address.</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/issues/6\">https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/issues/6</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Ah yes. It&#x27;s indeed forwarded.</span><br><span class=\"line\">Good to know it&#x27;s normal behavior. I saw multiple posts online like this reddit Post as well..</span><br><span class=\"line\">Maybe we should say this message is normal in most cases, especially a machine behind a nat. After all, it confuses me. As if I was doing something wrong.</span><br></pre></td></tr></table></figure>\n\n<p>那么下一步就变成: 如何在proxy下运行这个 tor -f torrc</p>\n<p>既然tor的 自己运行成 bridge mode 无法是在代理的情况; </p>\n<p>那么能否让整个docker的外网连接都是处于proxy状态下的, </p>\n<p>这样它的流量自动走入proxy; </p>\n<p>这样成bridge链接到一个relay应该就能成功</p>\n<p>或者使用docker 的环境变量</p>\n<p>HTTP_PROXY</p>\n<p>HTTPS_PROXY</p>\n<p>如何在docker-compose.yml中设置这样的环境变量</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.4&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">obfs4-bridge:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">thetorproject/obfs4-bridge:latest</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">obfs4_bridge_external_network</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if OR_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">OR_PORT=$&#123;OR_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">OR_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if PT_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PT_PORT=$&#123;PT_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">PT_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if EMAIL is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">EMAIL=$&#123;EMAIL:?Env</span> <span class=\"string\">var</span> <span class=\"string\">EMAIL</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Nickname with default value: &quot;DockerObfs4Bridge&quot;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NICKNAME=$&#123;NICKNAME:-DockerObfs4Bridge&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">HTTP_PROXY=http://192.168.6.116:7890</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">HTTPS_PROXY=http://192.168.6.116:7890</span></span><br><span class=\"line\">    <span class=\"attr\">env_file:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">.env</span></span><br><span class=\"line\">      </span><br><span class=\"line\"><span class=\"string\">....</span> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>显然: 这个方案是不靠谱的, 流量被被转发到代理</p>\n<p>修改配置文件torrc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Bridge meek_lite 192.0.2.20:80 url=https://1314488750.rsc.cdn77.org front=www.phpmyadmin.net utls=HelloRandomizedALPN</span><br><span class=\"line\">ClientTransportPlugin meek_lite exec /usr/bin/lyrebird managed</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it obfs4-bridge-obfs4-bridge-1 bash </span><br></pre></td></tr></table></figure>\n\n<p>进去去找找 lyrebird 这个东西, 在那里具体路径?</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/lyrebird</span><br></pre></td></tr></table></figure>\n\n\n\n<p>思路来源: <a href=\"https://spec.torproject.org/pt-spec/configuration-environment.html\">https://spec.torproject.org/pt-spec/configuration-environment.html</a></p>\n<p>TOR_PT_PROXY</p>\n<p>TOR_PT_PROXY&#x3D;<a href=\"http://198.51.100.3:443/\">http://198.51.100.3:443</a></p>\n<p>测试:</p>\n<p>把这个TOR_PT_PROXY参数设置到.env,重启docker, 无效</p>\n<p>下一步 修改torrc来</p>\n<p>设置TOR_PT_PROXY 和 ServerTransportPlugin obfs4 exec &#x2F;usr&#x2F;bin&#x2F;lyrebird                </p>\n<p>​\tMay 22 14:31:51.242 [warn] Failed to parse&#x2F;validate config: Unknown option ‘TOR_PT_PROXY’.  Failing.</p>\n<p>​\t看来torrc 中不能设置TOR_PT_PROXY; 导致整个docker无法启动</p>\n<p>​\t修改obfs4 为 meek_lite</p>\n<p>也失败了; 错误:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">May 22 14:34:23.000 [notice] Starting with guard context &quot;default&quot;</span><br><span class=\"line\">May 22 14:34:23.000 [warn] Server managed proxy encountered a method error. (meek_lite server not supported)</span><br><span class=\"line\">May 22 14:34:23.000 [warn] Managed proxy &#x27;/usr/bin/lyrebird&#x27; was spawned successfully, but it didn&#x27;t launch any pluggable transport listeners!</span><br><span class=\"line\">May 22 14:34:24.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br><span class=\"line\">May 22 14:34:24.000 [notice] Bootstrapped 5% (conn): Connecting to a relay</span><br><span class=\"line\">May 22 14:38:31.000 [warn] Problem bootstrapping. Stuck at 5% (conn): Connecting to a relay. (No route to host; NOROUTE; count 8; recommendation warn; host B6526852EF18FB54BC91437B54055D16FD581898 at 176.198.159.33:9001)</span><br><span class=\"line\">May 22 14:38:31.000 [warn] 7 connections have failed:</span><br></pre></td></tr></table></figure>\n\n\n\n<p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;start-tor.sh: line 25: &#x2F;etc&#x2F;tor&#x2F;torrc: Permission denied<br>Starting tor.</p>\n<h3 id=\"My-internet-connection-requires-an-HTTP-or-SOCKS-Proxy\"><a href=\"#My-internet-connection-requires-an-HTTP-or-SOCKS-Proxy\" class=\"headerlink\" title=\"My internet connection requires an HTTP or SOCKS Proxy\"></a>My internet connection requires an HTTP or SOCKS Proxy</h3><p>If you’re using Tor Browser, you can set your proxy’s address, port, and authentication information in the <a href=\"https://tb-manual.torproject.org/running-tor-browser/\">Connection Settings</a>.</p>\n<p>If you’re using Tor another way, you can set the proxy information in your torrc file. Check out the <code>HTTPSProxy</code> config option in the <a href=\"https://2019.www.torproject.org/docs/tor-manual.html.en#HTTPSProxy\">manual page</a>. If your proxy requires authentication, see the <code>HTTPSProxyAuthenticator</code> option. Example with authentication:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTPSProxy 10.0.0.1:8080</span><br><span class=\"line\">HTTPSProxyAuthenticator myusername:mypass</span><br></pre></td></tr></table></figure>\n\n<p>本小节思路来源: <a href=\"https://support.torproject.org/tbb/tbb-47/#topic_tbb-47\">My internet connection requires an HTTP or SOCKS Proxy</a></p>\n<p>config option in the <a href=\"https://2019.www.torproject.org/docs/tor-manual.html.en#HTTPSProxy\">manual page</a></p>\n<p>修改torrc文件, 添加(改成你本地可用的代理) </p>\n<p>HTTPSProxy 127.0.0.1:7890</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/bin/start-tor.sh: line 25: /etc/tor/torrc: Permission denied</span><br><span class=\"line\">Starting tor.</span><br><span class=\"line\">May 23 08:10:42.437 [notice] Tor 0.4.8.14 running on Linux with Libevent 2.1.12-stable, OpenSSL 3.0.15, Zlib 1.2.13, Liblzma 5.4.1, Libzstd 1.5.4 and Glibc 2.36 as libc.</span><br><span class=\"line\">May 23 08:10:42.437 [notice] Tor can&#x27;t help you if you use it wrong! Learn how to be safe at https://support.torproject.org/faq/staying-anonymous/</span><br><span class=\"line\">May 23 08:10:42.437 [notice] Read configuration file &quot;/etc/tor/torrc&quot;.</span><br><span class=\"line\">May 23 08:10:42.438 [notice] Based on detected system memory, MaxMemInQueues is set to 6296 MB. You can override this by setting MaxMemInQueues by hand.</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opening OR listener on 0.0.0.0:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opened OR listener connection (ready) on 0.0.0.0:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opening OR listener on [::]:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opened OR listener connection (ready) on [::]:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opening Extended OR listener on 127.0.0.1:0</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Extended OR listener listening on port 45571.</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opened Extended OR listener connection (ready) on 127.0.0.1:45571</span><br><span class=\"line\">May 23 08:10:42.000 [notice] Parsing GEOIP IPv4 file /usr/share/tor/geoip.</span><br><span class=\"line\">May 23 08:10:42.000 [notice] Parsing GEOIP IPv6 file /usr/share/tor/geoip6.</span><br><span class=\"line\">May 23 08:10:42.000 [notice] Configured to measure statistics. Look for the *-stats files that will first be written to the data directory in 24 hours from now.</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Your Tor server&#x27;s identity key fingerprint is &#x27;DockerObfs4Brg2025 BB46A33E093FAB4F48F2F8B433E51E38320DA462&#x27;</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Your Tor bridge&#x27;s hashed identity key fingerprint is &#x27;DockerObfs4Brg2025 20A3E084775ECB102401250C53F8E064D6EDA5FA&#x27;</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Your Tor server&#x27;s identity key ed25519 fingerprint is &#x27;DockerObfs4Brg2025 GExPVxdmowxMdpW3Erl8HQQbdPhyzjxpEqhJJ7BuZEE&#x27;</span><br><span class=\"line\">May 23 08:10:43.000 [notice] You can check the status of your bridge relay at https://bridges.torproject.org/status?id=20A3E084775ECB102401250C53F8E064D6EDA5FA</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Bootstrapped 0% (starting): Starting</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Starting with guard context &quot;default&quot;</span><br><span class=\"line\">May 23 08:10:43.000 [warn] Managed proxy &#x27;/usr/bin/lyrebird&#x27; did not configure the specified outgoing proxy and will be terminated.</span><br><span class=\"line\">May 23 08:10:43.000 [warn] Managed proxy &quot;N/A&quot; process terminated with status code 0</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 3% (conn_proxy): Connecting to proxy</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 4% (conn_done_proxy): Connected to proxy</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 10% (conn_done): Connected to a relay</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 14% (handshake): Handshaking with a relay</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 15% (handshake_done): Handshake with a relay done</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p><a href=\"https://blog.o1hy.com/2020/01/14/dev/docker/%E9%80%9A%E8%BF%87iptables%E8%BD%AC%E5%8F%91docker%E6%B5%81%E9%87%8F/\">通过IPTABLES转发docker流量</a></p>\n<h2 id=\"REDSOCKS\"><a href=\"#REDSOCKS\" class=\"headerlink\" title=\"REDSOCKS\"></a>REDSOCKS</h2><p>工具连接：<a href=\"https://github.com/darkk/redsocks\">https://github.com/darkk/redsocks</a></p>\n<blockquote>\n<p>This tool allows you to redirect any TCP connection to SOCKS or HTTPS proxy using your firewall, so redirection may be system-wide or network-wide.</p>\n</blockquote>\n<p>这个工具可以通过iptables将所有TCP流量转至它监听的端口下，然后通过代理发出。</p>\n<p><a href=\"https://www.notion.so/REDSOCKS-fb75b0b02b9d4e87867771166ee43731\">https://www.notion.so/REDSOCKS-fb75b0b02b9d4e87867771166ee43731</a></p>\n<p>本小节来源</p>\n<p><a href=\"https://fak3r.com/2024/10/22/run-a-tor-relay-in-docker/\">Run a Tor Relay in Docker</a></p>\n","more":"<h1 id=\"方法-1：Tor-Browser\"><a href=\"#方法-1：Tor-Browser\" class=\"headerlink\" title=\"方法 #1：Tor Browser\"></a>方法 #1：Tor Browser</h1><p>最简单直接的办法就是在电脑或手机中使用Tor Browser浏览器，这样可以直接使用到符合设计初衷的匿名浏览（同时也意味着*墙）。</p>\n<p>手机APP版指导手册：MOBILE TOR <a href=\"https://tb-manual.torproject.org/mobile-tor/#circumvention\">https://tb-manual.torproject.org/mobile-tor/#circumvention</a></p>\n<p>手机端设置要点：下载后打开Tor Browser，</p>\n<p>设置(右上角的齿轮图标) 》</p>\n<p>配置网桥（在Tor网络的页面最下方的扳手图标）》</p>\n<p>选中<strong>snowflake</strong> 并开启‘使用网桥’（2023年3月暂时可用）</p>\n<p>点击 “连接” 按钮，并等待3-5分钟，等待页面出现：“私密浏览”，在页面最下方即可输入网址。</p>\n<p>各种系统的电脑和手机版：<a href=\"https://www.torproject.org/zh-CN/download/\">下载 Tor 浏览器</a> </p>\n<p>以下步骤可以查看到Tor Browser中拓展出来的Socks5代理地址，从而用来配置在除了浏览器以外的应用程序中，来实现VPN的效果。</p>\n<ol>\n<li><p>打开Tor Browser，并等待其成功连接上Tor网络（这样就已实现匿名浏览的效果）</p>\n</li>\n<li><p>打开Tor Browser的设置首选项》连接，或者直接输入地址（并且回车）：about:preferences#connection</p>\n</li>\n<li><p>你需要在连接中选择 snowflake网桥（snowflake bridge）2023年3月，目前这种方式在天朝还是可以正在运作的（能撑多久，未知）</p>\n</li>\n<li><p>你需要找到一个合适的网桥，并连接成功。（需要耐心）</p>\n</li>\n<li><p>在该页面的最底部，找到‘高级选项’》查看Tor日志，页面会弹出一个新的小窗口，里面的日志信息如下（正常成功连接的时候）</p>\n</li>\n<li><ol>\n<li>2023-03-02 15:15:55.247 [NOTICE] New control connection opened from 127.0.0.1.<br>2023-03-02 15:15:55.248 [NOTICE] New control connection opened from 127.0.0.1.<br>2023-03-02 15:15:55.249 [NOTICE] DisableNetwork is set. Tor will not make or accept non-control network connections. Shutting down all existing connections.<br>2023-03-02 15:15:55.252 [NOTICE] Opening Socks listener on 127.0.0.1:9150<br>2023-03-02 15:15:55.252 [NOTICE] Opened Socks listener connection (ready) on 127.0.0.1:9150<br>2023-03-02 15:15:55.252 [WARN] Cannot find maximum file descriptor, assuming: 256<br>2023-03-02 15:15:56.265 [NOTICE] Bootstrapped 1% (conn_pt): Connecting to pluggable transport<br>2023-03-02 15:15:56.265 [NOTICE] Bootstrapped 2% (conn_done_pt): Connected to pluggable transport<br>2023-03-02 15:15:56.267 [NOTICE] Bootstrapped 10% (conn_done): Connected to a relay</li>\n</ol>\n</li>\n<li><p>注意观察这个日志中的 Opening Socks listener on 127.0.0.1:9150；这个就是我们要找的Socks5代理地址。</p>\n</li>\n</ol>\n<p> 如果您无法使用已知的链接来打开下载Tor Browser的话，请发挥您的想象力（施展判断力），比如用搜索引擎搜索一下关键字，条条大路通罗马。</p>\n<h1 id=\"方法-2-不保证-：Clash\"><a href=\"#方法-2-不保证-：Clash\" class=\"headerlink\" title=\"方法 #2(不保证)：Clash\"></a>方法 #2(不保证)：Clash</h1><p>1. 手机端，可以使用手机APP： Clash</p>\n<p>下载：<a href=\"https://github.com/Kr328/ClashForAndroid/releases\">https://github.com/Kr328/ClashForAndroid/releases</a><br> 参考文章：<a href=\"https://clashforandroid.org/clash-for-android-download/\">最新版 Clash</a> <a href=\"https://clashforandroid.org/clash-for-android-download/\">for</a> <a href=\"https://clashforandroid.org/clash-for-android-download/\">Android 下载</a></p>\n<p>配置：仅供朋友测试，v我索取</p>\n<p>2. 如果是Mac电脑端可以使用：ClashX</p>\n<p>3. 如果是Windows电脑端可以使用：Clash for Windows</p>\n<p>下载：<a href=\"https://github.com/yichengchen/clashX/releases\">https://github.com/yichengchen/clashX/releases</a><br>参考文章：<a href=\"https://clashx.org/clashx-download/\">最新版 ClashX 下载</a></p>\n<p>配置：仅供朋友测试，v我索取</p>\n<h1 id=\"方法-3-advance-：运行-tor\"><a href=\"#方法-3-advance-：运行-tor\" class=\"headerlink\" title=\"方法 #3(advance)：运行 tor\"></a>方法 #3(advance)：运行 tor</h1><p>这个方法需要更专业的计算机知识，以下已Mac OSX来举例，简单描述如下（当然首先得先有梯子*墙才能实现）：</p>\n<p>1.  下载mac.zip</p>\n<p>　　我把它改名为：OnionVPNWithSpeedControl_mac.zip，解压缩后里面有我们需要用到的工具</p>\n<p>　　<a href=\"https://github.com/lunu-bounir/onion-vpn\">https://github.com/lunu-bounir/onion-vpn</a></p>\n<p>　　OnionVPNWithSpeedControl_mac.zip is came from above git of name onion-vpn</p>\n<p>　　这步有点奇葩，因为从Tor官方下载的最新版expert bunlde 中的 tor 是无法使用的，一运行就退出了，原因未知。已测试：tor-expert-bundle-12.0.3-macos-aarch64.tar.gz，非常尴尬：tor-expert-bundle-12.0.3-macos-aarch64 里面的tor是不能用的。。。</p>\n<p>2. 安装go语言环境</p>\n<p>　　具体步骤不详细描述了，<a href=\"https://go.dev/dl/\">https://go.dev/dl/</a> 写得非常详细，十分友好。</p>\n<p>3. 下载并编译<a href=\"https://github.com/keroserene/snowflake.git\">https://github.com/keroserene/snowflake.git</a></p>\n<p>　　git clone打开新的Terminal，切换到client目录下，执行</p>\n<p>go get<br>go build</p>\n<p>注意：默认状况下在天朝go get会卡死（我就是遇到这种情况了）报错误：dial tcp 142.251.42.241:443: i&#x2F;o timeout<br>这时需要先执行go env -w GOPROXY&#x3D;<a href=\"https://goproxy.cn/\">https://goproxy.cn</a><br>解决方案来源：<a href=\"https://blog.csdn.net/weixin_45178126/article/details/122097221\">golang 在下载依赖包的时候出现错误：dial tcp 142.251.42.241:443: i&#x2F;o timeout</a></p>\n<p>　　最后会在client目录下生成一个client的Unix可执行文件。</p>\n<p>【可选步骤】4. 自定配置torrc文件，加入已知特定的snowflake bridge</p>\n<p>　　在client目录下有一个默认的torrc文件，这个就是tor运行起来后，我们希望其遵循的配置文件，里面有默认的snowflake bridge</p>\n<p>5. 运行tor</p>\n<p>　　具体命令参考 […client % &#x2F;Users&#x2F;carl&#x2F;Downloads&#x2F;OnionVPNWithSpeedControl_mac&#x2F;assets&#x2F;tor -f torrc</p>\n<p>　　类似的日志参考如下：</p>\n<p>Mar 03 09:36:49.721 [notice] Tor 0.4.4.6 (git-2a8b789ea6f308d0) running on Darwin with Libevent 2.1.11-stable, OpenSSL 1.1.1i, Zlib 1.2.11, Liblzma N&#x2F;A, and Libzstd N&#x2F;A.<br>Mar 03 09:36:49.721 [notice] Tor can’t help you if you use it wrong! Learn how to be safe at <a href=\"https://www.torproject.org/download/download#warning\">https://www.torproject.org/download/download#warning</a><br>Mar 03 09:36:49.722 [notice] Read configuration file “&#x2F;Users&#x2F;carlzeng&#x2F;WebstormProjects&#x2F;snowflake&#x2F;client&#x2F;torrc”.<br>Mar 03 09:36:49.723 [warn] Path for DataDirectory (datadir) is relative and will resolve to &#x2F;Users&#x2F;carl&#x2F;WebstormProjects&#x2F;snowflake&#x2F;client&#x2F;datadir. Is this what you wanted?<br>Mar 03 09:36:49.724 [notice] Opening Socks listener on 127.0.0.1:0<br>Mar 03 09:36:49.724 [notice] Socks listener listening on port 62501.<br>Mar 03 09:36:49.724 [notice] Opened Socks listener on 127.0.0.1:62501<br>Mar 03 09:36:49.000 [warn] Cannot find maximum file descriptor, assuming: 256<br>Mar 03 09:36:49.000 [notice] Bootstrapped 0% (starting): Starting<br>Mar 03 09:36:49.000 [notice] Starting with guard context “bridges”<br>Mar 03 09:36:49.000 [notice] Delaying directory fetches: No running bridges<br>Mar 03 09:36:50.000 [notice] Bootstrapped 1% (conn_pt): Connecting to pluggable transport<br>Mar 03 09:36:50.000 [notice] Bootstrapped 2% (conn_done_pt): Connected to pluggable transport<br>Mar 03 09:36:50.000 [notice] Bootstrapped 10% (conn_done): Connected to a relay<br>Mar 03 09:36:56.000 [notice] Managed proxy “.&#x2F;client”: offer created<br>。。。。<br>Mar 03 09:41:57.000 [notice] Bootstrapped 100% (done): Done  </p>\n<p>　　慢慢等待1-5分钟，一直等到 Mar 03 09:41:57.000 [notice] Bootstrapped 100% (done): Done</p>\n<p>6. 配置应用程序，连接到Socks 127.0.0.1:62501 即可（根据具体的日志信息）</p>\n<p>【可选步骤】7. 检测连接状态：<a href=\"https://check.torproject.org/\">https://check.torproject.org/</a></p>\n<p>祝各位：女神节快乐！～</p>\n<h1 id=\"Run-a-Tor-Relay-in-Docker运行Tor中继节点\"><a href=\"#Run-a-Tor-Relay-in-Docker运行Tor中继节点\" class=\"headerlink\" title=\"Run a Tor Relay in Docker运行Tor中继节点\"></a>Run a Tor Relay in Docker运行Tor中继节点</h1><ol>\n<li><p>创建和启动docker-compose</p>\n<p><a href=\"https://gitlab.torproject.org/torproject/anti-censorship/docker-obfs4-bridge/raw/main/docker-compose.yml\">https://gitlab.torproject.org/torproject/anti-censorship/docker-obfs4-bridge/raw/main/docker-compose.yml</a></p>\n<p><a href=\"https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/raw/main/.env\">https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/raw/main/.env</a></p>\n</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This file assists operators in (re-)deploying an obfs4 bridge Docker</span></span><br><span class=\"line\"><span class=\"comment\"># container.  You need the tool &#x27;docker-compose&#x27; to use this file.  You</span></span><br><span class=\"line\"><span class=\"comment\"># can find it in the Debian package &#x27;docker-compose&#x27;.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># First, you need to create a configuration file, &quot;.env&quot;, in the same directory</span></span><br><span class=\"line\"><span class=\"comment\"># as this file, &quot;docker-compose.yml&quot;.  Add the following environment variables</span></span><br><span class=\"line\"><span class=\"comment\"># to this configuration file.  EMAIL is your email address; OR_PORT is your</span></span><br><span class=\"line\"><span class=\"comment\"># onion routing port; and PT_PORT is your obfs4 port:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   EMAIL=you@example.com</span></span><br><span class=\"line\"><span class=\"comment\">#   OR_PORT=XXX</span></span><br><span class=\"line\"><span class=\"comment\">#   PT_PORT=XXX</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># If needed, you can also activate there an additional variables processing with:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   OBFS4_ENABLE_ADDITIONAL_VARIABLES=1</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># followed by defining desired torrc entries prefixed with OBFS4V_</span></span><br><span class=\"line\"><span class=\"comment\"># For example:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   OBFS4V_AddressDisableIPv6=1</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Next, pull the Docker image, by running:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   docker-compose pull obfs4-bridge</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># And finally, to (re-)deploy the container, run:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   docker-compose up -d obfs4-bridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.4&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">obfs4-bridge:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">thetorproject/obfs4-bridge:latest</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">obfs4_bridge_external_network</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if OR_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">OR_PORT=$&#123;OR_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">OR_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if PT_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PT_PORT=$&#123;PT_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">PT_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if EMAIL is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">EMAIL=$&#123;EMAIL:?Env</span> <span class=\"string\">var</span> <span class=\"string\">EMAIL</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Nickname with default value: &quot;DockerObfs4Bridge&quot;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NICKNAME=$&#123;NICKNAME:-DockerObfs4Bridge&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">env_file:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">.env</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data:/var/lib/tor</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;OR_PORT&#125;:$&#123;OR_PORT&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;PT_PORT&#125;:$&#123;PT_PORT&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">unless-stopped</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">tor-datadir-$&#123;OR_PORT&#125;-$&#123;PT_PORT&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">obfs4_bridge_external_network:</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Set required variables</span><br><span class=\"line\">OR_PORT=9099</span><br><span class=\"line\">PT_PORT=9050</span><br><span class=\"line\">EMAIL=ame@apple.com</span><br><span class=\"line\"># If you want, you could change the nickname of your bridge</span><br><span class=\"line\">#NICKNAME=DockerObfs4Bridge</span><br><span class=\"line\"># If needed, activate additional variables processing</span><br><span class=\"line\">#OBFS4_ENABLE_ADDITIONAL_VARIABLES=1</span><br><span class=\"line\"># and define desired torrc entries prefixed with OBFS4V_</span><br><span class=\"line\"># For example:</span><br><span class=\"line\">#OBFS4V_AddressDisableIPv6=1</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up</span><br><span class=\"line\">WARN[0000] /root/obfs4-bridge/docker-compose.yaml: `version` is obsolete </span><br><span class=\"line\">[+] Running 15/15</span><br><span class=\"line\"> ✔ obfs4-bridge Pulled                                                                      39.3s </span><br><span class=\"line\">   ✔ 04857b38bc21 Pull complete                                                              5.2s </span><br><span class=\"line\">   ✔ e5bfec8939cb Pull complete                                                              1.6s </span><br><span class=\"line\">   ✔ 5f68de6710c4 Pull complete                                                              1.8s </span><br><span class=\"line\">   ✔ b60093912f91 Pull complete                                                              3.2s </span><br><span class=\"line\">   ✔ ab018a71dd54 Pull complete                                                              5.0s </span><br><span class=\"line\">   ✔ 3b96c9cd7341 Pull complete                                                              7.1s </span><br><span class=\"line\">   ✔ 399de59d9384 Pull complete                                                              9.4s </span><br><span class=\"line\">   ✔ 1fd06b5f7332 Pull complete                                                              6.8s </span><br><span class=\"line\">   ✔ 9632961b9f45 Pull complete                                                              9.2s </span><br><span class=\"line\">   ✔ 8887d261ae57 Pull complete                                                              8.7s </span><br><span class=\"line\">   ✔ 702c64636d8d Pull complete                                                             10.3s </span><br><span class=\"line\">   ✔ 0c8449df639a Pull complete                                                             10.7s </span><br><span class=\"line\">   ✔ 5f1156e46d38 Pull complete                                                             11.3s </span><br><span class=\"line\">   ✔ dbc5b9df9780 Pull complete                                                             12.0s </span><br><span class=\"line\">[+] Running 2/1</span><br><span class=\"line\"> ✔ Network obfs4-bridge_obfs4_bridge_external_network  Created                               0.1s </span><br><span class=\"line\"> ✔ Volume &quot;tor-datadir-9099-9050&quot;                      C...                                  0.0s </span><br><span class=\"line\"> ⠋ Container obfs4-bridge-obfs4-bridge-1               Created                               0.0s </span><br><span class=\"line\">Attaching to obfs4-bridge-1</span><br><span class=\"line\">obfs4-bridge-1  | Using NICKNAME=DockerObfs4Bridge, OR_PORT=9099, PT_PORT=9050, and EMAIL=ame@apple.com.</span><br><span class=\"line\">obfs4-bridge-1  | Starting tor.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.842 [notice] Tor 0.4.8.14 running on Linux with Libevent 2.1.12-stable, OpenSSL 3.0.15, Zlib 1.2.13, Liblzma 5.4.1, Libzstd 1.5.4 and Glibc 2.36 as libc.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.842 [notice] Tor can&#x27;t help you if you use it wrong! Learn how to be safe at https://support.torproject.org/faq/staying-anonymous/</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.842 [notice] Read configuration file &quot;/etc/tor/torrc&quot;.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Based on detected system memory, MaxMemInQueues is set to 6296 MB. You can override this by setting MaxMemInQueues by hand.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opening OR listener on 0.0.0.0:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opened OR listener connection (ready) on 0.0.0.0:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opening OR listener on [::]:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opened OR listener connection (ready) on [::]:9099</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opening Extended OR listener on 127.0.0.1:0</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Extended OR listener listening on port 44627.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.843 [notice] Opened Extended OR listener connection (ready) on 127.0.0.1:44627</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.000 [notice] Parsing GEOIP IPv4 file /usr/share/tor/geoip.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:00.000 [notice] Parsing GEOIP IPv6 file /usr/share/tor/geoip6.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Configured to measure statistics. Look for the *-stats files that will first be written to the data directory in 24 hours from now.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] You are running a new relay. Thanks for helping the Tor network! If you wish to know what will happen in the upcoming weeks regarding its usage, have a look at https://blog.torproject.org/lifecycle-of-a-new-relay</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] It looks like I need to generate and sign a new medium-term signing key, because I don&#x27;t have one. To do that, I need to load (or create) the permanent master identity key. If the master identity key was not moved or encrypted with a passphrase, this will be done automatically and no further action is required. Otherwise, provide the necessary data using &#x27;tor --keygen&#x27; to do it manually.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Your Tor server&#x27;s identity key fingerprint is &#x27;DockerObfs4Bridge F22790FB5078D507920743B6D6&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Your Tor bridge&#x27;s hashed identity key fingerprint is &#x27;DockerObfs4Bridge 811EBA87EE1ACE2893140B5AC&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Your Tor server&#x27;s identity key ed25519 fingerprint is &#x27;DockerObfs4Bridge YlsH1QKdRNwX70+dDrHQHBoUDDWRMo&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] You can check the status of your bridge relay at https://bridges.torproject.org/status?id=811EBA87EE1ACE2893140</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Bootstrapped 0% (starting): Starting</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Starting with guard context &quot;default&quot;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:01.000 [notice] Registered server transport &#x27;obfs4&#x27; at &#x27;[::]:9050&#x27;</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:02.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:44:02.000 [notice] Bootstrapped 5% (conn): Connecting to a relay</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:48:18.000 [warn] Problem bootstrapping. Stuck at 5% (conn): Connecting to a relay. (Connection timed out; TIMEOUT; count 10; recommendation warn; host FA3EC05000800EB7C4 at 94.142.140.158:443)</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:48:18.000 [warn] 9 connections have failed:</span><br><span class=\"line\">obfs4-bridge-1  | May 21 04:48:18.000 [warn]  9 connections died in state connect()ing with SSL state (No SSL object)</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>NAT设置 端口转发</li>\n</ol>\n<p>Internet‘s 9050 至 docker机的9050</p>\n<p>Internet‘s 9059 至 docker机的9099</p>\n<h2 id=\"错误排除\"><a href=\"#错误排除\" class=\"headerlink\" title=\"错误排除\"></a>错误排除</h2><h3 id=\"Unable-to-find-IPv4-address-for-ORPort-9099-You-might-want-to-specify-IPv6Only-to-it-or-set-an-explicit-address-or-set-Address\"><a href=\"#Unable-to-find-IPv4-address-for-ORPort-9099-You-might-want-to-specify-IPv6Only-to-it-or-set-an-explicit-address-or-set-Address\" class=\"headerlink\" title=\"Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.\"></a>Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">May 22 08:57:23.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br></pre></td></tr></table></figure>\n\n<p>如何指定一个地址? </p>\n<p>docker-compse.yml中映射出docker容器中的tor配置文件</p>\n<h3 id=\"etc-tor-torrc\"><a href=\"#etc-tor-torrc\" class=\"headerlink\" title=\"/etc/tor/torrc\"></a><code>/etc/tor/torrc</code></h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obfs4-bridge-1  | May 22 11:57:20.345 [warn] Error parsing ServerTransportListenAddr address &#x27;op.c</span><br><span class=\"line\">arlzeng.com:9092&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obfs4-bridge-1  | May 21 07:57:46.000 [notice] Unable to find IPv4 address for ORPort 9099. You mi</span><br><span class=\"line\">ght want to specify IPv6Only to it or set an explicit address or set Address.</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/issues/6\">https://gitlab.torproject.org/tpo/anti-censorship/docker-obfs4-bridge/-/issues/6</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Ah yes. It&#x27;s indeed forwarded.</span><br><span class=\"line\">Good to know it&#x27;s normal behavior. I saw multiple posts online like this reddit Post as well..</span><br><span class=\"line\">Maybe we should say this message is normal in most cases, especially a machine behind a nat. After all, it confuses me. As if I was doing something wrong.</span><br></pre></td></tr></table></figure>\n\n<p>那么下一步就变成: 如何在proxy下运行这个 tor -f torrc</p>\n<p>既然tor的 自己运行成 bridge mode 无法是在代理的情况; </p>\n<p>那么能否让整个docker的外网连接都是处于proxy状态下的, </p>\n<p>这样它的流量自动走入proxy; </p>\n<p>这样成bridge链接到一个relay应该就能成功</p>\n<p>或者使用docker 的环境变量</p>\n<p>HTTP_PROXY</p>\n<p>HTTPS_PROXY</p>\n<p>如何在docker-compose.yml中设置这样的环境变量</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.4&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">obfs4-bridge:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">thetorproject/obfs4-bridge:latest</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">obfs4_bridge_external_network</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if OR_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">OR_PORT=$&#123;OR_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">OR_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if PT_PORT is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PT_PORT=$&#123;PT_PORT:?Env</span> <span class=\"string\">var</span> <span class=\"string\">PT_PORT</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Exit with an error message if EMAIL is unset or empty.</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">EMAIL=$&#123;EMAIL:?Env</span> <span class=\"string\">var</span> <span class=\"string\">EMAIL</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">set.&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># Nickname with default value: &quot;DockerObfs4Bridge&quot;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NICKNAME=$&#123;NICKNAME:-DockerObfs4Bridge&#125;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">HTTP_PROXY=http://192.168.6.116:7890</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">HTTPS_PROXY=http://192.168.6.116:7890</span></span><br><span class=\"line\">    <span class=\"attr\">env_file:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">.env</span></span><br><span class=\"line\">      </span><br><span class=\"line\"><span class=\"string\">....</span> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>显然: 这个方案是不靠谱的, 流量被被转发到代理</p>\n<p>修改配置文件torrc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Bridge meek_lite 192.0.2.20:80 url=https://1314488750.rsc.cdn77.org front=www.phpmyadmin.net utls=HelloRandomizedALPN</span><br><span class=\"line\">ClientTransportPlugin meek_lite exec /usr/bin/lyrebird managed</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it obfs4-bridge-obfs4-bridge-1 bash </span><br></pre></td></tr></table></figure>\n\n<p>进去去找找 lyrebird 这个东西, 在那里具体路径?</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/lyrebird</span><br></pre></td></tr></table></figure>\n\n\n\n<p>思路来源: <a href=\"https://spec.torproject.org/pt-spec/configuration-environment.html\">https://spec.torproject.org/pt-spec/configuration-environment.html</a></p>\n<p>TOR_PT_PROXY</p>\n<p>TOR_PT_PROXY&#x3D;<a href=\"http://198.51.100.3:443/\">http://198.51.100.3:443</a></p>\n<p>测试:</p>\n<p>把这个TOR_PT_PROXY参数设置到.env,重启docker, 无效</p>\n<p>下一步 修改torrc来</p>\n<p>设置TOR_PT_PROXY 和 ServerTransportPlugin obfs4 exec &#x2F;usr&#x2F;bin&#x2F;lyrebird                </p>\n<p>​\tMay 22 14:31:51.242 [warn] Failed to parse&#x2F;validate config: Unknown option ‘TOR_PT_PROXY’.  Failing.</p>\n<p>​\t看来torrc 中不能设置TOR_PT_PROXY; 导致整个docker无法启动</p>\n<p>​\t修改obfs4 为 meek_lite</p>\n<p>也失败了; 错误:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">May 22 14:34:23.000 [notice] Starting with guard context &quot;default&quot;</span><br><span class=\"line\">May 22 14:34:23.000 [warn] Server managed proxy encountered a method error. (meek_lite server not supported)</span><br><span class=\"line\">May 22 14:34:23.000 [warn] Managed proxy &#x27;/usr/bin/lyrebird&#x27; was spawned successfully, but it didn&#x27;t launch any pluggable transport listeners!</span><br><span class=\"line\">May 22 14:34:24.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br><span class=\"line\">May 22 14:34:24.000 [notice] Bootstrapped 5% (conn): Connecting to a relay</span><br><span class=\"line\">May 22 14:38:31.000 [warn] Problem bootstrapping. Stuck at 5% (conn): Connecting to a relay. (No route to host; NOROUTE; count 8; recommendation warn; host B6526852EF18FB54BC91437B54055D16FD581898 at 176.198.159.33:9001)</span><br><span class=\"line\">May 22 14:38:31.000 [warn] 7 connections have failed:</span><br></pre></td></tr></table></figure>\n\n\n\n<p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;start-tor.sh: line 25: &#x2F;etc&#x2F;tor&#x2F;torrc: Permission denied<br>Starting tor.</p>\n<h3 id=\"My-internet-connection-requires-an-HTTP-or-SOCKS-Proxy\"><a href=\"#My-internet-connection-requires-an-HTTP-or-SOCKS-Proxy\" class=\"headerlink\" title=\"My internet connection requires an HTTP or SOCKS Proxy\"></a>My internet connection requires an HTTP or SOCKS Proxy</h3><p>If you’re using Tor Browser, you can set your proxy’s address, port, and authentication information in the <a href=\"https://tb-manual.torproject.org/running-tor-browser/\">Connection Settings</a>.</p>\n<p>If you’re using Tor another way, you can set the proxy information in your torrc file. Check out the <code>HTTPSProxy</code> config option in the <a href=\"https://2019.www.torproject.org/docs/tor-manual.html.en#HTTPSProxy\">manual page</a>. If your proxy requires authentication, see the <code>HTTPSProxyAuthenticator</code> option. Example with authentication:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTPSProxy 10.0.0.1:8080</span><br><span class=\"line\">HTTPSProxyAuthenticator myusername:mypass</span><br></pre></td></tr></table></figure>\n\n<p>本小节思路来源: <a href=\"https://support.torproject.org/tbb/tbb-47/#topic_tbb-47\">My internet connection requires an HTTP or SOCKS Proxy</a></p>\n<p>config option in the <a href=\"https://2019.www.torproject.org/docs/tor-manual.html.en#HTTPSProxy\">manual page</a></p>\n<p>修改torrc文件, 添加(改成你本地可用的代理) </p>\n<p>HTTPSProxy 127.0.0.1:7890</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/bin/start-tor.sh: line 25: /etc/tor/torrc: Permission denied</span><br><span class=\"line\">Starting tor.</span><br><span class=\"line\">May 23 08:10:42.437 [notice] Tor 0.4.8.14 running on Linux with Libevent 2.1.12-stable, OpenSSL 3.0.15, Zlib 1.2.13, Liblzma 5.4.1, Libzstd 1.5.4 and Glibc 2.36 as libc.</span><br><span class=\"line\">May 23 08:10:42.437 [notice] Tor can&#x27;t help you if you use it wrong! Learn how to be safe at https://support.torproject.org/faq/staying-anonymous/</span><br><span class=\"line\">May 23 08:10:42.437 [notice] Read configuration file &quot;/etc/tor/torrc&quot;.</span><br><span class=\"line\">May 23 08:10:42.438 [notice] Based on detected system memory, MaxMemInQueues is set to 6296 MB. You can override this by setting MaxMemInQueues by hand.</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opening OR listener on 0.0.0.0:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opened OR listener connection (ready) on 0.0.0.0:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opening OR listener on [::]:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opened OR listener connection (ready) on [::]:9099</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opening Extended OR listener on 127.0.0.1:0</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Extended OR listener listening on port 45571.</span><br><span class=\"line\">May 23 08:10:42.439 [notice] Opened Extended OR listener connection (ready) on 127.0.0.1:45571</span><br><span class=\"line\">May 23 08:10:42.000 [notice] Parsing GEOIP IPv4 file /usr/share/tor/geoip.</span><br><span class=\"line\">May 23 08:10:42.000 [notice] Parsing GEOIP IPv6 file /usr/share/tor/geoip6.</span><br><span class=\"line\">May 23 08:10:42.000 [notice] Configured to measure statistics. Look for the *-stats files that will first be written to the data directory in 24 hours from now.</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Your Tor server&#x27;s identity key fingerprint is &#x27;DockerObfs4Brg2025 BB46A33E093FAB4F48F2F8B433E51E38320DA462&#x27;</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Your Tor bridge&#x27;s hashed identity key fingerprint is &#x27;DockerObfs4Brg2025 20A3E084775ECB102401250C53F8E064D6EDA5FA&#x27;</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Your Tor server&#x27;s identity key ed25519 fingerprint is &#x27;DockerObfs4Brg2025 GExPVxdmowxMdpW3Erl8HQQbdPhyzjxpEqhJJ7BuZEE&#x27;</span><br><span class=\"line\">May 23 08:10:43.000 [notice] You can check the status of your bridge relay at https://bridges.torproject.org/status?id=20A3E084775ECB102401250C53F8E064D6EDA5FA</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Bootstrapped 0% (starting): Starting</span><br><span class=\"line\">May 23 08:10:43.000 [notice] Starting with guard context &quot;default&quot;</span><br><span class=\"line\">May 23 08:10:43.000 [warn] Managed proxy &#x27;/usr/bin/lyrebird&#x27; did not configure the specified outgoing proxy and will be terminated.</span><br><span class=\"line\">May 23 08:10:43.000 [warn] Managed proxy &quot;N/A&quot; process terminated with status code 0</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Unable to find IPv4 address for ORPort 9099. You might want to specify IPv6Only to it or set an explicit address or set Address.</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 3% (conn_proxy): Connecting to proxy</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 4% (conn_done_proxy): Connected to proxy</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 10% (conn_done): Connected to a relay</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 14% (handshake): Handshaking with a relay</span><br><span class=\"line\">May 23 08:10:44.000 [notice] Bootstrapped 15% (handshake_done): Handshake with a relay done</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p><a href=\"https://blog.o1hy.com/2020/01/14/dev/docker/%E9%80%9A%E8%BF%87iptables%E8%BD%AC%E5%8F%91docker%E6%B5%81%E9%87%8F/\">通过IPTABLES转发docker流量</a></p>\n<h2 id=\"REDSOCKS\"><a href=\"#REDSOCKS\" class=\"headerlink\" title=\"REDSOCKS\"></a>REDSOCKS</h2><p>工具连接：<a href=\"https://github.com/darkk/redsocks\">https://github.com/darkk/redsocks</a></p>\n<blockquote>\n<p>This tool allows you to redirect any TCP connection to SOCKS or HTTPS proxy using your firewall, so redirection may be system-wide or network-wide.</p>\n</blockquote>\n<p>这个工具可以通过iptables将所有TCP流量转至它监听的端口下，然后通过代理发出。</p>\n<p><a href=\"https://www.notion.so/REDSOCKS-fb75b0b02b9d4e87867771166ee43731\">https://www.notion.so/REDSOCKS-fb75b0b02b9d4e87867771166ee43731</a></p>\n<p>本小节来源</p>\n<p><a href=\"https://fak3r.com/2024/10/22/run-a-tor-relay-in-docker/\">Run a Tor Relay in Docker</a></p>","categories":[{"name":"墙","path":"api/categories/墙.json"}],"tags":[{"name":"墙","path":"api/tags/墙.json"},{"name":"tor","path":"api/tags/tor.json"}]}