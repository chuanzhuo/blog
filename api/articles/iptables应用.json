{"title":"iptables应用","slug":"iptables应用","date":"2023-11-14T02:39:43.000Z","updated":"2024-07-12T10:46:25.081Z","comments":true,"path":"api/articles/iptables应用.json","excerpt":"有什么用管理Linux防火墙<br>开启Openwrt上的clash服务中转","covers":["https://img.carlzeng.top:3/i/2024/07/12/669108492a5ec.png"],"content":"<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>管理Linux防火墙<br>开启Openwrt上的clash服务中转</p>\n<span id=\"more\"></span>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><hr>\n<hr>\n<h1 id=\"iptables-应用\"><a href=\"#iptables-应用\" class=\"headerlink\" title=\"iptables 应用\"></a>iptables 应用</h1><p>在OpenWrt上面，<br>开放OpenWrt中OpenClash的HTTP &amp; SOCKS5 Proxy Port</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -p tcp --dport 7893 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">service iptables restart ## 这个是可选的，没执行成功</span><br><span class=\"line\">## OpenWrt上会自动马上生效，估计重启OP会重置，所以需要加到配置文件中</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##查询 iptables 所有列表</span><br><span class=\"line\">iptables -L -n</span><br><span class=\"line\">可以查询到当前列表中的所有项目，包括新增进去的section</span><br><span class=\"line\"></span><br><span class=\"line\">Chain INPUT (policy DROP)</span><br><span class=\"line\">target     prot opt source               destination         </span><br><span class=\"line\">SSR-SERVER-RULE  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class=\"line\">REJECT     udp  --  0.0.0.0/0            0.0.0.0/0            udp dpt:443 /* OpenClash QUIC REJECT */ ! match-set china_ip_route dst reject-with icmp-port-unreachable</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:7893</span><br><span class=\"line\">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">input_rule  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3: Custom input rule chain */</span><br><span class=\"line\">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED /* !fw3 */</span><br><span class=\"line\">DROP       all  --  0.0.0.0/0            0.0.0.0/0            ctstate INVALID /* !fw3 */</span><br><span class=\"line\">syn_flood  tcp  --  0.0.0.0/0            0.0.0.0/0            tcp flags:0x17/0x02 /* !fw3 */</span><br><span class=\"line\">zone_lan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_docker_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">reject     all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<img class=\"lozad\" data-src=\"\">\n\n\n\n<h1 id=\"限制某个MAC-地址访问\"><a href=\"#限制某个MAC-地址访问\" class=\"headerlink\" title=\"限制某个MAC 地址访问\"></a>限制某个MAC 地址访问</h1><p>iptables -I FORWARD  -m mac –mac-source C8:F6:50:B7:@@:@@ -j DROP</p>\n<p>如果想要解除丢弃数据包的指令：<br>解除访问互联网 iptables -D FORWARD  -m mac –mac-source 98:5A:EB:8B:@@:@@ -j DROP</p>\n<p>也可以使用UI的方式：OpenWrt 禁止某台设备联网</p>\n<p>访问放径：网络 》 防火墙 》通信规则 》添加（添加后截图效果如下）</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/12/669108492a5ec.png\" alt=\"image-20240712184109569\"></p>\n","more":"<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><hr>\n<hr>\n<h1 id=\"iptables-应用\"><a href=\"#iptables-应用\" class=\"headerlink\" title=\"iptables 应用\"></a>iptables 应用</h1><p>在OpenWrt上面，<br>开放OpenWrt中OpenClash的HTTP &amp; SOCKS5 Proxy Port</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -p tcp --dport 7893 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">service iptables restart ## 这个是可选的，没执行成功</span><br><span class=\"line\">## OpenWrt上会自动马上生效，估计重启OP会重置，所以需要加到配置文件中</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##查询 iptables 所有列表</span><br><span class=\"line\">iptables -L -n</span><br><span class=\"line\">可以查询到当前列表中的所有项目，包括新增进去的section</span><br><span class=\"line\"></span><br><span class=\"line\">Chain INPUT (policy DROP)</span><br><span class=\"line\">target     prot opt source               destination         </span><br><span class=\"line\">SSR-SERVER-RULE  all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class=\"line\">REJECT     udp  --  0.0.0.0/0            0.0.0.0/0            udp dpt:443 /* OpenClash QUIC REJECT */ ! match-set china_ip_route dst reject-with icmp-port-unreachable</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">openclash_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            ! match-set localnetwork src</span><br><span class=\"line\">ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:7893</span><br><span class=\"line\">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">input_rule  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3: Custom input rule chain */</span><br><span class=\"line\">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED /* !fw3 */</span><br><span class=\"line\">DROP       all  --  0.0.0.0/0            0.0.0.0/0            ctstate INVALID /* !fw3 */</span><br><span class=\"line\">syn_flood  tcp  --  0.0.0.0/0            0.0.0.0/0            tcp flags:0x17/0x02 /* !fw3 */</span><br><span class=\"line\">zone_lan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_wan_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">zone_docker_input  all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\">reject     all  --  0.0.0.0/0            0.0.0.0/0            /* !fw3 */</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<img class=\"lozad\" data-src=\"\">\n\n\n\n<h1 id=\"限制某个MAC-地址访问\"><a href=\"#限制某个MAC-地址访问\" class=\"headerlink\" title=\"限制某个MAC 地址访问\"></a>限制某个MAC 地址访问</h1><p>iptables -I FORWARD  -m mac –mac-source C8:F6:50:B7:@@:@@ -j DROP</p>\n<p>如果想要解除丢弃数据包的指令：<br>解除访问互联网 iptables -D FORWARD  -m mac –mac-source 98:5A:EB:8B:@@:@@ -j DROP</p>\n<p>也可以使用UI的方式：OpenWrt 禁止某台设备联网</p>\n<p>访问放径：网络 》 防火墙 》通信规则 》添加（添加后截图效果如下）</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/07/12/669108492a5ec.png\" alt=\"image-20240712184109569\"></p>","categories":[{"name":"openwrt","path":"api/categories/openwrt.json"}],"tags":[{"name":"debian","path":"api/tags/debian.json"},{"name":"openwrt","path":"api/tags/openwrt.json"},{"name":"linux","path":"api/tags/linux.json"},{"name":"iptables","path":"api/tags/iptables.json"}]}