{"title":"升级Artalk评论至V2-8-3解决错误(请求响应404)","slug":"升级Artalk评论至V2-8-3-解决Error-请求响应404","date":"2024-03-28T08:54:36.000Z","updated":"2024-10-25T12:35:05.917Z","comments":true,"path":"api/articles/升级Artalk评论至V2-8-3-解决Error-请求响应404.json","excerpt":" [Figure] 记录升级Artalk评论至V2.8.3，并解决Artalk Error Error: 请求响应 404，无法获取评论列表数据","covers":["https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png","https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png"],"content":"<p><img data-src=\"https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png\" alt=\"image-20240328164913925\"></p>\n<p>记录升级Artalk评论至V2.8.3，并解决Artalk Error Error: 请求响应 404，无法获取评论列表数据</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>升级Artalk评论至V2.8.3</p>\n<p>解决Artalk Error Error: 请求响应 404，无法获取评论列表数据</p>\n<h1 id=\"心路历程\"><a href=\"#心路历程\" class=\"headerlink\" title=\"心路历程\"></a>心路历程</h1><p>Artalk配置的SMTP，一直无法正常发送邮件；不清楚原因是什么？证书？日志呢？如何忽略验证？只能尝试升级这家伙先，当前版本（docker中输出）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Artalk (v2.6.4/8867eb2)     </span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/ArtalkJS/Artalk/issues/748\">https://github.com/ArtalkJS/Artalk/issues/748</a></p>\n<p>决定需要升级artalk到目前最新版！</p>\n<p>升级步骤</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">先关闭artalk服务</span></span><br><span class=\"line\">docker-compose down</span><br><span class=\"line\"></span><br><span class=\"line\">docker-compose pull</span><br><span class=\"line\">docker-compose up --remove-orphans </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">清理artalk旧版本的docker镜像</span></span><br><span class=\"line\">docker image prune</span><br></pre></td></tr></table></figure>\n\n<p>这三条命令就升级到当前最新版本：Artalk (v2.8.3&#x2F;8af7136)  </p>\n<p>页面提示出现错误：请求响应 404</p>\n<p>Artalk Error Error: 请求响应 404，无法获取评论列表数据<br>点击重新获取 | 打开控制台</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png\" alt=\"image-20240328164913925\"></p>\n<p>解决办法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">404 （未找到） 服务器找不到请求的网页。</span><br></pre></td></tr></table></figure>\n\n<p>反复检查，测试。</p>\n<p>docker绝对启动都正常了，</p>\n<p>严重怀疑是hexo版本滞后导致的请求页面错误？</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NexT.utils.loadComments(CONFIG.artalk.el)</span><br><span class=\"line\">  .then(() =&gt; NexT.utils.getScript(CONFIG.artalk.jsUrl, &#123;</span><br><span class=\"line\">    condition: window.Artalk </span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">  .then(() =&gt; &#123;</span><br><span class=\"line\">    Artalk.init(CONFIG.artalk);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>问题变成 ：hexo怎么升级？</p>\n<p>第二天复盘，server端的artalk是重装的最新版（保留原始数据），应该问题不大，那么就是如何integrate集成hexo的问题了；无非是node端的安装，hexo相关的配置 和 JS client，一一检查过去：</p>\n<p>尝试更新hexo的artalk插件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-next-artalk</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">提示up to <span class=\"built_in\">date</span>，说明插件已是最新版</span></span><br></pre></td></tr></table></figure>\n\n<p>无意间注意到_config.yml中引入的artalk是有版本的（是旧的版本）</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\">        <span class=\"comment\">#https://cdn.staticfile.org/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n<p>我必须把它升级到我目前docker-compose pull出来的最新版v2.8.3</p>\n<p>果然，修改了hexo的配置文件_config.yml中的关于JS和CSS的引用后，借助<a href=\"https://cdnjs.com/libraries/artalk\">https://cdnjs.com/libraries/artalk</a></p>\n<p>本地hexo clean</p>\n<p>hexo g &amp;&amp; hexo s</p>\n<p>成功解除404错误</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>下一步：继续检查&amp;测试artalk V2.8.3的smtp发通知功能</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com</span><br></pre></td></tr></table></figure>\n\n<p>ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=artalk\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | Artalk (v2.8.3/8af7136)                                                                          </span><br><span class=\"line\">artalk  |                                                                                                  </span><br><span class=\"line\">artalk  |  -&gt; A Self-hosted Comment System.                                                                </span><br><span class=\"line\">artalk  |  -&gt; https://artalk.js.org                                                                        </span><br><span class=\"line\">artalk  |                                                                                                  </span><br><span class=\"line\">artalk  | -------------------------------                                                                  </span><br><span class=\"line\">artalk  |                                                                                                  </span><br><span class=\"line\">artalk  | FATAL tls: provide a valid cert or key path                                                      </span><br><span class=\"line\">artalk exited with code 0  </span><br></pre></td></tr></table></figure>\n\n<p>即便把smtp的端口修改为25提示：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com   </span><br></pre></td></tr></table></figure>\n\n<p>感觉下一步入手：</p>\n<p>​\tartalk  | FATAL tls: provide a valid cert or key path  </p>\n<h2 id=\"发布注意事项\"><a href=\"#发布注意事项\" class=\"headerlink\" title=\"发布注意事项\"></a>发布注意事项</h2><p>需要将config.yaml修改了JS和CSS的文件内容<strong>同步</strong>更新至&#x2F;en目录下的英文站点，否则英文站点下的评论功能也会出现Error: 请求响应 404。</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://www.carlzeng.top/202310261222.html\">Hexo定制之家宽部署artalk评论</a></p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>升级Artalk评论至V2.8.3</p>\n<p>解决Artalk Error Error: 请求响应 404，无法获取评论列表数据</p>\n<h1 id=\"心路历程\"><a href=\"#心路历程\" class=\"headerlink\" title=\"心路历程\"></a>心路历程</h1><p>Artalk配置的SMTP，一直无法正常发送邮件；不清楚原因是什么？证书？日志呢？如何忽略验证？只能尝试升级这家伙先，当前版本（docker中输出）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Artalk (v2.6.4/8867eb2)     </span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/ArtalkJS/Artalk/issues/748\">https://github.com/ArtalkJS/Artalk/issues/748</a></p>\n<p>决定需要升级artalk到目前最新版！</p>\n<p>升级步骤</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">先关闭artalk服务</span></span><br><span class=\"line\">docker-compose down</span><br><span class=\"line\"></span><br><span class=\"line\">docker-compose pull</span><br><span class=\"line\">docker-compose up --remove-orphans </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">清理artalk旧版本的docker镜像</span></span><br><span class=\"line\">docker image prune</span><br></pre></td></tr></table></figure>\n\n<p>这三条命令就升级到当前最新版本：Artalk (v2.8.3&#x2F;8af7136)  </p>\n<p>页面提示出现错误：请求响应 404</p>\n<p>Artalk Error Error: 请求响应 404，无法获取评论列表数据<br>点击重新获取 | 打开控制台</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png\" alt=\"image-20240328164913925\"></p>\n<p>解决办法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">404 （未找到） 服务器找不到请求的网页。</span><br></pre></td></tr></table></figure>\n\n<p>反复检查，测试。</p>\n<p>docker绝对启动都正常了，</p>\n<p>严重怀疑是hexo版本滞后导致的请求页面错误？</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NexT.utils.loadComments(CONFIG.artalk.el)</span><br><span class=\"line\">  .then(() =&gt; NexT.utils.getScript(CONFIG.artalk.jsUrl, &#123;</span><br><span class=\"line\">    condition: window.Artalk </span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">  .then(() =&gt; &#123;</span><br><span class=\"line\">    Artalk.init(CONFIG.artalk);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>问题变成 ：hexo怎么升级？</p>\n<p>第二天复盘，server端的artalk是重装的最新版（保留原始数据），应该问题不大，那么就是如何integrate集成hexo的问题了；无非是node端的安装，hexo相关的配置 和 JS client，一一检查过去：</p>\n<p>尝试更新hexo的artalk插件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-next-artalk</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">提示up to <span class=\"built_in\">date</span>，说明插件已是最新版</span></span><br></pre></td></tr></table></figure>\n\n<p>无意间注意到_config.yml中引入的artalk是有版本的（是旧的版本）</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\">        <span class=\"comment\">#https://cdn.staticfile.org/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n<p>我必须把它升级到我目前docker-compose pull出来的最新版v2.8.3</p>\n<p>果然，修改了hexo的配置文件_config.yml中的关于JS和CSS的引用后，借助<a href=\"https://cdnjs.com/libraries/artalk\">https://cdnjs.com/libraries/artalk</a></p>\n<p>本地hexo clean</p>\n<p>hexo g &amp;&amp; hexo s</p>\n<p>成功解除404错误</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>下一步：继续检查&amp;测试artalk V2.8.3的smtp发通知功能</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com</span><br></pre></td></tr></table></figure>\n\n<p>ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=artalk\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | Artalk (v2.8.3/8af7136)                                                                          </span><br><span class=\"line\">artalk  |                                                                                                  </span><br><span class=\"line\">artalk  |  -&gt; A Self-hosted Comment System.                                                                </span><br><span class=\"line\">artalk  |  -&gt; https://artalk.js.org                                                                        </span><br><span class=\"line\">artalk  |                                                                                                  </span><br><span class=\"line\">artalk  | -------------------------------                                                                  </span><br><span class=\"line\">artalk  |                                                                                                  </span><br><span class=\"line\">artalk  | FATAL tls: provide a valid cert or key path                                                      </span><br><span class=\"line\">artalk exited with code 0  </span><br></pre></td></tr></table></figure>\n\n<p>即便把smtp的端口修改为25提示：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com   </span><br></pre></td></tr></table></figure>\n\n<p>感觉下一步入手：</p>\n<p>​\tartalk  | FATAL tls: provide a valid cert or key path  </p>\n<h2 id=\"发布注意事项\"><a href=\"#发布注意事项\" class=\"headerlink\" title=\"发布注意事项\"></a>发布注意事项</h2><p>需要将config.yaml修改了JS和CSS的文件内容<strong>同步</strong>更新至&#x2F;en目录下的英文站点，否则英文站点下的评论功能也会出现Error: 请求响应 404。</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://www.carlzeng.top/202310261222.html\">Hexo定制之家宽部署artalk评论</a></p>","categories":[{"name":"Artalk","path":"api/categories/Artalk.json"}],"tags":[{"name":"debian","path":"api/tags/debian.json"},{"name":"hexo","path":"api/tags/hexo.json"},{"name":"artalk","path":"api/tags/artalk.json"},{"name":"Nginx Proxy Manager","path":"api/tags/Nginx Proxy Manager.json"},{"name":"DDNS","path":"api/tags/DDNS.json"},{"name":"openwrt","path":"api/tags/openwrt.json"},{"name":"linux","path":"api/tags/linux.json"}]}