{"title":"孩子手机防沉迷之定时路由器端断网","slug":"孩子手机防沉迷之定时路由器端断网","date":"2023-12-07T08:25:36.000Z","updated":"2024-07-01T14:47:22.734Z","comments":true,"path":"api/articles/孩子手机防沉迷之定时路由器端断网.json","excerpt":" [Figure] 学会如何一键给孩子手机(机顶盒，iPad，电子学习机等设备)加上定时断网在控制端手机一键让孩子手机定时自动断网（电子设备防沉迷）","covers":["https://www.evernote.com/shard/s122/sh/4b7d3a56-0a2d-4487-9f08-e6c43e555709/86GFchghtZNA_PORS9sjFaFm4lBQDuNRqyRMRJbnN2OWDYt5HVmMjmh8Eg/deep/0/image.png"],"content":"<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/4b7d3a56-0a2d-4487-9f08-e6c43e555709/86GFchghtZNA_PORS9sjFaFm4lBQDuNRqyRMRJbnN2OWDYt5HVmMjmh8Eg/deep/0/image.png\">\n\n<p>学会如何一键给孩子手机(机顶盒，iPad，电子学习机等设备)加上定时断网</p>\n<p>在控制端手机一键让孩子手机定时自动断网（电子设备防沉迷）</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,1000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>在另外一台手机控制，通过1-2键给手机加上定时断网功能。</p>\n<p>优点：一键操作，不需要后续动作；不需要碰触到孩子手机；由于一般情况下手机的WIFI和数据网络是同时打开着的，这种断网，WIFI依旧连接（只是后台路由器丢弃了上网的数据包），手机自动依旧发数据到WIFI（路由器）而得不到返回的数据包。</p>\n<p>缺点：部署需要一定计算机知识，步骤太多了点</p>\n<h2 id=\"背景及个人应用\"><a href=\"#背景及个人应用\" class=\"headerlink\" title=\"背景及个人应用\"></a>背景及个人应用</h2><p>没错，我们有一个拉屎的激励机制，那就是上厕所就可以看手机。</p>\n<p>「别笑，这招非常管用，比现代医院医学的治疗积食等等因为不及时主动排便所引发的疾病治疗手段要有效得多」</p>\n<p>「我们发现很多跟孩子们的引导，还是在精神层面要重要，要紧急」</p>\n<p>但问题来了，孩子会因为贪看手机而长时间（超半小时）呆在厕所，虽然起到拉屎的作用，可副作用也来了。<br>多次用语言提醒尝试后，无法起到预期效果，又动了气又让气氛不好。<br>     突然想到了iPad是通过OP的iptables命令来丢弃数据包（限制访问外网），何不也把手机的数据包按时或定时限制访问互联网来自动提醒孩子该结束‘上厕所’的时间了。<br>        如何方便家长的手机快速下达：定时10-15分钟后关闭网络，然后最好10分钟后在自动开启手机的网络访问。<br>        shell或者python可以很轻松实现的功能吧；</p>\n<p>实在有不会的地方就在线问 <a href=\"https://c.carlzeng.top:3/chat\">ChatGPT</a></p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><p>目前的前提条件：你家里的路由器，需要能安装python（这个要求比较高）</p>\n<p>其实可以把脚本改一改，改成shell版本的，这样普通的K2P之类的100百元级别路由器（刷了系统）即可支持了</p>\n<ol>\n<li>当孩子需要使用电子设备时，提前跟TA们说好：只能使用15分钟（具体可以根据自己情况参数里面调），时间到以后设备会自动断网哦！<ol>\n<li>征询TA们同意以后，解锁手机（或机顶盒等电子设备）给孩子使用</li>\n</ol>\n</li>\n<li>打开家长自己的手机，登录ConnectBot（或者其他的安卓或苹果端ssh工具）回车运行python命令即可。<ol>\n<li>一条命令下去，家长就不需要操作任何了，到时间程序会自动给特定的电子设备断网，然后在多长时间后自己恢复（这个时候手机已经上锁）</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><p>如果您对相关的 <a href=\"https://www.carlzeng.top/search?q=openwrt\">openwrt</a> 感兴趣，以下内容可能帮到您：</p>\n<iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=openwrt\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><p>一下以OpenWrt系统的路由器（架设有phthon环境），安卓手机作为例子：</p>\n<p>就是下面2方面，其他不需要设置任何了，不需要安装任何APP</p>\n<h2 id=\"设置路由器端\"><a href=\"#设置路由器端\" class=\"headerlink\" title=\"设置路由器端\"></a>设置路由器端</h2><p>用电脑或手机登录到路由的ssh，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /root</span><br><span class=\"line\"></span><br><span class=\"line\">vi laShiPhone.py</span><br><span class=\"line\"></span><br><span class=\"line\">粘贴下面的代码（适当修改）完成后：</span><br><span class=\"line\">esc</span><br><span class=\"line\">:wq）</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> subprocess</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">disable_network</span>(<span class=\"params\">mac_address</span>):</span><br><span class=\"line\">    subprocess.run([<span class=\"string\">&#x27;iptables&#x27;</span>, <span class=\"string\">&#x27;-I&#x27;</span>, <span class=\"string\">&#x27;FORWARD&#x27;</span>, <span class=\"string\">&#x27;-m&#x27;</span>, <span class=\"string\">&#x27;mac&#x27;</span>, <span class=\"string\">&#x27;--mac-source&#x27;</span>, mac_address, <span class=\"string\">&#x27;-j&#x27;</span>, <span class=\"string\">&#x27;DROP&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">enable_network</span>(<span class=\"params\">mac_address</span>):</span><br><span class=\"line\">    subprocess.run([<span class=\"string\">&#x27;iptables&#x27;</span>, <span class=\"string\">&#x27;-D&#x27;</span>, <span class=\"string\">&#x27;FORWARD&#x27;</span>, <span class=\"string\">&#x27;-m&#x27;</span>, <span class=\"string\">&#x27;mac&#x27;</span>, <span class=\"string\">&#x27;--mac-source&#x27;</span>, mac_address, <span class=\"string\">&#x27;-j&#x27;</span>, <span class=\"string\">&#x27;DROP&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># MAC地址，修改为孩子手机的MAC地址（路由器中可以查看）</span></span><br><span class=\"line\">mac_address = <span class=\"string\">&#x27;1E:2B:D2:A8:D1:AA&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">enable_network(mac_address)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;1. Open Network 15min for &#x27;</span> + mac_address + <span class=\"string\">&#x27;. Time: &#x27;</span> + time.ctime())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 等待15分钟</span></span><br><span class=\"line\">time.sleep(<span class=\"number\">15</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 关闭网络连接</span></span><br><span class=\"line\">disable_network(mac_address)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;2. Done CLOSED Network, will open it 15min later. Time: &#x27;</span> + time.ctime())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 等待另外15分钟</span></span><br><span class=\"line\">time.sleep(<span class=\"number\">15</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"><span class=\"comment\"># 打开网络连接</span></span><br><span class=\"line\">enable_network(mac_address)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;3. Done Open Network, exit()&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 退出脚本</span></span><br><span class=\"line\">sys.exit(<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"如何查阅手机等设备的MAC地址？\"><a href=\"#如何查阅手机等设备的MAC地址？\" class=\"headerlink\" title=\"如何查阅手机等设备的MAC地址？\"></a>如何查阅手机等设备的MAC地址？</h3><p>打开Openwrt的Web端，在连接设备里面直接查看就好。</p>\n<p>我个人的<a href=\"http://192.168.6.1:8080/cgi-bin/luci/admin/status/overview\">查看URL地址</a></p>\n<h2 id=\"设置控制端手机\"><a href=\"#设置控制端手机\" class=\"headerlink\" title=\"设置控制端手机\"></a>设置控制端手机</h2><p>（安卓手机为例子）</p>\n<ol>\n<li>下载安装开源的SSH客户端：ConnectBot<ol>\n<li>下载地址：download ConnectBot from our <a href=\"https://github.com/connectbot/connectbot/releases\">releases page</a> <a href=\"https://github.com/connectbot/connectbot/releases/\">https://github.com/connectbot/connectbot/releases/</a></li>\n</ol>\n</li>\n<li>（一次性设置）操作ConnectBot生成密钥<ol>\n<li>右上角（三个点）</li>\n<li>管理密钥</li>\n<li>右上角（加号）<ol>\n<li>输入密钥名字（任意取名用户自我识别）</li>\n<li>默认的RSA</li>\n<li>位数1024足够了</li>\n<li>密码：可以为空，家庭局域网用留空就好</li>\n<li>生成</li>\n<li>按引导提示：在屏幕上乱滑动这样生成随机的密钥（直到进度100%）</li>\n<li>右上角（三个点） “复制公钥”（备用，在第三步中粘贴）</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>（一次性设置）新建主机连接<ol>\n<li><p>右下角+号</p>\n</li>\n<li><p>输入（开启了SSH的）：用户名@路由的IP地址，比如：<a href=\"mailto:&#x72;&#x6f;&#111;&#116;&#64;&#x31;&#57;&#50;&#46;&#49;&#54;&#56;&#x2e;&#x31;&#50;&#51;&#46;&#x31;\">&#x72;&#x6f;&#111;&#116;&#64;&#x31;&#57;&#50;&#46;&#49;&#54;&#56;&#x2e;&#x31;&#50;&#51;&#46;&#x31;</a></p>\n</li>\n<li><p>点击“使用密钥验证”</p>\n<ol>\n<li>选择上一步中保存的密钥名</li>\n</ol>\n</li>\n<li><p>“登录后自动运行”</p>\n<ol>\n<li>填写：python &#x2F;root&#x2F;laShiPhone.py</li>\n</ol>\n</li>\n<li><p>保存</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"返回路由器端设置免密码登陆\"><a href=\"#返回路由器端设置免密码登陆\" class=\"headerlink\" title=\"返回路由器端设置免密码登陆\"></a>返回路由器端设置免密码登陆</h2><p>参考 <a href=\"http://doc.aiwaly.com/docs/arm/arm-1eub39jsnsnvm\">OPENWRT中SSH免密钥登陆（具体步骤）</a></p>\n<ol>\n<li>SSH到路由器中，新建或编辑（如果已经存在authorized_keys文件） &#x2F;etc&#x2F;dropbear&#x2F;authorized_keys</li>\n<li>粘贴在第二步（设置控制端手机 &gt; 操作ConnectBot生成密钥 &gt; 复制公钥）</li>\n<li>保存authorized_keys, 拷贝完毕后，正常登陆一次目标主机。</li>\n<li>退出后又一次登陆，这个时候就配置的ssh密钥能够自动登陆目标主机了（无需输入密码）。</li>\n</ol>\n<h1 id=\"实践操作\"><a href=\"#实践操作\" class=\"headerlink\" title=\"实践操作\"></a>实践操作</h1><ol>\n<li>打开控制端手机</li>\n<li>点击保存的主机名（会自动登录）</li>\n<li>按回车，一键启动（登录后会自己显示配置的“登录后自动运行”的命令）</li>\n</ol>\n<h1 id=\"其他情况\"><a href=\"#其他情况\" class=\"headerlink\" title=\"其他情况\"></a>其他情况</h1><p>有人要说了，加入我的路由器没有python环境，是那种简单的openwrt系统的；</p>\n<p>那你可以问问<a href=\"https://c.carlzeng.top:3/chat\">ChatGPT</a>，把脚本改成shell，版本的；无非是执行的使用 chmod一下，然后运行: . &#x2F;XXX.sh</p>\n<p>如果需要留言多的话我在去转化一下shell版本的。</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://www.carlzeng.top/202311042118.html\">ipad解锁激活锁苹果平板绕激活锁经验</a></p>\n<p><a href=\"https://www.etaozj.com/723.html\">ConnectBot免密码登陆</a></p>\n<p><a href=\"https://3mile.github.io/archives/2020/0312120820/\">OpenWrt 下 ssh 密钥登录</a></p>\n<h2 id=\"过程绕弯路\"><a href=\"#过程绕弯路\" class=\"headerlink\" title=\"过程绕弯路\"></a>过程绕弯路</h2><p>【可选步骤】为了安全起见，openwrt 创建用户</p>\n<p>先ssh连上路由<br>        vim打开passwd文件，命令: vim &#x2F;etc&#x2F;passwd<br>        然后光标移到最后插入一行：（vim 按 i 插入）</p>\n<pre><code>    用户名：*：用户ID：用户组ID：三个逗号：/home/用户名：/bin/bash\n\n    示例：user123:*:1000:1000:,,,:/home/user123:/bin/bash\n\n    注意全英文，id建议1000以上，不要100以内\n    检查无误后保存退出（vim按esc退出编辑，然后输入:wq保存退出，注意英文）\n\n    然后编辑group文件，命令: vim /etc/group\n    同样最后一行插入：\n\n    用户组名：*：用户组ID：\n\n    示例：user123:*:1000:\n\n\n    vim /etc/passwd\n    carlzeng:*:7000:7000:,,,:/home/carlzeng:/bin/bash\n    passwd carlzeng\n        直接回车，这样把密码设置为空！\n    vim /etc/group\n        carlzeng:*:0: \n\n测试发现Termius弊端，\n    snippet 很多限制，毕竟是收费软件\n</code></pre>\n<p>切换回开源的ConnectBot，原来用密钥登录也是那么简单，而且还更安全！</p>\n<h1 id=\"改进\"><a href=\"#改进\" class=\"headerlink\" title=\"改进\"></a>改进</h1><p>用手机端打开ConnectBot（配置好了自动登录路由器）直接就到了输入命令的（并且设置了预先输好了默认的命令），已经挺方便了；通过维护不同的客户端，来选择性的临时关闭特定电子设备的外网访问。</p>\n<p>可是发现一旦手机退出ConnectBot，那条命令就不执行了（不管是执行过程在15分钟的等待时间还是在那里）</p>\n<h2 id=\"如何让python程序后台运行\"><a href=\"#如何让python程序后台运行\" class=\"headerlink\" title=\"如何让python程序后台运行\"></a>如何让python程序后台运行</h2><p>使用nohup（no hand up），在命令前面加一个nohup程序就会进入后台执行，我们事后查看nohup.out可以看到些信息，或ps可以检查“python &#x2F;root&#x2F;laShiPhone.py”这条命令是否存在（约30分钟后消失）</p>\n<p>默认的执行变成：nohup python &#x2F;root&#x2F;laShiPhone.py</p>\n<h1 id=\"下一步\"><a href=\"#下一步\" class=\"headerlink\" title=\"下一步\"></a>下一步</h1><p>正在寻找，思路：</p>\n<p>手机刷入 防沉迷 \t系统</p>\n<p>小米K40</p>\n<p>安卓 屏幕时间管理 app</p>\n<p>手机 青少年模式</p>\n<p>儿童空间</p>\n<p>下载了一加的兄弟Oppo退出的儿童空间，发现安装时提示：无法解析包。</p>\n<p>回到原始的方案，既然已经root了，直接<strong>删除系统自带的浏览器、商店</strong>等等系统自带应用。</p>\n<blockquote>\n<p>20240701</p>\n<p><a href=\"https://www.v2ex.com/t/673579\">https://www.v2ex.com/t/673579</a></p>\n</blockquote>\n<p>暴力一点，获取 ROOT 后直接冻结「软件包安装程序」这个系统自带的 APP</p>\n<p>​\tice-box.apk 已准备就绪</p>\n<p>root 后，把 apk 安装程序卸载就行。</p>\n<h1 id=\"删除商店\"><a href=\"#删除商店\" class=\"headerlink\" title=\"删除商店\"></a>删除商店</h1><p>我在&#x2F;system&#x2F;app下找到了一加从腾讯浏览器修改来的系统自带浏览器，删除。</p>\n<p>“商店”怎么也找不到，解决办法，上adb工具；</p>\n<ol>\n<li>连接一加5T到电脑</li>\n<li>用adb管理应用（android系统包）：</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.ssh % adb -s 5d817fad shell pm list packages | grep market                 </span><br><span class=\"line\">package:com.oppo.market  </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">得出应该使用的命令是：adb -s 5d817fad shell pm uninstall -k --user 0 com.oppo.market</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">adb -s 5d817fad shell pm uninstall -k --user 0 com.oppo.market</span></span><br><span class=\"line\">Success</span><br></pre></td></tr></table></figure>\n\n<p>后来得知，有些是安装在： &#x2F;system&#x2F;reserve</p>\n<p>这个pm uninstall works on all Android devices在所有的安卓系统上都是通用的，都是可以使用的</p>\n<p>本章节感谢</p>\n<p><a href=\"https://www.v2ex.com/t/699878\">https://www.v2ex.com/t/699878</a></p>\n<p><a href=\"https://bbs.oneplus.com/thread/6003405\">精简oppo系统 coloros13 adb停用删除自带app，卸载快应用</a></p>\n<h1 id=\"屏幕时间管理\"><a href=\"#屏幕时间管理\" class=\"headerlink\" title=\"屏幕时间管理\"></a>屏幕时间管理</h1><p><a href=\"http://www.3673.com/down/33707.html\">屏幕时间管理app.apk</a>\t<br>    测试结果是：这个APP不支持root的手机</p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,1000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>在另外一台手机控制，通过1-2键给手机加上定时断网功能。</p>\n<p>优点：一键操作，不需要后续动作；不需要碰触到孩子手机；由于一般情况下手机的WIFI和数据网络是同时打开着的，这种断网，WIFI依旧连接（只是后台路由器丢弃了上网的数据包），手机自动依旧发数据到WIFI（路由器）而得不到返回的数据包。</p>\n<p>缺点：部署需要一定计算机知识，步骤太多了点</p>\n<h2 id=\"背景及个人应用\"><a href=\"#背景及个人应用\" class=\"headerlink\" title=\"背景及个人应用\"></a>背景及个人应用</h2><p>没错，我们有一个拉屎的激励机制，那就是上厕所就可以看手机。</p>\n<p>「别笑，这招非常管用，比现代医院医学的治疗积食等等因为不及时主动排便所引发的疾病治疗手段要有效得多」</p>\n<p>「我们发现很多跟孩子们的引导，还是在精神层面要重要，要紧急」</p>\n<p>但问题来了，孩子会因为贪看手机而长时间（超半小时）呆在厕所，虽然起到拉屎的作用，可副作用也来了。<br>多次用语言提醒尝试后，无法起到预期效果，又动了气又让气氛不好。<br>     突然想到了iPad是通过OP的iptables命令来丢弃数据包（限制访问外网），何不也把手机的数据包按时或定时限制访问互联网来自动提醒孩子该结束‘上厕所’的时间了。<br>        如何方便家长的手机快速下达：定时10-15分钟后关闭网络，然后最好10分钟后在自动开启手机的网络访问。<br>        shell或者python可以很轻松实现的功能吧；</p>\n<p>实在有不会的地方就在线问 <a href=\"https://c.carlzeng.top:3/chat\">ChatGPT</a></p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><p>目前的前提条件：你家里的路由器，需要能安装python（这个要求比较高）</p>\n<p>其实可以把脚本改一改，改成shell版本的，这样普通的K2P之类的100百元级别路由器（刷了系统）即可支持了</p>\n<ol>\n<li>当孩子需要使用电子设备时，提前跟TA们说好：只能使用15分钟（具体可以根据自己情况参数里面调），时间到以后设备会自动断网哦！<ol>\n<li>征询TA们同意以后，解锁手机（或机顶盒等电子设备）给孩子使用</li>\n</ol>\n</li>\n<li>打开家长自己的手机，登录ConnectBot（或者其他的安卓或苹果端ssh工具）回车运行python命令即可。<ol>\n<li>一条命令下去，家长就不需要操作任何了，到时间程序会自动给特定的电子设备断网，然后在多长时间后自己恢复（这个时候手机已经上锁）</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><p>如果您对相关的 <a href=\"https://www.carlzeng.top/search?q=openwrt\">openwrt</a> 感兴趣，以下内容可能帮到您：</p>\n<iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=openwrt\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><p>一下以OpenWrt系统的路由器（架设有phthon环境），安卓手机作为例子：</p>\n<p>就是下面2方面，其他不需要设置任何了，不需要安装任何APP</p>\n<h2 id=\"设置路由器端\"><a href=\"#设置路由器端\" class=\"headerlink\" title=\"设置路由器端\"></a>设置路由器端</h2><p>用电脑或手机登录到路由的ssh，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /root</span><br><span class=\"line\"></span><br><span class=\"line\">vi laShiPhone.py</span><br><span class=\"line\"></span><br><span class=\"line\">粘贴下面的代码（适当修改）完成后：</span><br><span class=\"line\">esc</span><br><span class=\"line\">:wq）</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> subprocess</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">disable_network</span>(<span class=\"params\">mac_address</span>):</span><br><span class=\"line\">    subprocess.run([<span class=\"string\">&#x27;iptables&#x27;</span>, <span class=\"string\">&#x27;-I&#x27;</span>, <span class=\"string\">&#x27;FORWARD&#x27;</span>, <span class=\"string\">&#x27;-m&#x27;</span>, <span class=\"string\">&#x27;mac&#x27;</span>, <span class=\"string\">&#x27;--mac-source&#x27;</span>, mac_address, <span class=\"string\">&#x27;-j&#x27;</span>, <span class=\"string\">&#x27;DROP&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">enable_network</span>(<span class=\"params\">mac_address</span>):</span><br><span class=\"line\">    subprocess.run([<span class=\"string\">&#x27;iptables&#x27;</span>, <span class=\"string\">&#x27;-D&#x27;</span>, <span class=\"string\">&#x27;FORWARD&#x27;</span>, <span class=\"string\">&#x27;-m&#x27;</span>, <span class=\"string\">&#x27;mac&#x27;</span>, <span class=\"string\">&#x27;--mac-source&#x27;</span>, mac_address, <span class=\"string\">&#x27;-j&#x27;</span>, <span class=\"string\">&#x27;DROP&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># MAC地址，修改为孩子手机的MAC地址（路由器中可以查看）</span></span><br><span class=\"line\">mac_address = <span class=\"string\">&#x27;1E:2B:D2:A8:D1:AA&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">enable_network(mac_address)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;1. Open Network 15min for &#x27;</span> + mac_address + <span class=\"string\">&#x27;. Time: &#x27;</span> + time.ctime())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 等待15分钟</span></span><br><span class=\"line\">time.sleep(<span class=\"number\">15</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 关闭网络连接</span></span><br><span class=\"line\">disable_network(mac_address)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;2. Done CLOSED Network, will open it 15min later. Time: &#x27;</span> + time.ctime())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 等待另外15分钟</span></span><br><span class=\"line\">time.sleep(<span class=\"number\">15</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"><span class=\"comment\"># 打开网络连接</span></span><br><span class=\"line\">enable_network(mac_address)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;3. Done Open Network, exit()&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 退出脚本</span></span><br><span class=\"line\">sys.exit(<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"如何查阅手机等设备的MAC地址？\"><a href=\"#如何查阅手机等设备的MAC地址？\" class=\"headerlink\" title=\"如何查阅手机等设备的MAC地址？\"></a>如何查阅手机等设备的MAC地址？</h3><p>打开Openwrt的Web端，在连接设备里面直接查看就好。</p>\n<p>我个人的<a href=\"http://192.168.6.1:8080/cgi-bin/luci/admin/status/overview\">查看URL地址</a></p>\n<h2 id=\"设置控制端手机\"><a href=\"#设置控制端手机\" class=\"headerlink\" title=\"设置控制端手机\"></a>设置控制端手机</h2><p>（安卓手机为例子）</p>\n<ol>\n<li>下载安装开源的SSH客户端：ConnectBot<ol>\n<li>下载地址：download ConnectBot from our <a href=\"https://github.com/connectbot/connectbot/releases\">releases page</a> <a href=\"https://github.com/connectbot/connectbot/releases/\">https://github.com/connectbot/connectbot/releases/</a></li>\n</ol>\n</li>\n<li>（一次性设置）操作ConnectBot生成密钥<ol>\n<li>右上角（三个点）</li>\n<li>管理密钥</li>\n<li>右上角（加号）<ol>\n<li>输入密钥名字（任意取名用户自我识别）</li>\n<li>默认的RSA</li>\n<li>位数1024足够了</li>\n<li>密码：可以为空，家庭局域网用留空就好</li>\n<li>生成</li>\n<li>按引导提示：在屏幕上乱滑动这样生成随机的密钥（直到进度100%）</li>\n<li>右上角（三个点） “复制公钥”（备用，在第三步中粘贴）</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>（一次性设置）新建主机连接<ol>\n<li><p>右下角+号</p>\n</li>\n<li><p>输入（开启了SSH的）：用户名@路由的IP地址，比如：<a href=\"mailto:&#x72;&#x6f;&#111;&#116;&#64;&#x31;&#57;&#50;&#46;&#49;&#54;&#56;&#x2e;&#x31;&#50;&#51;&#46;&#x31;\">&#x72;&#x6f;&#111;&#116;&#64;&#x31;&#57;&#50;&#46;&#49;&#54;&#56;&#x2e;&#x31;&#50;&#51;&#46;&#x31;</a></p>\n</li>\n<li><p>点击“使用密钥验证”</p>\n<ol>\n<li>选择上一步中保存的密钥名</li>\n</ol>\n</li>\n<li><p>“登录后自动运行”</p>\n<ol>\n<li>填写：python &#x2F;root&#x2F;laShiPhone.py</li>\n</ol>\n</li>\n<li><p>保存</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"返回路由器端设置免密码登陆\"><a href=\"#返回路由器端设置免密码登陆\" class=\"headerlink\" title=\"返回路由器端设置免密码登陆\"></a>返回路由器端设置免密码登陆</h2><p>参考 <a href=\"http://doc.aiwaly.com/docs/arm/arm-1eub39jsnsnvm\">OPENWRT中SSH免密钥登陆（具体步骤）</a></p>\n<ol>\n<li>SSH到路由器中，新建或编辑（如果已经存在authorized_keys文件） &#x2F;etc&#x2F;dropbear&#x2F;authorized_keys</li>\n<li>粘贴在第二步（设置控制端手机 &gt; 操作ConnectBot生成密钥 &gt; 复制公钥）</li>\n<li>保存authorized_keys, 拷贝完毕后，正常登陆一次目标主机。</li>\n<li>退出后又一次登陆，这个时候就配置的ssh密钥能够自动登陆目标主机了（无需输入密码）。</li>\n</ol>\n<h1 id=\"实践操作\"><a href=\"#实践操作\" class=\"headerlink\" title=\"实践操作\"></a>实践操作</h1><ol>\n<li>打开控制端手机</li>\n<li>点击保存的主机名（会自动登录）</li>\n<li>按回车，一键启动（登录后会自己显示配置的“登录后自动运行”的命令）</li>\n</ol>\n<h1 id=\"其他情况\"><a href=\"#其他情况\" class=\"headerlink\" title=\"其他情况\"></a>其他情况</h1><p>有人要说了，加入我的路由器没有python环境，是那种简单的openwrt系统的；</p>\n<p>那你可以问问<a href=\"https://c.carlzeng.top:3/chat\">ChatGPT</a>，把脚本改成shell，版本的；无非是执行的使用 chmod一下，然后运行: . &#x2F;XXX.sh</p>\n<p>如果需要留言多的话我在去转化一下shell版本的。</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://www.carlzeng.top/202311042118.html\">ipad解锁激活锁苹果平板绕激活锁经验</a></p>\n<p><a href=\"https://www.etaozj.com/723.html\">ConnectBot免密码登陆</a></p>\n<p><a href=\"https://3mile.github.io/archives/2020/0312120820/\">OpenWrt 下 ssh 密钥登录</a></p>\n<h2 id=\"过程绕弯路\"><a href=\"#过程绕弯路\" class=\"headerlink\" title=\"过程绕弯路\"></a>过程绕弯路</h2><p>【可选步骤】为了安全起见，openwrt 创建用户</p>\n<p>先ssh连上路由<br>        vim打开passwd文件，命令: vim &#x2F;etc&#x2F;passwd<br>        然后光标移到最后插入一行：（vim 按 i 插入）</p>\n<pre><code>    用户名：*：用户ID：用户组ID：三个逗号：/home/用户名：/bin/bash\n\n    示例：user123:*:1000:1000:,,,:/home/user123:/bin/bash\n\n    注意全英文，id建议1000以上，不要100以内\n    检查无误后保存退出（vim按esc退出编辑，然后输入:wq保存退出，注意英文）\n\n    然后编辑group文件，命令: vim /etc/group\n    同样最后一行插入：\n\n    用户组名：*：用户组ID：\n\n    示例：user123:*:1000:\n\n\n    vim /etc/passwd\n    carlzeng:*:7000:7000:,,,:/home/carlzeng:/bin/bash\n    passwd carlzeng\n        直接回车，这样把密码设置为空！\n    vim /etc/group\n        carlzeng:*:0: \n\n测试发现Termius弊端，\n    snippet 很多限制，毕竟是收费软件\n</code></pre>\n<p>切换回开源的ConnectBot，原来用密钥登录也是那么简单，而且还更安全！</p>\n<h1 id=\"改进\"><a href=\"#改进\" class=\"headerlink\" title=\"改进\"></a>改进</h1><p>用手机端打开ConnectBot（配置好了自动登录路由器）直接就到了输入命令的（并且设置了预先输好了默认的命令），已经挺方便了；通过维护不同的客户端，来选择性的临时关闭特定电子设备的外网访问。</p>\n<p>可是发现一旦手机退出ConnectBot，那条命令就不执行了（不管是执行过程在15分钟的等待时间还是在那里）</p>\n<h2 id=\"如何让python程序后台运行\"><a href=\"#如何让python程序后台运行\" class=\"headerlink\" title=\"如何让python程序后台运行\"></a>如何让python程序后台运行</h2><p>使用nohup（no hand up），在命令前面加一个nohup程序就会进入后台执行，我们事后查看nohup.out可以看到些信息，或ps可以检查“python &#x2F;root&#x2F;laShiPhone.py”这条命令是否存在（约30分钟后消失）</p>\n<p>默认的执行变成：nohup python &#x2F;root&#x2F;laShiPhone.py</p>\n<h1 id=\"下一步\"><a href=\"#下一步\" class=\"headerlink\" title=\"下一步\"></a>下一步</h1><p>正在寻找，思路：</p>\n<p>手机刷入 防沉迷 \t系统</p>\n<p>小米K40</p>\n<p>安卓 屏幕时间管理 app</p>\n<p>手机 青少年模式</p>\n<p>儿童空间</p>\n<p>下载了一加的兄弟Oppo退出的儿童空间，发现安装时提示：无法解析包。</p>\n<p>回到原始的方案，既然已经root了，直接<strong>删除系统自带的浏览器、商店</strong>等等系统自带应用。</p>\n<blockquote>\n<p>20240701</p>\n<p><a href=\"https://www.v2ex.com/t/673579\">https://www.v2ex.com/t/673579</a></p>\n</blockquote>\n<p>暴力一点，获取 ROOT 后直接冻结「软件包安装程序」这个系统自带的 APP</p>\n<p>​\tice-box.apk 已准备就绪</p>\n<p>root 后，把 apk 安装程序卸载就行。</p>\n<h1 id=\"删除商店\"><a href=\"#删除商店\" class=\"headerlink\" title=\"删除商店\"></a>删除商店</h1><p>我在&#x2F;system&#x2F;app下找到了一加从腾讯浏览器修改来的系统自带浏览器，删除。</p>\n<p>“商店”怎么也找不到，解决办法，上adb工具；</p>\n<ol>\n<li>连接一加5T到电脑</li>\n<li>用adb管理应用（android系统包）：</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.ssh % adb -s 5d817fad shell pm list packages | grep market                 </span><br><span class=\"line\">package:com.oppo.market  </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">得出应该使用的命令是：adb -s 5d817fad shell pm uninstall -k --user 0 com.oppo.market</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">adb -s 5d817fad shell pm uninstall -k --user 0 com.oppo.market</span></span><br><span class=\"line\">Success</span><br></pre></td></tr></table></figure>\n\n<p>后来得知，有些是安装在： &#x2F;system&#x2F;reserve</p>\n<p>这个pm uninstall works on all Android devices在所有的安卓系统上都是通用的，都是可以使用的</p>\n<p>本章节感谢</p>\n<p><a href=\"https://www.v2ex.com/t/699878\">https://www.v2ex.com/t/699878</a></p>\n<p><a href=\"https://bbs.oneplus.com/thread/6003405\">精简oppo系统 coloros13 adb停用删除自带app，卸载快应用</a></p>\n<h1 id=\"屏幕时间管理\"><a href=\"#屏幕时间管理\" class=\"headerlink\" title=\"屏幕时间管理\"></a>屏幕时间管理</h1><p><a href=\"http://www.3673.com/down/33707.html\">屏幕时间管理app.apk</a>\t<br>    测试结果是：这个APP不支持root的手机</p>","categories":[{"name":"路由器","path":"api/categories/路由器.json"}],"tags":[{"name":"路由器","path":"api/tags/路由器.json"},{"name":"shell","path":"api/tags/shell.json"},{"name":"手机","path":"api/tags/手机.json"},{"name":"防沉迷","path":"api/tags/防沉迷.json"},{"name":"python","path":"api/tags/python.json"}]}