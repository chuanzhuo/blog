{"title":"实测Docker搭建短链接服务YOURLS","slug":"实测Docker搭建短链接服务YOURLS","date":"2023-11-08T02:03:29.000Z","updated":"2025-02-03T09:40:34.808Z","comments":true,"path":"api/articles/实测Docker搭建短链接服务YOURLS.json","excerpt":"URL缩短服务。可以让你在自己的服务器上运行的URL缩短服务<br>URL简化可以完全控制自己的数据，包括简单的统计、分析和许多插件","covers":["https://www.evernote.com/shard/s122/sh/da92cf63-633f-4527-800e-0c6360c55eac/hQ1AvljDYWbfCVIJtDV8YmhOlX9tUiGxUde88Fthy09LJZmfcf5yPozqCw/deep/0/image.png","https://img.carlzeng.com:3/i/2025/02/03/67a08b78bb1eb.png","https://img.carlzeng.com:3/i/2025/02/03/67a08b835f55f.png","https://img.carlzeng.com:3/i/2025/02/03/67a08b7fa6f77.png","https://img.carlzeng.com:3/i/2025/02/03/67a08b7c96d32.png","https://img.carlzeng.com:3/i/2025/02/03/67a08b71d1b18.png","https://www.evernote.com/shard/s122/sh/9cdd27f6-a8d0-42eb-8b74-72c3635ffb2b/CkXm5XGWidMRJSsB7i3iEiczTZiTUNFkt5n6EKNcq98jQLOqQjDPsshZfg/deep/0/image.png"],"content":"<p>URL缩短服务。可以让你在自己的服务器上运行的URL缩短服务<br>URL简化可以完全控制自己的数据，包括简单的统计、分析和许多<a href=\"https://github.com/YOURLS/awesome#plugins\">插件</a></p>\n<span id=\"more\"></span>\n\n<div class=\"note success\"><p>2024年10月25日：迁移数据库中的内容, 从carlzeng.top切换至carlzeng.com. 体现yourls工具的优势了.top域名开始陆续挂掉, 而拥有缩短服务的链接在后台一修改到新的地址, 原先的链接就依旧有效</p>\n<p>2023年12月30日：逃离mysql数据库，拥抱它的分支MariaDB</p>\n<p>原因：mysql在意外断电后，在此开启docker时报错无法解决，相比之下mariadb好香</p>\n</div>\n\n<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/da92cf63-633f-4527-800e-0c6360c55eac/hQ1AvljDYWbfCVIJtDV8YmhOlX9tUiGxUde88Fthy09LJZmfcf5yPozqCw/deep/0/image.png\">\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>URL缩短服务。可以让你在自己的服务器上运行的URL缩短服务<br>URL简化, 还可以完全控制自己的数据，包括统计、分析、还可以安装一些插件。<br>发布clash的url链接，进行管理 【done yourls setup】</p>\n<p>网上现成的其他方案，有的弊端很明显（有的进行隐藏式特殊的跳转）</p>\n<h2 id=\"现成网址缩短-url\"><a href=\"#现成网址缩短-url\" class=\"headerlink\" title=\"现成网址缩短 url\"></a>现成网址缩短 url</h2><p><a href=\"https://www.sina.lt/\">短网址</a><br>      <a href=\"https://t.hk.uy/b5kg\">https://t.hk.uy/b5kg</a><br>      <a href=\"https://netlify.carlzeng.com/\">https://netlify.carlzeng.com</a> 暂不支持您输入的域名(后缀)。<br>      使用这个网址来缩短： <a href=\"https://sage-halva-bac054.netlify.app/\">https://sage-halva-bac054.netlify.app</a><br>      <a href=\"https://t.hk.uy/b6qy\">https://t.hk.uy/b6qy</a></p>\n<p><a href=\"https://goo.su/lang/zh\">轻松缩短链接</a><br>      <a href=\"https://goo.su/BwRaE1T\">https://goo.su/BwRaE1T</a><br>      <a href=\"https://goo.su/prTA5T5\">https://goo.su/prTA5T5</a></p>\n<p><a href=\"https://www.ifreesite.com/shorturl/\">縮短網址產生器</a><br>      <a href=\"https://tinyurl.com/yurgh2fm\">https://tinyurl.com/yurgh2fm</a></p>\n<p><a href=\"https://www.dwz.lc/\">老牌免费短网址工具</a><br>      <a href=\"http://s8u.cn/HIG7o\">http://s8u.cn/HIG7o</a><br>      优美，但无法接受：先跳转到一个链接以后，在恢复原始网址。</p>\n<p>转变思路：<br>      还是用自己的域名做Nname更短，<br>自己搭建一个短网址服务；短链接服务</p>\n<h1 id=\"实现方法及过程笔记\"><a href=\"#实现方法及过程笔记\" class=\"headerlink\" title=\"实现方法及过程笔记\"></a>实现方法及过程笔记</h1><h2 id=\"图文教程\"><a href=\"#图文教程\" class=\"headerlink\" title=\"图文教程\"></a>图文教程</h2><p><a href=\"https://iwanlab.com/docker-compose-install-yourls/\">【好玩儿的Docker项目】10分钟搭建一个自己的短链接服务——YOURLS</a><br><a href=\"https://www.hellosanta.com.tw/knowledge/category-38/post-219\">【伺服器】如何使用Docker自架私有短網址YOURLS服務</a></p>\n<h2 id=\"过程-遇到的问题及解决方案\"><a href=\"#过程-遇到的问题及解决方案\" class=\"headerlink\" title=\"过程+遇到的问题及解决方案\"></a>过程+遇到的问题及解决方案</h2><p>bt 中新建docker-compose模版，<br>          docker-compose -f yours.yml up<br>          然后防火墙开放8200</p>\n<pre><code>      添加了一条防火墙规则后，无法连接bt面板了；\n</code></pre>\n<p>自己搭建一个短网址服务；短链接服务<br><a href=\"https://blog.laoda.de/archives/docker-compose-install-yourls/index.html\">https://blog.laoda.de/archives/docker-compose-install-yourls/index.html</a><br><a href=\"https://www.youtube.com/watch?v=pz3XZG_QZ-U\">https://www.youtube.com/watch?v=pz3XZG_QZ-U</a><br>  旧版<a href=\"https://www.cnblogs.com/CyLee/p/16152673.html\">https://www.cnblogs.com/CyLee/p/16152673.html</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.5&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\"></span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    image: mysql:5.7.42   # 如果遇到不正确的数据库配置，或无法连接到数据库PDOException: SQLSTATE[HY000] [1045] 用户&#x27;yourls&#x27;@&#x27;yourls_service.yourls_default&#x27;的访问被拒绝（使用密码：是）   可以把5.7.22 改为 5.7</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD=my-secret-pw</span><br><span class=\"line\">      - MYSQL_DATABASE=yourls</span><br><span class=\"line\">      - MYSQL_USER=yourls</span><br><span class=\"line\">      - MYSQL_PASSWORD=yourls</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./mysql/db/:/var/lib/mysql</span><br><span class=\"line\">      - ./mysql/conf/:/etc/mysql/conf # 此处要注意，原教程作者就是多了一个.d字符（估计是debian下的tab自动输入导致），花了半小时才脑补后排查成功</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    container_name: yourls_mysql #是的这样命名可以避免docker多了以后，名字重复的问题；还一目了然</span><br><span class=\"line\">  </span><br><span class=\"line\">  yourls:</span><br><span class=\"line\">    image: yourls</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;8200:80&quot;</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      YOURLS_DB_HOST: mysql</span><br><span class=\"line\">      YOURLS_DB_USER: admin</span><br><span class=\"line\">      YOURLS_DB_PASS: admin</span><br><span class=\"line\">      YOURLS_DB_NAME: yourls</span><br><span class=\"line\">      YOURLS_USER: admin      # 自己起一个名字</span><br><span class=\"line\">      YOURLS_PASS: 123admin@@      # 自己换一个登陆密码</span><br><span class=\"line\">      YOURLS_SITE: https://c.carlzeng.com:4443  # 换成你自己的域名，然后让Nginx Proxy Manager指向这个地址</span><br><span class=\"line\">      YOURLS_HOURS_OFFSET: 8</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./yourls_data/:/var/www/html   </span><br><span class=\"line\">    container_name: yourls_service</span><br><span class=\"line\">    links:</span><br><span class=\"line\">      - mysql:mysql</span><br></pre></td></tr></table></figure>\n\n<p>报错误：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yours_mysql     | 2023-11-07 13:33:44+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:44+00:00 [ERROR] [Entrypoint]: mysqld failed while attempting to check config</span><br><span class=\"line\">yours_mysql     |       command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.5snRuPe4br</span><br><span class=\"line\">yours_mysql     |       mysqld: Can&#x27;t read dir of &#x27;/etc/mysql/conf.d/&#x27; (Errcode: 13 - Permission denied)</span><br><span class=\"line\">yours_mysql     | mysqld: [ERROR] Fatal error in defaults handling. Program aborted!</span><br><span class=\"line\">yours_mysql exited with code 1</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:57+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:57+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:57+00:00 [ERROR] [Entrypoint]: mysqld failed while attempting to check config</span><br><span class=\"line\">yours_mysql     |       command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.atOD1yOw77</span><br><span class=\"line\">yours_mysql     |       mysqld: Can&#x27;t read dir of &#x27;/etc/mysql/conf.d/&#x27; (Errcode: 13 - Permission denied)</span><br><span class=\"line\">yours_mysql     | mysqld: [ERROR] Fatal error in defaults handling. Program aborted!</span><br></pre></td></tr></table></figure>\n\n<p>成功了，原来是sql的 docker-compose，映射，写错了，<br>          - .&#x2F;mysql&#x2F;conf&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf.d<br>          应该是：<br>          - .&#x2F;mysql&#x2F;conf&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf</p>\n<h2 id=\"安装QR-Code插件\"><a href=\"#安装QR-Code插件\" class=\"headerlink\" title=\"安装QR Code插件\"></a>安装QR Code插件</h2><p>过程非常简单：<a href=\"https://yourls.org/docs/development/examples/qrcode\">https://yourls.org/docs/development/examples/qrcode</a></p>\n<h2 id=\"配置：同一条链接对应多个短链接\"><a href=\"#配置：同一条链接对应多个短链接\" class=\"headerlink\" title=\"配置：同一条链接对应多个短链接\"></a>配置：同一条链接对应多个短链接</h2><p>同样是在刚刚修改语言的地方…&#x2F;yourls_data&#x2F;user&#x2F;config.php<br>下面一行，把这个改成true就可以了~ （正常应该改成false才对的，感觉是个BUG &#x3D; &#x3D;）</p>\n<img class=\"lozad\" data-src=https://img.laoda.de/i/2022/05/08/ls484i-0.webp>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/** Allow multiple short URLs for a same long URL</span><br><span class=\"line\"> ** Set to true to have only one pair of shortURL/longURL (default YOURLS behavior)</span><br><span class=\"line\"> ** Set to false to allow multiple short URLs pointing to the same long URL (bit.ly behavior) */</span><br><span class=\"line\">define( &#x27;YOURLS_UNIQUE_URLS&#x27;, getenv(&#x27;YOURLS_UNIQUE_URLS&#x27;) === true ?: filter_var(getenv(&#x27;YOURLS_UNIQUE_URLS&#x27;), FILTER_VALIDATE_BOOLEAN) );</span><br><span class=\"line\"></span><br><span class=\"line\">修改用户名密码等，都在这个配置文件中/user/config.php</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">记得重启容器：</span><br><span class=\"line\">docker-compose -f &#x27;yourls_service.yaml&#x27; restart</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"新增其他功能列表\"><a href=\"#新增其他功能列表\" class=\"headerlink\" title=\"新增其他功能列表\"></a>新增其他功能列表</h2><p><a href=\"https://github.com/MatthewC/yourls-password-protection\">YOURLS Password Protection</a><br>  <a href=\"https://c.carlzeng.com:3/yourls\">https://c.carlzeng.com:3/yourls</a></p>\n<h1 id=\"Migration-to-MariaDB-Done\"><a href=\"#Migration-to-MariaDB-Done\" class=\"headerlink\" title=\"Migration to MariaDB [Done]\"></a>Migration to MariaDB [Done]</h1><p>这些都不着急，如何把该死的数据库从mysql换mariadb才是硬道理，数据都丢2次了；只要是意外关闭这个docker（比如强制断电后恢复通电，强制跳掉整台虚拟机），都会导致mysql无法正常启动，导致数据丢失.</p>\n<blockquote>\n<p>切换成功， 把上面的yaml中的mysql数据库部分切换成这样，就ok了，<br>期待下次意外断电或任何特殊情况下的数据恢复表现。</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br><span class=\"line\"><span class=\"attr\">mysql:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">mariadb:jammy</span>  <span class=\"comment\">#mysql:5.7</span></span><br><span class=\"line\">  <span class=\"attr\">environment:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_ROOT_PASSWORD=my-secret-pw</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_DATABASE=yourls</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_USER=yourls</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_PASSWORD=yourls</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"comment\">#- ./mysql20231229/db/:/var/lib/mysql</span></span><br><span class=\"line\">    <span class=\"comment\">#- ./mysql20231229/conf/:/etc/mysql/conf</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">./yMariaDb:/var/lib/mysql</span></span><br><span class=\"line\">    <span class=\"comment\">#- ./OLDmysql_20231120/db/:/var/lib/mysql</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">  <span class=\"attr\">container_name:</span> <span class=\"string\">yourls_mysql</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"断电重启MariaDB启动失败\"><a href=\"#断电重启MariaDB启动失败\" class=\"headerlink\" title=\"断电重启MariaDB启动失败\"></a>断电重启MariaDB启动失败</h1><p>错误: permission denied</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b78bb1eb.png\" alt=\"image-20250203105605793\"></p>\n<p>目录的权限 被重置成系统的权限, 导致用户失去操作&#x2F;访问mariadb的数据文件</p>\n<p>修复: 修改相应的mariadb目录权限即可(目前改成777)</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b835f55f.png\" alt=\"image-20250203104258100\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b7fa6f77.png\" alt=\"image-20250203104710485\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b7c96d32.png\" alt=\"image-20250203105017056\"></p>\n<p>要修复这个&#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;matomo 目录权限</p>\n<p>仔细观察matomodb的权限所有者 600 &#x2F; systemd-cored 要改成mysql 777权限, 重启docker即可</p>\n<p>继续修复第三个maraiadb 目录权限 </p>\n<p>&#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;surveyking</p>\n<h2 id=\"NAS虚拟机启动正常提示\"><a href=\"#NAS虚拟机启动正常提示\" class=\"headerlink\" title=\"NAS虚拟机启动正常提示\"></a>NAS虚拟机启动正常提示</h2><p>WARNING:SATA boot support on thid platform is experimental?</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b71d1b18.png\" alt=\"image-20250203165230914\"></p>\n<p>这是正常的控制台提示, 这是打开 <a href=\"https://nas.carlzeng.com:4443/\">https://nas.carlzeng.com:4443/</a> 说明系统以正常运行</p>\n<h2 id=\"重启视频采集失败\"><a href=\"#重启视频采集失败\" class=\"headerlink\" title=\"重启视频采集失败\"></a>重启视频采集失败</h2><p>root@DS918:~# supervisorctl restart ffmpeg<br>unix:&#x2F;&#x2F;&#x2F;tmp&#x2F;supervisor.sock no such file</p>\n<p>解决办法:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/supervisord.d</span><br><span class=\"line\">supervisord -c /etc/supervisord.d/ffmpeg.conf</span><br></pre></td></tr></table></figure>\n\n<p>在重新运行</p>\n<p>supervisorctl restart ffmpeg</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><div class=\"tabs\" id=\"来源\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#来源-1\">来源 1</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"来源-1\"><p>Yourls项目地址：<a href=\"https://github.com/YOURLS/YOURLS\">https://github.com/YOURLS/YOURLS</a><br>旧版本docker说明（实践后无法使用）：<a href=\"https://hub.docker.com/_/yourls?tab=description\">https://hub.docker.com/_/yourls?tab=description</a><br><a href=\"https://iwanlab.com/docker-compose-install-yourls/\">https://iwanlab.com/docker-compose-install-yourls/</a><br><a href=\"https://blog.laoda.de/archives/yourls-building/\">https://blog.laoda.de/archives/yourls-building/</a><br><a href=\"https://www.hellosanta.com.tw/knowledge/category-38/post-219\">https://www.hellosanta.com.tw/knowledge/category-38/post-219</a></p></div></div></div>\n\n\n\n<h1 id=\"持续更新中\"><a href=\"#持续更新中\" class=\"headerlink\" title=\"持续更新中\"></a>持续更新中</h1><h2 id=\"Docker-yours-mysql不断重启的\"><a href=\"#Docker-yours-mysql不断重启的\" class=\"headerlink\" title=\"Docker yours_mysql不断重启的\"></a>Docker yours_mysql不断重启的</h2><p>yours_mysql，查看日志：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Initializing database files</span><br><span class=\"line\">2023-11-19T11:58:34.668526Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</span><br><span class=\"line\">2023-11-19T11:58:34.671001Z 0 [ERROR] --initialize specified but the data directory has files in it. Aborting.</span><br><span class=\"line\">2023-11-19T11:58:34.671049Z 0 [ERROR] Aborting</span><br></pre></td></tr></table></figure>\n\n<p>安装目录：cd &#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;yourls_service&#x2F;template</p>\n<p>发现是mysql 的冲突了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    docker update --restart=no mysql</span><br><span class=\"line\">    docker stop mysql</span><br><span class=\"line\"></span><br><span class=\"line\">    docker stop php nginx redis</span><br><span class=\"line\"></span><br><span class=\"line\">#先关闭</span><br><span class=\"line\">docker-compose -f &#x27;yourls_service.yaml&#x27; down</span><br><span class=\"line\">#再开启</span><br><span class=\"line\">docker-compose -f &#x27;yourls_service.yaml&#x27; up</span><br></pre></td></tr></table></figure>\n\n<p>docker exec -it yourls_mysql &#x2F;bin&#x2F;bash<br>无法进入。</p>\n<p>the issue is about the volume.<br><a href=\"https://www.youtube.com/watch?v=pFQC2F8SRag\">https://www.youtube.com/watch?v=pFQC2F8SRag</a></p>\n<ol>\n<li>docker info<br>Docker Root Dir: &#x2F;var&#x2F;lib&#x2F;docker</li>\n<li>cd &#x2F;var&#x2F;lib&#x2F;docker</li>\n<li>cd volumes&#x2F;</li>\n<li>ls<br> backingFsBlockDev  metadata.db<br> 没有发现视频中说的额外的volume，也就无从删除</li>\n</ol>\n<p>20231120 无法解决[已解决]；直接更换docker的映射目录，全部重装。数据丢失（包含缩短网址的数据和访问统计数据）。<br>这样配置的端地址的列表，要支持导出（或备份）；在特殊情况下，直接全部重来（更省时）</p>\n<p>完成的方案是：使用<a href=\"https://github.com/GautamGupta/YOURLS-Import-Export\">GautamGupta&#x2F;YOURLS-Import-Export</a>插件即可轻松实现导出和导入功能<br>详细的安装步骤为</p>\n<ol>\n<li><a href=\"https://github.com/GautamGupta/YOURLS-Import-Export/zipball/master\">Download the zip</a>.</li>\n<li>Extract the zip.</li>\n<li>Put the YOURLS-Import-Export folder in the user&#x2F;plugins directory.</li>\n<li>Activate the plugin.</li>\n<li>Restart the docker<br> docker-compose -f ‘yourls_service.yaml’ restart</li>\n</ol>\n<p>感受：非常好用，比如导出了一个当前的所有链接yourls_export.csv</p>\n<p>衍生阅读：<a href=\"https://github.com/YOURLS/awesome#plugins\">https://github.com/YOURLS/awesome#plugins</a><br>这个Plugins列表是按英文字母的顺序分类排列的，具体还是在页面上搜索文本来查找所需的功能</p>\n<h2 id=\"Next-TODO\"><a href=\"#Next-TODO\" class=\"headerlink\" title=\"Next TODO\"></a>Next TODO</h2><p>功能：分析用户的具体属性信息，比如IP地址，GEO地址，类似于statcounter.com那样的详细列表</p>\n<h3 id=\"yourls-geoip-update\"><a href=\"#yourls-geoip-update\" class=\"headerlink\" title=\"yourls-geoip-update\"></a>yourls-geoip-update</h3><p><a href=\"https://gh-proxy.com/github.com/ozh/yourls-geoip-update/archive/refs/heads/master.zip\">https://gh-proxy.com/github.com/ozh/yourls-geoip-update/archive/refs/heads/master.zip</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Database not updated.</span><br><span class=\"line\">Error downloading &quot;GeoLite2-Country&quot;. Invalid license key.</span><br></pre></td></tr></table></figure>\n<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/9cdd27f6-a8d0-42eb-8b74-72c3635ffb2b/CkXm5XGWidMRJSsB7i3iEiczTZiTUNFkt5n6EKNcq98jQLOqQjDPsshZfg/deep/0/image.png\">\n尽力了，哪位大神来帮忙纠正一下子？\n\n<p>20231208 尝试在目录下手工更新mmdb数据库文件 .&#x2F;yourls_data20231120&#x2F;includes&#x2F;geo</p>\n<ol>\n<li>上传GeoLite2-City.mmdb</li>\n<li>复制并覆盖原先的GeoLite2-Country.mmdb</li>\n<li>这样就有两个从原先5.41MB的文件变成了两个最新版64.34MB的文件</li>\n<li>TODO 静观其变</li>\n</ol>\n<blockquote>\n<p>20231216 实践证明没有变化。下一步动作</p>\n<ol>\n<li><p>下载<a href=\"alecthw/mmdb_china_ip_list\">alecthw&#x2F;mmdb_china_ip_list</a>获得文件Country.mmdb</p>\n</li>\n<li><p>上传至.&#x2F;yourls_data20231120&#x2F;includes&#x2F;geo，覆盖原先的GeoLite2-Country.mmdb. </p>\n</li>\n<li><p>重启Docker，TODO 静观其变</p>\n</li>\n</ol>\n</blockquote>\n<h2 id=\"优缺点\"><a href=\"#优缺点\" class=\"headerlink\" title=\"优缺点\"></a>优缺点</h2><h3 id=\"Yourls的优点\"><a href=\"#Yourls的优点\" class=\"headerlink\" title=\"Yourls的优点\"></a>Yourls的优点</h3><p>很多插件可以随意拼装。插件列表：<a href=\"https://github.com/YOURLS/awesome\">https://github.com/YOURLS/awesome</a></p>\n<h3 id=\"Yourls的缺点\"><a href=\"#Yourls的缺点\" class=\"headerlink\" title=\"Yourls的缺点\"></a>Yourls的缺点</h3><p>统计功能很初级，很弱；基本上在搞笑的级别。</p>\n<p>文档也不清晰易得，GeoIP update失败，那么手动上传IP数据到那么目录呢？ 居然google不到</p>\n<hr>\n<h1 id=\"Docker安装X-UI\"><a href=\"#Docker安装X-UI\" class=\"headerlink\" title=\"Docker安装X-UI\"></a>Docker安装X-UI</h1><p>docker 搭建 支持单端口多用户、多协议的 xray 面板，究极缝合怪</p>\n<p>使用FranzKafkaYu&#x2F;x-ui版本，仅需要讲上述镜像修改为 enwaiax&#x2F;x-ui:alpha-zh<br>由于telegram bot暂时没用，切换回第一个默认<a href=\"https://github.com/vaxilu/x-ui\">https://github.com/vaxilu/x-ui</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.9&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  xui:</span><br><span class=\"line\">    image: enwaiax/x-ui</span><br><span class=\"line\">    container_name: xui</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - $PWD/db/:/etc/x-ui/</span><br><span class=\"line\">      - $PWD/cert/:/root/cert/</span><br><span class=\"line\">    restart: unless-stopped</span><br><span class=\"line\">    network_mode: host</span><br></pre></td></tr></table></figure>\n<p>新建目录，并把上面的配置放到x-ui.yaml中<br>root@Debian11:&#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;x-ui&#x2F;template# docker-compose -f x-ui.yaml up</p>\n<p><a href=\"https://www.amadues.link/archives/dockerda-jian-jie-dian-vless-ws-tls-web\">https://www.amadues.link/archives/dockerda-jian-jie-dian-vless-ws-tls-web</a><br>docker-compose.yaml的方案follow：<a href=\"https://hostloc.com/thread-1108468-1-1.html\">https://hostloc.com/thread-1108468-1-1.html</a><br>配置的方案follow：<a href=\"https://iwanlab.com/npm-xui/\">https://iwanlab.com/npm-xui/</a><br>相关的视频：<a href=\"https://www.youtube.com/watch?v=V3nsDicSMBc\">https://www.youtube.com/watch?v=V3nsDicSMBc</a></p>\n<p>待测试：vless:&#x2F;&#x2F;<a href=\"mailto:&#x33;&#x39;&#102;&#x64;&#x65;&#50;&#100;&#x32;&#45;&#x63;&#x38;&#56;&#99;&#45;&#x34;&#98;&#x65;&#97;&#45;&#x64;&#52;&#57;&#x31;&#x2d;&#x66;&#x62;&#54;&#57;&#x39;&#x30;&#100;&#52;&#x39;&#x37;&#52;&#49;&#x40;&#x76;&#x6d;&#101;&#x73;&#115;&#x2e;&#x63;&#97;&#114;&#x6c;&#x7a;&#101;&#110;&#103;&#46;&#x63;&#111;&#109;\">&#x33;&#x39;&#102;&#x64;&#x65;&#50;&#100;&#x32;&#45;&#x63;&#x38;&#56;&#99;&#45;&#x34;&#98;&#x65;&#97;&#45;&#x64;&#52;&#57;&#x31;&#x2d;&#x66;&#x62;&#54;&#57;&#x39;&#x30;&#100;&#52;&#x39;&#x37;&#52;&#49;&#x40;&#x76;&#x6d;&#101;&#x73;&#115;&#x2e;&#x63;&#97;&#114;&#x6c;&#x7a;&#101;&#110;&#103;&#46;&#x63;&#111;&#109;</a>:17866?type&#x3D;ws&amp;security&#x3D;none&amp;path&#x3D;%2Fgugu#gugugee</p>\n<p>可以打开后台配置 <a href=\"http://192.168.6.116:54321/fk/xui/\">http://192.168.6.116:54321/fk/xui/</a><br>没成功…期待更多的客户端连接测试, 等救援</p>\n<p>思路有问题：x-ui是一个服务端的节点！</p>\n<div class=\"tabs\" id=\"名称\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#名称-1\">名称 1</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"名称-1\"><p>待续。。。</p></div></div></div>\n\n\n\n","more":"<div class=\"note success\"><p>2024年10月25日：迁移数据库中的内容, 从carlzeng.top切换至carlzeng.com. 体现yourls工具的优势了.top域名开始陆续挂掉, 而拥有缩短服务的链接在后台一修改到新的地址, 原先的链接就依旧有效</p>\n<p>2023年12月30日：逃离mysql数据库，拥抱它的分支MariaDB</p>\n<p>原因：mysql在意外断电后，在此开启docker时报错无法解决，相比之下mariadb好香</p>\n</div>\n\n<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/da92cf63-633f-4527-800e-0c6360c55eac/hQ1AvljDYWbfCVIJtDV8YmhOlX9tUiGxUde88Fthy09LJZmfcf5yPozqCw/deep/0/image.png\">\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>URL缩短服务。可以让你在自己的服务器上运行的URL缩短服务<br>URL简化, 还可以完全控制自己的数据，包括统计、分析、还可以安装一些插件。<br>发布clash的url链接，进行管理 【done yourls setup】</p>\n<p>网上现成的其他方案，有的弊端很明显（有的进行隐藏式特殊的跳转）</p>\n<h2 id=\"现成网址缩短-url\"><a href=\"#现成网址缩短-url\" class=\"headerlink\" title=\"现成网址缩短 url\"></a>现成网址缩短 url</h2><p><a href=\"https://www.sina.lt/\">短网址</a><br>      <a href=\"https://t.hk.uy/b5kg\">https://t.hk.uy/b5kg</a><br>      <a href=\"https://netlify.carlzeng.com/\">https://netlify.carlzeng.com</a> 暂不支持您输入的域名(后缀)。<br>      使用这个网址来缩短： <a href=\"https://sage-halva-bac054.netlify.app/\">https://sage-halva-bac054.netlify.app</a><br>      <a href=\"https://t.hk.uy/b6qy\">https://t.hk.uy/b6qy</a></p>\n<p><a href=\"https://goo.su/lang/zh\">轻松缩短链接</a><br>      <a href=\"https://goo.su/BwRaE1T\">https://goo.su/BwRaE1T</a><br>      <a href=\"https://goo.su/prTA5T5\">https://goo.su/prTA5T5</a></p>\n<p><a href=\"https://www.ifreesite.com/shorturl/\">縮短網址產生器</a><br>      <a href=\"https://tinyurl.com/yurgh2fm\">https://tinyurl.com/yurgh2fm</a></p>\n<p><a href=\"https://www.dwz.lc/\">老牌免费短网址工具</a><br>      <a href=\"http://s8u.cn/HIG7o\">http://s8u.cn/HIG7o</a><br>      优美，但无法接受：先跳转到一个链接以后，在恢复原始网址。</p>\n<p>转变思路：<br>      还是用自己的域名做Nname更短，<br>自己搭建一个短网址服务；短链接服务</p>\n<h1 id=\"实现方法及过程笔记\"><a href=\"#实现方法及过程笔记\" class=\"headerlink\" title=\"实现方法及过程笔记\"></a>实现方法及过程笔记</h1><h2 id=\"图文教程\"><a href=\"#图文教程\" class=\"headerlink\" title=\"图文教程\"></a>图文教程</h2><p><a href=\"https://iwanlab.com/docker-compose-install-yourls/\">【好玩儿的Docker项目】10分钟搭建一个自己的短链接服务——YOURLS</a><br><a href=\"https://www.hellosanta.com.tw/knowledge/category-38/post-219\">【伺服器】如何使用Docker自架私有短網址YOURLS服務</a></p>\n<h2 id=\"过程-遇到的问题及解决方案\"><a href=\"#过程-遇到的问题及解决方案\" class=\"headerlink\" title=\"过程+遇到的问题及解决方案\"></a>过程+遇到的问题及解决方案</h2><p>bt 中新建docker-compose模版，<br>          docker-compose -f yours.yml up<br>          然后防火墙开放8200</p>\n<pre><code>      添加了一条防火墙规则后，无法连接bt面板了；\n</code></pre>\n<p>自己搭建一个短网址服务；短链接服务<br><a href=\"https://blog.laoda.de/archives/docker-compose-install-yourls/index.html\">https://blog.laoda.de/archives/docker-compose-install-yourls/index.html</a><br><a href=\"https://www.youtube.com/watch?v=pz3XZG_QZ-U\">https://www.youtube.com/watch?v=pz3XZG_QZ-U</a><br>  旧版<a href=\"https://www.cnblogs.com/CyLee/p/16152673.html\">https://www.cnblogs.com/CyLee/p/16152673.html</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.5&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\"></span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    image: mysql:5.7.42   # 如果遇到不正确的数据库配置，或无法连接到数据库PDOException: SQLSTATE[HY000] [1045] 用户&#x27;yourls&#x27;@&#x27;yourls_service.yourls_default&#x27;的访问被拒绝（使用密码：是）   可以把5.7.22 改为 5.7</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD=my-secret-pw</span><br><span class=\"line\">      - MYSQL_DATABASE=yourls</span><br><span class=\"line\">      - MYSQL_USER=yourls</span><br><span class=\"line\">      - MYSQL_PASSWORD=yourls</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./mysql/db/:/var/lib/mysql</span><br><span class=\"line\">      - ./mysql/conf/:/etc/mysql/conf # 此处要注意，原教程作者就是多了一个.d字符（估计是debian下的tab自动输入导致），花了半小时才脑补后排查成功</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    container_name: yourls_mysql #是的这样命名可以避免docker多了以后，名字重复的问题；还一目了然</span><br><span class=\"line\">  </span><br><span class=\"line\">  yourls:</span><br><span class=\"line\">    image: yourls</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;8200:80&quot;</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      YOURLS_DB_HOST: mysql</span><br><span class=\"line\">      YOURLS_DB_USER: admin</span><br><span class=\"line\">      YOURLS_DB_PASS: admin</span><br><span class=\"line\">      YOURLS_DB_NAME: yourls</span><br><span class=\"line\">      YOURLS_USER: admin      # 自己起一个名字</span><br><span class=\"line\">      YOURLS_PASS: 123admin@@      # 自己换一个登陆密码</span><br><span class=\"line\">      YOURLS_SITE: https://c.carlzeng.com:4443  # 换成你自己的域名，然后让Nginx Proxy Manager指向这个地址</span><br><span class=\"line\">      YOURLS_HOURS_OFFSET: 8</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./yourls_data/:/var/www/html   </span><br><span class=\"line\">    container_name: yourls_service</span><br><span class=\"line\">    links:</span><br><span class=\"line\">      - mysql:mysql</span><br></pre></td></tr></table></figure>\n\n<p>报错误：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yours_mysql     | 2023-11-07 13:33:44+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:44+00:00 [ERROR] [Entrypoint]: mysqld failed while attempting to check config</span><br><span class=\"line\">yours_mysql     |       command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.5snRuPe4br</span><br><span class=\"line\">yours_mysql     |       mysqld: Can&#x27;t read dir of &#x27;/etc/mysql/conf.d/&#x27; (Errcode: 13 - Permission denied)</span><br><span class=\"line\">yours_mysql     | mysqld: [ERROR] Fatal error in defaults handling. Program aborted!</span><br><span class=\"line\">yours_mysql exited with code 1</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:57+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:57+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">yours_mysql     | 2023-11-07 13:33:57+00:00 [ERROR] [Entrypoint]: mysqld failed while attempting to check config</span><br><span class=\"line\">yours_mysql     |       command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.atOD1yOw77</span><br><span class=\"line\">yours_mysql     |       mysqld: Can&#x27;t read dir of &#x27;/etc/mysql/conf.d/&#x27; (Errcode: 13 - Permission denied)</span><br><span class=\"line\">yours_mysql     | mysqld: [ERROR] Fatal error in defaults handling. Program aborted!</span><br></pre></td></tr></table></figure>\n\n<p>成功了，原来是sql的 docker-compose，映射，写错了，<br>          - .&#x2F;mysql&#x2F;conf&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf.d<br>          应该是：<br>          - .&#x2F;mysql&#x2F;conf&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf</p>\n<h2 id=\"安装QR-Code插件\"><a href=\"#安装QR-Code插件\" class=\"headerlink\" title=\"安装QR Code插件\"></a>安装QR Code插件</h2><p>过程非常简单：<a href=\"https://yourls.org/docs/development/examples/qrcode\">https://yourls.org/docs/development/examples/qrcode</a></p>\n<h2 id=\"配置：同一条链接对应多个短链接\"><a href=\"#配置：同一条链接对应多个短链接\" class=\"headerlink\" title=\"配置：同一条链接对应多个短链接\"></a>配置：同一条链接对应多个短链接</h2><p>同样是在刚刚修改语言的地方…&#x2F;yourls_data&#x2F;user&#x2F;config.php<br>下面一行，把这个改成true就可以了~ （正常应该改成false才对的，感觉是个BUG &#x3D; &#x3D;）</p>\n<img class=\"lozad\" data-src=https://img.laoda.de/i/2022/05/08/ls484i-0.webp>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/** Allow multiple short URLs for a same long URL</span><br><span class=\"line\"> ** Set to true to have only one pair of shortURL/longURL (default YOURLS behavior)</span><br><span class=\"line\"> ** Set to false to allow multiple short URLs pointing to the same long URL (bit.ly behavior) */</span><br><span class=\"line\">define( &#x27;YOURLS_UNIQUE_URLS&#x27;, getenv(&#x27;YOURLS_UNIQUE_URLS&#x27;) === true ?: filter_var(getenv(&#x27;YOURLS_UNIQUE_URLS&#x27;), FILTER_VALIDATE_BOOLEAN) );</span><br><span class=\"line\"></span><br><span class=\"line\">修改用户名密码等，都在这个配置文件中/user/config.php</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">记得重启容器：</span><br><span class=\"line\">docker-compose -f &#x27;yourls_service.yaml&#x27; restart</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"新增其他功能列表\"><a href=\"#新增其他功能列表\" class=\"headerlink\" title=\"新增其他功能列表\"></a>新增其他功能列表</h2><p><a href=\"https://github.com/MatthewC/yourls-password-protection\">YOURLS Password Protection</a><br>  <a href=\"https://c.carlzeng.com:3/yourls\">https://c.carlzeng.com:3/yourls</a></p>\n<h1 id=\"Migration-to-MariaDB-Done\"><a href=\"#Migration-to-MariaDB-Done\" class=\"headerlink\" title=\"Migration to MariaDB [Done]\"></a>Migration to MariaDB [Done]</h1><p>这些都不着急，如何把该死的数据库从mysql换mariadb才是硬道理，数据都丢2次了；只要是意外关闭这个docker（比如强制断电后恢复通电，强制跳掉整台虚拟机），都会导致mysql无法正常启动，导致数据丢失.</p>\n<blockquote>\n<p>切换成功， 把上面的yaml中的mysql数据库部分切换成这样，就ok了，<br>期待下次意外断电或任何特殊情况下的数据恢复表现。</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br><span class=\"line\"><span class=\"attr\">mysql:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">mariadb:jammy</span>  <span class=\"comment\">#mysql:5.7</span></span><br><span class=\"line\">  <span class=\"attr\">environment:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_ROOT_PASSWORD=my-secret-pw</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_DATABASE=yourls</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_USER=yourls</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_PASSWORD=yourls</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"comment\">#- ./mysql20231229/db/:/var/lib/mysql</span></span><br><span class=\"line\">    <span class=\"comment\">#- ./mysql20231229/conf/:/etc/mysql/conf</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">./yMariaDb:/var/lib/mysql</span></span><br><span class=\"line\">    <span class=\"comment\">#- ./OLDmysql_20231120/db/:/var/lib/mysql</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">  <span class=\"attr\">container_name:</span> <span class=\"string\">yourls_mysql</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"断电重启MariaDB启动失败\"><a href=\"#断电重启MariaDB启动失败\" class=\"headerlink\" title=\"断电重启MariaDB启动失败\"></a>断电重启MariaDB启动失败</h1><p>错误: permission denied</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b78bb1eb.png\" alt=\"image-20250203105605793\"></p>\n<p>目录的权限 被重置成系统的权限, 导致用户失去操作&#x2F;访问mariadb的数据文件</p>\n<p>修复: 修改相应的mariadb目录权限即可(目前改成777)</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b835f55f.png\" alt=\"image-20250203104258100\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b7fa6f77.png\" alt=\"image-20250203104710485\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b7c96d32.png\" alt=\"image-20250203105017056\"></p>\n<p>要修复这个&#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;matomo 目录权限</p>\n<p>仔细观察matomodb的权限所有者 600 &#x2F; systemd-cored 要改成mysql 777权限, 重启docker即可</p>\n<p>继续修复第三个maraiadb 目录权限 </p>\n<p>&#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;surveyking</p>\n<h2 id=\"NAS虚拟机启动正常提示\"><a href=\"#NAS虚拟机启动正常提示\" class=\"headerlink\" title=\"NAS虚拟机启动正常提示\"></a>NAS虚拟机启动正常提示</h2><p>WARNING:SATA boot support on thid platform is experimental?</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/02/03/67a08b71d1b18.png\" alt=\"image-20250203165230914\"></p>\n<p>这是正常的控制台提示, 这是打开 <a href=\"https://nas.carlzeng.com:4443/\">https://nas.carlzeng.com:4443/</a> 说明系统以正常运行</p>\n<h2 id=\"重启视频采集失败\"><a href=\"#重启视频采集失败\" class=\"headerlink\" title=\"重启视频采集失败\"></a>重启视频采集失败</h2><p>root@DS918:~# supervisorctl restart ffmpeg<br>unix:&#x2F;&#x2F;&#x2F;tmp&#x2F;supervisor.sock no such file</p>\n<p>解决办法:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/supervisord.d</span><br><span class=\"line\">supervisord -c /etc/supervisord.d/ffmpeg.conf</span><br></pre></td></tr></table></figure>\n\n<p>在重新运行</p>\n<p>supervisorctl restart ffmpeg</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><div class=\"tabs\" id=\"来源\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#来源-1\">来源 1</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"来源-1\"><p>Yourls项目地址：<a href=\"https://github.com/YOURLS/YOURLS\">https://github.com/YOURLS/YOURLS</a><br>旧版本docker说明（实践后无法使用）：<a href=\"https://hub.docker.com/_/yourls?tab=description\">https://hub.docker.com/_/yourls?tab=description</a><br><a href=\"https://iwanlab.com/docker-compose-install-yourls/\">https://iwanlab.com/docker-compose-install-yourls/</a><br><a href=\"https://blog.laoda.de/archives/yourls-building/\">https://blog.laoda.de/archives/yourls-building/</a><br><a href=\"https://www.hellosanta.com.tw/knowledge/category-38/post-219\">https://www.hellosanta.com.tw/knowledge/category-38/post-219</a></p></div></div></div>\n\n\n\n<h1 id=\"持续更新中\"><a href=\"#持续更新中\" class=\"headerlink\" title=\"持续更新中\"></a>持续更新中</h1><h2 id=\"Docker-yours-mysql不断重启的\"><a href=\"#Docker-yours-mysql不断重启的\" class=\"headerlink\" title=\"Docker yours_mysql不断重启的\"></a>Docker yours_mysql不断重启的</h2><p>yours_mysql，查看日志：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 5.7.44-1.el7 started.</span><br><span class=\"line\">2023-11-19 11:58:34+00:00 [Note] [Entrypoint]: Initializing database files</span><br><span class=\"line\">2023-11-19T11:58:34.668526Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</span><br><span class=\"line\">2023-11-19T11:58:34.671001Z 0 [ERROR] --initialize specified but the data directory has files in it. Aborting.</span><br><span class=\"line\">2023-11-19T11:58:34.671049Z 0 [ERROR] Aborting</span><br></pre></td></tr></table></figure>\n\n<p>安装目录：cd &#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;yourls_service&#x2F;template</p>\n<p>发现是mysql 的冲突了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    docker update --restart=no mysql</span><br><span class=\"line\">    docker stop mysql</span><br><span class=\"line\"></span><br><span class=\"line\">    docker stop php nginx redis</span><br><span class=\"line\"></span><br><span class=\"line\">#先关闭</span><br><span class=\"line\">docker-compose -f &#x27;yourls_service.yaml&#x27; down</span><br><span class=\"line\">#再开启</span><br><span class=\"line\">docker-compose -f &#x27;yourls_service.yaml&#x27; up</span><br></pre></td></tr></table></figure>\n\n<p>docker exec -it yourls_mysql &#x2F;bin&#x2F;bash<br>无法进入。</p>\n<p>the issue is about the volume.<br><a href=\"https://www.youtube.com/watch?v=pFQC2F8SRag\">https://www.youtube.com/watch?v=pFQC2F8SRag</a></p>\n<ol>\n<li>docker info<br>Docker Root Dir: &#x2F;var&#x2F;lib&#x2F;docker</li>\n<li>cd &#x2F;var&#x2F;lib&#x2F;docker</li>\n<li>cd volumes&#x2F;</li>\n<li>ls<br> backingFsBlockDev  metadata.db<br> 没有发现视频中说的额外的volume，也就无从删除</li>\n</ol>\n<p>20231120 无法解决[已解决]；直接更换docker的映射目录，全部重装。数据丢失（包含缩短网址的数据和访问统计数据）。<br>这样配置的端地址的列表，要支持导出（或备份）；在特殊情况下，直接全部重来（更省时）</p>\n<p>完成的方案是：使用<a href=\"https://github.com/GautamGupta/YOURLS-Import-Export\">GautamGupta&#x2F;YOURLS-Import-Export</a>插件即可轻松实现导出和导入功能<br>详细的安装步骤为</p>\n<ol>\n<li><a href=\"https://github.com/GautamGupta/YOURLS-Import-Export/zipball/master\">Download the zip</a>.</li>\n<li>Extract the zip.</li>\n<li>Put the YOURLS-Import-Export folder in the user&#x2F;plugins directory.</li>\n<li>Activate the plugin.</li>\n<li>Restart the docker<br> docker-compose -f ‘yourls_service.yaml’ restart</li>\n</ol>\n<p>感受：非常好用，比如导出了一个当前的所有链接yourls_export.csv</p>\n<p>衍生阅读：<a href=\"https://github.com/YOURLS/awesome#plugins\">https://github.com/YOURLS/awesome#plugins</a><br>这个Plugins列表是按英文字母的顺序分类排列的，具体还是在页面上搜索文本来查找所需的功能</p>\n<h2 id=\"Next-TODO\"><a href=\"#Next-TODO\" class=\"headerlink\" title=\"Next TODO\"></a>Next TODO</h2><p>功能：分析用户的具体属性信息，比如IP地址，GEO地址，类似于statcounter.com那样的详细列表</p>\n<h3 id=\"yourls-geoip-update\"><a href=\"#yourls-geoip-update\" class=\"headerlink\" title=\"yourls-geoip-update\"></a>yourls-geoip-update</h3><p><a href=\"https://gh-proxy.com/github.com/ozh/yourls-geoip-update/archive/refs/heads/master.zip\">https://gh-proxy.com/github.com/ozh/yourls-geoip-update/archive/refs/heads/master.zip</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Database not updated.</span><br><span class=\"line\">Error downloading &quot;GeoLite2-Country&quot;. Invalid license key.</span><br></pre></td></tr></table></figure>\n<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/9cdd27f6-a8d0-42eb-8b74-72c3635ffb2b/CkXm5XGWidMRJSsB7i3iEiczTZiTUNFkt5n6EKNcq98jQLOqQjDPsshZfg/deep/0/image.png\">\n尽力了，哪位大神来帮忙纠正一下子？\n\n<p>20231208 尝试在目录下手工更新mmdb数据库文件 .&#x2F;yourls_data20231120&#x2F;includes&#x2F;geo</p>\n<ol>\n<li>上传GeoLite2-City.mmdb</li>\n<li>复制并覆盖原先的GeoLite2-Country.mmdb</li>\n<li>这样就有两个从原先5.41MB的文件变成了两个最新版64.34MB的文件</li>\n<li>TODO 静观其变</li>\n</ol>\n<blockquote>\n<p>20231216 实践证明没有变化。下一步动作</p>\n<ol>\n<li><p>下载<a href=\"alecthw/mmdb_china_ip_list\">alecthw&#x2F;mmdb_china_ip_list</a>获得文件Country.mmdb</p>\n</li>\n<li><p>上传至.&#x2F;yourls_data20231120&#x2F;includes&#x2F;geo，覆盖原先的GeoLite2-Country.mmdb. </p>\n</li>\n<li><p>重启Docker，TODO 静观其变</p>\n</li>\n</ol>\n</blockquote>\n<h2 id=\"优缺点\"><a href=\"#优缺点\" class=\"headerlink\" title=\"优缺点\"></a>优缺点</h2><h3 id=\"Yourls的优点\"><a href=\"#Yourls的优点\" class=\"headerlink\" title=\"Yourls的优点\"></a>Yourls的优点</h3><p>很多插件可以随意拼装。插件列表：<a href=\"https://github.com/YOURLS/awesome\">https://github.com/YOURLS/awesome</a></p>\n<h3 id=\"Yourls的缺点\"><a href=\"#Yourls的缺点\" class=\"headerlink\" title=\"Yourls的缺点\"></a>Yourls的缺点</h3><p>统计功能很初级，很弱；基本上在搞笑的级别。</p>\n<p>文档也不清晰易得，GeoIP update失败，那么手动上传IP数据到那么目录呢？ 居然google不到</p>\n<hr>\n<h1 id=\"Docker安装X-UI\"><a href=\"#Docker安装X-UI\" class=\"headerlink\" title=\"Docker安装X-UI\"></a>Docker安装X-UI</h1><p>docker 搭建 支持单端口多用户、多协议的 xray 面板，究极缝合怪</p>\n<p>使用FranzKafkaYu&#x2F;x-ui版本，仅需要讲上述镜像修改为 enwaiax&#x2F;x-ui:alpha-zh<br>由于telegram bot暂时没用，切换回第一个默认<a href=\"https://github.com/vaxilu/x-ui\">https://github.com/vaxilu/x-ui</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.9&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  xui:</span><br><span class=\"line\">    image: enwaiax/x-ui</span><br><span class=\"line\">    container_name: xui</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - $PWD/db/:/etc/x-ui/</span><br><span class=\"line\">      - $PWD/cert/:/root/cert/</span><br><span class=\"line\">    restart: unless-stopped</span><br><span class=\"line\">    network_mode: host</span><br></pre></td></tr></table></figure>\n<p>新建目录，并把上面的配置放到x-ui.yaml中<br>root@Debian11:&#x2F;www&#x2F;server&#x2F;panel&#x2F;data&#x2F;compose&#x2F;x-ui&#x2F;template# docker-compose -f x-ui.yaml up</p>\n<p><a href=\"https://www.amadues.link/archives/dockerda-jian-jie-dian-vless-ws-tls-web\">https://www.amadues.link/archives/dockerda-jian-jie-dian-vless-ws-tls-web</a><br>docker-compose.yaml的方案follow：<a href=\"https://hostloc.com/thread-1108468-1-1.html\">https://hostloc.com/thread-1108468-1-1.html</a><br>配置的方案follow：<a href=\"https://iwanlab.com/npm-xui/\">https://iwanlab.com/npm-xui/</a><br>相关的视频：<a href=\"https://www.youtube.com/watch?v=V3nsDicSMBc\">https://www.youtube.com/watch?v=V3nsDicSMBc</a></p>\n<p>待测试：vless:&#x2F;&#x2F;<a href=\"mailto:&#x33;&#x39;&#102;&#x64;&#x65;&#50;&#100;&#x32;&#45;&#x63;&#x38;&#56;&#99;&#45;&#x34;&#98;&#x65;&#97;&#45;&#x64;&#52;&#57;&#x31;&#x2d;&#x66;&#x62;&#54;&#57;&#x39;&#x30;&#100;&#52;&#x39;&#x37;&#52;&#49;&#x40;&#x76;&#x6d;&#101;&#x73;&#115;&#x2e;&#x63;&#97;&#114;&#x6c;&#x7a;&#101;&#110;&#103;&#46;&#x63;&#111;&#109;\">&#x33;&#x39;&#102;&#x64;&#x65;&#50;&#100;&#x32;&#45;&#x63;&#x38;&#56;&#99;&#45;&#x34;&#98;&#x65;&#97;&#45;&#x64;&#52;&#57;&#x31;&#x2d;&#x66;&#x62;&#54;&#57;&#x39;&#x30;&#100;&#52;&#x39;&#x37;&#52;&#49;&#x40;&#x76;&#x6d;&#101;&#x73;&#115;&#x2e;&#x63;&#97;&#114;&#x6c;&#x7a;&#101;&#110;&#103;&#46;&#x63;&#111;&#109;</a>:17866?type&#x3D;ws&amp;security&#x3D;none&amp;path&#x3D;%2Fgugu#gugugee</p>\n<p>可以打开后台配置 <a href=\"http://192.168.6.116:54321/fk/xui/\">http://192.168.6.116:54321/fk/xui/</a><br>没成功…期待更多的客户端连接测试, 等救援</p>\n<p>思路有问题：x-ui是一个服务端的节点！</p>\n<div class=\"tabs\" id=\"名称\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#名称-1\">名称 1</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"名称-1\"><p>待续。。。</p></div></div></div>","categories":[{"name":"Docker","path":"api/categories/Docker.json"}],"tags":[{"name":"docker","path":"api/tags/docker.json"},{"name":"debian","path":"api/tags/debian.json"},{"name":"docker-compose","path":"api/tags/docker-compose.json"},{"name":"NPM","path":"api/tags/NPM.json"},{"name":"短链接","path":"api/tags/短链接.json"},{"name":"YOURLS","path":"api/tags/YOURLS.json"},{"name":"URL缩短","path":"api/tags/URL缩短.json"}]}