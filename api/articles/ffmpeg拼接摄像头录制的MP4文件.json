{"title":"ffmpeg拼接摄像头录制的MP4文件","slug":"ffmpeg拼接摄像头录制的MP4文件","date":"2024-11-26T03:07:22.000Z","updated":"2025-12-01T02:50:46.352Z","comments":true,"path":"api/articles/ffmpeg拼接摄像头录制的MP4文件.json","excerpt":" [Figure] 学会如何拼接摄像头中的多个录像MP4文件, 成为一整段完整的录像MP4文件","covers":["https://img.carlzeng.com:3/i/2024/11/26/67453ebaf02d8.png","https://img.carlzeng.com:3/i/2024/11/26/67455327841e2.png","https://img.carlzeng.com:3/i/2024/11/26/67453f138ed94.png","https://img.carlzeng.com:3/i/2024/11/26/67455bb094599.png","https://img.carlzeng.com:3/i/2024/11/30/674b19a7339a7.png","https://img.carlzeng.com:3/i/2024/12/03/674f264c0b806.png"],"content":"<img class=\"lozad\" data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67453ebaf02d8.png\">\n\n<p>学会如何拼接摄像头中的多个录像MP4文件, 成为一整段完整的录像MP4文件</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>在苹果电脑中</p>\n<p>学会如何拼接摄像头中的多个录像MP4文件, 成为一整段完整的录像MP4文件</p>\n<p>学会如何拼接多张照片成视频</p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><p>安装ffmpeg </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install ffmpeg</span><br></pre></td></tr></table></figure>\n\n<p>编辑和运行bash a.sh</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=ffmpeg\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><h2 id=\"批量重命名文件\"><a href=\"#批量重命名文件\" class=\"headerlink\" title=\"批量重命名文件\"></a>批量重命名文件</h2><p>排序后, MAC中选中多个文件, 然后选重命名, </p>\n<p>会弹出一个对话框 如下图所示(这时修改完了的, 重新再重命名的界面)</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67455327841e2.png\" alt=\"image-20241126124837983\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67453f138ed94.png\" alt=\"image-20241126112257942\"></p>\n<h2 id=\"拼接出mp4文件\"><a href=\"#拼接出mp4文件\" class=\"headerlink\" title=\"拼接出mp4文件\"></a>拼接出mp4文件</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 将 mp4 文件封装为 ts 格式</span></span><br><span class=\"line\">ffmpeg -i a1.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 1.ts</span><br><span class=\"line\">ffmpeg -i a2.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 2.ts</span><br><span class=\"line\">ffmpeg -i a3.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 3.ts</span><br><span class=\"line\">ffmpeg -i a4.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 4.ts</span><br><span class=\"line\">ffmpeg -i a5.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 5.ts</span><br><span class=\"line\">ffmpeg -i a6.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 6.ts</span><br><span class=\"line\">ffmpeg -i a7.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 7.ts</span><br><span class=\"line\">ffmpeg -i a8.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 8.ts</span><br><span class=\"line\">ffmpeg -i a9.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 9.ts</span><br><span class=\"line\">ffmpeg -i a10.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 10.ts</span><br><span class=\"line\">ffmpeg -i a11.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 11.ts</span><br><span class=\"line\">ffmpeg -i a12.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 12.ts</span><br><span class=\"line\">ffmpeg -i a13.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 13.ts</span><br><span class=\"line\">ffmpeg -i a14.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 14.ts</span><br><span class=\"line\">ffmpeg -i a15.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 15.ts</span><br><span class=\"line\">ffmpeg -i a16.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 16.ts</span><br><span class=\"line\">ffmpeg -i a17.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 17.ts</span><br><span class=\"line\">ffmpeg -i a18.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 18.ts</span><br><span class=\"line\">ffmpeg -i a19.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 19.ts</span><br><span class=\"line\"><span class=\"comment\"># 拼接 ts 并导出最终 mp4 文件</span></span><br><span class=\"line\">ffmpeg -i <span class=\"string\">&quot;concat:1.ts|2.ts|3.ts|4.ts|5.ts|6.ts|7.ts|8.ts|9.ts|10.ts|11.ts|12.ts|13.ts|14.ts|15.ts|16.ts|17.ts|18.ts|19.ts&quot;</span> -acodec copy -vcodec copy -absf aac_adtstoasc output.mp4</span><br><span class=\"line\"><span class=\"comment\"># 删除过程中生成的 ts 文件</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> *.ts</span><br></pre></td></tr></table></figure>\n\n\n\n<p>终端中，cd 到 mp4 的目录，执行 bash a.sh，等待即可；</p>\n<h2 id=\"错误及解决办法\"><a href=\"#错误及解决办法\" class=\"headerlink\" title=\"错误及解决办法\"></a>错误及解决办法</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i a1.mp4 -vcodec copy -acodec copy -vbsf h264_mp4toannexb 1.ts</span><br><span class=\"line\"></span><br><span class=\"line\">[h264_mp4toannexb @ 0x127f2e760] Codec <span class=\"string\">&#x27;hevc&#x27;</span> (173) is not supported by the bitstream filter <span class=\"string\">&#x27;h264_mp4toannexb&#x27;</span>. Supported codecs are: h264 (27)</span><br><span class=\"line\"></span><br><span class=\"line\">[vost<span class=\"comment\">#0:0/copy @ 0x145f07ec0] Error initializing bitstream filter: h264_mp4toannexb</span></span><br><span class=\"line\">Error opening output file 1.ts.</span><br><span class=\"line\">Error opening output files: Invalid argument</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>更换编码</p>\n<p>从 h264_mp4toannexb 改成: hevc_mp4toannexb</p>\n<p>成功拼接19个摄像头中的mp4文件: output.mp4, 一共19个文件, 合并后大小460MB, 约1小时时长.</p>\n<p>成功拼接38个摄像头中的mp4文件: output.mp4. 一共38个文件, 合并后900MB, 2.5小时</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://www.yukapril.com/2020/05/31/mp4-combine.html\">使用 ffmpeg，完成多个 mp4 文件合并</a></p>\n<h1 id=\"拼接多张照片成视频\"><a href=\"#拼接多张照片成视频\" class=\"headerlink\" title=\"拼接多张照片成视频\"></a>拼接多张照片成视频</h1><h2 id=\"实践\"><a href=\"#实践\" class=\"headerlink\" title=\"实践\"></a>实践</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 1 -f image2 -i 202411231%03d.jpg output202411231.mp4 </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67455bb094599.png\" alt=\"image-20241126132503158\"></p>\n<p>下一步: 插入视频背景音乐</p>\n<h2 id=\"理论过程\"><a href=\"#理论过程\" class=\"headerlink\" title=\"理论过程\"></a>理论过程</h2><p>使用ffmpeg将图片拼接成视频前，需要将图片文件名做下预处理，文件名中必须有数字将其次序标记出来，这里我直接使用数字将图片重命名了，如下：</p>\n<p>直接使用命令<code>ffmpeg -f image2 -i %d.jpeg output.mp4</code> 就可以将其转为mp4视频，命令中的%d是数字编号占位符，ffmpeg会按次序加载1-250.jpeg做为输入。这里我们没有指定如何其他参数，所以ffmpeg使用了默认的参数，比如帧率是25fps，视频使用了h264编码，分辨率直接使用了图片原始分辨率……</p>\n<h3 id=\"r-调整帧率\"><a href=\"#r-调整帧率\" class=\"headerlink\" title=\"-r 调整帧率\"></a>-r 调整帧率</h3><p>不指定帧率的话，ffmpeg会使用默认的25帧，也就是1秒钟拼接25张图片，我们可以通过调整帧率的大小来控制最终生成视频的时长。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 10 -f image2 -i %d.jpeg output1.mp4</span><br></pre></td></tr></table></figure>\n\n<p>如上命令每秒会拼接10张图片，250张图片最终会生成25秒的视频。<br><strong>这里需要注意<code>-r 10</code> 参数的位置，在<code>-i %d.jpeg</code>前面和在后面的效果是不一样的。放在-i后面只会改变输出的视频帧率，而输入的还是默认值25</strong> ，比如<code>ffmpeg -f image2 -i %d.jpeg -r 10 output1.mp4</code>，250张图片依旧只会生成10s的视频，但视频的播放征率会减小到10。</p>\n<h3 id=\"b-v-调整视频码率\"><a href=\"#b-v-调整视频码率\" class=\"headerlink\" title=\"-b:v 调整视频码率\"></a>-b:v 调整视频码率</h3><p>-b:v bitrate of video。如果原始图片比较大，默认参数生成的视频大小会比较大。比如上文中我使用的图片都是2k的高清图，最终生成的10s视频就有35MB，码率有近30Mb&#x2F;s（码率是只1s播过的数据量，注意这里单位是小b）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 10 -f image2 -i %d.jpeg -b:v 4M output2.mp4</span><br></pre></td></tr></table></figure>\n\n<p>这里额外提醒下，改变码率会影响到视频清晰度，但并不意味着高码率的视频一定比低码率的视频清晰度更高，这还取决于视频编码格式，比如h265编码可以用更小的码率生成h264同等的视频质量，像av1、v8、v9等编码也优于h264。</p>\n<h3 id=\"crf-调整视频质量\"><a href=\"#crf-调整视频质量\" class=\"headerlink\" title=\"-crf 调整视频质量\"></a>-crf 调整视频质量</h3><p>-crf Constant Rate Factor，用以平衡视频质量和文件大小的参数，FFMPEG里取值范围为0-51，取值越高内容损失越多，视频质量更差。 ffmpeg的默认值是23，建议的取值范围是17-28。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 10 -f image2 -i %d.jpeg output3.mp4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"c-v-调整视频的编码格式\"><a href=\"#c-v-调整视频的编码格式\" class=\"headerlink\" title=\"-c:v 调整视频的编码格式\"></a>-c:v 调整视频的编码格式</h3><p>-c:v codec of video。目前ffmpeg针对于mp4默认使用的是h264，你可以使用<code>-c:v libx265</code>生成同等质量，但文件更小的h265视频。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -c:v libx265 output4.mp4</span><br></pre></td></tr></table></figure>\n\n<p>output4.mp4相比于上文中生成的output.mp4，视频文件大小减少了60%，但视频质量不变。你也可以使用<code>-c:v libvpx</code> <code>-c:v libvpx-vp9</code>分别生成v8和v9编码的webm文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -c:v libvpx output-v8.webm <span class=\"comment\">#注意webm默认生成的是低质量的视频，可使用-crf或者-b:v参数调整视频质量。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vf-scale-调整视频分辨率\"><a href=\"#vf-scale-调整视频分辨率\" class=\"headerlink\" title=\"-vf scale 调整视频分辨率\"></a>-vf scale 调整视频分辨率</h3><p>-vf scale: Video Filter Scale</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -s 640x480 output5.mp4</span><br></pre></td></tr></table></figure>\n\n<p>上面的命令会将视频直接调整为640x480的分辨率，如果原始图片不是4:3 肯定是会对原始图像做拉伸的。可以使用下面的命令等比例缩放</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -vf scale=-1:480 output5.mp4 <span class=\"comment\">#-1表示比例缩放，也可-vf scale=640:-1固定宽度缩放高度</span></span><br></pre></td></tr></table></figure>\n\n<p>以上就是几个常用的参数，这几个参数不仅限于图片转视频，视频转视频时也可以使用。</p>\n<h2 id=\"插入视频背景音乐\"><a href=\"#插入视频背景音乐\" class=\"headerlink\" title=\"插入视频背景音乐\"></a>插入视频背景音乐</h2><p>ffmpeg -an -i video.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 60 -y output_bgm.mp4</p>\n<p>-an -i   代表消除源视频中的音频</p>\n<p>-t 60 剪裁60秒</p>\n<p>实例:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -an -i output.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 2400 -y output_bgm.mp4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#合并, 去除原声, 一共剪裁输出40分钟的视频</span></span><br><span class=\"line\"><span class=\"comment\">#-t 60 代表剪裁输出60秒视频</span></span><br><span class=\"line\"><span class=\"comment\">#-stream_loop -1  参数-1代表循环输入源</span></span><br><span class=\"line\"><span class=\"comment\">#-c:v copy 对视频流进行复制，不需要重新编解码（前提是输入流和输出流一致），速度极快</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>其他</p>\n<p>2、视频编辑 </p>\n<p>比如从第5秒的地方开始，往后截取10秒钟</p>\n<p>ffmpeg -ss 5 -t 10 -i output1.mp4 output2.mp4</p>\n<p>4、视频加速</p>\n<p>ffmpeg -i result.mp4 -vf setpts&#x3D;PTS&#x2F;2 -af atempo&#x3D;2 result01.mp4</p>\n<p>6、调整视频宽高</p>\n<p>ffmpeg -i result.mp4 -vf scale&#x3D;320*240 result02.mp4</p>\n<h1 id=\"实际用例模版\"><a href=\"#实际用例模版\" class=\"headerlink\" title=\"实际用例模版\"></a>实际用例模版</h1><h2 id=\"1-组合监控截图\"><a href=\"#1-组合监控截图\" class=\"headerlink\" title=\"1. 组合监控截图\"></a>1. 组合监控截图</h2><p>打开Terminal, cd 拉到NAS的目录中 cd &#x2F;Volumes&#x2F;homes&#x2F;13261977480&#x2F;Photos&#x2F; 生成视频:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /Volumes/homes/13261977480/Photos/</span><br><span class=\"line\">ffmpeg -r 1 -f image2 -i 202411231%03d.jpg output202411231.mp4 </span><br></pre></td></tr></table></figure>\n\n<p>一条命令将特定一组的监控截图拼接&#x2F;合成成为视频mp4文件</p>\n<p>背景说明: 由于这一组的监控截图时通过以下的命令, 定时从监控摄像头中截取&#x2F;抽帧而来.</p>\n<p>nohup ffmpeg -i “rtsp:&#x2F;&#x2F;<em>:</em>@192.168.6.21:554” -y -f image2 -r 1&#x2F;180 &#x2F;volume2&#x2F;homes&#x2F;13261977480&#x2F;Photos&#x2F;202411231%03d.jpg &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</p>\n<p>实例</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Users/carlzeng/.ssh</span><br><span class=\"line\">./sshNas.sh</span><br><span class=\"line\">cd /Volumes/homes/13261977480/Photos/</span><br><span class=\"line\"></span><br><span class=\"line\">ffmpeg -r 1 -f image2 -i 202503073%03d.jpg Quest3更换摇杆202503073.mp4</span><br><span class=\"line\"></span><br><span class=\"line\">ffmpeg -an -i Quest3更换摇杆202503073.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 23 -y Quest3更换摇杆20250307_bgm.mp4</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"2-添加背景音乐\"><a href=\"#2-添加背景音乐\" class=\"headerlink\" title=\"2. 添加背景音乐\"></a>2. 添加背景音乐</h2><p>预览一下上面那个组合起来的视频, 看看总时长时多少(比如: 44秒)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -an -i output202412031.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 44 -y output_bgm.mp4</span><br></pre></td></tr></table></figure>\n\n<p>一条命令将mp4文件合成了背景音乐, 这第二条命令合并背景音乐, 并制定视频的总时长(如: 44秒)</p>\n<h2 id=\"AI生成Python程序\"><a href=\"#AI生成Python程序\" class=\"headerlink\" title=\"AI生成Python程序\"></a>AI生成Python程序</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> ffmpeg</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> glob</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_video_from_images</span>(<span class=\"params\">image_pattern, output_video, frame_rate=<span class=\"number\">1</span></span>):</span><br><span class=\"line\">    (</span><br><span class=\"line\">        ffmpeg</span><br><span class=\"line\">        .<span class=\"built_in\">input</span>(image_pattern, framerate=frame_rate)</span><br><span class=\"line\">        .output(output_video)</span><br><span class=\"line\">        .run()</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add_background_music</span>(<span class=\"params\">video_file, audio_file, output_file</span>):</span><br><span class=\"line\">    (</span><br><span class=\"line\">        ffmpeg</span><br><span class=\"line\">        .<span class=\"built_in\">input</span>(video_file, an=<span class=\"literal\">None</span>)</span><br><span class=\"line\">        .<span class=\"built_in\">input</span>(audio_file, stream_loop=-<span class=\"number\">1</span>)</span><br><span class=\"line\">        .output(output_file, vcodec=<span class=\"string\">&#x27;copy&#x27;</span>)</span><br><span class=\"line\">        .run()</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">count_images</span>(<span class=\"params\">image_pattern</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(glob.glob(image_pattern))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &lt; <span class=\"number\">4</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Usage: python video_creation.py &lt;image_pattern&gt; &lt;output_video&gt; &lt;audio_file&gt;&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    image_pattern = sys.argv[<span class=\"number\">1</span>]   <span class=\"comment\"># e.g. &#x27;202503073%03d.jpg&#x27;</span></span><br><span class=\"line\">    output_video = sys.argv[<span class=\"number\">2</span>]     <span class=\"comment\"># e.g. &#x27;Quest3更换摇杆202503073.mp4&#x27;</span></span><br><span class=\"line\">    audio_file = sys.argv[<span class=\"number\">3</span>]       <span class=\"comment\"># e.g. &#x27;bgm.mp3&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Count the number of images</span></span><br><span class=\"line\">    num_images = count_images(image_pattern)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> num_images == <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;No images found with the specified pattern.&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Calculate duration based on the number of images</span></span><br><span class=\"line\">    duration = num_images  <span class=\"comment\"># Assuming 1 second per image</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Generate the video from images</span></span><br><span class=\"line\">    create_video_from_images(image_pattern, output_video)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Add background music to the video</span></span><br><span class=\"line\">    output_with_bgm = output_video.replace(<span class=\"string\">&#x27;.mp4&#x27;</span>, <span class=\"string\">&#x27;_bgm.mp4&#x27;</span>)</span><br><span class=\"line\">    add_background_music(output_video, audio_file, output_with_bgm)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;Video with background music created: <span class=\"subst\">&#123;output_with_bgm&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 video_creation.py 202511281%03d.jpg SwitchOLED挖孔硬解2025</span><br><span class=\"line\">11281.mp4 bgm.mp3                                                                                               </span><br><span class=\"line\">Traceback (most recent call last):                                                                              </span><br><span class=\"line\">  File &quot;video_creation.py&quot;, line 1, in                                                                  </span><br><span class=\"line\">    import ffmpeg                                                                                               </span><br><span class=\"line\">ModuleNotFoundError: No module named &#x27;ffmpeg&#x27;         </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@DS918:/volume2/homes/13261977480/Photos# python --version                                                  </span><br><span class=\"line\">Python 3.8.12                                                                                                   </span><br><span class=\"line\">root@DS918:/volume2/homes/13261977480/Photos# pip3 install ffmpeg-python </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>POE的assistant没有帮我解决问题(开始提示点数到了, 将要无法免费), </p>\n<p>最终是<a href=\"https://www.doubao.com/chat/31965310298658306\">doubao的AI</a>写出来一个可用的:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> subprocess</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> tempfile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check_ffmpeg</span>():</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        subprocess.run([<span class=\"string\">&quot;ffmpeg&quot;</span>, <span class=\"string\">&quot;-version&quot;</span>], stdout=subprocess.PIPE, stderr=subprocess.PIPE, check=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;错误：未找到FFmpeg&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">count_images_by_pattern</span>(<span class=\"params\">img_pattern: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span><br><span class=\"line\">    digit_match = re.search(<span class=\"string\">r&#x27;%0(\\d+)d&#x27;</span>, img_pattern)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> digit_match:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;错误：图片模式格式不合法&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    digit_len = <span class=\"built_in\">int</span>(digit_match.group(<span class=\"number\">1</span>))</span><br><span class=\"line\">    folder = os.path.dirname(img_pattern) <span class=\"keyword\">or</span> <span class=\"string\">&quot;.&quot;</span></span><br><span class=\"line\">    filename_template = os.path.basename(img_pattern)</span><br><span class=\"line\">    prefix = filename_template.split(<span class=\"string\">&#x27;%0&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    suffix = filename_template.split(<span class=\"string\">&#x27;d&#x27;</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    count = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> os.listdir(folder):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> file.startswith(prefix) <span class=\"keyword\">and</span> file.endswith(suffix):</span><br><span class=\"line\">            num_str = file[<span class=\"built_in\">len</span>(prefix):-<span class=\"built_in\">len</span>(suffix)]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> num_str.isdigit() <span class=\"keyword\">and</span> <span class=\"built_in\">len</span>(num_str) == digit_len:</span><br><span class=\"line\">                count += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> count</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">images_to_video_with_temp</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">    img_pattern: <span class=\"built_in\">str</span>,</span></span><br><span class=\"line\"><span class=\"params\">    final_video: <span class=\"built_in\">str</span>,</span></span><br><span class=\"line\"><span class=\"params\">    fps: <span class=\"built_in\">int</span> = <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"params\">    bgm_path: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;bgm.mp3&quot;</span>,</span></span><br><span class=\"line\"><span class=\"params\">    overwrite: <span class=\"built_in\">bool</span> = <span class=\"literal\">True</span></span></span><br><span class=\"line\"><span class=\"params\"></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> check_ffmpeg():</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(bgm_path):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;错误：背景音乐文件不存在&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">    img_count = count_images_by_pattern(img_pattern)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> img_count == <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    video_duration = img_count / fps</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 创建临时文件（自动删除）</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> tempfile.NamedTemporaryFile(suffix=<span class=\"string\">&#x27;.mp4&#x27;</span>, delete=<span class=\"literal\">False</span>) <span class=\"keyword\">as</span> temp_file:</span><br><span class=\"line\">        temp_video = temp_file.name</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 第一步：图片转临时视频（无管道，最稳定）</span></span><br><span class=\"line\">        cmd1 = [</span><br><span class=\"line\">            <span class=\"string\">&quot;ffmpeg&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-r&quot;</span>, <span class=\"built_in\">str</span>(fps),</span><br><span class=\"line\">            <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;image2&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-i&quot;</span>, img_pattern,</span><br><span class=\"line\">            <span class=\"string\">&quot;-c:v&quot;</span>, <span class=\"string\">&quot;libx264&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-pix_fmt&quot;</span>, <span class=\"string\">&quot;yuv420p&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-y&quot;</span> <span class=\"keyword\">if</span> overwrite <span class=\"keyword\">else</span> <span class=\"string\">&quot;-n&quot;</span>,</span><br><span class=\"line\">            temp_video</span><br><span class=\"line\">        ]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;执行命令：<span class=\"subst\">&#123;<span class=\"string\">&#x27; &#x27;</span>.join(cmd1)&#125;</span>&quot;</span>)</span><br><span class=\"line\">        result1 = subprocess.run(cmd1, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class=\"literal\">True</span>, check=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 第二步：添加背景音乐</span></span><br><span class=\"line\">        cmd2 = [</span><br><span class=\"line\">            <span class=\"string\">&quot;ffmpeg&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-an&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-i&quot;</span>, temp_video,</span><br><span class=\"line\">            <span class=\"string\">&quot;-stream_loop&quot;</span>, <span class=\"string\">&quot;-1&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-i&quot;</span>, bgm_path,</span><br><span class=\"line\">            <span class=\"string\">&quot;-c:v&quot;</span>, <span class=\"string\">&quot;copy&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-t&quot;</span>, <span class=\"string\">f&quot;<span class=\"subst\">&#123;video_duration:<span class=\"number\">.2</span>f&#125;</span>&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-y&quot;</span> <span class=\"keyword\">if</span> overwrite <span class=\"keyword\">else</span> <span class=\"string\">&quot;-n&quot;</span>,</span><br><span class=\"line\">            final_video</span><br><span class=\"line\">        ]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;执行命令：<span class=\"subst\">&#123;<span class=\"string\">&#x27; &#x27;</span>.join(cmd2)&#125;</span>&quot;</span>)</span><br><span class=\"line\">        result2 = subprocess.run(cmd2, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class=\"literal\">True</span>, check=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 成功！最终文件：<span class=\"subst\">&#123;final_video&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">except</span> subprocess.CalledProcessError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;❌ 命令失败：<span class=\"subst\">&#123;e.cmd&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;错误输出：<span class=\"subst\">&#123;e.stderr&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">finally</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 清理临时文件</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> os.path.exists(temp_video):</span><br><span class=\"line\">            os.unlink(temp_video)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ð️ 已删除临时文件：<span class=\"subst\">&#123;temp_video&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) != <span class=\"number\">3</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;用法：python video_maker.py &lt;image_pattern&gt; &lt;output_video&gt;&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    img_pattern = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\">    final_video = sys.argv[<span class=\"number\">2</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    success = images_to_video_with_temp(img_pattern, final_video)</span><br><span class=\"line\">    sys.exit(<span class=\"number\">0</span> <span class=\"keyword\">if</span> success <span class=\"keyword\">else</span> <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p>继续优化成无需写硬盘(缓存第一个mp4文件), 直接用内存缓冲, 减轻硬盘读写压力, 优化速度.</p>\n<h2 id=\"3-发布到B站-抖音等等\"><a href=\"#3-发布到B站-抖音等等\" class=\"headerlink\" title=\"3. 发布到B站&#x2F;抖音等等\"></a>3. 发布到B站&#x2F;抖音等等</h2><p>3.1 打开Bilibili<a href=\"https://member.bilibili.com/platform/upload/video/frame?page_from=creative_home_top_upload\">创作中心 - 投稿</a>, 直接拉入在NAS中生成的视频文件(完成上传)</p>\n<p>填写基础及说明信息, 提交投稿</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/30/674b19a7339a7.png\" alt=\"image-20241130215646973\"></p>\n<p>3.2 打开抖音网页版 <a href=\"https://creator.douyin.com/creator-micro/content/manage\">抖音创作者中心</a> - <a href=\"https://creator.douyin.com/creator-micro/content/upload\">发布视频</a></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/12/03/674f264c0b806.png\" alt=\"image-20241203233954551\"></p>\n<p>3.3 打开小红书网页版 <a href=\"https://creator.xiaohongshu.com/new/home\">创作服务平台</a> - <a href=\"https://creator.xiaohongshu.com/publish/publish?from=menu\">发布笔记</a> </p>\n<p>关键字:</p>\n<p>Switch PS5 Xbox手柄快修 Steamdeck Quest</p>\n<p>博主 <a href=\"http://www.carlzeng.com/\">www.carlzeng.com</a></p>\n<p>海鲜市场账号: 手柄一修哥</p>\n<p>小电玩专修 专业现场手柄快修 游戏手柄&#x2F;主机修复 实时监控查看 switch ps5 xbox</p>\n<p>坐标: 北京通州</p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>在苹果电脑中</p>\n<p>学会如何拼接摄像头中的多个录像MP4文件, 成为一整段完整的录像MP4文件</p>\n<p>学会如何拼接多张照片成视频</p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><p>安装ffmpeg </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install ffmpeg</span><br></pre></td></tr></table></figure>\n\n<p>编辑和运行bash a.sh</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=ffmpeg\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><h2 id=\"批量重命名文件\"><a href=\"#批量重命名文件\" class=\"headerlink\" title=\"批量重命名文件\"></a>批量重命名文件</h2><p>排序后, MAC中选中多个文件, 然后选重命名, </p>\n<p>会弹出一个对话框 如下图所示(这时修改完了的, 重新再重命名的界面)</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67455327841e2.png\" alt=\"image-20241126124837983\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67453f138ed94.png\" alt=\"image-20241126112257942\"></p>\n<h2 id=\"拼接出mp4文件\"><a href=\"#拼接出mp4文件\" class=\"headerlink\" title=\"拼接出mp4文件\"></a>拼接出mp4文件</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 将 mp4 文件封装为 ts 格式</span></span><br><span class=\"line\">ffmpeg -i a1.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 1.ts</span><br><span class=\"line\">ffmpeg -i a2.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 2.ts</span><br><span class=\"line\">ffmpeg -i a3.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 3.ts</span><br><span class=\"line\">ffmpeg -i a4.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 4.ts</span><br><span class=\"line\">ffmpeg -i a5.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 5.ts</span><br><span class=\"line\">ffmpeg -i a6.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 6.ts</span><br><span class=\"line\">ffmpeg -i a7.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 7.ts</span><br><span class=\"line\">ffmpeg -i a8.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 8.ts</span><br><span class=\"line\">ffmpeg -i a9.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 9.ts</span><br><span class=\"line\">ffmpeg -i a10.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 10.ts</span><br><span class=\"line\">ffmpeg -i a11.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 11.ts</span><br><span class=\"line\">ffmpeg -i a12.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 12.ts</span><br><span class=\"line\">ffmpeg -i a13.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 13.ts</span><br><span class=\"line\">ffmpeg -i a14.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 14.ts</span><br><span class=\"line\">ffmpeg -i a15.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 15.ts</span><br><span class=\"line\">ffmpeg -i a16.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 16.ts</span><br><span class=\"line\">ffmpeg -i a17.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 17.ts</span><br><span class=\"line\">ffmpeg -i a18.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 18.ts</span><br><span class=\"line\">ffmpeg -i a19.mp4 -vcodec copy -acodec copy -vbsf hevc_mp4toannexb 19.ts</span><br><span class=\"line\"><span class=\"comment\"># 拼接 ts 并导出最终 mp4 文件</span></span><br><span class=\"line\">ffmpeg -i <span class=\"string\">&quot;concat:1.ts|2.ts|3.ts|4.ts|5.ts|6.ts|7.ts|8.ts|9.ts|10.ts|11.ts|12.ts|13.ts|14.ts|15.ts|16.ts|17.ts|18.ts|19.ts&quot;</span> -acodec copy -vcodec copy -absf aac_adtstoasc output.mp4</span><br><span class=\"line\"><span class=\"comment\"># 删除过程中生成的 ts 文件</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> *.ts</span><br></pre></td></tr></table></figure>\n\n\n\n<p>终端中，cd 到 mp4 的目录，执行 bash a.sh，等待即可；</p>\n<h2 id=\"错误及解决办法\"><a href=\"#错误及解决办法\" class=\"headerlink\" title=\"错误及解决办法\"></a>错误及解决办法</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i a1.mp4 -vcodec copy -acodec copy -vbsf h264_mp4toannexb 1.ts</span><br><span class=\"line\"></span><br><span class=\"line\">[h264_mp4toannexb @ 0x127f2e760] Codec <span class=\"string\">&#x27;hevc&#x27;</span> (173) is not supported by the bitstream filter <span class=\"string\">&#x27;h264_mp4toannexb&#x27;</span>. Supported codecs are: h264 (27)</span><br><span class=\"line\"></span><br><span class=\"line\">[vost<span class=\"comment\">#0:0/copy @ 0x145f07ec0] Error initializing bitstream filter: h264_mp4toannexb</span></span><br><span class=\"line\">Error opening output file 1.ts.</span><br><span class=\"line\">Error opening output files: Invalid argument</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>更换编码</p>\n<p>从 h264_mp4toannexb 改成: hevc_mp4toannexb</p>\n<p>成功拼接19个摄像头中的mp4文件: output.mp4, 一共19个文件, 合并后大小460MB, 约1小时时长.</p>\n<p>成功拼接38个摄像头中的mp4文件: output.mp4. 一共38个文件, 合并后900MB, 2.5小时</p>\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://www.yukapril.com/2020/05/31/mp4-combine.html\">使用 ffmpeg，完成多个 mp4 文件合并</a></p>\n<h1 id=\"拼接多张照片成视频\"><a href=\"#拼接多张照片成视频\" class=\"headerlink\" title=\"拼接多张照片成视频\"></a>拼接多张照片成视频</h1><h2 id=\"实践\"><a href=\"#实践\" class=\"headerlink\" title=\"实践\"></a>实践</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 1 -f image2 -i 202411231%03d.jpg output202411231.mp4 </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/26/67455bb094599.png\" alt=\"image-20241126132503158\"></p>\n<p>下一步: 插入视频背景音乐</p>\n<h2 id=\"理论过程\"><a href=\"#理论过程\" class=\"headerlink\" title=\"理论过程\"></a>理论过程</h2><p>使用ffmpeg将图片拼接成视频前，需要将图片文件名做下预处理，文件名中必须有数字将其次序标记出来，这里我直接使用数字将图片重命名了，如下：</p>\n<p>直接使用命令<code>ffmpeg -f image2 -i %d.jpeg output.mp4</code> 就可以将其转为mp4视频，命令中的%d是数字编号占位符，ffmpeg会按次序加载1-250.jpeg做为输入。这里我们没有指定如何其他参数，所以ffmpeg使用了默认的参数，比如帧率是25fps，视频使用了h264编码，分辨率直接使用了图片原始分辨率……</p>\n<h3 id=\"r-调整帧率\"><a href=\"#r-调整帧率\" class=\"headerlink\" title=\"-r 调整帧率\"></a>-r 调整帧率</h3><p>不指定帧率的话，ffmpeg会使用默认的25帧，也就是1秒钟拼接25张图片，我们可以通过调整帧率的大小来控制最终生成视频的时长。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 10 -f image2 -i %d.jpeg output1.mp4</span><br></pre></td></tr></table></figure>\n\n<p>如上命令每秒会拼接10张图片，250张图片最终会生成25秒的视频。<br><strong>这里需要注意<code>-r 10</code> 参数的位置，在<code>-i %d.jpeg</code>前面和在后面的效果是不一样的。放在-i后面只会改变输出的视频帧率，而输入的还是默认值25</strong> ，比如<code>ffmpeg -f image2 -i %d.jpeg -r 10 output1.mp4</code>，250张图片依旧只会生成10s的视频，但视频的播放征率会减小到10。</p>\n<h3 id=\"b-v-调整视频码率\"><a href=\"#b-v-调整视频码率\" class=\"headerlink\" title=\"-b:v 调整视频码率\"></a>-b:v 调整视频码率</h3><p>-b:v bitrate of video。如果原始图片比较大，默认参数生成的视频大小会比较大。比如上文中我使用的图片都是2k的高清图，最终生成的10s视频就有35MB，码率有近30Mb&#x2F;s（码率是只1s播过的数据量，注意这里单位是小b）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 10 -f image2 -i %d.jpeg -b:v 4M output2.mp4</span><br></pre></td></tr></table></figure>\n\n<p>这里额外提醒下，改变码率会影响到视频清晰度，但并不意味着高码率的视频一定比低码率的视频清晰度更高，这还取决于视频编码格式，比如h265编码可以用更小的码率生成h264同等的视频质量，像av1、v8、v9等编码也优于h264。</p>\n<h3 id=\"crf-调整视频质量\"><a href=\"#crf-调整视频质量\" class=\"headerlink\" title=\"-crf 调整视频质量\"></a>-crf 调整视频质量</h3><p>-crf Constant Rate Factor，用以平衡视频质量和文件大小的参数，FFMPEG里取值范围为0-51，取值越高内容损失越多，视频质量更差。 ffmpeg的默认值是23，建议的取值范围是17-28。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 10 -f image2 -i %d.jpeg output3.mp4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"c-v-调整视频的编码格式\"><a href=\"#c-v-调整视频的编码格式\" class=\"headerlink\" title=\"-c:v 调整视频的编码格式\"></a>-c:v 调整视频的编码格式</h3><p>-c:v codec of video。目前ffmpeg针对于mp4默认使用的是h264，你可以使用<code>-c:v libx265</code>生成同等质量，但文件更小的h265视频。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -c:v libx265 output4.mp4</span><br></pre></td></tr></table></figure>\n\n<p>output4.mp4相比于上文中生成的output.mp4，视频文件大小减少了60%，但视频质量不变。你也可以使用<code>-c:v libvpx</code> <code>-c:v libvpx-vp9</code>分别生成v8和v9编码的webm文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -c:v libvpx output-v8.webm <span class=\"comment\">#注意webm默认生成的是低质量的视频，可使用-crf或者-b:v参数调整视频质量。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vf-scale-调整视频分辨率\"><a href=\"#vf-scale-调整视频分辨率\" class=\"headerlink\" title=\"-vf scale 调整视频分辨率\"></a>-vf scale 调整视频分辨率</h3><p>-vf scale: Video Filter Scale</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -s 640x480 output5.mp4</span><br></pre></td></tr></table></figure>\n\n<p>上面的命令会将视频直接调整为640x480的分辨率，如果原始图片不是4:3 肯定是会对原始图像做拉伸的。可以使用下面的命令等比例缩放</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -f image2 -i %d.jpeg -vf scale=-1:480 output5.mp4 <span class=\"comment\">#-1表示比例缩放，也可-vf scale=640:-1固定宽度缩放高度</span></span><br></pre></td></tr></table></figure>\n\n<p>以上就是几个常用的参数，这几个参数不仅限于图片转视频，视频转视频时也可以使用。</p>\n<h2 id=\"插入视频背景音乐\"><a href=\"#插入视频背景音乐\" class=\"headerlink\" title=\"插入视频背景音乐\"></a>插入视频背景音乐</h2><p>ffmpeg -an -i video.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 60 -y output_bgm.mp4</p>\n<p>-an -i   代表消除源视频中的音频</p>\n<p>-t 60 剪裁60秒</p>\n<p>实例:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -an -i output.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 2400 -y output_bgm.mp4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#合并, 去除原声, 一共剪裁输出40分钟的视频</span></span><br><span class=\"line\"><span class=\"comment\">#-t 60 代表剪裁输出60秒视频</span></span><br><span class=\"line\"><span class=\"comment\">#-stream_loop -1  参数-1代表循环输入源</span></span><br><span class=\"line\"><span class=\"comment\">#-c:v copy 对视频流进行复制，不需要重新编解码（前提是输入流和输出流一致），速度极快</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>其他</p>\n<p>2、视频编辑 </p>\n<p>比如从第5秒的地方开始，往后截取10秒钟</p>\n<p>ffmpeg -ss 5 -t 10 -i output1.mp4 output2.mp4</p>\n<p>4、视频加速</p>\n<p>ffmpeg -i result.mp4 -vf setpts&#x3D;PTS&#x2F;2 -af atempo&#x3D;2 result01.mp4</p>\n<p>6、调整视频宽高</p>\n<p>ffmpeg -i result.mp4 -vf scale&#x3D;320*240 result02.mp4</p>\n<h1 id=\"实际用例模版\"><a href=\"#实际用例模版\" class=\"headerlink\" title=\"实际用例模版\"></a>实际用例模版</h1><h2 id=\"1-组合监控截图\"><a href=\"#1-组合监控截图\" class=\"headerlink\" title=\"1. 组合监控截图\"></a>1. 组合监控截图</h2><p>打开Terminal, cd 拉到NAS的目录中 cd &#x2F;Volumes&#x2F;homes&#x2F;13261977480&#x2F;Photos&#x2F; 生成视频:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /Volumes/homes/13261977480/Photos/</span><br><span class=\"line\">ffmpeg -r 1 -f image2 -i 202411231%03d.jpg output202411231.mp4 </span><br></pre></td></tr></table></figure>\n\n<p>一条命令将特定一组的监控截图拼接&#x2F;合成成为视频mp4文件</p>\n<p>背景说明: 由于这一组的监控截图时通过以下的命令, 定时从监控摄像头中截取&#x2F;抽帧而来.</p>\n<p>nohup ffmpeg -i “rtsp:&#x2F;&#x2F;<em>:</em>@192.168.6.21:554” -y -f image2 -r 1&#x2F;180 &#x2F;volume2&#x2F;homes&#x2F;13261977480&#x2F;Photos&#x2F;202411231%03d.jpg &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</p>\n<p>实例</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Users/carlzeng/.ssh</span><br><span class=\"line\">./sshNas.sh</span><br><span class=\"line\">cd /Volumes/homes/13261977480/Photos/</span><br><span class=\"line\"></span><br><span class=\"line\">ffmpeg -r 1 -f image2 -i 202503073%03d.jpg Quest3更换摇杆202503073.mp4</span><br><span class=\"line\"></span><br><span class=\"line\">ffmpeg -an -i Quest3更换摇杆202503073.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 23 -y Quest3更换摇杆20250307_bgm.mp4</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"2-添加背景音乐\"><a href=\"#2-添加背景音乐\" class=\"headerlink\" title=\"2. 添加背景音乐\"></a>2. 添加背景音乐</h2><p>预览一下上面那个组合起来的视频, 看看总时长时多少(比如: 44秒)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -an -i output202412031.mp4 -stream_loop -1 -i bgm.mp3 -c:v copy -t 44 -y output_bgm.mp4</span><br></pre></td></tr></table></figure>\n\n<p>一条命令将mp4文件合成了背景音乐, 这第二条命令合并背景音乐, 并制定视频的总时长(如: 44秒)</p>\n<h2 id=\"AI生成Python程序\"><a href=\"#AI生成Python程序\" class=\"headerlink\" title=\"AI生成Python程序\"></a>AI生成Python程序</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> ffmpeg</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> glob</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_video_from_images</span>(<span class=\"params\">image_pattern, output_video, frame_rate=<span class=\"number\">1</span></span>):</span><br><span class=\"line\">    (</span><br><span class=\"line\">        ffmpeg</span><br><span class=\"line\">        .<span class=\"built_in\">input</span>(image_pattern, framerate=frame_rate)</span><br><span class=\"line\">        .output(output_video)</span><br><span class=\"line\">        .run()</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add_background_music</span>(<span class=\"params\">video_file, audio_file, output_file</span>):</span><br><span class=\"line\">    (</span><br><span class=\"line\">        ffmpeg</span><br><span class=\"line\">        .<span class=\"built_in\">input</span>(video_file, an=<span class=\"literal\">None</span>)</span><br><span class=\"line\">        .<span class=\"built_in\">input</span>(audio_file, stream_loop=-<span class=\"number\">1</span>)</span><br><span class=\"line\">        .output(output_file, vcodec=<span class=\"string\">&#x27;copy&#x27;</span>)</span><br><span class=\"line\">        .run()</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">count_images</span>(<span class=\"params\">image_pattern</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(glob.glob(image_pattern))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &lt; <span class=\"number\">4</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Usage: python video_creation.py &lt;image_pattern&gt; &lt;output_video&gt; &lt;audio_file&gt;&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    image_pattern = sys.argv[<span class=\"number\">1</span>]   <span class=\"comment\"># e.g. &#x27;202503073%03d.jpg&#x27;</span></span><br><span class=\"line\">    output_video = sys.argv[<span class=\"number\">2</span>]     <span class=\"comment\"># e.g. &#x27;Quest3更换摇杆202503073.mp4&#x27;</span></span><br><span class=\"line\">    audio_file = sys.argv[<span class=\"number\">3</span>]       <span class=\"comment\"># e.g. &#x27;bgm.mp3&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Count the number of images</span></span><br><span class=\"line\">    num_images = count_images(image_pattern)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> num_images == <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;No images found with the specified pattern.&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Calculate duration based on the number of images</span></span><br><span class=\"line\">    duration = num_images  <span class=\"comment\"># Assuming 1 second per image</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Generate the video from images</span></span><br><span class=\"line\">    create_video_from_images(image_pattern, output_video)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Add background music to the video</span></span><br><span class=\"line\">    output_with_bgm = output_video.replace(<span class=\"string\">&#x27;.mp4&#x27;</span>, <span class=\"string\">&#x27;_bgm.mp4&#x27;</span>)</span><br><span class=\"line\">    add_background_music(output_video, audio_file, output_with_bgm)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;Video with background music created: <span class=\"subst\">&#123;output_with_bgm&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 video_creation.py 202511281%03d.jpg SwitchOLED挖孔硬解2025</span><br><span class=\"line\">11281.mp4 bgm.mp3                                                                                               </span><br><span class=\"line\">Traceback (most recent call last):                                                                              </span><br><span class=\"line\">  File &quot;video_creation.py&quot;, line 1, in                                                                  </span><br><span class=\"line\">    import ffmpeg                                                                                               </span><br><span class=\"line\">ModuleNotFoundError: No module named &#x27;ffmpeg&#x27;         </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@DS918:/volume2/homes/13261977480/Photos# python --version                                                  </span><br><span class=\"line\">Python 3.8.12                                                                                                   </span><br><span class=\"line\">root@DS918:/volume2/homes/13261977480/Photos# pip3 install ffmpeg-python </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>POE的assistant没有帮我解决问题(开始提示点数到了, 将要无法免费), </p>\n<p>最终是<a href=\"https://www.doubao.com/chat/31965310298658306\">doubao的AI</a>写出来一个可用的:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> subprocess</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> tempfile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check_ffmpeg</span>():</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        subprocess.run([<span class=\"string\">&quot;ffmpeg&quot;</span>, <span class=\"string\">&quot;-version&quot;</span>], stdout=subprocess.PIPE, stderr=subprocess.PIPE, check=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;错误：未找到FFmpeg&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">count_images_by_pattern</span>(<span class=\"params\">img_pattern: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">int</span>:</span><br><span class=\"line\">    digit_match = re.search(<span class=\"string\">r&#x27;%0(\\d+)d&#x27;</span>, img_pattern)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> digit_match:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;错误：图片模式格式不合法&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    digit_len = <span class=\"built_in\">int</span>(digit_match.group(<span class=\"number\">1</span>))</span><br><span class=\"line\">    folder = os.path.dirname(img_pattern) <span class=\"keyword\">or</span> <span class=\"string\">&quot;.&quot;</span></span><br><span class=\"line\">    filename_template = os.path.basename(img_pattern)</span><br><span class=\"line\">    prefix = filename_template.split(<span class=\"string\">&#x27;%0&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    suffix = filename_template.split(<span class=\"string\">&#x27;d&#x27;</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    count = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> os.listdir(folder):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> file.startswith(prefix) <span class=\"keyword\">and</span> file.endswith(suffix):</span><br><span class=\"line\">            num_str = file[<span class=\"built_in\">len</span>(prefix):-<span class=\"built_in\">len</span>(suffix)]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> num_str.isdigit() <span class=\"keyword\">and</span> <span class=\"built_in\">len</span>(num_str) == digit_len:</span><br><span class=\"line\">                count += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> count</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">images_to_video_with_temp</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">    img_pattern: <span class=\"built_in\">str</span>,</span></span><br><span class=\"line\"><span class=\"params\">    final_video: <span class=\"built_in\">str</span>,</span></span><br><span class=\"line\"><span class=\"params\">    fps: <span class=\"built_in\">int</span> = <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"params\">    bgm_path: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;bgm.mp3&quot;</span>,</span></span><br><span class=\"line\"><span class=\"params\">    overwrite: <span class=\"built_in\">bool</span> = <span class=\"literal\">True</span></span></span><br><span class=\"line\"><span class=\"params\"></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> check_ffmpeg():</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(bgm_path):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;错误：背景音乐文件不存在&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">    img_count = count_images_by_pattern(img_pattern)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> img_count == <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    video_duration = img_count / fps</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 创建临时文件（自动删除）</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> tempfile.NamedTemporaryFile(suffix=<span class=\"string\">&#x27;.mp4&#x27;</span>, delete=<span class=\"literal\">False</span>) <span class=\"keyword\">as</span> temp_file:</span><br><span class=\"line\">        temp_video = temp_file.name</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 第一步：图片转临时视频（无管道，最稳定）</span></span><br><span class=\"line\">        cmd1 = [</span><br><span class=\"line\">            <span class=\"string\">&quot;ffmpeg&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-r&quot;</span>, <span class=\"built_in\">str</span>(fps),</span><br><span class=\"line\">            <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;image2&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-i&quot;</span>, img_pattern,</span><br><span class=\"line\">            <span class=\"string\">&quot;-c:v&quot;</span>, <span class=\"string\">&quot;libx264&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-pix_fmt&quot;</span>, <span class=\"string\">&quot;yuv420p&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-y&quot;</span> <span class=\"keyword\">if</span> overwrite <span class=\"keyword\">else</span> <span class=\"string\">&quot;-n&quot;</span>,</span><br><span class=\"line\">            temp_video</span><br><span class=\"line\">        ]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;执行命令：<span class=\"subst\">&#123;<span class=\"string\">&#x27; &#x27;</span>.join(cmd1)&#125;</span>&quot;</span>)</span><br><span class=\"line\">        result1 = subprocess.run(cmd1, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class=\"literal\">True</span>, check=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 第二步：添加背景音乐</span></span><br><span class=\"line\">        cmd2 = [</span><br><span class=\"line\">            <span class=\"string\">&quot;ffmpeg&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-an&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-i&quot;</span>, temp_video,</span><br><span class=\"line\">            <span class=\"string\">&quot;-stream_loop&quot;</span>, <span class=\"string\">&quot;-1&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-i&quot;</span>, bgm_path,</span><br><span class=\"line\">            <span class=\"string\">&quot;-c:v&quot;</span>, <span class=\"string\">&quot;copy&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-t&quot;</span>, <span class=\"string\">f&quot;<span class=\"subst\">&#123;video_duration:<span class=\"number\">.2</span>f&#125;</span>&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;-y&quot;</span> <span class=\"keyword\">if</span> overwrite <span class=\"keyword\">else</span> <span class=\"string\">&quot;-n&quot;</span>,</span><br><span class=\"line\">            final_video</span><br><span class=\"line\">        ]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;执行命令：<span class=\"subst\">&#123;<span class=\"string\">&#x27; &#x27;</span>.join(cmd2)&#125;</span>&quot;</span>)</span><br><span class=\"line\">        result2 = subprocess.run(cmd2, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class=\"literal\">True</span>, check=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 成功！最终文件：<span class=\"subst\">&#123;final_video&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">except</span> subprocess.CalledProcessError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;❌ 命令失败：<span class=\"subst\">&#123;e.cmd&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;错误输出：<span class=\"subst\">&#123;e.stderr&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">finally</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 清理临时文件</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> os.path.exists(temp_video):</span><br><span class=\"line\">            os.unlink(temp_video)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ð️ 已删除临时文件：<span class=\"subst\">&#123;temp_video&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) != <span class=\"number\">3</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;用法：python video_maker.py &lt;image_pattern&gt; &lt;output_video&gt;&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    img_pattern = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\">    final_video = sys.argv[<span class=\"number\">2</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    success = images_to_video_with_temp(img_pattern, final_video)</span><br><span class=\"line\">    sys.exit(<span class=\"number\">0</span> <span class=\"keyword\">if</span> success <span class=\"keyword\">else</span> <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p>继续优化成无需写硬盘(缓存第一个mp4文件), 直接用内存缓冲, 减轻硬盘读写压力, 优化速度.</p>\n<h2 id=\"3-发布到B站-抖音等等\"><a href=\"#3-发布到B站-抖音等等\" class=\"headerlink\" title=\"3. 发布到B站&#x2F;抖音等等\"></a>3. 发布到B站&#x2F;抖音等等</h2><p>3.1 打开Bilibili<a href=\"https://member.bilibili.com/platform/upload/video/frame?page_from=creative_home_top_upload\">创作中心 - 投稿</a>, 直接拉入在NAS中生成的视频文件(完成上传)</p>\n<p>填写基础及说明信息, 提交投稿</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/11/30/674b19a7339a7.png\" alt=\"image-20241130215646973\"></p>\n<p>3.2 打开抖音网页版 <a href=\"https://creator.douyin.com/creator-micro/content/manage\">抖音创作者中心</a> - <a href=\"https://creator.douyin.com/creator-micro/content/upload\">发布视频</a></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/12/03/674f264c0b806.png\" alt=\"image-20241203233954551\"></p>\n<p>3.3 打开小红书网页版 <a href=\"https://creator.xiaohongshu.com/new/home\">创作服务平台</a> - <a href=\"https://creator.xiaohongshu.com/publish/publish?from=menu\">发布笔记</a> </p>\n<p>关键字:</p>\n<p>Switch PS5 Xbox手柄快修 Steamdeck Quest</p>\n<p>博主 <a href=\"http://www.carlzeng.com/\">www.carlzeng.com</a></p>\n<p>海鲜市场账号: 手柄一修哥</p>\n<p>小电玩专修 专业现场手柄快修 游戏手柄&#x2F;主机修复 实时监控查看 switch ps5 xbox</p>\n<p>坐标: 北京通州</p>","categories":[{"name":"ffmpeg","path":"api/categories/ffmpeg.json"}],"tags":[{"name":"ffmpeg","path":"api/tags/ffmpeg.json"},{"name":"mp4","path":"api/tags/mp4.json"}]}