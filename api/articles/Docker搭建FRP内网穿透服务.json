{"title":"Docker搭建FRP内网穿透服务(花生壳、Ngrok平替)","slug":"Docker搭建FRP内网穿透服务","date":"2023-12-03T11:26:39.000Z","updated":"2024-10-25T13:16:40.303Z","comments":true,"path":"api/articles/Docker搭建FRP内网穿透服务.json","excerpt":" [Figure] 内网穿透, 让局域网的服务在异地互联网状态依旧在线可用frp，一个高性能的反向代理, 可以通过互联网(外网)访问内网(本地局域网)设备灵活，TCP&#x2F;IP底层逻辑应用广泛","covers":["https://www.evernote.com/shard/s122/sh/5871f136-c4ad-4027-a582-45be87d46857/lsLZkP4tHMBKiqmU_ELAXPMwv1QgcYVGlopUkQFCXnN7zSsVEXZ_RkAccg/deep/0/image.png","https://www.evernote.com/shard/s122/sh/f91e4989-af7d-4910-abe5-c8146f128425/IQbusguULdKcK362p7Ob5rz7FkKSL8T5rzUwZMJ5uXnBSGjNM88g_xwyTg/deep/0/image.png","https://img.carlzeng.com:3/i/2024/08/01/66aa6dd923f04.png","https://img.carlzeng.com:3/i/2024/08/18/66c1efe0a5f34.png"],"content":"<p><img data-src=\"https://www.evernote.com/shard/s122/sh/5871f136-c4ad-4027-a582-45be87d46857/lsLZkP4tHMBKiqmU_ELAXPMwv1QgcYVGlopUkQFCXnN7zSsVEXZ_RkAccg/deep/0/image.png\" alt=\"frp+scrcpy\"></p>\n<p>内网穿透, 让局域网的服务在异地互联网状态依旧在线可用</p>\n<p><a href=\"https://github.com/fatedier/frp/blob/master/README_zh.md\">frp，一个高性能的反向代理</a>, 可以通过互联网(外网)访问内网(本地局域网)设备</p>\n<p>灵活，TCP&#x2F;IP底层逻辑应用广泛</p>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>2024.01 更新内容：如何家宽模式下使用（frp p2p模式 ）<br>使用感受：P2P模式对于这种家宽自建的frp服务太实用</p>\n</blockquote>\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>映射出局域网，‘打洞‘，平替花生壳之类的功能</p>\n<p>举例：远程scrcpy连接安卓设备的adb操作屏幕，说人话：远程控制机顶盒或电视等</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 操作步骤</span></span><br><span class=\"line\"><span class=\"comment\">## 开启frpc p2p模式</span></span><br><span class=\"line\">1. frpc -c frpc.ini </span><br><span class=\"line\"><span class=\"comment\">## 通过ssh连接本机特定端口，来连接远程NAS的SSH（TCP 22端口）</span></span><br><span class=\"line\">2. ssh 127.0.0.1 -p 22223</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"概念-什么是FRP-内网穿透服务\"><a href=\"#概念-什么是FRP-内网穿透服务\" class=\"headerlink\" title=\"[概念]什么是FRP 内网穿透服务\"></a>[概念]什么是FRP 内网穿透服务</h1><p><a href=\"https://github.com/fatedier/frp/blob/master/README_zh.md\">https://github.com/fatedier/frp/blob/master/README_zh.md</a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">为什么使用 frp ？</span><br><span class=\"line\">开发状态</span><br><span class=\"line\">完整文档已经迁移至 https://gofrp.org</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><p>先自建一个frps服务器端(运行frps用的)<br>然后自控端A，被控端B；内网穿透服务器<br><a href=\"https://zsxwz.com/2023/10/09/%E8%BF%9C%E7%A8%8B%E6%8A%95%E5%B1%8F%E6%8E%A7%E5%88%B6%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%EF%BC%8C%E4%B8%8D%E7%94%A8-usb-%E4%B8%8D%E7%94%A8-wifi-%E4%B8%8D%E7%94%A8root/\">https://zsxwz.com/2023/10/09/远程投屏控制安卓手机，不用-usb-不用-wifi-不用root/</a><br><a href=\"https://zsxwz.com/2023/10/03/frp-%E4%BD%BF%E7%94%A8-p2p-%E6%A8%A1%E5%BC%8F%EF%BC%8C%E7%82%B9%E5%AF%B9%E7%82%B9%E7%A9%BF%E9%80%8F%EF%BC%8C%E8%8A%82%E7%BA%A6%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%A6%E5%AE%BD/\">https://zsxwz.com/2023/10/03/frp-使用-p2p-模式，点对点穿透，节约服务器带宽/</a><br>    开启手机adb，然后用scrcpy</p>\n<p>[done]TODO 自建docker的frps服务<br><a href=\"https://github.com/fatedier/frp\">https://github.com/fatedier/frp</a><br>方案就是开放特定的内网服务到外网直接访问（域名+端口），这个特定的内网服务是有控制功能的，比如路由的web页面，可ssh的端口，可以远程桌面的mstc等。<br>这样打洞以后，在洞上面架设的是可以远程操作协助的APP（比如远程桌面，ssh等）<br>从而实现远程协助的功能。</p>\n<p>感觉frps，frpc才是王道，但愿受控端的操作会少一些，简单一下，步骤简易一些，通俗易懂一些。</p>\n<p>docker-compose.yml</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;3.3&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">     frps:</span><br><span class=\"line\">        image: snowdreamtech/frps:latest</span><br><span class=\"line\">        <span class=\"comment\">#ports:</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;7000:7000&quot; #</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;9527:7500&quot; #web management</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;10022:10022&quot; #used for ssh</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;7500:80&quot; #http</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;10443:443&quot; #https</span></span><br><span class=\"line\">        network_mode: host  <span class=\"comment\">#改成host模式，省出一些事来</span></span><br><span class=\"line\">        volumes:</span><br><span class=\"line\">          - ./frps.ini:/etc/frp/frps.toml <span class=\"comment\">#很奇葩为的最新版frps就是要这么对应</span></span><br><span class=\"line\">            <span class=\"comment\">#- ./frps.toml:/etc/frp/frps.toml </span></span><br><span class=\"line\">        container_name: frps</span><br><span class=\"line\">        restart: unless-stopped</span><br></pre></td></tr></table></figure>\n\n\n\n<p>FRP服务器配置文件 frps.ini  </p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span>                                                                                                                       </span><br><span class=\"line\"><span class=\"comment\">#frps listen on 7000                                                                                                           </span></span><br><span class=\"line\"><span class=\"attr\">bind_port</span>= <span class=\"number\">7000</span>                                                                                                                </span><br><span class=\"line\"><span class=\"attr\">kcp_bind_port</span> = <span class=\"number\">7000</span>                                                                                                           </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"comment\">#vhost_http_port = 80                                                                                                          </span></span><br><span class=\"line\"><span class=\"comment\">#vhost_https_port = 443                                                                                                        </span></span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"attr\">authentication_method</span> = token                                                                                                  </span><br><span class=\"line\"><span class=\"attr\">token</span> = @@@@@@@@@@                                                                                                                 </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"comment\"># If subDomainHost is not empty, you can set subdomain when type is http or https in frpc&#x27;s configure file                     </span></span><br><span class=\"line\"><span class=\"comment\"># When subdomain is est, the host used by routing is test.frps.com                                                             </span></span><br><span class=\"line\"><span class=\"attr\">custom_domains</span> = <span class=\"string\">&quot;carlzeng.com&quot;</span>                                                                                                </span><br><span class=\"line\"><span class=\"attr\">log_level</span> = trace                                                                                                              </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"comment\">#dashboard                                                                                                                     </span></span><br><span class=\"line\"><span class=\"attr\">dashboard_addr</span> = <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>                                                                                                       </span><br><span class=\"line\"><span class=\"attr\">dashboard_port</span>= <span class=\"number\">9527</span>                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">dashboard_user</span>= @@@@@@                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">dashboard_pwd</span>= @@@@@@</span><br></pre></td></tr></table></figure>\n\n<p>7000映射到外网了，在主路由上已配置。<br>测试frpc 来链接。。。。</p>\n<p>2023&#x2F;12&#x2F;01 08:35:34 [1;34m[I] [service.go:312] Dashboard listen on 0.0.0.0:9527[0m<br>无法正常连接, 原来是 配置文件dashboard_port&#x3D; 7500，然后docker映射出来9527即可。</p>\n<img data-src='https://www.evernote.com/shard/s122/sh/48544655-3a61-483a-b7ab-0a72f6cb4579/ebhmTXJ7DGn78oKPU3BDFhmbJ1jfxVMCaYN7a-J6dd8azwGBMDIH2P9NEg/deep/0/image.png'/>\n\n<p>docker重启日志中：<br>2023&#x2F;12&#x2F;01 08:57:30 [1;34m[I] [service.go:533] [67b3d0c8dd4be924] client login info: ip [120.244.216.197:37895] version [0.52.3] hostname [] os [linux] arch [mipsle][0m</p>\n<p>new proxy [web] type [http] error: subdomain is not supported because this feature is not enabled in server<br><a href=\"https://github.com/fatedier/frp\">https://github.com/fatedier/frp</a></p>\n<h2 id=\"FRPS-服务端如何反代？\"><a href=\"#FRPS-服务端如何反代？\" class=\"headerlink\" title=\"FRPS 服务端如何反代？\"></a>FRPS 服务端如何反代？</h2><p>修改了上面的配置:</p>\n<p>network_mode: host</p>\n<p>开启防火墙6002</p>\n<p>太赞了，https:&#x2F;&#x2F;@@@@.carlzeng.com:@@@@&#x2F;Advanced_Extensions_script.asp</p>\n<p>比Zerotier强太多了！！！</p>\n<p>​\tK2P UI中的文本框编辑在Zerotier中无法使用，在frpc后反代以后都正常了！</p>\n<p>https:&#x2F;&#x2F;@@@@.carlzeng.com:@@@@&#x2F; 反代到debian的6002端口，协议选择http</p>\n<h2 id=\"客户端frpc配置\"><a href=\"#客户端frpc配置\" class=\"headerlink\" title=\"客户端frpc配置\"></a>客户端frpc配置</h2><p>frpc可以运行与各个平台，比如：Windows电脑、苹果电脑、Linux、Unix等系统的电脑，安卓手机端，苹果手机端等等…</p>\n<h3 id=\"设置应用2\"><a href=\"#设置应用2\" class=\"headerlink\" title=\"设置应用2\"></a>设置应用2</h3><p>FRP客户端配置文件 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span> </span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = frp.@@@. <span class=\"comment\">#对应上面frps服务器的IP或者域名</span></span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[webFloor#2]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6003</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[webFloor#1]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">192.168</span>.<span class=\"number\">10.1</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6004</span></span><br></pre></td></tr></table></figure>\n\n<p>设置到K2P里面去</p>\n<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/f91e4989-af7d-4910-abe5-c8146f128425/IQbusguULdKcK362p7Ob5rz7FkKSL8T5rzUwZMJ5uXnBSGjNM88g_xwyTg/deep/0/image.png\">\n\n<p>[done]TODO：</p>\n<p>开启debian防火墙的6003-6004，</p>\n<p>NPM反代6003</p>\n<h3 id=\"设置应用3\"><a href=\"#设置应用3\" class=\"headerlink\" title=\"设置应用3\"></a>设置应用3</h3><p>去应用的docker中（比如独角数卡）加入frpc，然后反代出来</p>\n<p>wget <a href=\"https://mirror.ghproxy.com/https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz\">https://mirror.ghproxy.com/https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz</a></p>\n<p>tar -xf frp_0.52.3_linux_amd64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;bin</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure>\n\n<p>客户端 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span>                                                                                                                     </span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = <span class=\"number\">192.168</span>.<span class=\"number\">6.116</span>                                                                                                  </span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span>                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">token</span> = @@@@@                                                                                                               </span><br><span class=\"line\">                                                                                                                             </span><br><span class=\"line\"><span class=\"section\">[dujiaoshuka]</span>                                                                                                                </span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">4445</span>                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp                                                                                                                   </span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">4444</span>                                                                                                            </span><br><span class=\"line\"><span class=\"attr\">subdomain</span> = buy</span><br></pre></td></tr></table></figure>\n\n<p>发现仍然无法解决，页面的操作携带端口的需求</p>\n<h3 id=\"设置应用4\"><a href=\"#设置应用4\" class=\"headerlink\" title=\"设置应用4\"></a>设置应用4</h3><p>远程控制adb，安卓设备远程控制</p>\n<p>在路由器上，给192.168.123.189这个设备的5555端口映射出来</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">....<span class=\"comment\">#省略连接服务器部分的配置 [common] 都一样指定远程服务端的信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[zl_n1_adb5555]</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6006</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">192.168</span>.<span class=\"number\">1.243</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">5555</span></span><br><span class=\"line\"><span class=\"attr\">subdomain</span> = ssh_zl</span><br><span class=\"line\"><span class=\"section\">[zl_web_80]</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6008</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">192.168</span>.<span class=\"number\">1.12</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">subdomain</span> = ssh_zl</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h1 id=\"如何家宽模式下使用（frp-p2p模式-）\"><a href=\"#如何家宽模式下使用（frp-p2p模式-）\" class=\"headerlink\" title=\"如何家宽模式下使用（frp p2p模式 ）\"></a>如何家宽模式下使用（frp p2p模式 ）</h1><p>使用frp的p2p模式，点对点穿透，绝大多数数据无需经过服务端，加速了穿透访问</p>\n<p>第三方接入FRP服务器，映射出特定的端口到本地：</p>\n<p>服务器frps的配置，和上面一样无需做任何修改，只要是配置被控端和主控端的两个frpc配置文件：</p>\n<p>2、被控端B配置文件 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = 服务端ip地址</span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">123456</span>xxx</span><br><span class=\"line\"><span class=\"section\">[p2p_sj_adb]</span> <span class=\"comment\">#比如安卓手机termux穿透adb 5555端口，这个名称要对应主控端A的server_name名称</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = stcp</span><br><span class=\"line\"><span class=\"attr\">sk</span> = password</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span> <span class=\"comment\">##这也可以是本地局域网的特定主机IP</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">5555</span></span><br></pre></td></tr></table></figure>\n\n<p>3、主控端A 配置文件 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = 服务端ip地址</span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">123456</span>xxx</span><br><span class=\"line\"><span class=\"section\">[p2p_sj_adb_visitor]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = stcp <span class=\"comment\">#使用stcp协议</span></span><br><span class=\"line\"><span class=\"attr\">role</span> = visitor  <span class=\"comment\">#身份访客</span></span><br><span class=\"line\"><span class=\"attr\">server_name</span> = p2p_sj_adb  <span class=\"comment\">#和被控端的节点名称一样，这个名称要对应被控端B的名称</span></span><br><span class=\"line\"><span class=\"attr\">sk</span> = password  <span class=\"comment\">#必须是：和被控端一样的密码</span></span><br><span class=\"line\"><span class=\"attr\">bind_addr</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">bind_port</span> = <span class=\"number\">15550</span>  <span class=\"comment\">#使用到的本机端口；</span></span><br><span class=\"line\"><span class=\"comment\">#这样连接本机的15550端口就直接穿透到被控端B的5555端口</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"免费的FRP服务资源\"><a href=\"#免费的FRP服务资源\" class=\"headerlink\" title=\"免费的FRP服务资源\"></a>免费的FRP服务资源</h1><p>如果暂时没有自建的条件，可以直接使用网络上开放免费的FRP服务，比如：</p>\n<ol>\n<li><a href=\"https://frp.104300.xyz/\">https://frp.104300.xyz/</a></li>\n<li><a href=\"https://freefrp.net/\">https://freefrp.net/</a><ol>\n<li><a href=\"https://freefrp.net/docs\">说明文档</a>很赞; <a href=\"https://freefrp.net/docs\">https://freefrp.net/docs</a></li>\n</ol>\n</li>\n</ol>\n<p>优点：所见即所得，马上就用</p>\n<p>缺点：速度慢，适合用来学习测试</p>\n<p>设置和应用太灵活了，以至于很难理解和变通到家宽部署的情况。</p>\n<p>关键词：docker frps 反向代理</p>\n<h1 id=\"群晖中安装-frpc-脚本\"><a href=\"#群晖中安装-frpc-脚本\" class=\"headerlink\" title=\"群晖中安装 frpc 脚本\"></a>群晖中安装 frpc 脚本</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/stilleshan/frpc/master/frpc_synology_install.sh &amp;&amp; chmod +x frpc_synology_install.sh &amp;&amp; ./frpc_synology_install.sh</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">以下为国内镜像</span></span><br><span class=\"line\">wget https://github.ioiox.com/stilleshan/frpc/raw/branch/master/frpc_synology_install.sh &amp;&amp; chmod +x frpc_synology_install.sh &amp;&amp; ./frpc_synology_install.sh</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/08/01/66aa6dd923f04.png\" alt=\"image-20240801010110138\"></p>\n<p>frpc toml stcp 格式: <a href=\"https://github.com/fatedier/frp/blob/dev/conf/frpc_full_example.toml\">https://github.com/fatedier/frp/blob/dev/conf/frpc_full_example.toml</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup /usr/local/frp/frpc -c /usr/local/frp/frpc.ini &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>脚本再群晖中,自动安装 frpc</p>\n<h1 id=\"错误以及排除解决\"><a href=\"#错误以及排除解决\" class=\"headerlink\" title=\"错误以及排除解决\"></a>错误以及排除解决</h1><h2 id=\"custom-listener-for-doesn’t-exist\"><a href=\"#custom-listener-for-doesn’t-exist\" class=\"headerlink\" title=\"custom listener for [] doesn’t exist\"></a>custom listener for [] doesn’t exist</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024/08/18 17:53:42 [W] [visitor.go:149] [fa45c4fd20893d9b] [CTR_hby_k2p_web80] start new visitor connection error: custom listener for [hby_k2p_web80] doesn&#x27;t exist </span><br></pre></td></tr></table></figure>\n\n<p>ping frp.carlzeng.com 服务器的IP是正确的, 由于服务器的IP刚变, 现在不清楚是:</p>\n<ol>\n<li>服务器docker的故障?<ol>\n<li>实时证明, 服务端非常稳定</li>\n</ol>\n</li>\n<li>NAS中运行的frpc的故障?<ol>\n<li>由于没有frpc, 导致无法直接连接到NAS的ssh</li>\n<li>通过开放的debian代理, 直接远程来访问k2p的局域网地址: <a href=\"http://192.168.6.243/Advanced_WOL_Content.asp\">http://192.168.6.243/Advanced_WOL_Content.asp</a></li>\n<li>果然问题出现在这个层面了, 详见下方</li>\n</ol>\n</li>\n<li>本地的frpc故障?<ol>\n<li>重启一下MAC</li>\n</ol>\n</li>\n</ol>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/08/18/66c1efe0a5f34.png\" alt=\"image-20240818205804453\"></p>\n<p>原来在NAS中, ping frp.carlzeng.com 居然还是得到旧的IP地址(错误的), 难怪远程无法正常P2P连接过去.</p>\n<p>优化(20240818):</p>\n<ol>\n<li>把NAS中运行的frpc所连接的服务地址, 修改为局域网中的本地地址(192.168.*.*); 这样的好处就是, 不管外网IP怎么变(域名所解析带来的延迟效果, 错误解析等等) 都不会影响到, 本地局域网的frpc客户端上线.</li>\n<li>检查了NAS的计划任务, 每次开机启动NAS, 会自动运行frpc</li>\n</ol>\n<p>至此, 解决了NAS中的frpc 运行故障(DNS解析得到错误的IP地址)</p>\n<p>进一步优化: </p>\n<p>把这个命令添加到进程守护中去, 这样不管发生什么进程消失&#x2F;退出了; 会自动重启起来.</p>\n<h1 id=\"灵感来源-感谢列表\"><a href=\"#灵感来源-感谢列表\" class=\"headerlink\" title=\"灵感来源&#x2F;感谢列表\"></a>灵感来源&#x2F;感谢列表</h1><p><a href=\"https://iwanlab.com/frp-with-nginx-proxy-manager/\">家里没有公网IP？FRP+NPM+VPS &#x3D; 随时随地用域名访问家里的任何设备！内网穿透，从未如此简单！</a></p>\n<p><a href=\"https://waynegong.cn/posts/8279.html\">Docker 部署 Nginx、frp 实现内网穿透</a></p>\n<p><a href=\"https://meowlight.space/archives/1599398838584\">使用docker-compose来构筑NGINX、frp的HTTP内网穿透</a></p>\n<p><a href=\"https://medium.com/@ken_c/%E7%94%A8fpc%E5%AE%9E%E7%8E%B0https%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F-a8570049b557\">用FPC实现HTTPS内网穿透</a></p>\n<p><a href=\"https://www.isisy.com/647.html\">Frp内网穿透——frpc客户端使用（2）</a></p>\n","more":"<blockquote>\n<p>2024.01 更新内容：如何家宽模式下使用（frp p2p模式 ）<br>使用感受：P2P模式对于这种家宽自建的frp服务太实用</p>\n</blockquote>\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>映射出局域网，‘打洞‘，平替花生壳之类的功能</p>\n<p>举例：远程scrcpy连接安卓设备的adb操作屏幕，说人话：远程控制机顶盒或电视等</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 操作步骤</span></span><br><span class=\"line\"><span class=\"comment\">## 开启frpc p2p模式</span></span><br><span class=\"line\">1. frpc -c frpc.ini </span><br><span class=\"line\"><span class=\"comment\">## 通过ssh连接本机特定端口，来连接远程NAS的SSH（TCP 22端口）</span></span><br><span class=\"line\">2. ssh 127.0.0.1 -p 22223</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"概念-什么是FRP-内网穿透服务\"><a href=\"#概念-什么是FRP-内网穿透服务\" class=\"headerlink\" title=\"[概念]什么是FRP 内网穿透服务\"></a>[概念]什么是FRP 内网穿透服务</h1><p><a href=\"https://github.com/fatedier/frp/blob/master/README_zh.md\">https://github.com/fatedier/frp/blob/master/README_zh.md</a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">为什么使用 frp ？</span><br><span class=\"line\">开发状态</span><br><span class=\"line\">完整文档已经迁移至 https://gofrp.org</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><p>先自建一个frps服务器端(运行frps用的)<br>然后自控端A，被控端B；内网穿透服务器<br><a href=\"https://zsxwz.com/2023/10/09/%E8%BF%9C%E7%A8%8B%E6%8A%95%E5%B1%8F%E6%8E%A7%E5%88%B6%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%EF%BC%8C%E4%B8%8D%E7%94%A8-usb-%E4%B8%8D%E7%94%A8-wifi-%E4%B8%8D%E7%94%A8root/\">https://zsxwz.com/2023/10/09/远程投屏控制安卓手机，不用-usb-不用-wifi-不用root/</a><br><a href=\"https://zsxwz.com/2023/10/03/frp-%E4%BD%BF%E7%94%A8-p2p-%E6%A8%A1%E5%BC%8F%EF%BC%8C%E7%82%B9%E5%AF%B9%E7%82%B9%E7%A9%BF%E9%80%8F%EF%BC%8C%E8%8A%82%E7%BA%A6%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%A6%E5%AE%BD/\">https://zsxwz.com/2023/10/03/frp-使用-p2p-模式，点对点穿透，节约服务器带宽/</a><br>    开启手机adb，然后用scrcpy</p>\n<p>[done]TODO 自建docker的frps服务<br><a href=\"https://github.com/fatedier/frp\">https://github.com/fatedier/frp</a><br>方案就是开放特定的内网服务到外网直接访问（域名+端口），这个特定的内网服务是有控制功能的，比如路由的web页面，可ssh的端口，可以远程桌面的mstc等。<br>这样打洞以后，在洞上面架设的是可以远程操作协助的APP（比如远程桌面，ssh等）<br>从而实现远程协助的功能。</p>\n<p>感觉frps，frpc才是王道，但愿受控端的操作会少一些，简单一下，步骤简易一些，通俗易懂一些。</p>\n<p>docker-compose.yml</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;3.3&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">     frps:</span><br><span class=\"line\">        image: snowdreamtech/frps:latest</span><br><span class=\"line\">        <span class=\"comment\">#ports:</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;7000:7000&quot; #</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;9527:7500&quot; #web management</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;10022:10022&quot; #used for ssh</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;7500:80&quot; #http</span></span><br><span class=\"line\">        <span class=\"comment\">#    - &quot;10443:443&quot; #https</span></span><br><span class=\"line\">        network_mode: host  <span class=\"comment\">#改成host模式，省出一些事来</span></span><br><span class=\"line\">        volumes:</span><br><span class=\"line\">          - ./frps.ini:/etc/frp/frps.toml <span class=\"comment\">#很奇葩为的最新版frps就是要这么对应</span></span><br><span class=\"line\">            <span class=\"comment\">#- ./frps.toml:/etc/frp/frps.toml </span></span><br><span class=\"line\">        container_name: frps</span><br><span class=\"line\">        restart: unless-stopped</span><br></pre></td></tr></table></figure>\n\n\n\n<p>FRP服务器配置文件 frps.ini  </p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span>                                                                                                                       </span><br><span class=\"line\"><span class=\"comment\">#frps listen on 7000                                                                                                           </span></span><br><span class=\"line\"><span class=\"attr\">bind_port</span>= <span class=\"number\">7000</span>                                                                                                                </span><br><span class=\"line\"><span class=\"attr\">kcp_bind_port</span> = <span class=\"number\">7000</span>                                                                                                           </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"comment\">#vhost_http_port = 80                                                                                                          </span></span><br><span class=\"line\"><span class=\"comment\">#vhost_https_port = 443                                                                                                        </span></span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"attr\">authentication_method</span> = token                                                                                                  </span><br><span class=\"line\"><span class=\"attr\">token</span> = @@@@@@@@@@                                                                                                                 </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"comment\"># If subDomainHost is not empty, you can set subdomain when type is http or https in frpc&#x27;s configure file                     </span></span><br><span class=\"line\"><span class=\"comment\"># When subdomain is est, the host used by routing is test.frps.com                                                             </span></span><br><span class=\"line\"><span class=\"attr\">custom_domains</span> = <span class=\"string\">&quot;carlzeng.com&quot;</span>                                                                                                </span><br><span class=\"line\"><span class=\"attr\">log_level</span> = trace                                                                                                              </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\">                                                                                                                               </span><br><span class=\"line\"><span class=\"comment\">#dashboard                                                                                                                     </span></span><br><span class=\"line\"><span class=\"attr\">dashboard_addr</span> = <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>                                                                                                       </span><br><span class=\"line\"><span class=\"attr\">dashboard_port</span>= <span class=\"number\">9527</span>                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">dashboard_user</span>= @@@@@@                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">dashboard_pwd</span>= @@@@@@</span><br></pre></td></tr></table></figure>\n\n<p>7000映射到外网了，在主路由上已配置。<br>测试frpc 来链接。。。。</p>\n<p>2023&#x2F;12&#x2F;01 08:35:34 [1;34m[I] [service.go:312] Dashboard listen on 0.0.0.0:9527[0m<br>无法正常连接, 原来是 配置文件dashboard_port&#x3D; 7500，然后docker映射出来9527即可。</p>\n<img data-src='https://www.evernote.com/shard/s122/sh/48544655-3a61-483a-b7ab-0a72f6cb4579/ebhmTXJ7DGn78oKPU3BDFhmbJ1jfxVMCaYN7a-J6dd8azwGBMDIH2P9NEg/deep/0/image.png'/>\n\n<p>docker重启日志中：<br>2023&#x2F;12&#x2F;01 08:57:30 [1;34m[I] [service.go:533] [67b3d0c8dd4be924] client login info: ip [120.244.216.197:37895] version [0.52.3] hostname [] os [linux] arch [mipsle][0m</p>\n<p>new proxy [web] type [http] error: subdomain is not supported because this feature is not enabled in server<br><a href=\"https://github.com/fatedier/frp\">https://github.com/fatedier/frp</a></p>\n<h2 id=\"FRPS-服务端如何反代？\"><a href=\"#FRPS-服务端如何反代？\" class=\"headerlink\" title=\"FRPS 服务端如何反代？\"></a>FRPS 服务端如何反代？</h2><p>修改了上面的配置:</p>\n<p>network_mode: host</p>\n<p>开启防火墙6002</p>\n<p>太赞了，https:&#x2F;&#x2F;@@@@.carlzeng.com:@@@@&#x2F;Advanced_Extensions_script.asp</p>\n<p>比Zerotier强太多了！！！</p>\n<p>​\tK2P UI中的文本框编辑在Zerotier中无法使用，在frpc后反代以后都正常了！</p>\n<p>https:&#x2F;&#x2F;@@@@.carlzeng.com:@@@@&#x2F; 反代到debian的6002端口，协议选择http</p>\n<h2 id=\"客户端frpc配置\"><a href=\"#客户端frpc配置\" class=\"headerlink\" title=\"客户端frpc配置\"></a>客户端frpc配置</h2><p>frpc可以运行与各个平台，比如：Windows电脑、苹果电脑、Linux、Unix等系统的电脑，安卓手机端，苹果手机端等等…</p>\n<h3 id=\"设置应用2\"><a href=\"#设置应用2\" class=\"headerlink\" title=\"设置应用2\"></a>设置应用2</h3><p>FRP客户端配置文件 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span> </span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = frp.@@@. <span class=\"comment\">#对应上面frps服务器的IP或者域名</span></span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[webFloor#2]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6003</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[webFloor#1]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">192.168</span>.<span class=\"number\">10.1</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6004</span></span><br></pre></td></tr></table></figure>\n\n<p>设置到K2P里面去</p>\n<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/f91e4989-af7d-4910-abe5-c8146f128425/IQbusguULdKcK362p7Ob5rz7FkKSL8T5rzUwZMJ5uXnBSGjNM88g_xwyTg/deep/0/image.png\">\n\n<p>[done]TODO：</p>\n<p>开启debian防火墙的6003-6004，</p>\n<p>NPM反代6003</p>\n<h3 id=\"设置应用3\"><a href=\"#设置应用3\" class=\"headerlink\" title=\"设置应用3\"></a>设置应用3</h3><p>去应用的docker中（比如独角数卡）加入frpc，然后反代出来</p>\n<p>wget <a href=\"https://mirror.ghproxy.com/https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz\">https://mirror.ghproxy.com/https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz</a></p>\n<p>tar -xf frp_0.52.3_linux_amd64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;bin</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure>\n\n<p>客户端 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span>                                                                                                                     </span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = <span class=\"number\">192.168</span>.<span class=\"number\">6.116</span>                                                                                                  </span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span>                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">token</span> = @@@@@                                                                                                               </span><br><span class=\"line\">                                                                                                                             </span><br><span class=\"line\"><span class=\"section\">[dujiaoshuka]</span>                                                                                                                </span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">4445</span>                                                                                                           </span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp                                                                                                                   </span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">4444</span>                                                                                                            </span><br><span class=\"line\"><span class=\"attr\">subdomain</span> = buy</span><br></pre></td></tr></table></figure>\n\n<p>发现仍然无法解决，页面的操作携带端口的需求</p>\n<h3 id=\"设置应用4\"><a href=\"#设置应用4\" class=\"headerlink\" title=\"设置应用4\"></a>设置应用4</h3><p>远程控制adb，安卓设备远程控制</p>\n<p>在路由器上，给192.168.123.189这个设备的5555端口映射出来</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">....<span class=\"comment\">#省略连接服务器部分的配置 [common] 都一样指定远程服务端的信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[zl_n1_adb5555]</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6006</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">192.168</span>.<span class=\"number\">1.243</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">5555</span></span><br><span class=\"line\"><span class=\"attr\">subdomain</span> = ssh_zl</span><br><span class=\"line\"><span class=\"section\">[zl_web_80]</span></span><br><span class=\"line\"><span class=\"attr\">remote_port</span> = <span class=\"number\">6008</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = tcp</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">192.168</span>.<span class=\"number\">1.12</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"attr\">subdomain</span> = ssh_zl</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h1 id=\"如何家宽模式下使用（frp-p2p模式-）\"><a href=\"#如何家宽模式下使用（frp-p2p模式-）\" class=\"headerlink\" title=\"如何家宽模式下使用（frp p2p模式 ）\"></a>如何家宽模式下使用（frp p2p模式 ）</h1><p>使用frp的p2p模式，点对点穿透，绝大多数数据无需经过服务端，加速了穿透访问</p>\n<p>第三方接入FRP服务器，映射出特定的端口到本地：</p>\n<p>服务器frps的配置，和上面一样无需做任何修改，只要是配置被控端和主控端的两个frpc配置文件：</p>\n<p>2、被控端B配置文件 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = 服务端ip地址</span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">123456</span>xxx</span><br><span class=\"line\"><span class=\"section\">[p2p_sj_adb]</span> <span class=\"comment\">#比如安卓手机termux穿透adb 5555端口，这个名称要对应主控端A的server_name名称</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = stcp</span><br><span class=\"line\"><span class=\"attr\">sk</span> = password</span><br><span class=\"line\"><span class=\"attr\">local_ip</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span> <span class=\"comment\">##这也可以是本地局域网的特定主机IP</span></span><br><span class=\"line\"><span class=\"attr\">local_port</span> = <span class=\"number\">5555</span></span><br></pre></td></tr></table></figure>\n\n<p>3、主控端A 配置文件 frpc.ini</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[common]</span></span><br><span class=\"line\"><span class=\"attr\">server_addr</span> = 服务端ip地址</span><br><span class=\"line\"><span class=\"attr\">server_port</span> = <span class=\"number\">7000</span></span><br><span class=\"line\"><span class=\"attr\">token</span> = <span class=\"number\">123456</span>xxx</span><br><span class=\"line\"><span class=\"section\">[p2p_sj_adb_visitor]</span></span><br><span class=\"line\"><span class=\"attr\">type</span> = stcp <span class=\"comment\">#使用stcp协议</span></span><br><span class=\"line\"><span class=\"attr\">role</span> = visitor  <span class=\"comment\">#身份访客</span></span><br><span class=\"line\"><span class=\"attr\">server_name</span> = p2p_sj_adb  <span class=\"comment\">#和被控端的节点名称一样，这个名称要对应被控端B的名称</span></span><br><span class=\"line\"><span class=\"attr\">sk</span> = password  <span class=\"comment\">#必须是：和被控端一样的密码</span></span><br><span class=\"line\"><span class=\"attr\">bind_addr</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">bind_port</span> = <span class=\"number\">15550</span>  <span class=\"comment\">#使用到的本机端口；</span></span><br><span class=\"line\"><span class=\"comment\">#这样连接本机的15550端口就直接穿透到被控端B的5555端口</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"免费的FRP服务资源\"><a href=\"#免费的FRP服务资源\" class=\"headerlink\" title=\"免费的FRP服务资源\"></a>免费的FRP服务资源</h1><p>如果暂时没有自建的条件，可以直接使用网络上开放免费的FRP服务，比如：</p>\n<ol>\n<li><a href=\"https://frp.104300.xyz/\">https://frp.104300.xyz/</a></li>\n<li><a href=\"https://freefrp.net/\">https://freefrp.net/</a><ol>\n<li><a href=\"https://freefrp.net/docs\">说明文档</a>很赞; <a href=\"https://freefrp.net/docs\">https://freefrp.net/docs</a></li>\n</ol>\n</li>\n</ol>\n<p>优点：所见即所得，马上就用</p>\n<p>缺点：速度慢，适合用来学习测试</p>\n<p>设置和应用太灵活了，以至于很难理解和变通到家宽部署的情况。</p>\n<p>关键词：docker frps 反向代理</p>\n<h1 id=\"群晖中安装-frpc-脚本\"><a href=\"#群晖中安装-frpc-脚本\" class=\"headerlink\" title=\"群晖中安装 frpc 脚本\"></a>群晖中安装 frpc 脚本</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/stilleshan/frpc/master/frpc_synology_install.sh &amp;&amp; chmod +x frpc_synology_install.sh &amp;&amp; ./frpc_synology_install.sh</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">以下为国内镜像</span></span><br><span class=\"line\">wget https://github.ioiox.com/stilleshan/frpc/raw/branch/master/frpc_synology_install.sh &amp;&amp; chmod +x frpc_synology_install.sh &amp;&amp; ./frpc_synology_install.sh</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/08/01/66aa6dd923f04.png\" alt=\"image-20240801010110138\"></p>\n<p>frpc toml stcp 格式: <a href=\"https://github.com/fatedier/frp/blob/dev/conf/frpc_full_example.toml\">https://github.com/fatedier/frp/blob/dev/conf/frpc_full_example.toml</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup /usr/local/frp/frpc -c /usr/local/frp/frpc.ini &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>脚本再群晖中,自动安装 frpc</p>\n<h1 id=\"错误以及排除解决\"><a href=\"#错误以及排除解决\" class=\"headerlink\" title=\"错误以及排除解决\"></a>错误以及排除解决</h1><h2 id=\"custom-listener-for-doesn’t-exist\"><a href=\"#custom-listener-for-doesn’t-exist\" class=\"headerlink\" title=\"custom listener for [] doesn’t exist\"></a>custom listener for [] doesn’t exist</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024/08/18 17:53:42 [W] [visitor.go:149] [fa45c4fd20893d9b] [CTR_hby_k2p_web80] start new visitor connection error: custom listener for [hby_k2p_web80] doesn&#x27;t exist </span><br></pre></td></tr></table></figure>\n\n<p>ping frp.carlzeng.com 服务器的IP是正确的, 由于服务器的IP刚变, 现在不清楚是:</p>\n<ol>\n<li>服务器docker的故障?<ol>\n<li>实时证明, 服务端非常稳定</li>\n</ol>\n</li>\n<li>NAS中运行的frpc的故障?<ol>\n<li>由于没有frpc, 导致无法直接连接到NAS的ssh</li>\n<li>通过开放的debian代理, 直接远程来访问k2p的局域网地址: <a href=\"http://192.168.6.243/Advanced_WOL_Content.asp\">http://192.168.6.243/Advanced_WOL_Content.asp</a></li>\n<li>果然问题出现在这个层面了, 详见下方</li>\n</ol>\n</li>\n<li>本地的frpc故障?<ol>\n<li>重启一下MAC</li>\n</ol>\n</li>\n</ol>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/08/18/66c1efe0a5f34.png\" alt=\"image-20240818205804453\"></p>\n<p>原来在NAS中, ping frp.carlzeng.com 居然还是得到旧的IP地址(错误的), 难怪远程无法正常P2P连接过去.</p>\n<p>优化(20240818):</p>\n<ol>\n<li>把NAS中运行的frpc所连接的服务地址, 修改为局域网中的本地地址(192.168.*.*); 这样的好处就是, 不管外网IP怎么变(域名所解析带来的延迟效果, 错误解析等等) 都不会影响到, 本地局域网的frpc客户端上线.</li>\n<li>检查了NAS的计划任务, 每次开机启动NAS, 会自动运行frpc</li>\n</ol>\n<p>至此, 解决了NAS中的frpc 运行故障(DNS解析得到错误的IP地址)</p>\n<p>进一步优化: </p>\n<p>把这个命令添加到进程守护中去, 这样不管发生什么进程消失&#x2F;退出了; 会自动重启起来.</p>\n<h1 id=\"灵感来源-感谢列表\"><a href=\"#灵感来源-感谢列表\" class=\"headerlink\" title=\"灵感来源&#x2F;感谢列表\"></a>灵感来源&#x2F;感谢列表</h1><p><a href=\"https://iwanlab.com/frp-with-nginx-proxy-manager/\">家里没有公网IP？FRP+NPM+VPS &#x3D; 随时随地用域名访问家里的任何设备！内网穿透，从未如此简单！</a></p>\n<p><a href=\"https://waynegong.cn/posts/8279.html\">Docker 部署 Nginx、frp 实现内网穿透</a></p>\n<p><a href=\"https://meowlight.space/archives/1599398838584\">使用docker-compose来构筑NGINX、frp的HTTP内网穿透</a></p>\n<p><a href=\"https://medium.com/@ken_c/%E7%94%A8fpc%E5%AE%9E%E7%8E%B0https%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F-a8570049b557\">用FPC实现HTTPS内网穿透</a></p>\n<p><a href=\"https://www.isisy.com/647.html\">Frp内网穿透——frpc客户端使用（2）</a></p>","categories":[{"name":"frp","path":"api/categories/frp.json"}],"tags":[{"name":"debian","path":"api/tags/debian.json"},{"name":"docker","path":"api/tags/docker.json"},{"name":"docker-compose","path":"api/tags/docker-compose.json"},{"name":"家宽","path":"api/tags/家宽.json"},{"name":"NPM","path":"api/tags/NPM.json"},{"name":"内网穿透","path":"api/tags/内网穿透.json"},{"name":"FRP","path":"api/tags/FRP.json"},{"name":"frpc","path":"api/tags/frpc.json"},{"name":"frps","path":"api/tags/frps.json"}]}