{"title":"如何让路由器按要求定时发BTC价至手机","slug":"如何让路由器按要求定时发BTC价至手机","date":"2023-12-02T02:28:05.000Z","updated":"2023-12-06T02:13:01.594Z","comments":true,"path":"api/articles/如何让路由器按要求定时发BTC价至手机.json","excerpt":" [Figure] shell实现让路由器按要求定时发BTC价至手机","covers":["https://www.evernote.com/shard/s122/sh/2183c5e6-6ae1-4039-9ec9-b7894da92ebc/S2ODzlF12bRw4LpRYBq-wlwUxDdJAzlOE7L3qvkCHYv1J0dY_blt00atnA/deep/0/image.png","https://www.evernote.com/shard/s122/sh/2183c5e6-6ae1-4039-9ec9-b7894da92ebc/S2ODzlF12bRw4LpRYBq-wlwUxDdJAzlOE7L3qvkCHYv1J0dY_blt00atnA/deep/0/image.png"],"content":"<p><img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/2183c5e6-6ae1-4039-9ec9-b7894da92ebc/S2ODzlF12bRw4LpRYBq-wlwUxDdJAzlOE7L3qvkCHYv1J0dY_blt00atnA/deep/0/image.png\">shell实现让路由器按要求定时发BTC价至手机</p>\n<span id=\"more\"></span>\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>让路由器按要求定时发BTC价至手机</p>\n<h2 id=\"前提条件\"><a href=\"#前提条件\" class=\"headerlink\" title=\"前提条件\"></a>前提条件</h2><p>API需要魔法上网来访问</p>\n<p>Operwrt的软路由，或者自己刷了OP系统的路由器</p>\n<h2 id=\"下一步\"><a href=\"#下一步\" class=\"headerlink\" title=\"下一步\"></a>下一步</h2><p>感受（缺点）：shell真不是人写的，语法太魔性；下一步修改用python实现吧</p>\n<p>优点：由于中间没有经过任何解释器，再直接依托于系统级别的cron定时任务，贼稳定，执行优先级也高</p>\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><h2 id=\"找到两个可用的API\"><a href=\"#找到两个可用的API\" class=\"headerlink\" title=\"找到两个可用的API\"></a>找到两个可用的API</h2><ol>\n<li>curl -x “<a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a>“ -s <a href=\"https://api-pub.bitfinex.com/v2/ticker/tBTCUSD\">https://api-pub.bitfinex.com/v2/ticker/tBTCUSD</a> | awk -F ‘,’ ‘{print $7}’</li>\n<li>curl -x “<a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a>“ -s <a href=\"http://api.coindesk.com/v1/bpi/currentprice.json\">http://api.coindesk.com/v1/bpi/currentprice.json</a> | python -c “import json, sys; print(json.load(sys.stdin)[‘bpi’][‘USD’][‘rate’])”</li>\n</ol>\n<h2 id=\"发送方案一：微信推送\"><a href=\"#发送方案一：微信推送\" class=\"headerlink\" title=\"发送方案一：微信推送\"></a>发送方案一：微信推送</h2><ol>\n<li><p><a href=\"https://github.com/tty228/luci-app-wechatpush/blob/master/root/usr/share/wechatpush/wechatpush\">A plugin for OpenWRT routers to send various information notifications to a mobile phone via WeChat or Telegram.</a></p>\n</li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">priceText=$(curl -x <span class=\"string\">&quot;http://192.168.6.116:7890&quot;</span> -s https://api-pub.bitfinex.com/v2/ticker/tBTCUSD)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#$priceText|awk -F &#x27;,&#x27; &#x27;$7&#x27;</span></span><br><span class=\"line\">price=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$priceText</span>|awk -F <span class=\"string\">&#x27;,&#x27;</span> <span class=\"string\">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">curl -X POST -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;title&quot;: &quot;【BTC】：&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27; &quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;content&quot;: &quot;&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27;\\n----\\n##### 内容1\\n    设备1\\n    设备2\\n----\\n##### 内容2\\n1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;token&quot;: &quot;6275de3c34fd40ce86a3d7dc5d98465b&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;template&quot;: &quot;markdown&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;&#x27;</span> <span class=\"string\">&quot;http://www.pushplus.plus/send&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n</li>\n<li><p>&#x2F;etc&#x2F;init.d&#x2F;cron start</p>\n</li>\n<li><p>定时设置</p>\n</li>\n<li><img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/2183c5e6-6ae1-4039-9ec9-b7894da92ebc/S2ODzlF12bRw4LpRYBq-wlwUxDdJAzlOE7L3qvkCHYv1J0dY_blt00atnA/deep/0/image.png\">\n</li>\n<li><p>添加</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 */3 * * * /usr/share/wechatpush/btc.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>crontab -l &#x2F;&#x2F;显示crontab文件</p>\n<p>service cron status</p>\n<h3 id=\"上传btc-sh\"><a href=\"#上传btc-sh\" class=\"headerlink\" title=\"上传btc.sh\"></a>上传btc.sh</h3><p>打开 <a href=\"http://192.168.6.1:8080/cgi-bin/luci/admin/system/fileassistant\">http://192.168.6.1:8080/cgi-bin/luci/admin/system/fileassistant</a></p>\n<p>测试用的shell命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">priceText=$(curl -x <span class=\"string\">&quot;http://192.168.6.116:7890&quot;</span> -s https://api-pub.bitfinex.com/v2/ticker/tBTCUSD)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#$priceText|awk -F &#x27;,&#x27; &#x27;$7&#x27;</span></span><br><span class=\"line\">price=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$priceText</span>|awk -F <span class=\"string\">&#x27;,&#x27;</span> <span class=\"string\">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;price&#125;</span> -gt <span class=\"string\">&#x27;39000&#x27;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">curl -X POST -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;title&quot;: &quot;【BTC】：&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27; &quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;content&quot;: &quot;&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27;\\n----\\n##### 内容1\\n    设备1\\n    设备2\\n----\\n##### 内容2\\n1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;token&quot;: &quot;6275de3c34fd40ce86a3d7dc5d98465b&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;template&quot;: &quot;markdown&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;&#x27;</span> <span class=\"string\">&quot;http://www.pushplus.plus/send&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>切换到这个目录（举个例子）&#x2F;usr&#x2F;share&#x2F;wechatpush&#x2F;</p>\n<h3 id=\"添加计划任务\"><a href=\"#添加计划任务\" class=\"headerlink\" title=\"添加计划任务\"></a>添加计划任务</h3><p>上传文件后修改计划任务</p>\n<ol>\n<li><p>打开<a href=\"http://192.168.6.1:8080/cgi-bin/luci/admin/system/crontab\">http://192.168.6.1:8080/cgi-bin/luci/admin/system/crontab</a></p>\n</li>\n<li><p>修改内容为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*/45 * * * * /usr/share/wechatpush/btc.sh</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li></li>\n</ol>\n<p>这样每分钟都是会执行，用来测试立即执行的效果；当然也可以直接shell里面敲入.&#x2F;btc.sh执行 </p>\n<div class=\"note warning\"><p>过了2天，发现这个添加到计划任务里面自定义的这行，居然消失了</p>\n<p>原因待查明, to be continued…</p>\n</div>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logread -e cron</span><br></pre></td></tr></table></figure>\n\n<p>读取日志发现：</p>\n<p>最后一次执行记录（昨晚7点）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mon Dec  4 19:00:00 2023 cron.info crond[31979]: USER root pid 6769 cmd /usr/share/wechatpush/btc.sh                          </span><br></pre></td></tr></table></figure>\n\n<p>测试解决方法：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">测试使用 &#x27;定时执行任务/开机启动任务设置&#x27;</span><br><span class=\"line\">https://@@@@@@/cgi-bin/luci/admin/control/autotimeset/base</span><br><span class=\"line\"></span><br><span class=\"line\">这个脚本是会保存的，设置了每小时自动执行</span><br><span class=\"line\"></span><br><span class=\"line\">第二天：</span><br><span class=\"line\">语法纠正 </span><br><span class=\"line\">. /usr/share/wechatpush/btc.sh</span><br><span class=\"line\">设置纠正</span><br><span class=\"line\">*/1 * * * * /usr/bin/timesethandler customscript Scheduled_task</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p>说明文档很清晰：<a href=\"https://openwrt.org/zh/docs/guide-user/base-system/cron\">Cron 和 crontab</a></p>\n<p>现实应用，勉强能用…</p>\n<p>还是期待下一步的python实现</p>\n<p>题外话：这个项目<a href=\"https://github.com/gaocuo/fic\">“假装在中国”</a>是学习shell的好实际应用 <a href=\"https://github.com/gaocuo/fic\">https://github.com/gaocuo/fic</a></p>\n","more":"<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>让路由器按要求定时发BTC价至手机</p>\n<h2 id=\"前提条件\"><a href=\"#前提条件\" class=\"headerlink\" title=\"前提条件\"></a>前提条件</h2><p>API需要魔法上网来访问</p>\n<p>Operwrt的软路由，或者自己刷了OP系统的路由器</p>\n<h2 id=\"下一步\"><a href=\"#下一步\" class=\"headerlink\" title=\"下一步\"></a>下一步</h2><p>感受（缺点）：shell真不是人写的，语法太魔性；下一步修改用python实现吧</p>\n<p>优点：由于中间没有经过任何解释器，再直接依托于系统级别的cron定时任务，贼稳定，执行优先级也高</p>\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><h2 id=\"找到两个可用的API\"><a href=\"#找到两个可用的API\" class=\"headerlink\" title=\"找到两个可用的API\"></a>找到两个可用的API</h2><ol>\n<li>curl -x “<a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a>“ -s <a href=\"https://api-pub.bitfinex.com/v2/ticker/tBTCUSD\">https://api-pub.bitfinex.com/v2/ticker/tBTCUSD</a> | awk -F ‘,’ ‘{print $7}’</li>\n<li>curl -x “<a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a>“ -s <a href=\"http://api.coindesk.com/v1/bpi/currentprice.json\">http://api.coindesk.com/v1/bpi/currentprice.json</a> | python -c “import json, sys; print(json.load(sys.stdin)[‘bpi’][‘USD’][‘rate’])”</li>\n</ol>\n<h2 id=\"发送方案一：微信推送\"><a href=\"#发送方案一：微信推送\" class=\"headerlink\" title=\"发送方案一：微信推送\"></a>发送方案一：微信推送</h2><ol>\n<li><p><a href=\"https://github.com/tty228/luci-app-wechatpush/blob/master/root/usr/share/wechatpush/wechatpush\">A plugin for OpenWRT routers to send various information notifications to a mobile phone via WeChat or Telegram.</a></p>\n</li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">priceText=$(curl -x <span class=\"string\">&quot;http://192.168.6.116:7890&quot;</span> -s https://api-pub.bitfinex.com/v2/ticker/tBTCUSD)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#$priceText|awk -F &#x27;,&#x27; &#x27;$7&#x27;</span></span><br><span class=\"line\">price=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$priceText</span>|awk -F <span class=\"string\">&#x27;,&#x27;</span> <span class=\"string\">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">curl -X POST -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;title&quot;: &quot;【BTC】：&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27; &quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;content&quot;: &quot;&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27;\\n----\\n##### 内容1\\n    设备1\\n    设备2\\n----\\n##### 内容2\\n1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;token&quot;: &quot;6275de3c34fd40ce86a3d7dc5d98465b&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;template&quot;: &quot;markdown&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;&#x27;</span> <span class=\"string\">&quot;http://www.pushplus.plus/send&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n</li>\n<li><p>&#x2F;etc&#x2F;init.d&#x2F;cron start</p>\n</li>\n<li><p>定时设置</p>\n</li>\n<li><img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/2183c5e6-6ae1-4039-9ec9-b7894da92ebc/S2ODzlF12bRw4LpRYBq-wlwUxDdJAzlOE7L3qvkCHYv1J0dY_blt00atnA/deep/0/image.png\">\n</li>\n<li><p>添加</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 */3 * * * /usr/share/wechatpush/btc.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>crontab -l &#x2F;&#x2F;显示crontab文件</p>\n<p>service cron status</p>\n<h3 id=\"上传btc-sh\"><a href=\"#上传btc-sh\" class=\"headerlink\" title=\"上传btc.sh\"></a>上传btc.sh</h3><p>打开 <a href=\"http://192.168.6.1:8080/cgi-bin/luci/admin/system/fileassistant\">http://192.168.6.1:8080/cgi-bin/luci/admin/system/fileassistant</a></p>\n<p>测试用的shell命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">priceText=$(curl -x <span class=\"string\">&quot;http://192.168.6.116:7890&quot;</span> -s https://api-pub.bitfinex.com/v2/ticker/tBTCUSD)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#$priceText|awk -F &#x27;,&#x27; &#x27;$7&#x27;</span></span><br><span class=\"line\">price=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$priceText</span>|awk -F <span class=\"string\">&#x27;,&#x27;</span> <span class=\"string\">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;price&#125;</span> -gt <span class=\"string\">&#x27;39000&#x27;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">curl -X POST -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -d <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;title&quot;: &quot;【BTC】：&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27; &quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;content&quot;: &quot;&#x27;</span><span class=\"variable\">$&#123;price&#125;</span><span class=\"string\">&#x27;\\n----\\n##### 内容1\\n    设备1\\n    设备2\\n----\\n##### 内容2\\n1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;token&quot;: &quot;6275de3c34fd40ce86a3d7dc5d98465b&quot;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;template&quot;: &quot;markdown&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;&#x27;</span> <span class=\"string\">&quot;http://www.pushplus.plus/send&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>切换到这个目录（举个例子）&#x2F;usr&#x2F;share&#x2F;wechatpush&#x2F;</p>\n<h3 id=\"添加计划任务\"><a href=\"#添加计划任务\" class=\"headerlink\" title=\"添加计划任务\"></a>添加计划任务</h3><p>上传文件后修改计划任务</p>\n<ol>\n<li><p>打开<a href=\"http://192.168.6.1:8080/cgi-bin/luci/admin/system/crontab\">http://192.168.6.1:8080/cgi-bin/luci/admin/system/crontab</a></p>\n</li>\n<li><p>修改内容为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*/45 * * * * /usr/share/wechatpush/btc.sh</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li></li>\n</ol>\n<p>这样每分钟都是会执行，用来测试立即执行的效果；当然也可以直接shell里面敲入.&#x2F;btc.sh执行 </p>\n<div class=\"note warning\"><p>过了2天，发现这个添加到计划任务里面自定义的这行，居然消失了</p>\n<p>原因待查明, to be continued…</p>\n</div>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logread -e cron</span><br></pre></td></tr></table></figure>\n\n<p>读取日志发现：</p>\n<p>最后一次执行记录（昨晚7点）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mon Dec  4 19:00:00 2023 cron.info crond[31979]: USER root pid 6769 cmd /usr/share/wechatpush/btc.sh                          </span><br></pre></td></tr></table></figure>\n\n<p>测试解决方法：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">测试使用 &#x27;定时执行任务/开机启动任务设置&#x27;</span><br><span class=\"line\">https://@@@@@@/cgi-bin/luci/admin/control/autotimeset/base</span><br><span class=\"line\"></span><br><span class=\"line\">这个脚本是会保存的，设置了每小时自动执行</span><br><span class=\"line\"></span><br><span class=\"line\">第二天：</span><br><span class=\"line\">语法纠正 </span><br><span class=\"line\">. /usr/share/wechatpush/btc.sh</span><br><span class=\"line\">设置纠正</span><br><span class=\"line\">*/1 * * * * /usr/bin/timesethandler customscript Scheduled_task</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p>说明文档很清晰：<a href=\"https://openwrt.org/zh/docs/guide-user/base-system/cron\">Cron 和 crontab</a></p>\n<p>现实应用，勉强能用…</p>\n<p>还是期待下一步的python实现</p>\n<p>题外话：这个项目<a href=\"https://github.com/gaocuo/fic\">“假装在中国”</a>是学习shell的好实际应用 <a href=\"https://github.com/gaocuo/fic\">https://github.com/gaocuo/fic</a></p>","categories":[{"name":"openwrt","path":"api/categories/openwrt.json"}],"tags":[{"name":"openwrt","path":"api/tags/openwrt.json"},{"name":"OP","path":"api/tags/OP.json"},{"name":"shell","path":"api/tags/shell.json"}]}