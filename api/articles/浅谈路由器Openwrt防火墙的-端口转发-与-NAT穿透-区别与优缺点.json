{"title":"浅谈路由器Openwrt防火墙的 端口转发 与 NAT穿透 区别与优缺点","slug":"浅谈路由器Openwrt防火墙的-端口转发-与-NAT穿透-区别与优缺点","date":"2026-01-15T01:29:16.000Z","updated":"2026-01-15T02:14:58.881Z","comments":true,"path":"api/articles/浅谈路由器Openwrt防火墙的-端口转发-与-NAT穿透-区别与优缺点.json","excerpt":" [Figure] 绝大多数ADSL用户处于大内网中(而99.9%的宽带用户使用这种方式入网, 政策持续收紧IPv4公网IP的发放), 本文进一步探讨如何映射大内网中的服务到互联网. PS5主机, Switch, Steamdeck等主机NAT类型探讨","covers":["https://img.carlzeng.com:3/i/2026/01/15/696848b26bbba.png","https://img.carlzeng.com:3/i/2026/01/15/69684c2f90aa9.png","https://img.carlzeng.com:3/i/2026/01/15/69684ceec826b.png","https://mao.fan/images/nat1.webp","https://img.carlzeng.com:3/i/2026/01/15/69684a46152e4.png"],"content":"<img class=\"lozad\" data-src=\"https://img.carlzeng.com:3/i/2026/01/15/696848b26bbba.png\">\n\n<p>绝大多数ADSL用户处于大内网中(而99.9%的宽带用户使用这种方式入网, 政策持续收紧IPv4公网IP的发放), 本文进一步探讨如何映射大内网中的服务到互联网. PS5主机, Switch, Steamdeck等主机NAT类型探讨</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>路由器Openwrt防火墙的 端口转发 与 NAT穿透 区别与优缺点</p>\n<p>了解原理, 拓展应用</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2026/01/15/69684c2f90aa9.png\" alt=\"image-20260115100846022\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2026/01/15/69684ceec826b.png\" alt=\"image-20260115101156631\"></p>\n<h1 id=\"概念与理论\"><a href=\"#概念与理论\" class=\"headerlink\" title=\"概念与理论\"></a>概念与理论</h1><p>设置路由器安装相应的应用, 配置等. 实现特定功能.  相关视频(介绍的stun打洞穿透nat):</p>\n<iframe width=\"951\" height=\"535\" src=\"https://youtu.be/T5S5O2D1hqg\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\n\n\n<h2 id=\"什么是-NAT？\"><a href=\"#什么是-NAT？\" class=\"headerlink\" title=\"什么是 NAT？\"></a>什么是 NAT？</h2><p><strong>NAT 代表网络地址转换</strong>，允许多个内网设备共享一个公网IP地址，使内网设备能够与外部互联网通信，主要是为了解决IPV4地址不足的问题，NAT通常部署在路由器上。 NAT 在正常的网页浏览、观看视频没太大问题，主要影响在 P2P 连接上，对游戏、下载、视频通话等应用，会受到不同NAT类型的影响。</p>\n<p><img data-src=\"https://mao.fan/images/nat1.webp\" alt=\"什么是NAT\"></p>\n<h4 id=\"NAT-四种类型：\"><a href=\"#NAT-四种类型：\" class=\"headerlink\" title=\"NAT 四种类型：\"></a>NAT 四种类型：</h4><ul>\n<li><ul>\n<li><strong>Full Cone NAT</strong>：全锥形，任何外部主机只要知道这个公网IP和端口，就能向内网主机发送数据。</li>\n<li><strong>Restricted Cone NAT</strong>：受限锥形，内网主机需先向外部主机发送数据，该外部主机才能向内网主机发送数据。</li>\n<li><strong>Port Restricted Cone NAT</strong>：端口受限锥形，内网主机需先向外部主机发送数据，该外部主机的特定端口才能向内网主机发送数据。</li>\n<li><strong>Symmetric NAT</strong>：对称形，内网主机与每个外部主机通信时，会分配不同的公网IP和端口，在安全性上最为严格，但也最容易导致连接问题。</li>\n</ul>\n</li>\n</ul>\n<p><strong>总结</strong>：前面三种NAT类型都是锥形网络，内网主机使用固定的公网IP和端口进行所有的外部通信，区别在于NAT设备防火墙的安全策略不同，对称形限制最严格，场景最复杂。</p>\n<h2 id=\"端口转发和NAT-穿透-区别于优缺点\"><a href=\"#端口转发和NAT-穿透-区别于优缺点\" class=\"headerlink\" title=\"端口转发和NAT 穿透 区别于优缺点\"></a><strong>端口转发</strong>和<strong>NAT 穿透</strong> 区别于优缺点</h2><p>在 OpenWrt 环境中，<strong>端口转发</strong>和<strong>NAT 穿透</strong>是两种解决内网设备对外暴露服务的技术，核心目标一致但实现原理、适用场景完全不同，下面详细拆解它们的区别、优缺点及适用场景。</p>\n<h3 id=\"一、核心概念与原理\"><a href=\"#一、核心概念与原理\" class=\"headerlink\" title=\"一、核心概念与原理\"></a>一、核心概念与原理</h3><h4 id=\"1-端口转发（Port-Forwarding）\"><a href=\"#1-端口转发（Port-Forwarding）\" class=\"headerlink\" title=\"1.  端口转发（Port Forwarding）\"></a>1.  端口转发（Port Forwarding）</h4><ul>\n<li><p><strong>本质</strong>：属于 <strong>静态 NAT 技术</strong>，由 OpenWrt 路由器主动配置规则，将<strong>公网 IP 的特定端口</strong>映射到<strong>内网指定设备的端口</strong>。</p>\n</li>\n<li><p>工作流程</p>\n<ol>\n<li>外网设备向路由器的公网 IP + 映射端口发起请求；</li>\n<li>路由器根据预设规则，将请求转发给内网目标设备；</li>\n<li>内网设备的响应通过路由器原路返回给外网设备。</li>\n</ol>\n</li>\n<li><p><strong>OpenWrt 配置入口</strong>：<code>网络 → 防火墙 → 端口转发</code>，需填写<strong>外部端口、内部 IP、内部端口、协议</strong>等参数。</p>\n</li>\n</ul>\n<h4 id=\"2-NAT-穿透（NAT-Traversal）\"><a href=\"#2-NAT-穿透（NAT-Traversal）\" class=\"headerlink\" title=\"2.  NAT 穿透（NAT Traversal）\"></a>2.  NAT 穿透（NAT Traversal）</h4><ul>\n<li><p><strong>本质</strong>：一种 <strong>动态穿透技术</strong>，用于突破 NAT 网关的隔离限制，让外网设备直接访问内网设备，无需依赖路由器的公网 IP 或手动配置端口规则。</p>\n</li>\n<li><p>常见实现方式</p>\n<ul>\n<li><strong>UPnP&#x2F;NAT-PMP</strong>：内网设备主动向路由器申请端口映射，路由器自动生成临时规则（重启后可能失效）；</li>\n<li><strong>P2P 穿透（如 STUN&#x2F;TURN&#x2F;ICE 协议）</strong>：通过公共服务器获取双方的 NAT 类型和端口信息，建立直接连接；</li>\n<li><strong>反向代理穿透（如 frp、ngrok）</strong>：借助公网服务器作为中转，内网设备主动连接公网服务器，外网设备通过服务器间接访问内网服务。</li>\n</ul>\n</li>\n<li><p><strong>OpenWrt 相关配置</strong>：UPnP 可通过安装 <code>luci-app-upnp</code> 插件启用；第三方穿透工具（如 frp）需手动安装客户端并配置。</p>\n</li>\n</ul>\n<h3 id=\"二、核心区别对比表\"><a href=\"#二、核心区别对比表\" class=\"headerlink\" title=\"二、核心区别对比表\"></a>二、核心区别对比表</h3><table>\n<thead>\n<tr>\n<th align=\"center\">对比维度</th>\n<th align=\"center\">端口转发（静态 NAT）</th>\n<th align=\"center\">NAT 穿透（动态 &#x2F; 中转）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><strong>依赖条件</strong></td>\n<td align=\"center\">路由器必须有<strong>公网 IP</strong>（运营商提供）</td>\n<td align=\"center\">支持多种场景：有 &#x2F; 无公网 IP 均可（中转模式无需公网 IP）</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>配置方式</strong></td>\n<td align=\"center\">手动在路由器配置固定规则，静态不变</td>\n<td align=\"center\">自动（UPnP）或客户端配置，动态灵活</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>端口控制权</strong></td>\n<td align=\"center\">端口由路由器分配，固定不变</td>\n<td align=\"center\">端口可由内网设备申请（UPnP）或随机分配</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>适用网络环境</strong></td>\n<td align=\"center\">仅适用于<strong>有公网 IP</strong>的宽带（如家庭光纤）</td>\n<td align=\"center\">适用于<strong>无公网 IP</strong>的环境（如内网多层 NAT、校园网）</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>安全性</strong></td>\n<td align=\"center\">规则固定，暴露端口少，风险可控</td>\n<td align=\"center\">UPnP 自动开放端口，存在安全隐患；中转模式依赖第三方服务器</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>稳定性</strong></td>\n<td align=\"center\">规则固定，稳定性高</td>\n<td align=\"center\">UPnP 可能因路由器重启失效；P2P 穿透受 NAT 类型影响，稳定性一般</td>\n</tr>\n</tbody></table>\n<h3 id=\"三、优缺点分析\"><a href=\"#三、优缺点分析\" class=\"headerlink\" title=\"三、优缺点分析\"></a>三、优缺点分析</h3><h4 id=\"1-端口转发（Port-Forwarding）-1\"><a href=\"#1-端口转发（Port-Forwarding）-1\" class=\"headerlink\" title=\"1.  端口转发（Port Forwarding）\"></a>1.  端口转发（Port Forwarding）</h4><h5 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h5><ul>\n<li><strong>稳定性强</strong>：规则是静态配置的，只要公网 IP 不变，服务就能稳定对外提供；</li>\n<li><strong>安全性高</strong>：仅开放需要的端口，且可配合防火墙规则（如限制访问源 IP）进一步降低风险；</li>\n<li><strong>无额外开销</strong>：无需依赖第三方服务器，数据直接传输，延迟低。</li>\n</ul>\n<h5 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h5><ul>\n<li><strong>依赖公网 IP</strong>：如果运营商不给公网 IP（如内网 IP、CGNAT 网络），则完全无法使用；</li>\n<li><strong>配置繁琐</strong>：每新增一个内网服务，都需要手动在路由器添加一条转发规则；</li>\n<li><strong>公网 IP 变化影响服务</strong>：家庭宽带的公网 IP 多为动态，IP 变化后外网设备需重新更新地址。</li>\n</ul>\n<h4 id=\"2-NAT-穿透\"><a href=\"#2-NAT-穿透\" class=\"headerlink\" title=\"2.  NAT 穿透\"></a>2.  NAT 穿透</h4><h5 id=\"优点-1\"><a href=\"#优点-1\" class=\"headerlink\" title=\"优点\"></a>优点</h5><ul>\n<li><strong>无需公网 IP</strong>：中转模式（如 frp）即使路由器是内网 IP，也能实现外网访问；</li>\n<li><strong>配置灵活</strong>：UPnP 可自动映射端口，无需手动配置；第三方穿透工具支持多设备、多服务同时穿透；</li>\n<li><strong>适配复杂网络</strong>：适合校园网、企业内网等多层 NAT 环境。</li>\n</ul>\n<h5 id=\"缺点-1\"><a href=\"#缺点-1\" class=\"headerlink\" title=\"缺点\"></a>缺点</h5><ul>\n<li><p>稳定性参差不齐：</p>\n<ul>\n<li>UPnP 依赖路由器支持，部分路由器兼容性差，重启后规则丢失；</li>\n<li>P2P 穿透受 NAT 类型限制（如对称型 NAT 难以穿透），可能需要中转服务器；</li>\n</ul>\n</li>\n<li><p><strong>安全风险</strong>：UPnP 会自动开放内网端口，若设备存在漏洞，容易被外网攻击；</p>\n</li>\n<li><p><strong>中转模式有额外延迟</strong>：数据需经过第三方公网服务器转发，延迟比端口转发高，且可能受服务器带宽限制。</p>\n</li>\n</ul>\n<h3 id=\"四、适用场景推荐\"><a href=\"#四、适用场景推荐\" class=\"headerlink\" title=\"四、适用场景推荐\"></a>四、适用场景推荐</h3><table>\n<thead>\n<tr>\n<th align=\"center\">场景</th>\n<th align=\"center\">推荐技术</th>\n<th align=\"center\">原因</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">家庭宽带（有公网 IP），搭建内网服务（如 NAS、监控）</td>\n<td align=\"center\">端口转发</td>\n<td align=\"center\">稳定、低延迟、安全可控</td>\n</tr>\n<tr>\n<td align=\"center\">家庭宽带（无公网 IP&#x2F;CGNAT），临时访问内网设备</td>\n<td align=\"center\">NAT 穿透（frp&#x2F;ngrok 中转）</td>\n<td align=\"center\">突破无公网 IP 限制</td>\n</tr>\n<tr>\n<td align=\"center\">内网设备频繁新增服务，不想手动配置</td>\n<td align=\"center\">NAT 穿透（UPnP）</td>\n<td align=\"center\">自动映射端口，简化操作</td>\n</tr>\n<tr>\n<td align=\"center\">企业 &#x2F; 校园网（多层 NAT），远程访问内网办公设备</td>\n<td align=\"center\">NAT 穿透（frp 内网穿透）</td>\n<td align=\"center\">适配复杂网络环境</td>\n</tr>\n</tbody></table>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ol>\n<li><strong>有公网 IP 优先选端口转发</strong>：稳定、安全、无额外开销，是家庭场景的最优解；</li>\n<li><strong>无公网 IP 选 NAT 穿透</strong>：通过中转工具（如 frp）实现外网访问，牺牲一点延迟换可用性；</li>\n<li><strong>临时轻量需求用 UPnP</strong>：适合游戏、投屏等临时端口映射需求，长期服务不建议依赖。</li>\n</ol>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=openwrt\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"NAT及应用-stun打洞穿透nat\"><a href=\"#NAT及应用-stun打洞穿透nat\" class=\"headerlink\" title=\"NAT及应用(stun打洞穿透nat)\"></a>NAT及应用(stun打洞穿透nat)</h1><p>在线检测NAT类型: <a href=\"https://mao.fan/mynat\">https://mao.fan/mynat</a></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2026/01/15/69684a46152e4.png\" alt=\"image-20260115100036449\"></p>\n<h2 id=\"NAT-类型对比\"><a href=\"#NAT-类型对比\" class=\"headerlink\" title=\"NAT 类型对比\"></a>NAT 类型对比</h2><table>\n<thead>\n<tr>\n<th align=\"left\">NAT 类型</th>\n<th align=\"center\">游戏</th>\n<th align=\"center\">语音</th>\n<th align=\"center\">P2P</th>\n<th align=\"center\">PS5</th>\n<th align=\"center\">Xbox</th>\n<th align=\"center\">Switch</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">开放网络</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">Type 1</td>\n<td align=\"center\">Open</td>\n<td align=\"center\">Type A</td>\n</tr>\n<tr>\n<td align=\"left\">全锥形 NAT</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">Type 1</td>\n<td align=\"center\">Open</td>\n<td align=\"center\">Type A</td>\n</tr>\n<tr>\n<td align=\"left\">受限 NAT</td>\n<td align=\"center\">良好</td>\n<td align=\"center\">良好</td>\n<td align=\"center\">中等</td>\n<td align=\"center\">Type 2</td>\n<td align=\"center\">Moderate</td>\n<td align=\"center\">Type B</td>\n</tr>\n<tr>\n<td align=\"left\">端口受限 NAT</td>\n<td align=\"center\">中等</td>\n<td align=\"center\">中等</td>\n<td align=\"center\">较差</td>\n<td align=\"center\">Type 2</td>\n<td align=\"center\">Moderate</td>\n<td align=\"center\">Type C</td>\n</tr>\n<tr>\n<td align=\"left\">对称 NAT</td>\n<td align=\"center\">较差</td>\n<td align=\"center\">较差</td>\n<td align=\"center\">阻止</td>\n<td align=\"center\">Type 3</td>\n<td align=\"center\">Strict</td>\n<td align=\"center\">Type D</td>\n</tr>\n</tbody></table>\n<p>路由器拨号获取IP地址 100.64.<em>.</em> 这个网段是cgnat专用网段</p>\n<p>用到的工具是natmap: <a href=\"https://github.com/heiher/natmap\">https://github.com/heiher/natmap</a></p>\n<h1 id=\"未完待续…\"><a href=\"#未完待续…\" class=\"headerlink\" title=\"未完待续…\"></a>未完待续…</h1><h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://bulianglin.com/archives/stun.html\">【全网最细】无公网IP实现异地远程访问家里内网设备，通过stun打洞穿透运营商NAT，实现P2P直连满速下载，无需花钱搭建内网穿透服务，打洞通信流程分析，stun、fullcone、nat1、CGNAT、完全锥形</a></p>\n<p><a href=\"https://github.com/bannedbook/fanqiang/blob/master/game/PS4-PS5%E6%B8%B8%E6%88%8F%E6%9C%BA%E9%80%9A%E8%BF%87%E5%B1%80%E5%9F%9F%E7%BD%91%E7%BF%BB%E5%A2%99%E6%95%99%E7%A8%8B.md\">PS4-PS5游戏机通过局域网翻墙，加速游戏，以及下载游戏教程</a></p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>路由器Openwrt防火墙的 端口转发 与 NAT穿透 区别与优缺点</p>\n<p>了解原理, 拓展应用</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2026/01/15/69684c2f90aa9.png\" alt=\"image-20260115100846022\"></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2026/01/15/69684ceec826b.png\" alt=\"image-20260115101156631\"></p>\n<h1 id=\"概念与理论\"><a href=\"#概念与理论\" class=\"headerlink\" title=\"概念与理论\"></a>概念与理论</h1><p>设置路由器安装相应的应用, 配置等. 实现特定功能.  相关视频(介绍的stun打洞穿透nat):</p>\n<iframe width=\"951\" height=\"535\" src=\"https://youtu.be/T5S5O2D1hqg\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\n\n\n<h2 id=\"什么是-NAT？\"><a href=\"#什么是-NAT？\" class=\"headerlink\" title=\"什么是 NAT？\"></a>什么是 NAT？</h2><p><strong>NAT 代表网络地址转换</strong>，允许多个内网设备共享一个公网IP地址，使内网设备能够与外部互联网通信，主要是为了解决IPV4地址不足的问题，NAT通常部署在路由器上。 NAT 在正常的网页浏览、观看视频没太大问题，主要影响在 P2P 连接上，对游戏、下载、视频通话等应用，会受到不同NAT类型的影响。</p>\n<p><img data-src=\"https://mao.fan/images/nat1.webp\" alt=\"什么是NAT\"></p>\n<h4 id=\"NAT-四种类型：\"><a href=\"#NAT-四种类型：\" class=\"headerlink\" title=\"NAT 四种类型：\"></a>NAT 四种类型：</h4><ul>\n<li><ul>\n<li><strong>Full Cone NAT</strong>：全锥形，任何外部主机只要知道这个公网IP和端口，就能向内网主机发送数据。</li>\n<li><strong>Restricted Cone NAT</strong>：受限锥形，内网主机需先向外部主机发送数据，该外部主机才能向内网主机发送数据。</li>\n<li><strong>Port Restricted Cone NAT</strong>：端口受限锥形，内网主机需先向外部主机发送数据，该外部主机的特定端口才能向内网主机发送数据。</li>\n<li><strong>Symmetric NAT</strong>：对称形，内网主机与每个外部主机通信时，会分配不同的公网IP和端口，在安全性上最为严格，但也最容易导致连接问题。</li>\n</ul>\n</li>\n</ul>\n<p><strong>总结</strong>：前面三种NAT类型都是锥形网络，内网主机使用固定的公网IP和端口进行所有的外部通信，区别在于NAT设备防火墙的安全策略不同，对称形限制最严格，场景最复杂。</p>\n<h2 id=\"端口转发和NAT-穿透-区别于优缺点\"><a href=\"#端口转发和NAT-穿透-区别于优缺点\" class=\"headerlink\" title=\"端口转发和NAT 穿透 区别于优缺点\"></a><strong>端口转发</strong>和<strong>NAT 穿透</strong> 区别于优缺点</h2><p>在 OpenWrt 环境中，<strong>端口转发</strong>和<strong>NAT 穿透</strong>是两种解决内网设备对外暴露服务的技术，核心目标一致但实现原理、适用场景完全不同，下面详细拆解它们的区别、优缺点及适用场景。</p>\n<h3 id=\"一、核心概念与原理\"><a href=\"#一、核心概念与原理\" class=\"headerlink\" title=\"一、核心概念与原理\"></a>一、核心概念与原理</h3><h4 id=\"1-端口转发（Port-Forwarding）\"><a href=\"#1-端口转发（Port-Forwarding）\" class=\"headerlink\" title=\"1.  端口转发（Port Forwarding）\"></a>1.  端口转发（Port Forwarding）</h4><ul>\n<li><p><strong>本质</strong>：属于 <strong>静态 NAT 技术</strong>，由 OpenWrt 路由器主动配置规则，将<strong>公网 IP 的特定端口</strong>映射到<strong>内网指定设备的端口</strong>。</p>\n</li>\n<li><p>工作流程</p>\n<ol>\n<li>外网设备向路由器的公网 IP + 映射端口发起请求；</li>\n<li>路由器根据预设规则，将请求转发给内网目标设备；</li>\n<li>内网设备的响应通过路由器原路返回给外网设备。</li>\n</ol>\n</li>\n<li><p><strong>OpenWrt 配置入口</strong>：<code>网络 → 防火墙 → 端口转发</code>，需填写<strong>外部端口、内部 IP、内部端口、协议</strong>等参数。</p>\n</li>\n</ul>\n<h4 id=\"2-NAT-穿透（NAT-Traversal）\"><a href=\"#2-NAT-穿透（NAT-Traversal）\" class=\"headerlink\" title=\"2.  NAT 穿透（NAT Traversal）\"></a>2.  NAT 穿透（NAT Traversal）</h4><ul>\n<li><p><strong>本质</strong>：一种 <strong>动态穿透技术</strong>，用于突破 NAT 网关的隔离限制，让外网设备直接访问内网设备，无需依赖路由器的公网 IP 或手动配置端口规则。</p>\n</li>\n<li><p>常见实现方式</p>\n<ul>\n<li><strong>UPnP&#x2F;NAT-PMP</strong>：内网设备主动向路由器申请端口映射，路由器自动生成临时规则（重启后可能失效）；</li>\n<li><strong>P2P 穿透（如 STUN&#x2F;TURN&#x2F;ICE 协议）</strong>：通过公共服务器获取双方的 NAT 类型和端口信息，建立直接连接；</li>\n<li><strong>反向代理穿透（如 frp、ngrok）</strong>：借助公网服务器作为中转，内网设备主动连接公网服务器，外网设备通过服务器间接访问内网服务。</li>\n</ul>\n</li>\n<li><p><strong>OpenWrt 相关配置</strong>：UPnP 可通过安装 <code>luci-app-upnp</code> 插件启用；第三方穿透工具（如 frp）需手动安装客户端并配置。</p>\n</li>\n</ul>\n<h3 id=\"二、核心区别对比表\"><a href=\"#二、核心区别对比表\" class=\"headerlink\" title=\"二、核心区别对比表\"></a>二、核心区别对比表</h3><table>\n<thead>\n<tr>\n<th align=\"center\">对比维度</th>\n<th align=\"center\">端口转发（静态 NAT）</th>\n<th align=\"center\">NAT 穿透（动态 &#x2F; 中转）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><strong>依赖条件</strong></td>\n<td align=\"center\">路由器必须有<strong>公网 IP</strong>（运营商提供）</td>\n<td align=\"center\">支持多种场景：有 &#x2F; 无公网 IP 均可（中转模式无需公网 IP）</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>配置方式</strong></td>\n<td align=\"center\">手动在路由器配置固定规则，静态不变</td>\n<td align=\"center\">自动（UPnP）或客户端配置，动态灵活</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>端口控制权</strong></td>\n<td align=\"center\">端口由路由器分配，固定不变</td>\n<td align=\"center\">端口可由内网设备申请（UPnP）或随机分配</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>适用网络环境</strong></td>\n<td align=\"center\">仅适用于<strong>有公网 IP</strong>的宽带（如家庭光纤）</td>\n<td align=\"center\">适用于<strong>无公网 IP</strong>的环境（如内网多层 NAT、校园网）</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>安全性</strong></td>\n<td align=\"center\">规则固定，暴露端口少，风险可控</td>\n<td align=\"center\">UPnP 自动开放端口，存在安全隐患；中转模式依赖第三方服务器</td>\n</tr>\n<tr>\n<td align=\"center\"><strong>稳定性</strong></td>\n<td align=\"center\">规则固定，稳定性高</td>\n<td align=\"center\">UPnP 可能因路由器重启失效；P2P 穿透受 NAT 类型影响，稳定性一般</td>\n</tr>\n</tbody></table>\n<h3 id=\"三、优缺点分析\"><a href=\"#三、优缺点分析\" class=\"headerlink\" title=\"三、优缺点分析\"></a>三、优缺点分析</h3><h4 id=\"1-端口转发（Port-Forwarding）-1\"><a href=\"#1-端口转发（Port-Forwarding）-1\" class=\"headerlink\" title=\"1.  端口转发（Port Forwarding）\"></a>1.  端口转发（Port Forwarding）</h4><h5 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h5><ul>\n<li><strong>稳定性强</strong>：规则是静态配置的，只要公网 IP 不变，服务就能稳定对外提供；</li>\n<li><strong>安全性高</strong>：仅开放需要的端口，且可配合防火墙规则（如限制访问源 IP）进一步降低风险；</li>\n<li><strong>无额外开销</strong>：无需依赖第三方服务器，数据直接传输，延迟低。</li>\n</ul>\n<h5 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h5><ul>\n<li><strong>依赖公网 IP</strong>：如果运营商不给公网 IP（如内网 IP、CGNAT 网络），则完全无法使用；</li>\n<li><strong>配置繁琐</strong>：每新增一个内网服务，都需要手动在路由器添加一条转发规则；</li>\n<li><strong>公网 IP 变化影响服务</strong>：家庭宽带的公网 IP 多为动态，IP 变化后外网设备需重新更新地址。</li>\n</ul>\n<h4 id=\"2-NAT-穿透\"><a href=\"#2-NAT-穿透\" class=\"headerlink\" title=\"2.  NAT 穿透\"></a>2.  NAT 穿透</h4><h5 id=\"优点-1\"><a href=\"#优点-1\" class=\"headerlink\" title=\"优点\"></a>优点</h5><ul>\n<li><strong>无需公网 IP</strong>：中转模式（如 frp）即使路由器是内网 IP，也能实现外网访问；</li>\n<li><strong>配置灵活</strong>：UPnP 可自动映射端口，无需手动配置；第三方穿透工具支持多设备、多服务同时穿透；</li>\n<li><strong>适配复杂网络</strong>：适合校园网、企业内网等多层 NAT 环境。</li>\n</ul>\n<h5 id=\"缺点-1\"><a href=\"#缺点-1\" class=\"headerlink\" title=\"缺点\"></a>缺点</h5><ul>\n<li><p>稳定性参差不齐：</p>\n<ul>\n<li>UPnP 依赖路由器支持，部分路由器兼容性差，重启后规则丢失；</li>\n<li>P2P 穿透受 NAT 类型限制（如对称型 NAT 难以穿透），可能需要中转服务器；</li>\n</ul>\n</li>\n<li><p><strong>安全风险</strong>：UPnP 会自动开放内网端口，若设备存在漏洞，容易被外网攻击；</p>\n</li>\n<li><p><strong>中转模式有额外延迟</strong>：数据需经过第三方公网服务器转发，延迟比端口转发高，且可能受服务器带宽限制。</p>\n</li>\n</ul>\n<h3 id=\"四、适用场景推荐\"><a href=\"#四、适用场景推荐\" class=\"headerlink\" title=\"四、适用场景推荐\"></a>四、适用场景推荐</h3><table>\n<thead>\n<tr>\n<th align=\"center\">场景</th>\n<th align=\"center\">推荐技术</th>\n<th align=\"center\">原因</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">家庭宽带（有公网 IP），搭建内网服务（如 NAS、监控）</td>\n<td align=\"center\">端口转发</td>\n<td align=\"center\">稳定、低延迟、安全可控</td>\n</tr>\n<tr>\n<td align=\"center\">家庭宽带（无公网 IP&#x2F;CGNAT），临时访问内网设备</td>\n<td align=\"center\">NAT 穿透（frp&#x2F;ngrok 中转）</td>\n<td align=\"center\">突破无公网 IP 限制</td>\n</tr>\n<tr>\n<td align=\"center\">内网设备频繁新增服务，不想手动配置</td>\n<td align=\"center\">NAT 穿透（UPnP）</td>\n<td align=\"center\">自动映射端口，简化操作</td>\n</tr>\n<tr>\n<td align=\"center\">企业 &#x2F; 校园网（多层 NAT），远程访问内网办公设备</td>\n<td align=\"center\">NAT 穿透（frp 内网穿透）</td>\n<td align=\"center\">适配复杂网络环境</td>\n</tr>\n</tbody></table>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ol>\n<li><strong>有公网 IP 优先选端口转发</strong>：稳定、安全、无额外开销，是家庭场景的最优解；</li>\n<li><strong>无公网 IP 选 NAT 穿透</strong>：通过中转工具（如 frp）实现外网访问，牺牲一点延迟换可用性；</li>\n<li><strong>临时轻量需求用 UPnP</strong>：适合游戏、投屏等临时端口映射需求，长期服务不建议依赖。</li>\n</ol>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=openwrt\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"NAT及应用-stun打洞穿透nat\"><a href=\"#NAT及应用-stun打洞穿透nat\" class=\"headerlink\" title=\"NAT及应用(stun打洞穿透nat)\"></a>NAT及应用(stun打洞穿透nat)</h1><p>在线检测NAT类型: <a href=\"https://mao.fan/mynat\">https://mao.fan/mynat</a></p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2026/01/15/69684a46152e4.png\" alt=\"image-20260115100036449\"></p>\n<h2 id=\"NAT-类型对比\"><a href=\"#NAT-类型对比\" class=\"headerlink\" title=\"NAT 类型对比\"></a>NAT 类型对比</h2><table>\n<thead>\n<tr>\n<th align=\"left\">NAT 类型</th>\n<th align=\"center\">游戏</th>\n<th align=\"center\">语音</th>\n<th align=\"center\">P2P</th>\n<th align=\"center\">PS5</th>\n<th align=\"center\">Xbox</th>\n<th align=\"center\">Switch</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">开放网络</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">Type 1</td>\n<td align=\"center\">Open</td>\n<td align=\"center\">Type A</td>\n</tr>\n<tr>\n<td align=\"left\">全锥形 NAT</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">优秀</td>\n<td align=\"center\">Type 1</td>\n<td align=\"center\">Open</td>\n<td align=\"center\">Type A</td>\n</tr>\n<tr>\n<td align=\"left\">受限 NAT</td>\n<td align=\"center\">良好</td>\n<td align=\"center\">良好</td>\n<td align=\"center\">中等</td>\n<td align=\"center\">Type 2</td>\n<td align=\"center\">Moderate</td>\n<td align=\"center\">Type B</td>\n</tr>\n<tr>\n<td align=\"left\">端口受限 NAT</td>\n<td align=\"center\">中等</td>\n<td align=\"center\">中等</td>\n<td align=\"center\">较差</td>\n<td align=\"center\">Type 2</td>\n<td align=\"center\">Moderate</td>\n<td align=\"center\">Type C</td>\n</tr>\n<tr>\n<td align=\"left\">对称 NAT</td>\n<td align=\"center\">较差</td>\n<td align=\"center\">较差</td>\n<td align=\"center\">阻止</td>\n<td align=\"center\">Type 3</td>\n<td align=\"center\">Strict</td>\n<td align=\"center\">Type D</td>\n</tr>\n</tbody></table>\n<p>路由器拨号获取IP地址 100.64.<em>.</em> 这个网段是cgnat专用网段</p>\n<p>用到的工具是natmap: <a href=\"https://github.com/heiher/natmap\">https://github.com/heiher/natmap</a></p>\n<h1 id=\"未完待续…\"><a href=\"#未完待续…\" class=\"headerlink\" title=\"未完待续…\"></a>未完待续…</h1><h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://bulianglin.com/archives/stun.html\">【全网最细】无公网IP实现异地远程访问家里内网设备，通过stun打洞穿透运营商NAT，实现P2P直连满速下载，无需花钱搭建内网穿透服务，打洞通信流程分析，stun、fullcone、nat1、CGNAT、完全锥形</a></p>\n<p><a href=\"https://github.com/bannedbook/fanqiang/blob/master/game/PS4-PS5%E6%B8%B8%E6%88%8F%E6%9C%BA%E9%80%9A%E8%BF%87%E5%B1%80%E5%9F%9F%E7%BD%91%E7%BF%BB%E5%A2%99%E6%95%99%E7%A8%8B.md\">PS4-PS5游戏机通过局域网翻墙，加速游戏，以及下载游戏教程</a></p>","categories":[{"name":"openwrt","path":"api/categories/openwrt.json"}],"tags":[{"name":"openwrt","path":"api/tags/openwrt.json"},{"name":"NAT","path":"api/tags/NAT.json"}]}