{"title":"如何不拔卡调取摄像头监控-回放取流","slug":"不拔卡调取摄像头监控-回放取流","date":"2024-12-16T14:37:09.000Z","updated":"2024-12-19T05:36:18.250Z","comments":true,"path":"api/articles/不拔卡调取摄像头监控-回放取流.json","excerpt":" [Figure] 如何不拔卡调取摄像头监控(TP1Z为例子)","covers":["https://img.carlzeng.com:3/i/2024/12/17/6760f5ac6ffdf.png","https://img.carlzeng.com:3/i/2024/12/17/67617820c79bb.png","https://img.carlzeng.com:3/i/2024/12/17/67618c5abae49.png"],"content":"<img class=\"lozad\" data-src=\"https://img.carlzeng.com:3/i/2024/12/17/6760f5ac6ffdf.png\">\n\n<p>如何不拔卡调取摄像头监控(TP1Z为例子)</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用-怎么用\"><a href=\"#有什么用-怎么用\" class=\"headerlink\" title=\"有什么用&amp;怎么用\"></a>有什么用&amp;怎么用</h1><p>如何不拔卡调取摄像头监控-回放取流</p>\n<p>通过获取摄像头的回放取流地址, 来读取摄像头中的回放数据</p>\n<p>背景: 某位调皮的顾客, 非要上来就诬陷我更换了他的Switch电池. 百口莫辩, 实属无奈还得去调阅监控. 上次的方法是直接把卡, 然后找到监控的目录文件(按日期时间命名的), 最后拷贝出多个大的文件, 然后在组合多个此类MP4文件成为完整的全过程监控.</p>\n<p>这样做太累人了, 而且导致了监控的中断. </p>\n<p>今天尝试使用取流回放流的方式, 成功取到了回放的流; 但是要录制成完整的mp4,需要等量的时间(1.5小时多); 这可真累人啊, 一个命令要执行1.75个小时, 我哪有那个耐心和时间? </p>\n<p>于是乎, 想各种其他的方法, 推流到SRS, 让他自己去看SRS上回放的流(网页播发失败). </p>\n<p>最后还是使用抽帧最快, 每5秒抽一张照片, 抽出来一共将近1千张截图, 基本可以完全涵盖了整个修复过程(也证明了我没有去动电池)</p>\n<p>某某同学: 请移步去网盘看看您设备的修复全过程吧, <a href=\"https://file.carlzeng.com:3/d/Aria2%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%A4%B9/switchSDadapter20241213.mp4\">switchSDadapter20241213.mp4</a></p>\n<p>(因为他已自行觉悟并确认收货, 我不会在发他视频去所谓的自证清白; 终于明白为啥需要法院这样的第三方来沟通矛盾, 有时2个方面直接联系, 根本无效, 累死宝宝)</p>\n<p>后话: 这种方式还不完美(目前已经够用, 足以当证据来提交第三方), 不够高效; 后期还需努力把回放的流推流到SRS更高效, 根本只需要参数就OK(限时特定时间段可查阅, 不长期保存)</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=摄像头\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"获取摄像头的回放取流URL地址\"><a href=\"#获取摄像头的回放取流URL地址\" class=\"headerlink\" title=\"获取摄像头的回放取流URL地址\"></a>获取摄像头的回放取流URL地址</h1><p>比如这是我的实例</p>\n<h2 id=\"1-回放取流url\"><a href=\"#1-回放取流url\" class=\"headerlink\" title=\"1. 回放取流url\"></a>1. 回放取流url</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://admin:d@172.22.0.26:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_11_19_00&amp;endtime=2024_12_13_12_51_48</span><br></pre></td></tr></table></figure>\n\n<p>说明：</p>\n<ul>\n<li>playback表示回放</li>\n<li>channel&#x3D;number表示通道号</li>\n<li>subtype&#x3D;0表示主码流</li>\n<li>starttime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放开始时间</li>\n<li>endtime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放结束时间</li>\n</ul>\n<blockquote>\n<p>20240705 实测有效，vlc播放成功。这是一个实用的功能</p>\n<p>可随时查看回放</p>\n</blockquote>\n<h2 id=\"2-录制取流地址内视频\"><a href=\"#2-录制取流地址内视频\" class=\"headerlink\" title=\"2. 录制取流地址内视频\"></a>2. 录制取流地址内视频</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i &quot;rtsp://地址&quot; -t 录制秒数 文件名.mp4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"录制MP4\"><a href=\"#录制MP4\" class=\"headerlink\" title=\"录制MP4\"></a>录制MP4</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&quot; -t 5568 Switch的SD卡底座修复.mp4</span><br><span class=\"line\"></span><br><span class=\"line\"># 关键帧录制</span><br><span class=\"line\">ffmpeg -i  &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -vf &quot;select=&#x27;eq(pict_type,PICT_TYPE_I)&#x27;&quot; -t 1:32:48 -vcodec copy -acodec copy </span><br><span class=\"line\">  -f mp4  Switch的SD卡底座修复.mp4</span><br></pre></td></tr></table></figure>\n\n\n\n<p>ffmpeg+加速录制+rtsp流</p>\n<h3 id=\"FLV录制FLV\"><a href=\"#FLV录制FLV\" class=\"headerlink\" title=\"FLV录制FLV\"></a>FLV录制FLV</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i  &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&quot; -t 1:32:48 -vcodec copy -acodec copy -f flv  Switch的SD卡底座修复.flv</span><br><span class=\"line\">#也是太慢了,要一秒一秒录制, 真的要等待1个半小时</span><br><span class=\"line\"></span><br><span class=\"line\">#关键帧录制</span><br><span class=\"line\">ffmpeg -i  &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&quot; -vf &quot;select=&#x27;eq(pict_type,PICT_TYPE_I)&#x27;&quot; -t 1:32:48 -vcodec copy -acodec copy </span><br><span class=\"line\">  -f flv Switch的SD卡底座修复2.flv</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>ffmpeg+加速录制+rtsp流</p>\n<p>推流这段回放到SRS服务器上, 让服务器不停循环播放即可</p>\n<p>可否把思路转变为: 推流这段回放到SRS服务器上, 让服务器不停循环播放即可</p>\n<p>rtsp:&#x2F;&#x2F;*:<a href=\"mailto:&#100;&#x40;&#x31;&#55;&#50;&#46;&#x32;&#50;&#46;&#48;&#x2e;&#x32;&#x36;\">&#100;&#x40;&#x31;&#55;&#50;&#46;&#x32;&#50;&#46;&#48;&#x2e;&#x32;&#x36;</a>:554&#x2F;cam&#x2F;playback?channel&#x3D;1&amp;subtype&#x3D;1&amp;starttime&#x3D;2024_12_13_11_19_00&amp;endtime&#x3D;2024_12_13_12_51_48</p>\n<h2 id=\"3-推流回放流到SRS\"><a href=\"#3-推流回放流到SRS\" class=\"headerlink\" title=\"3. 推流回放流到SRS\"></a>3. 推流回放流到SRS</h2><p>ffmpeg -re -i “rtsp:&#x2F;&#x2F;*:<a href=\"mailto:&#100;&#x40;&#x31;&#55;&#50;&#x2e;&#50;&#50;&#x2e;&#48;&#46;&#x32;&#54;\">&#100;&#x40;&#x31;&#55;&#50;&#x2e;&#50;&#50;&#x2e;&#48;&#46;&#x32;&#54;</a>:554&#x2F;cam&#x2F;playback?channel&#x3D;1&amp;subtype&#x3D;1&amp;starttime&#x3D;2024_12_13_11_19_00&amp;endtime&#x3D;2024_12_13_12_51_48” -c copy -f flv -y rtmp:&#x2F;&#x2F;192.168.6.221:1935&#x2F;live&#x2F;switchSDadapter</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/switchSDadapter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    title           : Media Server</span><br><span class=\"line\">  Duration: 02:30:30.00, start: 0.000000, bitrate: N/A</span><br><span class=\"line\">  Stream #0:0: Video: hevc (Main), yuvj420p(pc, bt709), 1920x1080 [SAR 1:1 DAR 16:9], 10 fps, 100 tbr, 90k tbn</span><br><span class=\"line\">  Stream #0:1: Audio: aac (LC), 16000 Hz, mono, fltp</span><br><span class=\"line\">[flv @ 0x563db2eb0400] Video codec hevc not compatible with flv</span><br><span class=\"line\"><span class=\"meta prompt_\">  [out#</span><span class=\"language-bash\">0/flv @ 0x563db2e9f000] Could not write header (incorrect codec parameters ?): Function not implemented</span></span><br><span class=\"line\"><span class=\"meta prompt_\">[aost#</span><span class=\"language-bash\">0:1/copy @ 0x563db2e9bac0] Error initializing output stream:</span> </span><br><span class=\"line\">Stream mapping:</span><br><span class=\"line\">  Stream #0:0 -&gt; #0:0 (copy)</span><br><span class=\"line\">  Stream #0:1 -&gt; #0:1 (copy)</span><br><span class=\"line\">    Last message repeated 1 times</span><br><span class=\"line\">    </span><br><span class=\"line\">   </span><br></pre></td></tr></table></figure>\n\n<p>可以推流成功, 但是无法获取图像, 如何修复?</p>\n<p>原来是我的SRS目前版本(5.0)不支持H.265, 导致上面的错误, 临时的解决方案是使用H.264</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -c copy -vcodec libx264 -f flv -y rtmp://192.168.6.116:1935/live/switchsdcar</span><br></pre></td></tr></table></figure>\n\n<p>这样就是H.264了可是画面经常花屏, 画面有故障.</p>\n<p>还是去升级SRS更靠谱</p>\n<p>升级后</p>\n<p>管理SRS页面: </p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/12/17/67617820c79bb.png\" alt=\"image-20241217210948894\"></p>\n<p>docker 删除旧的镜像</p>\n<p>运行简单的命令 </p>\n<ol>\n<li><p>docker images -a</p>\n</li>\n<li><p><em>docker</em> image rm</p>\n</li>\n</ol>\n<p><em>删除</em>未使用的<em>Docker镜像</em>：. </p>\n<p><em>docker</em> image prune </p>\n<p><em>docker</em> image prune -a.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker image prune</span><br><span class=\"line\">WARNING! This will remove all dangling images.</span><br><span class=\"line\">Are you sure you want to continue? [y/N] y</span><br><span class=\"line\">....</span><br><span class=\"line\">Total reclaimed space: 1.034GB</span><br><span class=\"line\"></span><br><span class=\"line\">root@Debian11:/www/server/panel/data/compose/srs# docker images -a</span><br><span class=\"line\">REPOSITORY                                    TAG         IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">registry.cn-hangzhou.aliyuncs.com/ossrs/srs   6           298b47d809f9   3 months ago    158MB</span><br><span class=\"line\">jc21/nginx-proxy-manager                      latest      28147ecda659   5 months ago    1.09GB</span><br><span class=\"line\">registry.cn-hangzhou.aliyuncs.com/ossrs/srs   5           5a4b3440626f   6 months ago    156MB</span><br><span class=\"line\">yidadaa/chatgpt-next-web                      latest      0737281804a6   7 months ago    200MB</span><br><span class=\"line\">teddysun/hysteria                             latest      fd9e3fc55d0c   8 months ago    27MB</span><br><span class=\"line\">artalk/artalk-go                              latest      84a28d6e4f57   9 months ago    52.8MB</span><br><span class=\"line\">alpine                                        latest      05455a08881e   10 months ago   7.38MB</span><br><span class=\"line\">mariadb                                       jammy       c74611c2858a   12 months ago   404MB</span><br><span class=\"line\">zmisgod/iptvchecker                           latest      842f43ba9daf   12 months ago   944MB</span><br><span class=\"line\">node                                          latest      b866e35a0dc4   12 months ago   1.1GB</span><br><span class=\"line\">matomo                                        latest      10c0eb643cc0   12 months ago   576MB</span><br><span class=\"line\">metacubex/clash-meta                          Alpha       f2b726e6300e   13 months ago   90.9MB</span><br><span class=\"line\">yourls                                        latest      922ce96efa9b   13 months ago   513MB</span><br><span class=\"line\">ghcr.io/metacubex/metacubexd                  latest      7ef93884b264   13 months ago   51.9MB</span><br><span class=\"line\">snowdreamtech/frps                            latest      ee2878617a63   14 months ago   24.1MB</span><br><span class=\"line\">adams549659584/go-proxy-bingai                latest      0dd1ec40e63b   18 months ago   14.7MB</span><br><span class=\"line\">stilleshan/hideipnetwork-web                  latest      34e0e6b19b99   20 months ago   140MB</span><br><span class=\"line\">searx/searx                                   latest      146813a62a41   20 months ago   172MB</span><br><span class=\"line\">openjdk                                       8u342-jdk   b273004037cc   2 years ago     526MB</span><br><span class=\"line\">yaonew/mmplayer                               latest      05f26aed5bfd   2 years ago     200MB</span><br><span class=\"line\"></span><br><span class=\"line\">root@Debian11:/www/server/panel/data/compose/srs# docker image rm 5a4b3440626f</span><br><span class=\"line\">Untagged: registry.cn-hangzhou.aliyuncs.com/ossrs/srs:5</span><br><span class=\"line\">Untagged: registry.cn-hangzhou.aliyuncs.com/ossrs/srs@sha256:b429bdb565f0a533e60634856760a500a1b673f8cadce072b2a2eb2674cd7b31</span><br><span class=\"line\">Deleted: sha256:5a4b3440626f0468254ac3c2eb99d9d744b9640d2d6ece0dd269af947b62ebe5</span><br><span class=\"line\">Deleted: sha256:f7762c297912069c267d347427fd4f959650cc2aa0a5b2fbc41527e025a26574</span><br><span class=\"line\">Deleted: sha256:b9a47b202efd2bdddbdcfecd4c111e964f8f6a875f1a8284c683ea666525751d</span><br><span class=\"line\">Deleted: sha256:fd56f7f39f1ebe03640162ad77a1f733d7c3929fc0e35bb6415aaa555300c727</span><br><span class=\"line\">Deleted: sha256:fb4b0d13ce99bc5901e085a3e587b9f9af63ebd5eed3293c779b542eab085c80</span><br><span class=\"line\"></span><br><span class=\"line\">root@Debian11:/www/server/panel/data/compose/srs# docker images -a</span><br><span class=\"line\">REPOSITORY                                    TAG         IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">registry.cn-hangzhou.aliyuncs.com/ossrs/srs   6           298b47d809f9   3 months ago    158MB</span><br><span class=\"line\">jc21/nginx-proxy-manager                      latest      28147ecda659   5 months ago    1.09GB</span><br><span class=\"line\">yidadaa/chatgpt-next-web                      latest      0737281804a6   7 months ago    200MB</span><br><span class=\"line\">teddysun/hysteria                             latest      fd9e3fc55d0c   8 months ago    27MB</span><br><span class=\"line\">artalk/artalk-go                              latest      84a28d6e4f57   9 months ago    52.8MB</span><br><span class=\"line\">alpine                                        latest      05455a08881e   10 months ago   7.38MB</span><br><span class=\"line\">mariadb                                       jammy       c74611c2858a   12 months ago   404MB</span><br><span class=\"line\">zmisgod/iptvchecker                           latest      842f43ba9daf   12 months ago   944MB</span><br><span class=\"line\">node                                          latest      b866e35a0dc4   12 months ago   1.1GB</span><br><span class=\"line\">matomo                                        latest      10c0eb643cc0   12 months ago   576MB</span><br><span class=\"line\">metacubex/clash-meta                          Alpha       f2b726e6300e   13 months ago   90.9MB</span><br><span class=\"line\">yourls                                        latest      922ce96efa9b   13 months ago   513MB</span><br><span class=\"line\">ghcr.io/metacubex/metacubexd                  latest      7ef93884b264   13 months ago   51.9MB</span><br><span class=\"line\">snowdreamtech/frps                            latest      ee2878617a63   14 months ago   24.1MB</span><br><span class=\"line\">adams549659584/go-proxy-bingai                latest      0dd1ec40e63b   18 months ago   14.7MB</span><br><span class=\"line\">stilleshan/hideipnetwork-web                  latest      34e0e6b19b99   20 months ago   140MB</span><br><span class=\"line\">searx/searx                                   latest      146813a62a41   20 months ago   172MB</span><br><span class=\"line\">openjdk                                       8u342-jdk   b273004037cc   2 years ago     526MB</span><br><span class=\"line\">yaonew/mmplayer                               latest      05f26aed5bfd   2 years ago     200MB</span><br></pre></td></tr></table></figure>\n\n\n\n<p>降低每秒的帧率 -r 1 来推流</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?chan</span><br><span class=\"line\">nel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -r 1   -c copy -f flv -y rtmp://192.168.6.116:1935/live/switchSDadapter  </span><br></pre></td></tr></table></figure>\n\n<p>VLC可以正常流程播放 <a href=\"https://cam1.carlzeng.com:3/live/switchSDadapter.m3u8\">https://cam1.carlzeng.com:3/live/switchSDadapter.m3u8</a></p>\n<p>可是<a href=\"https://cam1.carlzeng.com:3/players/srs_player.html?schema=https&port=3&api=3&autostart=true\">本地的网页播放器</a>和<a href=\"https://ossrs.net/srs.release/trunk/research/players/srs_player.html\">官方的网页播放器</a>都无法正常播放</p>\n<p>暂时搞不定, 不管怎么调整ffmpeg的参数, 都是无法成功使用网页播放器来播放回流</p>\n<p>我何必需要推流给SRS, 直接外网映射进来; 可直接播发的回放取流地址不就行了? </p>\n<p>何必推来推去(因为本身已经是视频的情况下)</p>\n<p>如何保护播放‘回放取流地址’的具体地址? 因为它具有最高权限, 这是极其危险的行为.</p>\n<p>rtsp:&#x2F;&#x2F;*:<a href=\"mailto:&#112;&#97;&#x73;&#115;&#x77;&#x6f;&#x72;&#x64;&#64;&#49;&#x39;&#x32;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x32;&#49;&#49;\">&#112;&#97;&#x73;&#115;&#x77;&#x6f;&#x72;&#x64;&#64;&#49;&#x39;&#x32;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x32;&#49;&#49;</a>:554&#x2F;cam&#x2F;playback?channel&#x3D;1&amp;subtype&#x3D;1&amp;starttime&#x3D;2024_12_13_10_19_00&amp;endtime&#x3D;2024_12_13_12_51_48</p>\n<p>目前紧急情况, 使用 Yourls缩短以后, 浏览器打开 <a href=\"https://c.carlzeng.com:4443/12131\">https://c.carlzeng.com:4443/12131</a>, 会提示: </p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/12/17/67618c5abae49.png\" alt=\"image-20241217223608783\"></p>\n<p>调用VLC以后, 可以正常播放(在本地播放) ; 配置切换地址后, 也可以网络播放.</p>\n<h3 id=\"使用在线srs播放器拉流\"><a href=\"#使用在线srs播放器拉流\" class=\"headerlink\" title=\"使用在线srs播放器拉流\"></a><strong>使用在线srs播放器拉流</strong></h3><p>在线SRS播放器播放， 由于RTMP已经被禁用了，请使用HTTP-FLV链接。</p>\n<ul>\n<li><a href=\"http://ossrs.net/srs.release/trunk/research/players/srs_player.html\">http://ossrs.net/srs.release/trunk/research/players/srs_player.html</a> （官方提供的连接）</li>\n<li></li>\n</ul>\n<h2 id=\"如何去除录制的视频中的音频\"><a href=\"#如何去除录制的视频中的音频\" class=\"headerlink\" title=\"如何去除录制的视频中的音频?\"></a>如何去除录制的视频中的音频?</h2><p>-an  </p>\n<p>似乎 只能用在转化的时候使用, 无法在推流时使用 </p>\n<p>ffmpeg能不能嵌套呢? 一边转化一边把转化的结果推流</p>\n<p>就是视频过滤 filter</p>\n<h2 id=\"ffmpeg-添加水印-字母-OSD\"><a href=\"#ffmpeg-添加水印-字母-OSD\" class=\"headerlink\" title=\"ffmpeg 添加水印&#x2F;字母&#x2F;OSD\"></a>ffmpeg 添加水印&#x2F;字母&#x2F;OSD</h2><p>我们需要创建一个滤镜链来添加水印。我们可以使用<code>movie</code>滤镜来加载水印图像，然后使用<code>overlay</code>滤镜将水印添加到视频中。以下是示例命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell</span><br><span class=\"line\">ffmpeg -i input.mp4 -vf &quot;movie=watermark.png[watermark];[in][watermark]overlay=W-w-10:H-h-10[out]&quot; output.mp4</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>watermark.png</code>是水印图像的文件名，<code>W</code>和<code>H</code>分别代表视频的宽度和高度。该命令将在视频的右下角添加一个距离视频右下角10个像素的水印。</p>\n<p>在执行命令后，FFmpeg会将视频重新编码，并将添加水印后的视频保存为<code>output.mp4</code>。</p>\n<p>除了在右下角添加水印，我们还可以控制水印的位置、大小和透明度等。例如，以下命令将在视频左上角添加一个大小为100x100像素，透明度为50%的水印：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell</span><br><span class=\"line\">ffmpeg -i input.mp4 -vf &quot;movie=watermark.png[watermark];[in][watermark]overlay=10:10:alpha=0.5[out]&quot; output.mp4</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，添加水印会增加视频的处理时间和文件大小。如果您对视频质量要求较高，可以使用额外的参数进行优化，如调整视频的帧率、码率等。这些参数可以根据实际情况进行调整。</p>\n<p>总的来说，使用FFmpeg命令给视频添加水印是一种简单而有效的方法。</p>\n<h2 id=\"新思路-每5秒抽帧\"><a href=\"#新思路-每5秒抽帧\" class=\"headerlink\" title=\"[新思路] 每5秒抽帧\"></a>[新思路] 每5秒抽帧</h2><p>可以对回放的视频(时长1.5小时), 进行时间很短间隔的抽帧, 最后再把照片组合成视频</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -y -f image2 -r 1/5 /Users/carlzeng/Downloads/switchSDadapter/202412131%03d.jpg</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Input #0, rtsp, from &#x27;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&#x27;:</span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    title           : Media Server</span><br><span class=\"line\">  Duration: 02:30:30.00, start: 0.000000, bitrate: N/A</span><br><span class=\"line\">  Stream #0:0: Video: hevc (Main), yuvj420p(pc, bt709), 1920x1080 [SAR 1:1 DAR 16:9], 10 fps, 100 tbr, 90k tbn</span><br><span class=\"line\">  Stream #0:1: Audio: aac (LC), 16000 Hz, mono, fltp</span><br><span class=\"line\">Stream mapping:</span><br><span class=\"line\">  Stream #0:0 -&gt; #0:0 (hevc (native) -&gt; mjpeg (native))</span><br><span class=\"line\">Press [q] to stop, [?] for help</span><br><span class=\"line\">Output #0, image2, to &#x27;/Users/carlzeng/Downloads/switchSDadapter/202412131%03d.jpg&#x27;:</span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    title           : Media Server</span><br><span class=\"line\">    encoder         : Lavf60.16.100</span><br><span class=\"line\">  Stream #0:0: Video: mjpeg, yuvj420p(pc, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 200 kb/s, 0.20 fps, 0.20 tbn</span><br><span class=\"line\">    Metadata:</span><br><span class=\"line\">      encoder         : Lavc60.31.102 mjpeg</span><br><span class=\"line\">    Side data:</span><br><span class=\"line\">      cpb: bitrate max/min/avg: 0/0/200000 buffer size: 0 vbv_delay: N/A</span><br><span class=\"line\">frame=  273 fps=0.2 q=5.5 size=N/A time=00:22:40.00 bitrate=N/A dup=0 drop=13305 speed=   1x </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后再组合成MP4文件\"><a href=\"#最后再组合成MP4文件\" class=\"headerlink\" title=\"最后再组合成MP4文件\"></a>最后再组合成MP4文件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 1 -f image2 -i 202412131%03d.jpg switchSDadapter.mp4    </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">如果需要每秒0.5张,也就是每张图片2秒钟后切换</span></span><br><span class=\"line\">ffmpeg -r 0.5 -f image2 -i 202412131%03d.jpg switchSDadapter.mp4    </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">## -r 调整帧率</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">不指定帧率的话，ffmpeg会使用默认的25帧，也就是1秒钟拼接25张图片</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p>本站搜索: 动态公网IP 和 SRS</p>\n<p><a href=\"https://ossrs.net/lts/zh-cn/blog/lets-do-h265-live-streaming\">SRS - H.265直播省一半带宽费用</a></p>\n<p><a href=\"https://cloud.tencent.com/developer/article/2277703\">FFmpeg推流命令总结</a></p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用-怎么用\"><a href=\"#有什么用-怎么用\" class=\"headerlink\" title=\"有什么用&amp;怎么用\"></a>有什么用&amp;怎么用</h1><p>如何不拔卡调取摄像头监控-回放取流</p>\n<p>通过获取摄像头的回放取流地址, 来读取摄像头中的回放数据</p>\n<p>背景: 某位调皮的顾客, 非要上来就诬陷我更换了他的Switch电池. 百口莫辩, 实属无奈还得去调阅监控. 上次的方法是直接把卡, 然后找到监控的目录文件(按日期时间命名的), 最后拷贝出多个大的文件, 然后在组合多个此类MP4文件成为完整的全过程监控.</p>\n<p>这样做太累人了, 而且导致了监控的中断. </p>\n<p>今天尝试使用取流回放流的方式, 成功取到了回放的流; 但是要录制成完整的mp4,需要等量的时间(1.5小时多); 这可真累人啊, 一个命令要执行1.75个小时, 我哪有那个耐心和时间? </p>\n<p>于是乎, 想各种其他的方法, 推流到SRS, 让他自己去看SRS上回放的流(网页播发失败). </p>\n<p>最后还是使用抽帧最快, 每5秒抽一张照片, 抽出来一共将近1千张截图, 基本可以完全涵盖了整个修复过程(也证明了我没有去动电池)</p>\n<p>某某同学: 请移步去网盘看看您设备的修复全过程吧, <a href=\"https://file.carlzeng.com:3/d/Aria2%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%A4%B9/switchSDadapter20241213.mp4\">switchSDadapter20241213.mp4</a></p>\n<p>(因为他已自行觉悟并确认收货, 我不会在发他视频去所谓的自证清白; 终于明白为啥需要法院这样的第三方来沟通矛盾, 有时2个方面直接联系, 根本无效, 累死宝宝)</p>\n<p>后话: 这种方式还不完美(目前已经够用, 足以当证据来提交第三方), 不够高效; 后期还需努力把回放的流推流到SRS更高效, 根本只需要参数就OK(限时特定时间段可查阅, 不长期保存)</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=摄像头\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"获取摄像头的回放取流URL地址\"><a href=\"#获取摄像头的回放取流URL地址\" class=\"headerlink\" title=\"获取摄像头的回放取流URL地址\"></a>获取摄像头的回放取流URL地址</h1><p>比如这是我的实例</p>\n<h2 id=\"1-回放取流url\"><a href=\"#1-回放取流url\" class=\"headerlink\" title=\"1. 回放取流url\"></a>1. 回放取流url</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtsp://admin:d@172.22.0.26:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_11_19_00&amp;endtime=2024_12_13_12_51_48</span><br></pre></td></tr></table></figure>\n\n<p>说明：</p>\n<ul>\n<li>playback表示回放</li>\n<li>channel&#x3D;number表示通道号</li>\n<li>subtype&#x3D;0表示主码流</li>\n<li>starttime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放开始时间</li>\n<li>endtime&#x3D;YYYY_MM_DD_HH_mm_SS表示回放结束时间</li>\n</ul>\n<blockquote>\n<p>20240705 实测有效，vlc播放成功。这是一个实用的功能</p>\n<p>可随时查看回放</p>\n</blockquote>\n<h2 id=\"2-录制取流地址内视频\"><a href=\"#2-录制取流地址内视频\" class=\"headerlink\" title=\"2. 录制取流地址内视频\"></a>2. 录制取流地址内视频</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i &quot;rtsp://地址&quot; -t 录制秒数 文件名.mp4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"录制MP4\"><a href=\"#录制MP4\" class=\"headerlink\" title=\"录制MP4\"></a>录制MP4</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&quot; -t 5568 Switch的SD卡底座修复.mp4</span><br><span class=\"line\"></span><br><span class=\"line\"># 关键帧录制</span><br><span class=\"line\">ffmpeg -i  &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -vf &quot;select=&#x27;eq(pict_type,PICT_TYPE_I)&#x27;&quot; -t 1:32:48 -vcodec copy -acodec copy </span><br><span class=\"line\">  -f mp4  Switch的SD卡底座修复.mp4</span><br></pre></td></tr></table></figure>\n\n\n\n<p>ffmpeg+加速录制+rtsp流</p>\n<h3 id=\"FLV录制FLV\"><a href=\"#FLV录制FLV\" class=\"headerlink\" title=\"FLV录制FLV\"></a>FLV录制FLV</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i  &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&quot; -t 1:32:48 -vcodec copy -acodec copy -f flv  Switch的SD卡底座修复.flv</span><br><span class=\"line\">#也是太慢了,要一秒一秒录制, 真的要等待1个半小时</span><br><span class=\"line\"></span><br><span class=\"line\">#关键帧录制</span><br><span class=\"line\">ffmpeg -i  &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&quot; -vf &quot;select=&#x27;eq(pict_type,PICT_TYPE_I)&#x27;&quot; -t 1:32:48 -vcodec copy -acodec copy </span><br><span class=\"line\">  -f flv Switch的SD卡底座修复2.flv</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>ffmpeg+加速录制+rtsp流</p>\n<p>推流这段回放到SRS服务器上, 让服务器不停循环播放即可</p>\n<p>可否把思路转变为: 推流这段回放到SRS服务器上, 让服务器不停循环播放即可</p>\n<p>rtsp:&#x2F;&#x2F;*:<a href=\"mailto:&#100;&#x40;&#x31;&#55;&#50;&#46;&#x32;&#50;&#46;&#48;&#x2e;&#x32;&#x36;\">&#100;&#x40;&#x31;&#55;&#50;&#46;&#x32;&#50;&#46;&#48;&#x2e;&#x32;&#x36;</a>:554&#x2F;cam&#x2F;playback?channel&#x3D;1&amp;subtype&#x3D;1&amp;starttime&#x3D;2024_12_13_11_19_00&amp;endtime&#x3D;2024_12_13_12_51_48</p>\n<h2 id=\"3-推流回放流到SRS\"><a href=\"#3-推流回放流到SRS\" class=\"headerlink\" title=\"3. 推流回放流到SRS\"></a>3. 推流回放流到SRS</h2><p>ffmpeg -re -i “rtsp:&#x2F;&#x2F;*:<a href=\"mailto:&#100;&#x40;&#x31;&#55;&#50;&#x2e;&#50;&#50;&#x2e;&#48;&#46;&#x32;&#54;\">&#100;&#x40;&#x31;&#55;&#50;&#x2e;&#50;&#50;&#x2e;&#48;&#46;&#x32;&#54;</a>:554&#x2F;cam&#x2F;playback?channel&#x3D;1&amp;subtype&#x3D;1&amp;starttime&#x3D;2024_12_13_11_19_00&amp;endtime&#x3D;2024_12_13_12_51_48” -c copy -f flv -y rtmp:&#x2F;&#x2F;192.168.6.221:1935&#x2F;live&#x2F;switchSDadapter</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -c copy -f flv -y rtmp://192.168.6.116:1935/live/switchSDadapter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    title           : Media Server</span><br><span class=\"line\">  Duration: 02:30:30.00, start: 0.000000, bitrate: N/A</span><br><span class=\"line\">  Stream #0:0: Video: hevc (Main), yuvj420p(pc, bt709), 1920x1080 [SAR 1:1 DAR 16:9], 10 fps, 100 tbr, 90k tbn</span><br><span class=\"line\">  Stream #0:1: Audio: aac (LC), 16000 Hz, mono, fltp</span><br><span class=\"line\">[flv @ 0x563db2eb0400] Video codec hevc not compatible with flv</span><br><span class=\"line\"><span class=\"meta prompt_\">  [out#</span><span class=\"language-bash\">0/flv @ 0x563db2e9f000] Could not write header (incorrect codec parameters ?): Function not implemented</span></span><br><span class=\"line\"><span class=\"meta prompt_\">[aost#</span><span class=\"language-bash\">0:1/copy @ 0x563db2e9bac0] Error initializing output stream:</span> </span><br><span class=\"line\">Stream mapping:</span><br><span class=\"line\">  Stream #0:0 -&gt; #0:0 (copy)</span><br><span class=\"line\">  Stream #0:1 -&gt; #0:1 (copy)</span><br><span class=\"line\">    Last message repeated 1 times</span><br><span class=\"line\">    </span><br><span class=\"line\">   </span><br></pre></td></tr></table></figure>\n\n<p>可以推流成功, 但是无法获取图像, 如何修复?</p>\n<p>原来是我的SRS目前版本(5.0)不支持H.265, 导致上面的错误, 临时的解决方案是使用H.264</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -c copy -vcodec libx264 -f flv -y rtmp://192.168.6.116:1935/live/switchsdcar</span><br></pre></td></tr></table></figure>\n\n<p>这样就是H.264了可是画面经常花屏, 画面有故障.</p>\n<p>还是去升级SRS更靠谱</p>\n<p>升级后</p>\n<p>管理SRS页面: </p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/12/17/67617820c79bb.png\" alt=\"image-20241217210948894\"></p>\n<p>docker 删除旧的镜像</p>\n<p>运行简单的命令 </p>\n<ol>\n<li><p>docker images -a</p>\n</li>\n<li><p><em>docker</em> image rm</p>\n</li>\n</ol>\n<p><em>删除</em>未使用的<em>Docker镜像</em>：. </p>\n<p><em>docker</em> image prune </p>\n<p><em>docker</em> image prune -a.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker image prune</span><br><span class=\"line\">WARNING! This will remove all dangling images.</span><br><span class=\"line\">Are you sure you want to continue? [y/N] y</span><br><span class=\"line\">....</span><br><span class=\"line\">Total reclaimed space: 1.034GB</span><br><span class=\"line\"></span><br><span class=\"line\">root@Debian11:/www/server/panel/data/compose/srs# docker images -a</span><br><span class=\"line\">REPOSITORY                                    TAG         IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">registry.cn-hangzhou.aliyuncs.com/ossrs/srs   6           298b47d809f9   3 months ago    158MB</span><br><span class=\"line\">jc21/nginx-proxy-manager                      latest      28147ecda659   5 months ago    1.09GB</span><br><span class=\"line\">registry.cn-hangzhou.aliyuncs.com/ossrs/srs   5           5a4b3440626f   6 months ago    156MB</span><br><span class=\"line\">yidadaa/chatgpt-next-web                      latest      0737281804a6   7 months ago    200MB</span><br><span class=\"line\">teddysun/hysteria                             latest      fd9e3fc55d0c   8 months ago    27MB</span><br><span class=\"line\">artalk/artalk-go                              latest      84a28d6e4f57   9 months ago    52.8MB</span><br><span class=\"line\">alpine                                        latest      05455a08881e   10 months ago   7.38MB</span><br><span class=\"line\">mariadb                                       jammy       c74611c2858a   12 months ago   404MB</span><br><span class=\"line\">zmisgod/iptvchecker                           latest      842f43ba9daf   12 months ago   944MB</span><br><span class=\"line\">node                                          latest      b866e35a0dc4   12 months ago   1.1GB</span><br><span class=\"line\">matomo                                        latest      10c0eb643cc0   12 months ago   576MB</span><br><span class=\"line\">metacubex/clash-meta                          Alpha       f2b726e6300e   13 months ago   90.9MB</span><br><span class=\"line\">yourls                                        latest      922ce96efa9b   13 months ago   513MB</span><br><span class=\"line\">ghcr.io/metacubex/metacubexd                  latest      7ef93884b264   13 months ago   51.9MB</span><br><span class=\"line\">snowdreamtech/frps                            latest      ee2878617a63   14 months ago   24.1MB</span><br><span class=\"line\">adams549659584/go-proxy-bingai                latest      0dd1ec40e63b   18 months ago   14.7MB</span><br><span class=\"line\">stilleshan/hideipnetwork-web                  latest      34e0e6b19b99   20 months ago   140MB</span><br><span class=\"line\">searx/searx                                   latest      146813a62a41   20 months ago   172MB</span><br><span class=\"line\">openjdk                                       8u342-jdk   b273004037cc   2 years ago     526MB</span><br><span class=\"line\">yaonew/mmplayer                               latest      05f26aed5bfd   2 years ago     200MB</span><br><span class=\"line\"></span><br><span class=\"line\">root@Debian11:/www/server/panel/data/compose/srs# docker image rm 5a4b3440626f</span><br><span class=\"line\">Untagged: registry.cn-hangzhou.aliyuncs.com/ossrs/srs:5</span><br><span class=\"line\">Untagged: registry.cn-hangzhou.aliyuncs.com/ossrs/srs@sha256:b429bdb565f0a533e60634856760a500a1b673f8cadce072b2a2eb2674cd7b31</span><br><span class=\"line\">Deleted: sha256:5a4b3440626f0468254ac3c2eb99d9d744b9640d2d6ece0dd269af947b62ebe5</span><br><span class=\"line\">Deleted: sha256:f7762c297912069c267d347427fd4f959650cc2aa0a5b2fbc41527e025a26574</span><br><span class=\"line\">Deleted: sha256:b9a47b202efd2bdddbdcfecd4c111e964f8f6a875f1a8284c683ea666525751d</span><br><span class=\"line\">Deleted: sha256:fd56f7f39f1ebe03640162ad77a1f733d7c3929fc0e35bb6415aaa555300c727</span><br><span class=\"line\">Deleted: sha256:fb4b0d13ce99bc5901e085a3e587b9f9af63ebd5eed3293c779b542eab085c80</span><br><span class=\"line\"></span><br><span class=\"line\">root@Debian11:/www/server/panel/data/compose/srs# docker images -a</span><br><span class=\"line\">REPOSITORY                                    TAG         IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">registry.cn-hangzhou.aliyuncs.com/ossrs/srs   6           298b47d809f9   3 months ago    158MB</span><br><span class=\"line\">jc21/nginx-proxy-manager                      latest      28147ecda659   5 months ago    1.09GB</span><br><span class=\"line\">yidadaa/chatgpt-next-web                      latest      0737281804a6   7 months ago    200MB</span><br><span class=\"line\">teddysun/hysteria                             latest      fd9e3fc55d0c   8 months ago    27MB</span><br><span class=\"line\">artalk/artalk-go                              latest      84a28d6e4f57   9 months ago    52.8MB</span><br><span class=\"line\">alpine                                        latest      05455a08881e   10 months ago   7.38MB</span><br><span class=\"line\">mariadb                                       jammy       c74611c2858a   12 months ago   404MB</span><br><span class=\"line\">zmisgod/iptvchecker                           latest      842f43ba9daf   12 months ago   944MB</span><br><span class=\"line\">node                                          latest      b866e35a0dc4   12 months ago   1.1GB</span><br><span class=\"line\">matomo                                        latest      10c0eb643cc0   12 months ago   576MB</span><br><span class=\"line\">metacubex/clash-meta                          Alpha       f2b726e6300e   13 months ago   90.9MB</span><br><span class=\"line\">yourls                                        latest      922ce96efa9b   13 months ago   513MB</span><br><span class=\"line\">ghcr.io/metacubex/metacubexd                  latest      7ef93884b264   13 months ago   51.9MB</span><br><span class=\"line\">snowdreamtech/frps                            latest      ee2878617a63   14 months ago   24.1MB</span><br><span class=\"line\">adams549659584/go-proxy-bingai                latest      0dd1ec40e63b   18 months ago   14.7MB</span><br><span class=\"line\">stilleshan/hideipnetwork-web                  latest      34e0e6b19b99   20 months ago   140MB</span><br><span class=\"line\">searx/searx                                   latest      146813a62a41   20 months ago   172MB</span><br><span class=\"line\">openjdk                                       8u342-jdk   b273004037cc   2 years ago     526MB</span><br><span class=\"line\">yaonew/mmplayer                               latest      05f26aed5bfd   2 years ago     200MB</span><br></pre></td></tr></table></figure>\n\n\n\n<p>降低每秒的帧率 -r 1 来推流</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?chan</span><br><span class=\"line\">nel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -r 1   -c copy -f flv -y rtmp://192.168.6.116:1935/live/switchSDadapter  </span><br></pre></td></tr></table></figure>\n\n<p>VLC可以正常流程播放 <a href=\"https://cam1.carlzeng.com:3/live/switchSDadapter.m3u8\">https://cam1.carlzeng.com:3/live/switchSDadapter.m3u8</a></p>\n<p>可是<a href=\"https://cam1.carlzeng.com:3/players/srs_player.html?schema=https&port=3&api=3&autostart=true\">本地的网页播放器</a>和<a href=\"https://ossrs.net/srs.release/trunk/research/players/srs_player.html\">官方的网页播放器</a>都无法正常播放</p>\n<p>暂时搞不定, 不管怎么调整ffmpeg的参数, 都是无法成功使用网页播放器来播放回流</p>\n<p>我何必需要推流给SRS, 直接外网映射进来; 可直接播发的回放取流地址不就行了? </p>\n<p>何必推来推去(因为本身已经是视频的情况下)</p>\n<p>如何保护播放‘回放取流地址’的具体地址? 因为它具有最高权限, 这是极其危险的行为.</p>\n<p>rtsp:&#x2F;&#x2F;*:<a href=\"mailto:&#112;&#97;&#x73;&#115;&#x77;&#x6f;&#x72;&#x64;&#64;&#49;&#x39;&#x32;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x32;&#49;&#49;\">&#112;&#97;&#x73;&#115;&#x77;&#x6f;&#x72;&#x64;&#64;&#49;&#x39;&#x32;&#x2e;&#x31;&#54;&#x38;&#46;&#x36;&#x2e;&#x32;&#49;&#49;</a>:554&#x2F;cam&#x2F;playback?channel&#x3D;1&amp;subtype&#x3D;1&amp;starttime&#x3D;2024_12_13_10_19_00&amp;endtime&#x3D;2024_12_13_12_51_48</p>\n<p>目前紧急情况, 使用 Yourls缩短以后, 浏览器打开 <a href=\"https://c.carlzeng.com:4443/12131\">https://c.carlzeng.com:4443/12131</a>, 会提示: </p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/12/17/67618c5abae49.png\" alt=\"image-20241217223608783\"></p>\n<p>调用VLC以后, 可以正常播放(在本地播放) ; 配置切换地址后, 也可以网络播放.</p>\n<h3 id=\"使用在线srs播放器拉流\"><a href=\"#使用在线srs播放器拉流\" class=\"headerlink\" title=\"使用在线srs播放器拉流\"></a><strong>使用在线srs播放器拉流</strong></h3><p>在线SRS播放器播放， 由于RTMP已经被禁用了，请使用HTTP-FLV链接。</p>\n<ul>\n<li><a href=\"http://ossrs.net/srs.release/trunk/research/players/srs_player.html\">http://ossrs.net/srs.release/trunk/research/players/srs_player.html</a> （官方提供的连接）</li>\n<li></li>\n</ul>\n<h2 id=\"如何去除录制的视频中的音频\"><a href=\"#如何去除录制的视频中的音频\" class=\"headerlink\" title=\"如何去除录制的视频中的音频?\"></a>如何去除录制的视频中的音频?</h2><p>-an  </p>\n<p>似乎 只能用在转化的时候使用, 无法在推流时使用 </p>\n<p>ffmpeg能不能嵌套呢? 一边转化一边把转化的结果推流</p>\n<p>就是视频过滤 filter</p>\n<h2 id=\"ffmpeg-添加水印-字母-OSD\"><a href=\"#ffmpeg-添加水印-字母-OSD\" class=\"headerlink\" title=\"ffmpeg 添加水印&#x2F;字母&#x2F;OSD\"></a>ffmpeg 添加水印&#x2F;字母&#x2F;OSD</h2><p>我们需要创建一个滤镜链来添加水印。我们可以使用<code>movie</code>滤镜来加载水印图像，然后使用<code>overlay</code>滤镜将水印添加到视频中。以下是示例命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell</span><br><span class=\"line\">ffmpeg -i input.mp4 -vf &quot;movie=watermark.png[watermark];[in][watermark]overlay=W-w-10:H-h-10[out]&quot; output.mp4</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>watermark.png</code>是水印图像的文件名，<code>W</code>和<code>H</code>分别代表视频的宽度和高度。该命令将在视频的右下角添加一个距离视频右下角10个像素的水印。</p>\n<p>在执行命令后，FFmpeg会将视频重新编码，并将添加水印后的视频保存为<code>output.mp4</code>。</p>\n<p>除了在右下角添加水印，我们还可以控制水印的位置、大小和透明度等。例如，以下命令将在视频左上角添加一个大小为100x100像素，透明度为50%的水印：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell</span><br><span class=\"line\">ffmpeg -i input.mp4 -vf &quot;movie=watermark.png[watermark];[in][watermark]overlay=10:10:alpha=0.5[out]&quot; output.mp4</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，添加水印会增加视频的处理时间和文件大小。如果您对视频质量要求较高，可以使用额外的参数进行优化，如调整视频的帧率、码率等。这些参数可以根据实际情况进行调整。</p>\n<p>总的来说，使用FFmpeg命令给视频添加水印是一种简单而有效的方法。</p>\n<h2 id=\"新思路-每5秒抽帧\"><a href=\"#新思路-每5秒抽帧\" class=\"headerlink\" title=\"[新思路] 每5秒抽帧\"></a>[新思路] 每5秒抽帧</h2><p>可以对回放的视频(时长1.5小时), 进行时间很短间隔的抽帧, 最后再把照片组合成视频</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i &quot;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&quot; -y -f image2 -r 1/5 /Users/carlzeng/Downloads/switchSDadapter/202412131%03d.jpg</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Input #0, rtsp, from &#x27;rtsp://*:*@192.168.6.211:554/cam/playback?channel=1&amp;subtype=1&amp;starttime=2024_12_13_10_19_00&amp;endtime=2024_12_13_12_51_48&#x27;:</span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    title           : Media Server</span><br><span class=\"line\">  Duration: 02:30:30.00, start: 0.000000, bitrate: N/A</span><br><span class=\"line\">  Stream #0:0: Video: hevc (Main), yuvj420p(pc, bt709), 1920x1080 [SAR 1:1 DAR 16:9], 10 fps, 100 tbr, 90k tbn</span><br><span class=\"line\">  Stream #0:1: Audio: aac (LC), 16000 Hz, mono, fltp</span><br><span class=\"line\">Stream mapping:</span><br><span class=\"line\">  Stream #0:0 -&gt; #0:0 (hevc (native) -&gt; mjpeg (native))</span><br><span class=\"line\">Press [q] to stop, [?] for help</span><br><span class=\"line\">Output #0, image2, to &#x27;/Users/carlzeng/Downloads/switchSDadapter/202412131%03d.jpg&#x27;:</span><br><span class=\"line\">  Metadata:</span><br><span class=\"line\">    title           : Media Server</span><br><span class=\"line\">    encoder         : Lavf60.16.100</span><br><span class=\"line\">  Stream #0:0: Video: mjpeg, yuvj420p(pc, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 200 kb/s, 0.20 fps, 0.20 tbn</span><br><span class=\"line\">    Metadata:</span><br><span class=\"line\">      encoder         : Lavc60.31.102 mjpeg</span><br><span class=\"line\">    Side data:</span><br><span class=\"line\">      cpb: bitrate max/min/avg: 0/0/200000 buffer size: 0 vbv_delay: N/A</span><br><span class=\"line\">frame=  273 fps=0.2 q=5.5 size=N/A time=00:22:40.00 bitrate=N/A dup=0 drop=13305 speed=   1x </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最后再组合成MP4文件\"><a href=\"#最后再组合成MP4文件\" class=\"headerlink\" title=\"最后再组合成MP4文件\"></a>最后再组合成MP4文件</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -r 1 -f image2 -i 202412131%03d.jpg switchSDadapter.mp4    </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">如果需要每秒0.5张,也就是每张图片2秒钟后切换</span></span><br><span class=\"line\">ffmpeg -r 0.5 -f image2 -i 202412131%03d.jpg switchSDadapter.mp4    </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">## -r 调整帧率</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">不指定帧率的话，ffmpeg会使用默认的25帧，也就是1秒钟拼接25张图片</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p>本站搜索: 动态公网IP 和 SRS</p>\n<p><a href=\"https://ossrs.net/lts/zh-cn/blog/lets-do-h265-live-streaming\">SRS - H.265直播省一半带宽费用</a></p>\n<p><a href=\"https://cloud.tencent.com/developer/article/2277703\">FFmpeg推流命令总结</a></p>","categories":[{"name":"cam","path":"api/categories/cam.json"}],"tags":[{"name":"ffmpeg","path":"api/tags/ffmpeg.json"},{"name":"cam","path":"api/tags/cam.json"}]}