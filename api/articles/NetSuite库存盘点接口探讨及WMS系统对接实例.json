{"title":"NetSuite库存盘点接口探讨及WMS系统对接实例","slug":"NetSuite库存盘点接口探讨及WMS系统对接实例","date":"2025-08-28T01:24:53.000Z","updated":"2025-08-29T03:45:50.067Z","comments":true,"path":"api/articles/NetSuite库存盘点接口探讨及WMS系统对接实例.json","excerpt":" [Figure] NetSuite库存盘点接口探讨及WMS系统对接实例, 思路探讨文章不涉及商业应用或客户信息","covers":["https://img.carlzeng.com:3/i/2025/08/29/68b109d13a243.png","https://img.carlzeng.com:3/i/2025/08/29/68b1209347b60.png"],"content":"<img class=\"lozad\" data-src=\"https://img.carlzeng.com:3/i/2025/08/29/68b109d13a243.png\">\n\n<p>NetSuite库存盘点接口探讨及WMS系统对接实例, 思路探讨文章不涉及商业应用或客户信息</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>了解NetSuite库存盘点接口, 以及WMS系统对接实例</p>\n<p>学习NetSuite如果通过Restlet进行接口类设计和开发</p>\n<p>已提前隐去客户的私人信息, 本文内容不针对任何特定客户, 本文只是思路的探讨, 如有侵权, 请<a href=\"carl.zeng@me.com\">联系作者</a>删除</p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><p>把两个实例代码在NetSuite中创建脚本记录, 配置Integration Record, 让RestLet可以与外界通信</p>\n<p>抛砖引玉, 展开思路; 这一类的接口设计(或系统对接, 拓展NetSuite或外部系统功能)都可以引用参考</p>\n<p>下面的实现方法已局限于特定的应用(库存盘点), 难免会局限思维, 仅可作为一个特定的实例, 现实当中可以搭配更加灵活的设计, 让整体多系统之间实现协调, 从而达到拓展单一系统功能局限性或包容特定行业应用的特色等目的.</p>\n<p>解放人力, 高效协作(系统间, 人与人之间)</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=netsuite\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"NetSuite-实现方法\"><a href=\"#NetSuite-实现方法\" class=\"headerlink\" title=\"NetSuite 实现方法\"></a>NetSuite 实现方法</h1><h2 id=\"Inventory-Count在Script中局限性\"><a href=\"#Inventory-Count在Script中局限性\" class=\"headerlink\" title=\"Inventory Count在Script中局限性\"></a>Inventory Count在Script中局限性</h2><h3 id=\"本身上的局限\"><a href=\"#本身上的局限\" class=\"headerlink\" title=\"本身上的局限\"></a>本身上的局限</h3><ol>\n<li><p>Inventory Count 不支持自定义表单(custom form), 但是可以新建自定义表头字段并应用到InventoryCount</p>\n</li>\n<li><p>Inventory Count 不支持显示自定义表头和列表自定义字段</p>\n</li>\n<li><p>Inventory Count 不支持保存自定义列表字段的内容(即便在Script中写入了自定义列表字段内容, 保存单据后, 自定义列表字段内容会清空消失)</p>\n</li>\n<li><p>当在点击“开始盘点Start Count” 动作之前输入货品以及详细的盘点数据, 然后在点击‘开始盘点’, 完成盘点 和审批的流程性动作, 会导致盘点的货品数据只是调增</p>\n<ol>\n<li>也就是说详细的盘点数据 不是覆盖目前系统中货品的库存数据, 而是新增添加到当前的库存数据中去.</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"流程上局限\"><a href=\"#流程上局限\" class=\"headerlink\" title=\"流程上局限\"></a>流程上局限</h3><ol>\n<li><p>创建库存盘点单. 根据现实情况输入Body上面的字段. 然后搜索或选择货品，然后选择库位和单位后即可保存(此时为‘未结’状态)</p>\n</li>\n<li><p>之后点击“开始盘点” 为‘已开始’状态后点击编辑即可输入\t盘点数量，\t输入完数量后才能点击盘点\t明细按钮打开对话框，然后输入批次号、下拉框状态、数量保存即可，此时状态下拉框\t默认只有Good - available 可用状态，输入好判断数量后点击“完成盘点”后就完成了盘点单</p>\n</li>\n<li><p>点击“完成盘点”按钮后状态就变成了\t‘已完成&#x2F;待审批’状态，\t之后就是审批流程。审批通过后就回生成一个库存调整单，就会按照原来的盘点数量来加数量审批通过\t后就\t会操作数据.  在开发过程中，接收到传过来的值后就可以立即进行一整套操作，跳过审批直接生成库存调整，执行完成后返回信息。</p>\n</li>\n</ol>\n<p>走完库存盘点单Inventory Count 需要搭配 新建保存初始单据 然后 “开始盘点Start Count” 和 “完成盘点Complete Count” 和 “审批Approve”这个四个动作action</p>\n<p>问题来了: 我们通过Reslet来接收WMS传来的库存盘单数据, 然后需要一步到位走完NetSuite的库存盘点的四个动作流程才能生效(影响货品库存和GL Impact)</p>\n<p>经过测试 “开始盘点Start Count” 和 “完成盘点Complete Count” 和 “审批Approve”这个四个动作是无法用非’N&#x2F;action’的NetSuite默认包来实现的, 然后Restlet又无法支持引用’N&#x2F;action’包.</p>\n<h2 id=\"灵活思路解决方案\"><a href=\"#灵活思路解决方案\" class=\"headerlink\" title=\"灵活思路解决方案\"></a>灵活思路解决方案</h2><p>Restlet先接收和缓存库存盘点的详细Item数据(比如批次和数量等), 然后通过另新建一个User Event Script来继续操作剩下的流程 “开始盘点Start Count”, 输入详细的盘点数量数据 和 “完成盘点Complete Count” 和 “审批Approve”</p>\n<h2 id=\"Sample-RestLet-Script\"><a href=\"#Sample-RestLet-Script\" class=\"headerlink\" title=\"Sample RestLet Script\"></a>Sample RestLet Script</h2><p>解析WMS post传来的参数, 做好数据对应后, 在把详细的盘点数据缓存在表单头的自定义字段中(custbody_wms_invcount_items), 等待下一步处理.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">// Copyright 2018, All rights reserved, Carl Notes.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// No part of this file may be copied or used without express, written</span></span><br><span class=\"line\"><span class=\"comment\">// permission of Carl Notes.</span></span><br><span class=\"line\"><span class=\"comment\">//------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">//Script: ep_OperateInvCount_rl.js</span></span><br><span class=\"line\"><span class=\"comment\">//Developer: Carl</span></span><br><span class=\"line\"><span class=\"comment\">//Date: 20250808</span></span><br><span class=\"line\"><span class=\"comment\">//Description: API REST Endpoint: Operate Inventory Count</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\t   Running in nonpaged mode, per search upto 4000 results.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// ------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NApiVersion</span> 2.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NScriptType</span> <span class=\"variable\">Restlet</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_\">define</span>([<span class=\"string\">&#x27;N/error&#x27;</span>, <span class=\"string\">&#x27;N/record&#x27;</span>, <span class=\"string\">&#x27;N/runtime&#x27;</span>, <span class=\"string\">&#x27;N/search&#x27;</span>],</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">error</span>&#125; <span class=\"variable\">error</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">record</span>&#125; <span class=\"variable\">record</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">runtime</span>&#125; <span class=\"variable\">runtime</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">search</span>&#125; <span class=\"variable\">search</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">error, record, runtime, search</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a GET request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">requestParams</span> - Parameters from HTTP request URL; parameters passed as an Object (for all supported</span></span><br><span class=\"line\"><span class=\"comment\">         *     content types)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">get</span> = (<span class=\"params\">requestParams</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a PUT request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string | Object</span>&#125; <span class=\"variable\">requestBody</span> - The HTTP request body; request body are passed as a string when request</span></span><br><span class=\"line\"><span class=\"comment\">         *     Content-Type is &#x27;text/plain&#x27; or parsed into an Object when request Content-Type is &#x27;application/json&#x27; (in which case</span></span><br><span class=\"line\"><span class=\"comment\">         *     the body must be a valid JSON)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">put</span> = (<span class=\"params\">requestBody</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a POST request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string | Object</span>&#125; <span class=\"variable\">requestBody</span> - The HTTP request body; request body is passed as a string when request</span></span><br><span class=\"line\"><span class=\"comment\">         *     Content-Type is &#x27;text/plain&#x27; or parsed into an Object when request Content-Type is &#x27;application/json&#x27; (in which case</span></span><br><span class=\"line\"><span class=\"comment\">         *     the body must be a valid JSON)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">post</span> = (<span class=\"params\">requestBody</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//Validate requestBody</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!requestBody.<span class=\"property\">body</span> || !requestBody.<span class=\"property\">body</span>.<span class=\"property\">location</span>||!requestBody.<span class=\"property\">body</span>.<span class=\"property\">internalid</span>||!requestBody.<span class=\"property\">body</span>.<span class=\"property\">data</span>) &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">                error.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Invalid_Post_Data&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Please check documenation for validate Post data&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">notifyOff</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> objInvCountBd = requestBody.<span class=\"property\">body</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Create Inventory Count</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> recInvCount = record.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: record.<span class=\"property\">Type</span>.<span class=\"property\">INVENTORY_COUNT</span>,</span><br><span class=\"line\">                <span class=\"attr\">isDynamic</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;location&#x27;</span>, objInvCountBd.<span class=\"property\">location</span>);</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;account&#x27;</span>, <span class=\"number\">1423</span>);</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_id&#x27;</span>, objInvCountBd.<span class=\"property\">internalid</span>);</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_user&#x27;</span>, requestBody.<span class=\"property\">user</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> arrInvCountItems = [];</span><br><span class=\"line\">            arrInvCountItems = objInvCountBd.<span class=\"property\">data</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> ln=<span class=\"number\">0</span> ; arrInvCountItems &amp;&amp; ln&lt;arrInvCountItems.<span class=\"property\">length</span>; ln++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> objInvCountItm = arrInvCountItems[ln];</span><br><span class=\"line\"></span><br><span class=\"line\">                recInvCount.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">value</span>: objInvCountItm.<span class=\"property\">item</span>,</span><br><span class=\"line\">                    <span class=\"attr\">line</span>: ln</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                recInvCount.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;binnumber&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">value</span>: objInvCountItm.<span class=\"property\">binnumber</span>, <span class=\"comment\">//20 = 2.配件库位; 23 = 1. 成品库位</span></span><br><span class=\"line\">                    <span class=\"attr\">line</span>: ln</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                arrInvCountItems[ln].<span class=\"property\">line</span> = ln;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_items&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(arrInvCountItems));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> intInvCountId = recInvCount.<span class=\"title function_\">save</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">enableSourcing</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                <span class=\"comment\">// , ignoreMandatoryFields: true</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            log.<span class=\"title function_\">audit</span>(<span class=\"string\">&#x27;ep_OperateInvCount_rl&#x27;</span>, <span class=\"string\">&#x27;Created New Inventory Count: &#x27;</span> + intInvCountId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// return &#123;</span></span><br><span class=\"line\">            <span class=\"comment\">//     code: 0,</span></span><br><span class=\"line\">            <span class=\"comment\">//     msg: &#x27;推送库存盘点单成功&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> intInvCountId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a DELETE request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">requestParams</span> - Parameters from HTTP request URL; parameters are passed as an Object (for all supported</span></span><br><span class=\"line\"><span class=\"comment\">         *     content types)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">doDelete</span> = (<span class=\"params\">requestParams</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// get: post,</span></span><br><span class=\"line\">            <span class=\"comment\">// , put,</span></span><br><span class=\"line\">            <span class=\"attr\">post</span>: post</span><br><span class=\"line\">            <span class=\"comment\">// , delete: doDelete</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Sample-Inventory-Count-User-Event\"><a href=\"#Sample-Inventory-Count-User-Event\" class=\"headerlink\" title=\"Sample Inventory Count User Event\"></a>Sample Inventory Count User Event</h2><p>根据严格限定条件, 锁定只有第一次RestLet传来的库存盘点单才进行自动化处理. “开始盘点Start Count”, 输入每个货品详细的盘点批次和数量等数据 和 “完成盘点Complete Count” 和 “审批Approve”这个四个动作action</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NApiVersion</span> 2.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NScriptType</span> <span class=\"variable\">UserEventScript</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_\">define</span>([<span class=\"string\">&#x27;N/action&#x27;</span>, <span class=\"string\">&#x27;N/error&#x27;</span>, <span class=\"string\">&#x27;N/record&#x27;</span>, <span class=\"string\">&#x27;N/runtime&#x27;</span>, <span class=\"string\">&#x27;N/search&#x27;</span>],</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">action, error, record, runtime, search</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function definition that is executed before record is loaded.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">scriptContext</span></span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.newRecord - New record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; scriptContext.type - Trigger type; use values from the context.UserEventType enum</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Form</span>&#125; scriptContext.form - Current form</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">ServletRequest</span>&#125; scriptContext.request - HTTP request information sent from the browser for a client action only.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">beforeLoad</span> = (<span class=\"params\">scriptContext</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function definition that is executed before record is submitted.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">scriptContext</span></span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.newRecord - New record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.oldRecord - Old record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; scriptContext.type - Trigger type; use values from the context.UserEventType enum</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">beforeSubmit</span> = (<span class=\"params\">scriptContext</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function definition that is executed after record is submitted.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">scriptContext</span></span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.newRecord - New record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.oldRecord - Old record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; scriptContext.type - Trigger type; use values from the context.UserEventType enum</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">afterSubmit</span> = (<span class=\"params\">scriptContext</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> currentRecord = scriptContext.<span class=\"property\">newRecord</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> intInvCountId = currentRecord.<span class=\"property\">id</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//flag for restlet API transaction</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_id&#x27;</span>))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//only available for RESTLET</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (runtime.<span class=\"property\">executionContext</span> != runtime.<span class=\"property\">ContextType</span>.<span class=\"property\">RESTLET</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;status&#x27;</span>)|| </span><br><span class=\"line\">                currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;status&#x27;</span>) == <span class=\"string\">&#x27;Open&#x27;</span> || currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;statuskey&#x27;</span>) == <span class=\"string\">&#x27;A&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                action.<span class=\"title function_\">execute</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;startcount&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">recordType</span>: currentRecord.<span class=\"property\">type</span>,</span><br><span class=\"line\">                    <span class=\"attr\">params</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">recordId</span>: currentRecord.<span class=\"property\">id</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//re-enter the quantity and count detail</span></span><br><span class=\"line\">                recInvCount = record.<span class=\"title function_\">load</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">type</span>: record.<span class=\"property\">Type</span>.<span class=\"property\">INVENTORY_COUNT</span>,</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: intInvCountId</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> strItemData = recInvCount.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_items&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> arrInvCountItems = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(strItemData);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> arrLinkedArrIdx = [];</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span> ; arrInvCountItems &amp;&amp; i&lt;arrInvCountItems.<span class=\"property\">length</span>; i++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> objInvCountItm = arrInvCountItems[i];</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> intItemId_tmp = recInvCount.<span class=\"title function_\">getSublistValue</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> intItemBin_tmp = recInvCount.<span class=\"title function_\">getSublistValue</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;binnumber&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (objInvCountItm.<span class=\"property\">item</span>!=intItemId_tmp || objInvCountItm.<span class=\"property\">binnumber</span>!=intItemBin_tmp)</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// countdetail  --------------------------</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> intQtyTtl = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> arrCountDtl = objInvCountItm.<span class=\"property\">info</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> objCountDtl = recInvCount.<span class=\"title function_\">getSublistSubrecord</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;countdetail&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> countDtlIdx=<span class=\"number\">0</span> ; arrCountDtl &amp;&amp; countDtlIdx&lt;arrCountDtl.<span class=\"property\">length</span>; countDtlIdx++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        objCountDtl.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;inventorydetail&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;inventorynumber&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">value</span>: arrCountDtl[countDtlIdx].<span class=\"property\">inventorynumber</span>,<span class=\"comment\">//&#x27;Test20250812&#x27;,</span></span><br><span class=\"line\">                            <span class=\"attr\">line</span>: countDtlIdx</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                        objCountDtl.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;inventorydetail&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;inventorystatus&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">value</span>: arrCountDtl[countDtlIdx].<span class=\"property\">inventorystatus</span>,<span class=\"comment\">//&#x27;1&#x27;,</span></span><br><span class=\"line\">                            <span class=\"attr\">line</span>: countDtlIdx</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                        objCountDtl.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;inventorydetail&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;quantity&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">value</span>: arrCountDtl[countDtlIdx].<span class=\"property\">inventorycount</span>,<span class=\"comment\">//&#x27;999&#x27;,</span></span><br><span class=\"line\">                            <span class=\"attr\">line</span>: countDtlIdx</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                        intQtyTtl = intQtyTtl + arrCountDtl[countDtlIdx].<span class=\"property\">inventorycount</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    recInvCount.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;countquantity&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">value</span>: intQtyTtl,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> intInvCountId = recInvCount.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">                log.<span class=\"title function_\">audit</span>(<span class=\"string\">&#x27;wms_invCount_ue&#x27;</span>, <span class=\"string\">&#x27;Updated New Inventory Count: &#x27;</span> + intInvCountId);</span><br><span class=\"line\"></span><br><span class=\"line\">                action.<span class=\"title function_\">execute</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;completecount&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">recordType</span>: currentRecord.<span class=\"property\">type</span>,</span><br><span class=\"line\">                    <span class=\"attr\">params</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">recordId</span>: currentRecord.<span class=\"property\">id</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                action.<span class=\"title function_\">execute</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;approve&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">recordType</span>: currentRecord.<span class=\"property\">type</span>,</span><br><span class=\"line\">                    <span class=\"attr\">params</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">recordId</span>: currentRecord.<span class=\"property\">id</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// beforeLoad, beforeSubmit,</span></span><br><span class=\"line\">            afterSubmit</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"POSTMAN及设置\"><a href=\"#POSTMAN及设置\" class=\"headerlink\" title=\"POSTMAN及设置\"></a>POSTMAN及设置</h2><p>oAuth 1.0 的设置中, 有个需要注意的地方: 把NetSuite Account ID 放到 header的 Realm 字段中. In Postman in your request tab and then in the authorization tab in the advanced section there is a field called Realm. Put the account id in the realm field with underscores.</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/08/29/68b1209347b60.png\" alt=\"image-20250829113750207\"></p>\n<h1 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h1><p>实例由于隐去所有显示应用的信息, 难免会十分偏向于技术性的探讨, 也变得比较难理解. </p>\n<p>如果您对这类对接设计或开发或应用实现等感兴趣, 可通过下方的链接(或扫码) 与我取得联系</p>\n<p>我们可以进行更加针对性的探讨与交流</p>\n<p>感谢您有耐心看到这里, 祝您生活愉快!~</p>\n<p>本文仅是思路的探讨, 如有侵权, 请<a href=\"carl.zeng@me.com\">联系作者</a>删除修改</p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>了解NetSuite库存盘点接口, 以及WMS系统对接实例</p>\n<p>学习NetSuite如果通过Restlet进行接口类设计和开发</p>\n<p>已提前隐去客户的私人信息, 本文内容不针对任何特定客户, 本文只是思路的探讨, 如有侵权, 请<a href=\"carl.zeng@me.com\">联系作者</a>删除</p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><p>把两个实例代码在NetSuite中创建脚本记录, 配置Integration Record, 让RestLet可以与外界通信</p>\n<p>抛砖引玉, 展开思路; 这一类的接口设计(或系统对接, 拓展NetSuite或外部系统功能)都可以引用参考</p>\n<p>下面的实现方法已局限于特定的应用(库存盘点), 难免会局限思维, 仅可作为一个特定的实例, 现实当中可以搭配更加灵活的设计, 让整体多系统之间实现协调, 从而达到拓展单一系统功能局限性或包容特定行业应用的特色等目的.</p>\n<p>解放人力, 高效协作(系统间, 人与人之间)</p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=netsuite\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"NetSuite-实现方法\"><a href=\"#NetSuite-实现方法\" class=\"headerlink\" title=\"NetSuite 实现方法\"></a>NetSuite 实现方法</h1><h2 id=\"Inventory-Count在Script中局限性\"><a href=\"#Inventory-Count在Script中局限性\" class=\"headerlink\" title=\"Inventory Count在Script中局限性\"></a>Inventory Count在Script中局限性</h2><h3 id=\"本身上的局限\"><a href=\"#本身上的局限\" class=\"headerlink\" title=\"本身上的局限\"></a>本身上的局限</h3><ol>\n<li><p>Inventory Count 不支持自定义表单(custom form), 但是可以新建自定义表头字段并应用到InventoryCount</p>\n</li>\n<li><p>Inventory Count 不支持显示自定义表头和列表自定义字段</p>\n</li>\n<li><p>Inventory Count 不支持保存自定义列表字段的内容(即便在Script中写入了自定义列表字段内容, 保存单据后, 自定义列表字段内容会清空消失)</p>\n</li>\n<li><p>当在点击“开始盘点Start Count” 动作之前输入货品以及详细的盘点数据, 然后在点击‘开始盘点’, 完成盘点 和审批的流程性动作, 会导致盘点的货品数据只是调增</p>\n<ol>\n<li>也就是说详细的盘点数据 不是覆盖目前系统中货品的库存数据, 而是新增添加到当前的库存数据中去.</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"流程上局限\"><a href=\"#流程上局限\" class=\"headerlink\" title=\"流程上局限\"></a>流程上局限</h3><ol>\n<li><p>创建库存盘点单. 根据现实情况输入Body上面的字段. 然后搜索或选择货品，然后选择库位和单位后即可保存(此时为‘未结’状态)</p>\n</li>\n<li><p>之后点击“开始盘点” 为‘已开始’状态后点击编辑即可输入\t盘点数量，\t输入完数量后才能点击盘点\t明细按钮打开对话框，然后输入批次号、下拉框状态、数量保存即可，此时状态下拉框\t默认只有Good - available 可用状态，输入好判断数量后点击“完成盘点”后就完成了盘点单</p>\n</li>\n<li><p>点击“完成盘点”按钮后状态就变成了\t‘已完成&#x2F;待审批’状态，\t之后就是审批流程。审批通过后就回生成一个库存调整单，就会按照原来的盘点数量来加数量审批通过\t后就\t会操作数据.  在开发过程中，接收到传过来的值后就可以立即进行一整套操作，跳过审批直接生成库存调整，执行完成后返回信息。</p>\n</li>\n</ol>\n<p>走完库存盘点单Inventory Count 需要搭配 新建保存初始单据 然后 “开始盘点Start Count” 和 “完成盘点Complete Count” 和 “审批Approve”这个四个动作action</p>\n<p>问题来了: 我们通过Reslet来接收WMS传来的库存盘单数据, 然后需要一步到位走完NetSuite的库存盘点的四个动作流程才能生效(影响货品库存和GL Impact)</p>\n<p>经过测试 “开始盘点Start Count” 和 “完成盘点Complete Count” 和 “审批Approve”这个四个动作是无法用非’N&#x2F;action’的NetSuite默认包来实现的, 然后Restlet又无法支持引用’N&#x2F;action’包.</p>\n<h2 id=\"灵活思路解决方案\"><a href=\"#灵活思路解决方案\" class=\"headerlink\" title=\"灵活思路解决方案\"></a>灵活思路解决方案</h2><p>Restlet先接收和缓存库存盘点的详细Item数据(比如批次和数量等), 然后通过另新建一个User Event Script来继续操作剩下的流程 “开始盘点Start Count”, 输入详细的盘点数量数据 和 “完成盘点Complete Count” 和 “审批Approve”</p>\n<h2 id=\"Sample-RestLet-Script\"><a href=\"#Sample-RestLet-Script\" class=\"headerlink\" title=\"Sample RestLet Script\"></a>Sample RestLet Script</h2><p>解析WMS post传来的参数, 做好数据对应后, 在把详细的盘点数据缓存在表单头的自定义字段中(custbody_wms_invcount_items), 等待下一步处理.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">// Copyright 2018, All rights reserved, Carl Notes.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// No part of this file may be copied or used without express, written</span></span><br><span class=\"line\"><span class=\"comment\">// permission of Carl Notes.</span></span><br><span class=\"line\"><span class=\"comment\">//------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">//Script: ep_OperateInvCount_rl.js</span></span><br><span class=\"line\"><span class=\"comment\">//Developer: Carl</span></span><br><span class=\"line\"><span class=\"comment\">//Date: 20250808</span></span><br><span class=\"line\"><span class=\"comment\">//Description: API REST Endpoint: Operate Inventory Count</span></span><br><span class=\"line\"><span class=\"comment\">//\t\t\t   Running in nonpaged mode, per search upto 4000 results.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// ------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NApiVersion</span> 2.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NScriptType</span> <span class=\"variable\">Restlet</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_\">define</span>([<span class=\"string\">&#x27;N/error&#x27;</span>, <span class=\"string\">&#x27;N/record&#x27;</span>, <span class=\"string\">&#x27;N/runtime&#x27;</span>, <span class=\"string\">&#x27;N/search&#x27;</span>],</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">error</span>&#125; <span class=\"variable\">error</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">record</span>&#125; <span class=\"variable\">record</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">runtime</span>&#125; <span class=\"variable\">runtime</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>&#123;<span class=\"type\">search</span>&#125; <span class=\"variable\">search</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">error, record, runtime, search</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a GET request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">requestParams</span> - Parameters from HTTP request URL; parameters passed as an Object (for all supported</span></span><br><span class=\"line\"><span class=\"comment\">         *     content types)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">get</span> = (<span class=\"params\">requestParams</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a PUT request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string | Object</span>&#125; <span class=\"variable\">requestBody</span> - The HTTP request body; request body are passed as a string when request</span></span><br><span class=\"line\"><span class=\"comment\">         *     Content-Type is &#x27;text/plain&#x27; or parsed into an Object when request Content-Type is &#x27;application/json&#x27; (in which case</span></span><br><span class=\"line\"><span class=\"comment\">         *     the body must be a valid JSON)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">put</span> = (<span class=\"params\">requestBody</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a POST request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string | Object</span>&#125; <span class=\"variable\">requestBody</span> - The HTTP request body; request body is passed as a string when request</span></span><br><span class=\"line\"><span class=\"comment\">         *     Content-Type is &#x27;text/plain&#x27; or parsed into an Object when request Content-Type is &#x27;application/json&#x27; (in which case</span></span><br><span class=\"line\"><span class=\"comment\">         *     the body must be a valid JSON)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">post</span> = (<span class=\"params\">requestBody</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//Validate requestBody</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!requestBody.<span class=\"property\">body</span> || !requestBody.<span class=\"property\">body</span>.<span class=\"property\">location</span>||!requestBody.<span class=\"property\">body</span>.<span class=\"property\">internalid</span>||!requestBody.<span class=\"property\">body</span>.<span class=\"property\">data</span>) &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">                error.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Invalid_Post_Data&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Please check documenation for validate Post data&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">notifyOff</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> objInvCountBd = requestBody.<span class=\"property\">body</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Create Inventory Count</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> recInvCount = record.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: record.<span class=\"property\">Type</span>.<span class=\"property\">INVENTORY_COUNT</span>,</span><br><span class=\"line\">                <span class=\"attr\">isDynamic</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;location&#x27;</span>, objInvCountBd.<span class=\"property\">location</span>);</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;account&#x27;</span>, <span class=\"number\">1423</span>);</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_id&#x27;</span>, objInvCountBd.<span class=\"property\">internalid</span>);</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_user&#x27;</span>, requestBody.<span class=\"property\">user</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> arrInvCountItems = [];</span><br><span class=\"line\">            arrInvCountItems = objInvCountBd.<span class=\"property\">data</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> ln=<span class=\"number\">0</span> ; arrInvCountItems &amp;&amp; ln&lt;arrInvCountItems.<span class=\"property\">length</span>; ln++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> objInvCountItm = arrInvCountItems[ln];</span><br><span class=\"line\"></span><br><span class=\"line\">                recInvCount.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">value</span>: objInvCountItm.<span class=\"property\">item</span>,</span><br><span class=\"line\">                    <span class=\"attr\">line</span>: ln</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                recInvCount.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;binnumber&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">value</span>: objInvCountItm.<span class=\"property\">binnumber</span>, <span class=\"comment\">//20 = 2.配件库位; 23 = 1. 成品库位</span></span><br><span class=\"line\">                    <span class=\"attr\">line</span>: ln</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                arrInvCountItems[ln].<span class=\"property\">line</span> = ln;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            recInvCount.<span class=\"title function_\">setValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_items&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(arrInvCountItems));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> intInvCountId = recInvCount.<span class=\"title function_\">save</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">enableSourcing</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                <span class=\"comment\">// , ignoreMandatoryFields: true</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            log.<span class=\"title function_\">audit</span>(<span class=\"string\">&#x27;ep_OperateInvCount_rl&#x27;</span>, <span class=\"string\">&#x27;Created New Inventory Count: &#x27;</span> + intInvCountId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// return &#123;</span></span><br><span class=\"line\">            <span class=\"comment\">//     code: 0,</span></span><br><span class=\"line\">            <span class=\"comment\">//     msg: &#x27;推送库存盘点单成功&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> intInvCountId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function that is executed when a DELETE request is sent to a RESTlet.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">requestParams</span> - Parameters from HTTP request URL; parameters are passed as an Object (for all supported</span></span><br><span class=\"line\"><span class=\"comment\">         *     content types)</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">string | Object</span>&#125; HTTP response body; returns a string when request Content-Type is &#x27;text/plain&#x27;; returns an</span></span><br><span class=\"line\"><span class=\"comment\">         *     Object when request Content-Type is &#x27;application/json&#x27; or &#x27;application/xml&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">doDelete</span> = (<span class=\"params\">requestParams</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// get: post,</span></span><br><span class=\"line\">            <span class=\"comment\">// , put,</span></span><br><span class=\"line\">            <span class=\"attr\">post</span>: post</span><br><span class=\"line\">            <span class=\"comment\">// , delete: doDelete</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Sample-Inventory-Count-User-Event\"><a href=\"#Sample-Inventory-Count-User-Event\" class=\"headerlink\" title=\"Sample Inventory Count User Event\"></a>Sample Inventory Count User Event</h2><p>根据严格限定条件, 锁定只有第一次RestLet传来的库存盘点单才进行自动化处理. “开始盘点Start Count”, 输入每个货品详细的盘点批次和数量等数据 和 “完成盘点Complete Count” 和 “审批Approve”这个四个动作action</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NApiVersion</span> 2.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@NScriptType</span> <span class=\"variable\">UserEventScript</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_\">define</span>([<span class=\"string\">&#x27;N/action&#x27;</span>, <span class=\"string\">&#x27;N/error&#x27;</span>, <span class=\"string\">&#x27;N/record&#x27;</span>, <span class=\"string\">&#x27;N/runtime&#x27;</span>, <span class=\"string\">&#x27;N/search&#x27;</span>],</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">action, error, record, runtime, search</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function definition that is executed before record is loaded.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">scriptContext</span></span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.newRecord - New record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; scriptContext.type - Trigger type; use values from the context.UserEventType enum</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Form</span>&#125; scriptContext.form - Current form</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">ServletRequest</span>&#125; scriptContext.request - HTTP request information sent from the browser for a client action only.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">beforeLoad</span> = (<span class=\"params\">scriptContext</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function definition that is executed before record is submitted.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">scriptContext</span></span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.newRecord - New record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.oldRecord - Old record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; scriptContext.type - Trigger type; use values from the context.UserEventType enum</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">beforeSubmit</span> = (<span class=\"params\">scriptContext</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Defines the function definition that is executed after record is submitted.</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">scriptContext</span></span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.newRecord - New record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Record</span>&#125; scriptContext.oldRecord - Old record</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; scriptContext.type - Trigger type; use values from the context.UserEventType enum</span></span><br><span class=\"line\"><span class=\"comment\">         * <span class=\"doctag\">@since</span> 2015.2</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">afterSubmit</span> = (<span class=\"params\">scriptContext</span>) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> currentRecord = scriptContext.<span class=\"property\">newRecord</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> intInvCountId = currentRecord.<span class=\"property\">id</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//flag for restlet API transaction</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_id&#x27;</span>))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//only available for RESTLET</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (runtime.<span class=\"property\">executionContext</span> != runtime.<span class=\"property\">ContextType</span>.<span class=\"property\">RESTLET</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;status&#x27;</span>)|| </span><br><span class=\"line\">                currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;status&#x27;</span>) == <span class=\"string\">&#x27;Open&#x27;</span> || currentRecord.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;statuskey&#x27;</span>) == <span class=\"string\">&#x27;A&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                action.<span class=\"title function_\">execute</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;startcount&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">recordType</span>: currentRecord.<span class=\"property\">type</span>,</span><br><span class=\"line\">                    <span class=\"attr\">params</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">recordId</span>: currentRecord.<span class=\"property\">id</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//re-enter the quantity and count detail</span></span><br><span class=\"line\">                recInvCount = record.<span class=\"title function_\">load</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">type</span>: record.<span class=\"property\">Type</span>.<span class=\"property\">INVENTORY_COUNT</span>,</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: intInvCountId</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> strItemData = recInvCount.<span class=\"title function_\">getValue</span>(<span class=\"string\">&#x27;custbody_wms_invcount_items&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> arrInvCountItems = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(strItemData);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> arrLinkedArrIdx = [];</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span> ; arrInvCountItems &amp;&amp; i&lt;arrInvCountItems.<span class=\"property\">length</span>; i++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> objInvCountItm = arrInvCountItems[i];</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> intItemId_tmp = recInvCount.<span class=\"title function_\">getSublistValue</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> intItemBin_tmp = recInvCount.<span class=\"title function_\">getSublistValue</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;binnumber&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (objInvCountItm.<span class=\"property\">item</span>!=intItemId_tmp || objInvCountItm.<span class=\"property\">binnumber</span>!=intItemBin_tmp)</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// countdetail  --------------------------</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> intQtyTtl = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> arrCountDtl = objInvCountItm.<span class=\"property\">info</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> objCountDtl = recInvCount.<span class=\"title function_\">getSublistSubrecord</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;countdetail&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> countDtlIdx=<span class=\"number\">0</span> ; arrCountDtl &amp;&amp; countDtlIdx&lt;arrCountDtl.<span class=\"property\">length</span>; countDtlIdx++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        objCountDtl.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;inventorydetail&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;inventorynumber&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">value</span>: arrCountDtl[countDtlIdx].<span class=\"property\">inventorynumber</span>,<span class=\"comment\">//&#x27;Test20250812&#x27;,</span></span><br><span class=\"line\">                            <span class=\"attr\">line</span>: countDtlIdx</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                        objCountDtl.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;inventorydetail&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;inventorystatus&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">value</span>: arrCountDtl[countDtlIdx].<span class=\"property\">inventorystatus</span>,<span class=\"comment\">//&#x27;1&#x27;,</span></span><br><span class=\"line\">                            <span class=\"attr\">line</span>: countDtlIdx</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                        objCountDtl.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;inventorydetail&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;quantity&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">value</span>: arrCountDtl[countDtlIdx].<span class=\"property\">inventorycount</span>,<span class=\"comment\">//&#x27;999&#x27;,</span></span><br><span class=\"line\">                            <span class=\"attr\">line</span>: countDtlIdx</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                        intQtyTtl = intQtyTtl + arrCountDtl[countDtlIdx].<span class=\"property\">inventorycount</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    recInvCount.<span class=\"title function_\">setSublistValue</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">sublistId</span>: <span class=\"string\">&#x27;item&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">fieldId</span>: <span class=\"string\">&#x27;countquantity&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">value</span>: intQtyTtl,</span><br><span class=\"line\">                        <span class=\"attr\">line</span>: i</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> intInvCountId = recInvCount.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">                log.<span class=\"title function_\">audit</span>(<span class=\"string\">&#x27;wms_invCount_ue&#x27;</span>, <span class=\"string\">&#x27;Updated New Inventory Count: &#x27;</span> + intInvCountId);</span><br><span class=\"line\"></span><br><span class=\"line\">                action.<span class=\"title function_\">execute</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;completecount&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">recordType</span>: currentRecord.<span class=\"property\">type</span>,</span><br><span class=\"line\">                    <span class=\"attr\">params</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">recordId</span>: currentRecord.<span class=\"property\">id</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                action.<span class=\"title function_\">execute</span>(&#123;</span><br><span class=\"line\">                    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;approve&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">recordType</span>: currentRecord.<span class=\"property\">type</span>,</span><br><span class=\"line\">                    <span class=\"attr\">params</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">recordId</span>: currentRecord.<span class=\"property\">id</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// beforeLoad, beforeSubmit,</span></span><br><span class=\"line\">            afterSubmit</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"POSTMAN及设置\"><a href=\"#POSTMAN及设置\" class=\"headerlink\" title=\"POSTMAN及设置\"></a>POSTMAN及设置</h2><p>oAuth 1.0 的设置中, 有个需要注意的地方: 把NetSuite Account ID 放到 header的 Realm 字段中. In Postman in your request tab and then in the authorization tab in the advanced section there is a field called Realm. Put the account id in the realm field with underscores.</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2025/08/29/68b1209347b60.png\" alt=\"image-20250829113750207\"></p>\n<h1 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h1><p>实例由于隐去所有显示应用的信息, 难免会十分偏向于技术性的探讨, 也变得比较难理解. </p>\n<p>如果您对这类对接设计或开发或应用实现等感兴趣, 可通过下方的链接(或扫码) 与我取得联系</p>\n<p>我们可以进行更加针对性的探讨与交流</p>\n<p>感谢您有耐心看到这里, 祝您生活愉快!~</p>\n<p>本文仅是思路的探讨, 如有侵权, 请<a href=\"carl.zeng@me.com\">联系作者</a>删除修改</p>","categories":[{"name":"NetSuite","path":"api/categories/NetSuite.json"}],"tags":[{"name":"NetSuite","path":"api/tags/NetSuite.json"},{"name":"接口","path":"api/tags/接口.json"},{"name":"Integration","path":"api/tags/Integration.json"}]}