{"title":"netsuite与首信易支付（v4.3）接口-CarlZeng","slug":"netsuite与首信易支付（v4-3）接口-CarlZeng","date":"2009-01-11T10:48:00.000Z","updated":"2023-10-08T13:38:52.659Z","comments":true,"path":"api/articles/netsuite与首信易支付（v4-3）接口-CarlZeng.json","excerpt":"问题1 ，文档中提及了 URL参数是以http://开头的完整URL地址。 而netsuite中向外开放的可用的地址都是https://，难道首信就不支持？这个问题需要与首信确认。 已答复：支持，曾经只有发现一个https无法返回的案例。说明此问题不是主要问题。问题2，步骤一， 用户从客户中心中自己下了订单后，决定支付，于是到订单页面点'前往支付'按钮，系统要传递订单信息，到suitelet来读取...","covers":null,"content":"<p>问题1 ，文档中提及了 URL参数是以http:&#x2F;&#x2F;开头的完整URL地址。 而netsuite中向外开放的可用的地址都是https:&#x2F;&#x2F;，难道首信就不支持？这个问题需要与首信确认。 已答复：支持，曾经只有发现一个https无法返回的案例。说明此问题不是主要问题。问题2，步骤一， 用户从客户中心中自己下了订单后，决定支付，于是到订单页面点’前往支付’按钮，系统要传递订单信息，到suitelet来读取…</p>\n<!-- more -->\n<p>问题1 ，文档中提及了 URL参数是以http:&#x2F;&#x2F;开头的完整URL地址。 而netsuite中向外开放的可用的地址都是https:&#x2F;&#x2F;，难道首信就不支持？这个问题需要与首信确认。 已答复：支持，曾经只有发现一个https无法返回的案例。说明此问题不是主要问题。  </p>\n<p>问题2，步骤一， 用户从客户中心中自己下了订单后，决定支付，于是到订单页面点’前往支付’按钮，系统要传递订单信息，到suitelet来读取订单的资料，并展示给客户（下方定有一个’确认支付’），内容大致如下：</p>\n<form name=form method=post  \naction=\"[http://pay.beijing.com.cn/prs/user\\_payment.checkit](http://pay.beijing.com.cn/prs/user_payment.checkit)\">  \n<input type=hidden name=v\\_mid value=\"888\"> 商户编号  \n<input type=hidden name=v\\_oid value=\"19990720-888-000001234\"> 订单编号  \n<input type=hidden name=v\\_rcvname value=\"888\"> 收货人姓名  \n<input type=hidden name=v\\_rcvaddr value=\"北京海淀\"> 收货人地址  \n<input type=hidden name=v\\_rcvtel value=\"68475566\"> 收货人电话  \n<input type=hidden name=v\\_rcvpost value=\"100036\"> 收货人邮编  \n<input type=hidden name=v\\_amount value=\"13.45\"> 订单总金额  \n<input type=hidden name=v\\_ymd value=\"19990720\"> 订单产生日期  \n<input type=hidden name=v\\_orderstatus value=\"0\"> 配货状态  \n<input type=hidden name=v\\_ordername value=\"李四\"> 订货人姓名  \n<input type=hidden name=v\\_moneytype value=\"0\"> 币种,0为人民币,1为美元  \n<input type=hidden name=v\\_url value=\"[http://domain/program](http://domain/program)\"> //支付动作完成后返回到该url，支付结果以GET方式发送  \n<input type=hidden name=v\\_md5info value=\"1630dc083d70a1e8af60f49c143a7b95\"> //订单数字指纹  \n<img data-src=\"../path/../首信易支付.gif\" width=\"150\" height=\"30\"  \nonClick=\"document.form.submit();>\"  \n</form>\n\n<p>这个时候这个页面上这些input 可以显示但是已经是不可以修改的form；一旦用户点击这个图片 submit给首信。这个步骤就完毕了，</p>\n<p>步骤二，接收返回的页面一，支付完成后页面转到商户时，从首信易支付返回的消息格式（注意，与<strong>后台接口程序文档第三部分</strong>定时发送方式使用的消息格式有<strong>区别</strong>）； 这个时候要做的事情 ，可能不是告诉netsuite已经支付成功，有可能还只是提交成功，因为首信返回了付款的方式如那家银行等等。这个时候netsuite需要记录这些信息到特定so的特定字段上，</p>\n<p>步骤三，</p>\n<p>问题3，<SCRIPT language=\"vbscript\" type=\"text/vbscript\" runat=server><br>function str2binlExpress(str) 是在md5.inc中定义的，也就是说验证的程序需要调用vbscript 这样netsuite支持吗？<br>javascript中只有Unicode转换没有ascii码转换，所以要用vbscript中的代码来实现...加了这段代码后，最好在页面中有脚本的地方都写清楚脚本语言，否则可能会出现错误。</p>\n<p>解决：c=String.fromCharCode(65)<br>---------------------------------------------------------------  </p>\n<p>str.charCodeAt(x)，表示将字符串str中的第x个字符转变成ASCII值<br>求ASCII转字符：javascript用String.fromCharCode(x);vbscript用chr(x)或chrw(x)<br>求字符转ASCII：javascript用??;vbscript用asc('字符')</p>\n<p><em>chr</em> Asc 这两个函数很难转的 ？？碰到了Asc</p>\n<p>function str2binlExpress(str)<br>result = \"\"<br>a = \"\"<br>b = 0<br>for i = 1 to len(str)  </p>\n<p>a = mid(str,i,1)<br>b = asc(a)  </p>\n<p>if b > -1 and b < 255 then<br>result = result & b & \",\"<br>end if  </p>\n<p>if b<0 then<br>result = result & int((b + 65536)/256) & \",\"<br>result = result & (b and 255) & \",\"<br>end if  </p>\n<p>if(b > 255) then<br>result = result & int((b)/256) & \",\"<br>result = result & (b and 255) & \",\"<br>end if<br>next<br>str2binlExpress = result<br>end function</p>\n<p>将被从vbscript转化为javascript 转化结果如下：</p>\n<p>function str2binlExpress(str)<br>{<br>result = \"\";<br>var a = \"\";<br>var b = 0;<br>for( var i=0; i<str.length; i++)<br>{<br>//a = mid(str,i,1); //mid 是从第i位往后的i位<br>//b = asc(a);<br>a=str.substr(i,1); //substr 是从i位往后的1位<br>b = a.charCodeAt(0); //绝对是从０开始的.  </p>\n<p>if ( b > -1 && b < 255) result = result + b + \",\" ;  </p>\n<p>if ( b<0 ) {<br>result = result + parseInt( (parseInt(b) + 65536)/256 ) + \",\"; //result = result + int((b + 65536)/256) + \",\";<br>result = result + (b & 255) + \",\" ;<br>}  </p>\n<p>if( b > 255) {<br>result = result + parseInt( b/256 ) + \",\"; //result = result + int((b)/256) + \",\";<br>result = result + (b & 255) + \",\";<br>}<br>}<br>var str2binlExpress = result;<br>//alert('str:'+str+'a:'+a+'b:'+b+'str2binlExpress:'+str2binlExpress);<br>return str2binlExpress;<br>}</p>\n<p>英文状态下是ok的，询问易支付后得知，他们都使用gb2312来校验的，我需要做的就是发送时v_rcvname涉及字符装换；接收时涉及 v_pmode 和 v_pstring的字符转化。</p>\n<p>问题4：已确认发送成功，并且银行支付成功，但是没有取得实时的返回，那么原因已排出url是带119个字符并且有参数的原因，那么需要继续测试银行支付成功以后，银行给我中转值的情况。</p>\n","more":"<p>问题1 ，文档中提及了 URL参数是以http:&#x2F;&#x2F;开头的完整URL地址。 而netsuite中向外开放的可用的地址都是https:&#x2F;&#x2F;，难道首信就不支持？这个问题需要与首信确认。 已答复：支持，曾经只有发现一个https无法返回的案例。说明此问题不是主要问题。问题2，步骤一， 用户从客户中心中自己下了订单后，决定支付，于是到订单页面点’前往支付’按钮，系统要传递订单信息，到suitelet来读取…</p>\n<!-- more -->\n<p>问题1 ，文档中提及了 URL参数是以http:&#x2F;&#x2F;开头的完整URL地址。 而netsuite中向外开放的可用的地址都是https:&#x2F;&#x2F;，难道首信就不支持？这个问题需要与首信确认。 已答复：支持，曾经只有发现一个https无法返回的案例。说明此问题不是主要问题。  </p>\n<p>问题2，步骤一， 用户从客户中心中自己下了订单后，决定支付，于是到订单页面点’前往支付’按钮，系统要传递订单信息，到suitelet来读取订单的资料，并展示给客户（下方定有一个’确认支付’），内容大致如下：</p>\n<form name=form method=post  \naction=\"[http://pay.beijing.com.cn/prs/user\\_payment.checkit](http://pay.beijing.com.cn/prs/user_payment.checkit)\">  \n<input type=hidden name=v\\_mid value=\"888\"> 商户编号  \n<input type=hidden name=v\\_oid value=\"19990720-888-000001234\"> 订单编号  \n<input type=hidden name=v\\_rcvname value=\"888\"> 收货人姓名  \n<input type=hidden name=v\\_rcvaddr value=\"北京海淀\"> 收货人地址  \n<input type=hidden name=v\\_rcvtel value=\"68475566\"> 收货人电话  \n<input type=hidden name=v\\_rcvpost value=\"100036\"> 收货人邮编  \n<input type=hidden name=v\\_amount value=\"13.45\"> 订单总金额  \n<input type=hidden name=v\\_ymd value=\"19990720\"> 订单产生日期  \n<input type=hidden name=v\\_orderstatus value=\"0\"> 配货状态  \n<input type=hidden name=v\\_ordername value=\"李四\"> 订货人姓名  \n<input type=hidden name=v\\_moneytype value=\"0\"> 币种,0为人民币,1为美元  \n<input type=hidden name=v\\_url value=\"[http://domain/program](http://domain/program)\"> //支付动作完成后返回到该url，支付结果以GET方式发送  \n<input type=hidden name=v\\_md5info value=\"1630dc083d70a1e8af60f49c143a7b95\"> //订单数字指纹  \n<img data-src=\"../path/../首信易支付.gif\" width=\"150\" height=\"30\"  \nonClick=\"document.form.submit();>\"  \n</form>\n\n<p>这个时候这个页面上这些input 可以显示但是已经是不可以修改的form；一旦用户点击这个图片 submit给首信。这个步骤就完毕了，</p>\n<p>步骤二，接收返回的页面一，支付完成后页面转到商户时，从首信易支付返回的消息格式（注意，与<strong>后台接口程序文档第三部分</strong>定时发送方式使用的消息格式有<strong>区别</strong>）； 这个时候要做的事情 ，可能不是告诉netsuite已经支付成功，有可能还只是提交成功，因为首信返回了付款的方式如那家银行等等。这个时候netsuite需要记录这些信息到特定so的特定字段上，</p>\n<p>步骤三，</p>\n<p>问题3，<SCRIPT language=\"vbscript\" type=\"text/vbscript\" runat=server><br>function str2binlExpress(str) 是在md5.inc中定义的，也就是说验证的程序需要调用vbscript 这样netsuite支持吗？<br>javascript中只有Unicode转换没有ascii码转换，所以要用vbscript中的代码来实现...加了这段代码后，最好在页面中有脚本的地方都写清楚脚本语言，否则可能会出现错误。</p>\n<p>解决：c=String.fromCharCode(65)<br>---------------------------------------------------------------  </p>\n<p>str.charCodeAt(x)，表示将字符串str中的第x个字符转变成ASCII值<br>求ASCII转字符：javascript用String.fromCharCode(x);vbscript用chr(x)或chrw(x)<br>求字符转ASCII：javascript用??;vbscript用asc('字符')</p>\n<p><em>chr</em> Asc 这两个函数很难转的 ？？碰到了Asc</p>\n<p>function str2binlExpress(str)<br>result = \"\"<br>a = \"\"<br>b = 0<br>for i = 1 to len(str)  </p>\n<p>a = mid(str,i,1)<br>b = asc(a)  </p>\n<p>if b > -1 and b < 255 then<br>result = result & b & \",\"<br>end if  </p>\n<p>if b<0 then<br>result = result & int((b + 65536)/256) & \",\"<br>result = result & (b and 255) & \",\"<br>end if  </p>\n<p>if(b > 255) then<br>result = result & int((b)/256) & \",\"<br>result = result & (b and 255) & \",\"<br>end if<br>next<br>str2binlExpress = result<br>end function</p>\n<p>将被从vbscript转化为javascript 转化结果如下：</p>\n<p>function str2binlExpress(str)<br>{<br>result = \"\";<br>var a = \"\";<br>var b = 0;<br>for( var i=0; i<str.length; i++)<br>{<br>//a = mid(str,i,1); //mid 是从第i位往后的i位<br>//b = asc(a);<br>a=str.substr(i,1); //substr 是从i位往后的1位<br>b = a.charCodeAt(0); //绝对是从０开始的.  </p>\n<p>if ( b > -1 && b < 255) result = result + b + \",\" ;  </p>\n<p>if ( b<0 ) {<br>result = result + parseInt( (parseInt(b) + 65536)/256 ) + \",\"; //result = result + int((b + 65536)/256) + \",\";<br>result = result + (b & 255) + \",\" ;<br>}  </p>\n<p>if( b > 255) {<br>result = result + parseInt( b/256 ) + \",\"; //result = result + int((b)/256) + \",\";<br>result = result + (b & 255) + \",\";<br>}<br>}<br>var str2binlExpress = result;<br>//alert('str:'+str+'a:'+a+'b:'+b+'str2binlExpress:'+str2binlExpress);<br>return str2binlExpress;<br>}</p>\n<p>英文状态下是ok的，询问易支付后得知，他们都使用gb2312来校验的，我需要做的就是发送时v_rcvname涉及字符装换；接收时涉及 v_pmode 和 v_pstring的字符转化。</p>\n<p>问题4：已确认发送成功，并且银行支付成功，但是没有取得实时的返回，那么原因已排出url是带119个字符并且有参数的原因，那么需要继续测试银行支付成功以后，银行给我中转值的情况。</p>\n","categories":[{"name":"NetSuite","path":"api/categories/NetSuite.json"}],"tags":[{"name":"NetSuite","path":"api/tags/NetSuite.json"}]}