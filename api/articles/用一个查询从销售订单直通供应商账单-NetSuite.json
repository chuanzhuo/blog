{"title":"用一个查询从销售订单直通供应商账单 NetSuite","slug":"用一个查询从销售订单直通供应商账单-NetSuite","date":"2024-04-19T02:47:35.000Z","updated":"2024-04-19T03:35:43.526Z","comments":true,"path":"api/articles/用一个查询从销售订单直通供应商账单-NetSuite.json","excerpt":" [Figure] ","covers":["https://img.carlzeng.top:3/i/2024/04/19/6621de6a99a12.png","https://img.carlzeng.top:3/i/2024/04/19/6621e21a9cc93.png","https://img.carlzeng.top:3/i/2024/04/19/6621e4126dfdf.png","https://img.carlzeng.top:3/i/2024/04/19/6621e52a1f8da.png"],"content":"<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621de6a99a12.png\" alt=\"image-20240419110043185\"></p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>用一个查询从销售订单直通供应商账单 NetSuite： 从SO销售订单，到PO采购订单，到Bill供应商账单</p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`<span class=\"keyword\">SELECT</span> Transaction.ID,</span><br><span class=\"line\">        Transaction.TranDate,</span><br><span class=\"line\">        BUILTIN.DF(Transaction.Type)  <span class=\"keyword\">AS</span> Type,</span><br><span class=\"line\">        Transaction.TranID,</span><br><span class=\"line\">        REPLACE(BUILTIN.DF(Transaction.Status), BUILTIN.DF(Transaction.Type) <span class=\"operator\">||</span> <span class=\"string\">&#x27; : &#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> Status,</span><br><span class=\"line\">        Transaction.ForeignTotal</span><br><span class=\"line\"> <span class=\"keyword\">FROM</span> Transaction</span><br><span class=\"line\"> <span class=\"keyword\">WHERE</span> Transaction.ID <span class=\"keyword\">IN</span> (</span><br><span class=\"line\">\t\t <span class=\"comment\">-- 这是第一个嵌套</span></span><br><span class=\"line\">     <span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">     <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">     <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"keyword\">in</span> (</span><br><span class=\"line\">         <span class=\"comment\">-- 这是第二个嵌套</span></span><br><span class=\"line\">         <span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">         <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">         <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"operator\">=</span> <span class=\"number\">50878826</span>)</span><br><span class=\"line\">     )</span><br><span class=\"line\">     )</span><br><span class=\"line\"> )`</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>SO销售订单，自动生成多个PO采购订单；这些设置是定义了销售货品属于Speical Order或者Drop Ship。</p>\n<p>当SO销售订单审批通过以后，这些PO采购订单就会自动生成，然后走采购流程，收货，预付款或最后供应商发账单Bill。另外一边继续走销售订单的系统及现实流程</p>\n<p>那么如何通过最起初原始的一张SO销售订单，查询到一共关联到了具体哪些供应商的账单呢？</p>\n<p>用上面那一个查询即可得出：</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621e21a9cc93.png\" alt=\"image-20240419111639828\"></p>\n<p>而它对应了系统中的多个流程和交易订单。</p>\n<h1 id=\"分析该query查询\"><a href=\"#分析该query查询\" class=\"headerlink\" title=\"分析该query查询\"></a>分析该query查询</h1><h2 id=\"最小的第二个嵌套\"><a href=\"#最小的第二个嵌套\" class=\"headerlink\" title=\"最小的第二个嵌套\"></a>最小的第二个嵌套</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"operator\">=</span> <span class=\"number\">50878826</span>)</span><br></pre></td></tr></table></figure>\n\n<p>查询哪些PO采购订单是创建于特定的SO销售订单（50878826），这借助了NetSuite中采购订单的ID是链接存储与SO销售订单的Item列表中（可通过‘Create PO’来查询）。</p>\n<p>查询系统交易的交易行表（TransactionLine），通过TransactionLine.CreatedFrom指定SO销售订单，然后向上一级查询当前交易行的系统交易&#x2F;订单ID。</p>\n<p>这个查询得到了3个PO号码：</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621e4126dfdf.png\" alt=\"image-20240419112503073\"></p>\n<h2 id=\"第一个嵌套\"><a href=\"#第一个嵌套\" class=\"headerlink\" title=\"第一个嵌套\"></a>第一个嵌套</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">    <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"keyword\">in</span> (</span><br><span class=\"line\">        <span class=\"comment\">-- 这是第二个嵌套</span></span><br><span class=\"line\">        <span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">        <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">        <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"operator\">=</span> <span class=\"number\">50878826</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n\n<p>这个查询其实已经查到供应商的账单了，</p>\n<p>原理是通过已知的PO采购订单，来查询哪些交易是创建自这些PO采购订单的，而Bill供应商账单就是创建自PO采购订单的，而且他们二者通过CreatedFrom来链接。</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621e52a1f8da.png\" alt=\"image-20240419112939609\"></p>\n<h2 id=\"最上级查询\"><a href=\"#最上级查询\" class=\"headerlink\" title=\"最上级查询\"></a>最上级查询</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> Transaction.ID,</span><br><span class=\"line\">        Transaction.TranDate,</span><br><span class=\"line\">        BUILTIN.DF(Transaction.Type)  <span class=\"keyword\">AS</span> Type,</span><br><span class=\"line\">        Transaction.TranID,</span><br><span class=\"line\">        REPLACE(BUILTIN.DF(Transaction.Status), BUILTIN.DF(Transaction.Type) <span class=\"operator\">||</span> <span class=\"string\">&#x27; : &#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> Status,</span><br><span class=\"line\">        Transaction.ForeignTotal</span><br><span class=\"line\"> <span class=\"keyword\">FROM</span> Transaction</span><br><span class=\"line\"> <span class=\"keyword\">WHERE</span> Transaction.ID <span class=\"keyword\">IN</span> (</span><br><span class=\"line\"> <span class=\"comment\">--  ...</span></span><br><span class=\"line\"> )</span><br></pre></td></tr></table></figure>\n\n<p>该最上级查询是用于输出用户友好的结果，比如一个NS系统内部的链接（当然也可以挂一个SuiteLet链接下一步交易事务处理）</p>\n<p>这是一个非常灵活的应用query的例子，可以无限延展出很多实例和应用，如果你有什么想法，欢迎留言或<a href=\"https://calendly.com/carlzeng/30min\">meeting</a></p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=netsuite\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://timdietrich.me/blog/netsuite-suiteql-related-transactions-revisited/\">NetSuite: SuiteQL and Related Transactions (Revisited)</a></p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">朗读全文</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>用一个查询从销售订单直通供应商账单 NetSuite： 从SO销售订单，到PO采购订单，到Bill供应商账单</p>\n<h1 id=\"怎么用\"><a href=\"#怎么用\" class=\"headerlink\" title=\"怎么用\"></a>怎么用</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`<span class=\"keyword\">SELECT</span> Transaction.ID,</span><br><span class=\"line\">        Transaction.TranDate,</span><br><span class=\"line\">        BUILTIN.DF(Transaction.Type)  <span class=\"keyword\">AS</span> Type,</span><br><span class=\"line\">        Transaction.TranID,</span><br><span class=\"line\">        REPLACE(BUILTIN.DF(Transaction.Status), BUILTIN.DF(Transaction.Type) <span class=\"operator\">||</span> <span class=\"string\">&#x27; : &#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> Status,</span><br><span class=\"line\">        Transaction.ForeignTotal</span><br><span class=\"line\"> <span class=\"keyword\">FROM</span> Transaction</span><br><span class=\"line\"> <span class=\"keyword\">WHERE</span> Transaction.ID <span class=\"keyword\">IN</span> (</span><br><span class=\"line\">\t\t <span class=\"comment\">-- 这是第一个嵌套</span></span><br><span class=\"line\">     <span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">     <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">     <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"keyword\">in</span> (</span><br><span class=\"line\">         <span class=\"comment\">-- 这是第二个嵌套</span></span><br><span class=\"line\">         <span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">         <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">         <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"operator\">=</span> <span class=\"number\">50878826</span>)</span><br><span class=\"line\">     )</span><br><span class=\"line\">     )</span><br><span class=\"line\"> )`</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>SO销售订单，自动生成多个PO采购订单；这些设置是定义了销售货品属于Speical Order或者Drop Ship。</p>\n<p>当SO销售订单审批通过以后，这些PO采购订单就会自动生成，然后走采购流程，收货，预付款或最后供应商发账单Bill。另外一边继续走销售订单的系统及现实流程</p>\n<p>那么如何通过最起初原始的一张SO销售订单，查询到一共关联到了具体哪些供应商的账单呢？</p>\n<p>用上面那一个查询即可得出：</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621e21a9cc93.png\" alt=\"image-20240419111639828\"></p>\n<p>而它对应了系统中的多个流程和交易订单。</p>\n<h1 id=\"分析该query查询\"><a href=\"#分析该query查询\" class=\"headerlink\" title=\"分析该query查询\"></a>分析该query查询</h1><h2 id=\"最小的第二个嵌套\"><a href=\"#最小的第二个嵌套\" class=\"headerlink\" title=\"最小的第二个嵌套\"></a>最小的第二个嵌套</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"operator\">=</span> <span class=\"number\">50878826</span>)</span><br></pre></td></tr></table></figure>\n\n<p>查询哪些PO采购订单是创建于特定的SO销售订单（50878826），这借助了NetSuite中采购订单的ID是链接存储与SO销售订单的Item列表中（可通过‘Create PO’来查询）。</p>\n<p>查询系统交易的交易行表（TransactionLine），通过TransactionLine.CreatedFrom指定SO销售订单，然后向上一级查询当前交易行的系统交易&#x2F;订单ID。</p>\n<p>这个查询得到了3个PO号码：</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621e4126dfdf.png\" alt=\"image-20240419112503073\"></p>\n<h2 id=\"第一个嵌套\"><a href=\"#第一个嵌套\" class=\"headerlink\" title=\"第一个嵌套\"></a>第一个嵌套</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">    <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"keyword\">in</span> (</span><br><span class=\"line\">        <span class=\"comment\">-- 这是第二个嵌套</span></span><br><span class=\"line\">        <span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> TransactionLine.Transaction</span><br><span class=\"line\">        <span class=\"keyword\">FROM</span> TransactionLine</span><br><span class=\"line\">        <span class=\"keyword\">WHERE</span> (TransactionLine.CreatedFrom <span class=\"operator\">=</span> <span class=\"number\">50878826</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n\n<p>这个查询其实已经查到供应商的账单了，</p>\n<p>原理是通过已知的PO采购订单，来查询哪些交易是创建自这些PO采购订单的，而Bill供应商账单就是创建自PO采购订单的，而且他们二者通过CreatedFrom来链接。</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/19/6621e52a1f8da.png\" alt=\"image-20240419112939609\"></p>\n<h2 id=\"最上级查询\"><a href=\"#最上级查询\" class=\"headerlink\" title=\"最上级查询\"></a>最上级查询</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> Transaction.ID,</span><br><span class=\"line\">        Transaction.TranDate,</span><br><span class=\"line\">        BUILTIN.DF(Transaction.Type)  <span class=\"keyword\">AS</span> Type,</span><br><span class=\"line\">        Transaction.TranID,</span><br><span class=\"line\">        REPLACE(BUILTIN.DF(Transaction.Status), BUILTIN.DF(Transaction.Type) <span class=\"operator\">||</span> <span class=\"string\">&#x27; : &#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> Status,</span><br><span class=\"line\">        Transaction.ForeignTotal</span><br><span class=\"line\"> <span class=\"keyword\">FROM</span> Transaction</span><br><span class=\"line\"> <span class=\"keyword\">WHERE</span> Transaction.ID <span class=\"keyword\">IN</span> (</span><br><span class=\"line\"> <span class=\"comment\">--  ...</span></span><br><span class=\"line\"> )</span><br></pre></td></tr></table></figure>\n\n<p>该最上级查询是用于输出用户友好的结果，比如一个NS系统内部的链接（当然也可以挂一个SuiteLet链接下一步交易事务处理）</p>\n<p>这是一个非常灵活的应用query的例子，可以无限延展出很多实例和应用，如果你有什么想法，欢迎留言或<a href=\"https://calendly.com/carlzeng/30min\">meeting</a></p>\n<h1 id=\"相关内容\"><a href=\"#相关内容\" class=\"headerlink\" title=\"相关内容\"></a>相关内容</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=netsuite\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n\n<h1 id=\"灵感来源\"><a href=\"#灵感来源\" class=\"headerlink\" title=\"灵感来源\"></a>灵感来源</h1><p><a href=\"https://timdietrich.me/blog/netsuite-suiteql-related-transactions-revisited/\">NetSuite: SuiteQL and Related Transactions (Revisited)</a></p>","categories":[{"name":"用一个查询从销售订单直通供应商账单 NetSuite","path":"api/categories/用一个查询从销售订单直通供应商账单 NetSuite.json"}],"tags":[{"name":"NetSuite","path":"api/tags/NetSuite.json"},{"name":"query","path":"api/tags/query.json"}]}