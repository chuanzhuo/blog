{"title":"Docker搭建自动售货系统-独角数卡","slug":"Docker搭建自动售货系统-独角数卡","date":"2023-11-20T08:54:57.000Z","updated":"2024-10-25T14:42:55.562Z","comments":true,"path":"api/articles/Docker搭建自动售货系统-独角数卡.json","excerpt":" [Figure] 自动售货系统-独角数卡 dujiaoka","covers":["https://www.evernote.com/shard/s122/sh/28cd0f84-7b75-402b-a78b-0fdbc30e7615/0Vihl8lVbSwR84f1sWlHCWkZdwVZjcmThrHc-x0gAzbTvCrzNM1ztoXh0g/deep/0/image.png"],"content":"<img class=\"lozad\" data-src=\"https://www.evernote.com/shard/s122/sh/28cd0f84-7b75-402b-a78b-0fdbc30e7615/0Vihl8lVbSwR84f1sWlHCWkZdwVZjcmThrHc-x0gAzbTvCrzNM1ztoXh0g/deep/0/image.png\">\n自动售货系统-独角数卡 dujiaoka\n<span id=\"more\"></span>\n\n<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>自动售货系统-独角数卡<br>尝试按教材和视频搭建失败了（详见章节：搭建失败的历史记录），<br>鼓起勇气，重新选用新的方案：<a href=\"https://blog.dov.moe/posts/49102/\">https://blog.dov.moe/posts/49102/</a></p>\n<p>举个🌰例子：<a href=\"https://dovshop.net/\">https://dovshop.net/</a></p>\n<p><a href=\"https://ayangshop.com/buy/38\">https://ayangshop.com/buy/38</a></p>\n<div class=\"note danger\"><p>由于本人无法解决，反代以后的页面中链接没有自动携带端口好问题。放弃使用。</p>\n</div>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /www/server/panel/data/compose/dujiaoka/template</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir Shop &amp;&amp; cd Shop</span><br><span class=\"line\">mkdir storage uploads</span><br><span class=\"line\">chmod 777 storage uploads</span><br><span class=\"line\">❗注意此处文件夹权限一定要给！</span><br><span class=\"line\"></span><br><span class=\"line\">chmod -R 777 env.conf</span><br><span class=\"line\"># 重要步骤</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  faka:</span><br><span class=\"line\">    image: ghcr.io/apocalypsor/dujiaoka:latest</span><br><span class=\"line\">    <span class=\"comment\"># 国内服务器可以用 hkccr.ccs.tencentyun.com/apocalypsor/dujiaoka:latest</span></span><br><span class=\"line\">    container_name: faka</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        <span class=\"comment\"># - INSTALL=false</span></span><br><span class=\"line\">        - <span class=\"attr\">INSTALL</span>=<span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># - MODIFY=true</span></span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./env.conf:/dujiaoka/.env</span><br><span class=\"line\">      - ./uploads:/dujiaoka/public/uploads</span><br><span class=\"line\">      - ./storage:/dujiaoka/storage</span><br><span class=\"line\">      - ./start-hook.sh:/dujiaoka/start-hook.sh</span><br><span class=\"line\">      <span class=\"comment\"># 网站图标 32X32 favicon.ico 4kb，默认模版只需第一处，其他模版需要第二处</span></span><br><span class=\"line\">\t  <span class=\"comment\">#- ./favicon.ico:/dujiaoka/public/favicon.ico:ro</span></span><br><span class=\"line\">\t  <span class=\"comment\">#- ./favicon.ico:/dujiaoka/public/assets/style/favicon.ico:ro</span></span><br><span class=\"line\">\t  <span class=\"comment\"># 默认商品图片 512x512 default.jpg 18kb（网站 LOGO 共享此图，与后台自定义 LOGO 和商品图片不冲突）</span></span><br><span class=\"line\">\t  <span class=\"comment\"># - ./default.png:/dujiaoka/public/assets/common/images/default.jpg:ro</span></span><br><span class=\"line\">\t  <span class=\"comment\"># Luna 主题网站背景 1920x1224 background.png 198kb</span></span><br><span class=\"line\">\t  <span class=\"comment\">#- ./background.png:/dujiaoka/public/assets/luna/img/background.png:ro</span></span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 4444:80</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\"> </span><br><span class=\"line\">  db:</span><br><span class=\"line\">    image: mariadb:focal</span><br><span class=\"line\">    container_name: faka-data</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_ROOT_PASSWORD</span>=mariadb</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_DATABASE</span>=dujiaoka</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_USER</span>=dujiaoka</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_PASSWORD</span>=dujiaokapassword</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./data:/var/lib/mysql</span><br><span class=\"line\"></span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    image: redis:alpine</span><br><span class=\"line\">    container_name: faka-redis</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./redis:/data</span><br></pre></td></tr></table></figure>\n\n<p>编辑 .env 文件</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">APP_NAME</span>=Carl的小店</span><br><span class=\"line\"><span class=\"attr\">APP_ENV</span>=local</span><br><span class=\"line\"><span class=\"attr\">APP_KEY</span>=base64:hDVkYhfkUjaePiaI1tcBT7G8bh2A8RQxwWIGkq7BO18=</span><br><span class=\"line\"><span class=\"attr\">APP_DEBUG</span>=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">APP_URL</span>=http://<span class=\"number\">192.168</span>.<span class=\"number\">6.116</span>:<span class=\"number\">4444</span></span><br><span class=\"line\"><span class=\"comment\">#ADMIN_HTTPS=true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">LOG_CHANNEL</span>=stack</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据库配置</span></span><br><span class=\"line\"><span class=\"attr\">DB_CONNECTION</span>=mysql</span><br><span class=\"line\"><span class=\"attr\">DB_HOST</span>=db</span><br><span class=\"line\"><span class=\"attr\">DB_PORT</span>=<span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">DB_DATABASE</span>=dujiaoka</span><br><span class=\"line\"><span class=\"attr\">DB_USERNAME</span>=dujiaoka</span><br><span class=\"line\"><span class=\"attr\">DB_PASSWORD</span>=dujiaokapassword</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># redis 配置</span></span><br><span class=\"line\"><span class=\"attr\">REDIS_HOST</span>=redis</span><br><span class=\"line\"><span class=\"attr\">REDIS_PASSWORD</span>=</span><br><span class=\"line\"><span class=\"attr\">REDIS_PORT</span>=<span class=\"number\">6379</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">BROADCAST_DRIVER</span>=log</span><br><span class=\"line\"><span class=\"attr\">SESSION_DRIVER</span>=file</span><br><span class=\"line\"><span class=\"attr\">SESSION_LIFETIME</span>=<span class=\"number\">120</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 缓存配置</span></span><br><span class=\"line\"><span class=\"comment\"># file 为磁盘文件  redis 为内存级别</span></span><br><span class=\"line\"><span class=\"comment\"># redis 为内存需要安装好 redis 服务端并配置</span></span><br><span class=\"line\"><span class=\"attr\">CACHE_DRIVER</span>=redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 异步消息队列</span></span><br><span class=\"line\"><span class=\"comment\"># sync 为同步  redis 为异步</span></span><br><span class=\"line\"><span class=\"comment\"># 使用 redis 异步需要安装好 redis 服务端并配置</span></span><br><span class=\"line\"><span class=\"attr\">QUEUE_CONNECTION</span>=redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 后台语言</span></span><br><span class=\"line\"><span class=\"comment\">## zh_CN 简体中文</span></span><br><span class=\"line\"><span class=\"comment\">## zh_TW 繁体中文</span></span><br><span class=\"line\"><span class=\"comment\">## en    英文</span></span><br><span class=\"line\"><span class=\"attr\">DUJIAO_ADMIN_LANGUAGE</span>=zh_CN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 后台登录地址</span></span><br><span class=\"line\"><span class=\"attr\">ADMIN_ROUTE_PREFIX</span>=/admin</span><br></pre></td></tr></table></figure>\n\n<p>一直无法下载成功……<br>修改使用：stilleshan&#x2F;dujiaoka</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose+如何使用代理提速</span><br><span class=\"line\">\t\thttps://neucrack.com/p/286</span><br><span class=\"line\">\tworkaournd：手动让OpenClash不停在线（不在线就重新刷新取获取最新节点信息）</span><br></pre></td></tr></table></figure>\n\n<p>终于下载成功后，启动失败</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error mounting &quot;/www/server/panel/data/compose/dujiaoka/template/Shop/favicon.ico&quot; to rootfs at &quot;/dujiaoka/public/favicon.ico&quot;: mount /www/server/panel/data/compose/dujiaoka/template/Shop/favicon.ico:/dujiaoka/public/favicon.ico (via /proc/self/fd/6), flags: 0x5001: not a directory: unknown: Are you trying to mount a directory onto a file (or vice-versa)? Check if the specified host path exists and is the expected type</span><br></pre></td></tr></table></figure>\n<p>注释掉那几个自定义的文件映射，就好了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">faka        | The environment file is invalid!</span><br><span class=\"line\">faka        | Failed to parse dotenv file due to unexpected whitespace. Failed at [Carl Shop].</span><br></pre></td></tr></table></figure>\n<p>返回修改把前后加上引号。</p>\n<p>修改了端口映射出4444后，错误：<br>500<br>Server Error</p>\n<p>❗注意环境变量如果写的不对可能导致 500，可以开 APP_DEBUG&#x3D;true 看看具体是哪里写错了。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   throw new RuntimeException(&#x27;The only supported ciphers are AES-128-CBC and AES-256-CBC with the correct key lengths.&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">解决办法：修改APP_KEY=base64:hDVkYhfkUjaePiaI1tcBT7G8bh2A8RQxwWIGkq7BO18=</span><br><span class=\"line\">--------------</span><br><span class=\"line\"></span><br><span class=\"line\">file_put_contents(/dujiaoka/.env): failed to open stream: Permission denied</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>本地访问成功：<a href=\"http://192.168.6.116:4444/\">http://192.168.6.116:4444</a></p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://hub.docker.com/r/stilleshan/dujiaoka\">https://hub.docker.com/r/stilleshan/dujiaoka</a><br><a href=\"https://hub.docker.com/r/jiangjuhong/dujiaoka\">https://hub.docker.com/r/jiangjuhong/dujiaoka</a></p>\n<h2 id=\"搭配frpc\"><a href=\"#搭配frpc\" class=\"headerlink\" title=\"搭配frpc\"></a>搭配frpc</h2><p>20231203 NPM反代失败，几周后；终于找到解决方案了：发现可以用frpc反代出去就好</p>\n<p>配置完成frpc -c frpc.ini， 可是依旧是点击的链接没有携带端口号；非常郁闷</p>\n<hr>\n<hr>\n<h1 id=\"搭建失败的历史记录\"><a href=\"#搭建失败的历史记录\" class=\"headerlink\" title=\"搭建失败的历史记录\"></a>搭建失败的历史记录</h1><p>独角数卡<br>开源式站长自动化售货解决方案、高效、稳定、快速！</p>\n<p>徒手搭建独角数发卡网站 经营自己的小店！ - 六月 26, 2023<br><a href=\"https://kejilion.blogspot.com/2023/06/blog-post_26.html\">https://kejilion.blogspot.com/2023/06/blog-post_26.html</a></p>\n<p>配置docker-compose<br><a href=\"https://github.com/kejilion/docker/blob/main/LNMP-docker-compose.yml\">https://github.com/kejilion/docker/blob/main/LNMP-docker-compose.yml</a></p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;3.8&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  nginx:</span><br><span class=\"line\">    image: nginx:1.22</span><br><span class=\"line\">    container_name: nginx</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 882:80</span><br><span class=\"line\">      - 4444:443      </span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./nginx.conf:/etc/nginx/nginx.conf</span><br><span class=\"line\">      - ./certs:/etc/nginx/certs      </span><br><span class=\"line\">      - ./html:/var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\">  php:</span><br><span class=\"line\">    image: php:7.4.33-fpm</span><br><span class=\"line\">    container_name: php</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./html:/var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    image: mysql:5.7.42</span><br><span class=\"line\">    container_name: mysql</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./mysql:/var/lib/mysql</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_ROOT_PASSWORD</span>=webroot</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_DATABASE</span>=web</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_USER</span>=carlZeng</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_PASSWORD</span>=carlZengYYDS</span><br><span class=\"line\"></span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    image: redis:latest</span><br><span class=\"line\">    container_name: redis</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./redis:/data</span><br></pre></td></tr></table></figure>\n<p>修改了独角数卡的端口</p>\n<p>申请证书, 下载证书;</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">直接去NPM中下载证书解压缩后重命名放到debian的目录：</span><br><span class=\"line\">/home/web/certs</span><br><span class=\"line\">    key.pem</span><br><span class=\"line\">    cert.pem</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>继续配置nginx.conf</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections 1024<span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    include       /etc/nginx/mime.types<span class=\"comment\">;</span></span><br><span class=\"line\">    default_type  application/octet-stream<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on<span class=\"comment\">;</span></span><br><span class=\"line\">    keepalive_timeout  65<span class=\"comment\">;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    client_max_body_size 1000m<span class=\"comment\">;  </span></span><br><span class=\"line\">    <span class=\"comment\">#上传限制参数1G以内文件可上传</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HTTP server</span></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 80<span class=\"comment\">;</span></span><br><span class=\"line\">        server_name shop.carlzeng.com<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Redirect all HTTP requests to HTTPS</span></span><br><span class=\"line\">        return 301 https://$host$request_uri<span class=\"comment\">;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HTTPS server</span></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 443 ssl http2<span class=\"comment\">;</span></span><br><span class=\"line\">        server_name shop.carlzeng.com<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># http2 on;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">        ssl_certificate /etc/nginx/certs/cert.pem<span class=\"comment\">;</span></span><br><span class=\"line\">        ssl_certificate_key /etc/nginx/certs/key.pem<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        root /var/www/html/dujiaoka/public/<span class=\"comment\">;</span></span><br><span class=\"line\">        index index.php<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        try_files $uri $uri/ /index.php?$query_string<span class=\"comment\">;    </span></span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># PHP-FPM configuration</span></span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">            fastcgi_pass php:9000<span class=\"comment\">;</span></span><br><span class=\"line\">            fastcgi_index index.php<span class=\"comment\">;</span></span><br><span class=\"line\">            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name<span class=\"comment\">;</span></span><br><span class=\"line\">            include fastcgi_params<span class=\"comment\">;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>cd &#x2F;home&#x2F;web&#x2F;html &amp;&amp; wget <a href=\"https://ghproxy.com/https://github.com/assimon/dujiaoka/releases/download/2.0.6/2.0.6-antibody.tar.gz\">https://ghproxy.com/https://github.com/assimon/dujiaoka/releases/download/2.0.6/2.0.6-antibody.tar.gz</a> &amp;&amp; apt install -y tar &amp;&amp; tar -zxvf 2.0.6-antibody.tar.gz &amp;&amp; rm 2.0.6-antibody.tar.gz</p>\n<p>安装PHP扩展</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec php apt update &amp;&amp; docker exec php apt install -y libmariadb-dev-compat libmariadb-dev libzip-dev libmagickwand-dev imagemagick</span><br><span class=\"line\"></span><br><span class=\"line\">卡死在这一步，分解如下：</span><br><span class=\"line\">    docker exec php apt install -y libmariadb-dev-compat</span><br><span class=\"line\">    docker exec php apt install -y libmariadb-dev</span><br><span class=\"line\">    docker exec php apt install -y libzip-dev</span><br><span class=\"line\">    docker exec php apt install -y libmagickwand-dev</span><br><span class=\"line\">        libmagickwand-dev is already the newest version (8:6.9.11.60+dfsg-1.3+deb11u1).</span><br><span class=\"line\">    docker exec php apt install -y imagemagick</span><br><span class=\"line\">        Build process completed successfully</span><br><span class=\"line\">        Installing &#x27;/usr/local/lib/php/extensions/no-debug-non-zts-20190902/redis.so&#x27;</span><br><span class=\"line\">        install ok: channel://pecl.php.net/redis-6.0.2</span><br><span class=\"line\">        configuration option &quot;php_ini&quot; is not set to php.ini location</span><br><span class=\"line\">        You should add &quot;extension=redis.so&quot; to php.ini</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">docker exec php docker-php-ext-install pdo_mysql zip bcmath gd intl opcache &amp;&amp; docker exec php pecl install redis &amp;&amp; docker exec php sh -c &#x27;echo &quot;extension=redis.so&quot; &gt; /usr/local/etc/php/conf.d/docker-php-ext-redis.ini&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>如果登录时报错再使用该命令，解除HTTPS限制</p>\n<p>sed -i ‘s&#x2F;ADMIN_HTTPS&#x3D;false&#x2F;ADMIN_HTTPS&#x3D;true&#x2F;g’ &#x2F;home&#x2F;web&#x2F;html&#x2F;dujiaoka&#x2F;.env</p>\n<p>错误以及解决办法<br>不同时期再网页页面，点击安装后出现的错误</p>\n<h4 id=\"数据库配置错误-could-not-find-driver-SQL-select-1-limit-1\"><a href=\"#数据库配置错误-could-not-find-driver-SQL-select-1-limit-1\" class=\"headerlink\" title=\"数据库配置错误 :could not find driver (SQL: select 1 limit 1)\"></a>数据库配置错误 :could not find driver (SQL: select 1 limit 1)</h4><pre><code>解决：修改了nginx.conf，确保80和443端口（docker中的端口占用，默认即可）\n确认了php docker中的PHP扩展，确保所有插件都安装成功\n</code></pre>\n<h3 id=\"Redis配置错误-php-network-getaddresses-getaddrinfo-failed-Name-or-service-not-known\"><a href=\"#Redis配置错误-php-network-getaddresses-getaddrinfo-failed-Name-or-service-not-known\" class=\"headerlink\" title=\"Redis配置错误 :php_network_getaddresses: getaddrinfo failed: Name or service not known\"></a>Redis配置错误 :php_network_getaddresses: getaddrinfo failed: Name or service not known</h3><pre><code>解决：sed -i &#39;s/ADMIN_HTTPS=false/ADMIN_HTTPS=true/g&#39; /home/web/html/dujiaoka/.env\n核查了php docker中 安装PHP拓展部分于redis相关的；\ndocker-php-ext-redis.ini（已包含内容：extension=redis.so）\n\n原来是redis 写成了radis，纠正后重试\n</code></pre>\n<h3 id=\"数据库配置错误-SQLSTATE-HY000-1045-Access-denied-for-user-‘carlZEng‘-’172-24-0-5’-using-password-YES-SQL-select-1-limit-1\"><a href=\"#数据库配置错误-SQLSTATE-HY000-1045-Access-denied-for-user-‘carlZEng‘-’172-24-0-5’-using-password-YES-SQL-select-1-limit-1\" class=\"headerlink\" title=\"数据库配置错误 :SQLSTATE[HY000] [1045] Access denied for user ‘carlZEng‘@’172.24.0.5’ (using password: YES) (SQL: select 1 limit 1)\"></a>数据库配置错误 :SQLSTATE[HY000] [1045] Access denied for user ‘carlZEng‘@’172.24.0.5’ (using password: YES) (SQL: select 1 limit 1)</h3><pre><code>解决：MySQL用户名填写错误，纠正后重试\n</code></pre>\n<h4 id=\"数据库配置错误-could-not-find-driver-SQL-select-1-limit-1-1\"><a href=\"#数据库配置错误-could-not-find-driver-SQL-select-1-limit-1-1\" class=\"headerlink\" title=\"数据库配置错误 :could not find driver (SQL: select 1 limit 1)\"></a>数据库配置错误 :could not find driver (SQL: select 1 limit 1)</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">解决：</span><br><span class=\"line\">检测：docker exec -it php php -i |grep mysqlnd  排查是否启用了mysql驱动</span><br><span class=\"line\">    mysqlnd</span><br><span class=\"line\">    mysqlnd =&gt; enabled</span><br><span class=\"line\">    Version =&gt; mysqlnd 7.4.3</span><br><span class=\"line\"></span><br><span class=\"line\">docker exec -it php /bin/bash</span><br><span class=\"line\">docker-php-ext-install pdo pdo_mysql</span><br><span class=\"line\">docker-compose restart php</span><br><span class=\"line\"></span><br><span class=\"line\">这个好像没有被永久保存住，这导致每次docker-compose restart php都会出现这个错误,</span><br><span class=\"line\">按照上面解决好以后，紧接着就是下面这个Redis错误</span><br><span class=\"line\"></span><br><span class=\"line\">这次是修正后，最后是通过docker restart php 解决了错误</span><br><span class=\"line\">测试 docker-compose restart 会不会把数据在继续破坏了，重新拉取？</span><br><span class=\"line\">    也是正常的！ 那下一次怎么办？继续如此修复即可</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Please-make-sure-the-PHP-Redis-extension-is-installed-and-enabled\"><a href=\"#Please-make-sure-the-PHP-Redis-extension-is-installed-and-enabled\" class=\"headerlink\" title=\"Please make sure the PHP Redis extension is installed and enabled.\"></a>Please make sure the PHP Redis extension is installed and enabled.</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it php /bin/bash</span><br><span class=\"line\">pecl install redis</span><br><span class=\"line\">    checking for igbinary includes... configure: error: Cannot find igbinary.h</span><br><span class=\"line\">        ERROR: `/tmp/pear/temp/redis/configure --with-php-config=/usr/local/bin/php-config --enable-redis-igbinary=yes --enable-redis-lzf=yes --enable-redis-zstd=yes --enable-redis-msgpack=yes --enable-redis-lz4=yes --with-liblz4&#x27; failed</span><br><span class=\"line\">Build process completed successfully</span><br><span class=\"line\">Installing &#x27;/usr/local/lib/php/extensions/no-debug-non-zts-20190902/redis.so&#x27;</span><br><span class=\"line\">install ok: channel://pecl.php.net/redis-6.0.2</span><br><span class=\"line\">configuration option &quot;php_ini&quot; is not set to php.ini location</span><br><span class=\"line\">You should add &quot;extension=redis.so&quot; to php.ini</span><br><span class=\"line\"></span><br><span class=\"line\">解决：docker exec php docker-php-ext-install pdo_mysql zip bcmath gd intl opcache &amp;&amp; docker exec php pecl install redis &amp;&amp; docker exec php sh -c &#x27;echo &quot;extension=redis.so&quot; &gt; /usr/local/etc/php/conf.d/docker-php-ext-redis.ini&#x27;</span><br><span class=\"line\">解决分解，并逐一确认执行成功</span><br><span class=\"line\">    docker exec -it php /bin/bash</span><br><span class=\"line\">        docker-php-ext-install pdo_mysql zip bcmath gd intl opcache</span><br><span class=\"line\">        pecl install redis</span><br><span class=\"line\">        sh -c &#x27;echo &quot;extension=redis.so&quot; &gt; /usr/local/etc/php/conf.d/docker-php-ext-redis.ini&#x27;</span><br><span class=\"line\">在 bash 下，一一执行，检查结果</span><br><span class=\"line\"></span><br><span class=\"line\">最后，需要docker-compose restart</span><br><span class=\"line\">之前都是重启php容器docker restart php 无法解决问题。需要的是：docker-compose restart</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0-error\"><a href=\"#0-error\" class=\"headerlink\" title=\"0 error\"></a>0 error</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">安装成功后 redirect https://192.168.6.116:4444/admin/auth/login</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">后台登录出现0err或者其他登录异常问题，大概率是开启了https而后台没有开启，把下面的<span class=\"literal\">false</span>改为<span class=\"literal\">true</span>即可</span></span><br><span class=\"line\">ADMIN_HTTPS=false</span><br><span class=\"line\">解决：sed -i &#x27;s/ADMIN_HTTPS=false/ADMIN_HTTPS=true/g&#x27; /home/web/html/dujiaoka/.env</span><br><span class=\"line\"></span><br><span class=\"line\">成功了，本地局域网可访问。</span><br><span class=\"line\">下一步是为何无法NPM反代https://192.168.6.116:4444</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"outstanding-创建订单出错-Symfony-Component-Debug-Exception-FatalThrowableError\"><a href=\"#outstanding-创建订单出错-Symfony-Component-Debug-Exception-FatalThrowableError\" class=\"headerlink\" title=\"[outstanding]创建订单出错 Symfony\\Component\\Debug\\Exception\\FatalThrowableError\"></a>[outstanding]创建订单出错 Symfony\\Component\\Debug\\Exception\\FatalThrowableError</h4><pre><code>Call to undefined function App\\Service\\bcmul()\nhttps://192.168.6.116:4444/create-order\n</code></pre>\n<h4 id=\"outstanding-npm更换二级域名后反代成功-https-buy-carlzeng-com-4443-导致问题：所有的图片那些指向的链接-没有加端口号，导致图片全部失效-buy链接也没有端口号…\"><a href=\"#outstanding-npm更换二级域名后反代成功-https-buy-carlzeng-com-4443-导致问题：所有的图片那些指向的链接-没有加端口号，导致图片全部失效-buy链接也没有端口号…\" class=\"headerlink\" title=\"[outstanding]npm更换二级域名后反代成功 https://buy.carlzeng.com:4443/ 导致问题：所有的图片那些指向的链接 没有加端口号，导致图片全部失效, buy链接也没有端口号…\"></a>[outstanding]npm更换二级域名后反代成功 <a href=\"https://buy.carlzeng.com:4443/\">https://buy.carlzeng.com:4443/</a> 导致问题：所有的图片那些指向的链接 没有加端口号，导致图片全部失效, buy链接也没有端口号…</h4><h4 id=\"重命名install-lock-重装\"><a href=\"#重命名install-lock-重装\" class=\"headerlink\" title=\"重命名install.lock 重装\"></a>重命名install.lock 重装</h4><pre><code>重装后数据重新配置，导致设置的商品等等全部清零；上面问题待测试\nURL自动携带端口，没有解决。\n</code></pre>\n<p>​    </p>\n<h1 id=\"Debian-Manual\"><a href=\"#Debian-Manual\" class=\"headerlink\" title=\"Debian Manual\"></a>Debian Manual</h1><h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><ul>\n<li>此教程专为有洁癖的宝宝们准备。不使用任何一键安装脚本。面板党可以退散了！！</li>\n<li>本人测试环境是 Debian 11 其他的没测试。</li>\n</ul>\n<h2 id=\"手动安装lnmp\"><a href=\"#手动安装lnmp\" class=\"headerlink\" title=\"手动安装lnmp\"></a>手动安装lnmp</h2><ul>\n<li>更新源</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update  </span><br><span class=\"line\">apt upgrade</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>安装Nginx<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install nginx</span><br></pre></td></tr></table></figure></li>\n<li>安装Mariadb<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install mariadb-server</span><br></pre></td></tr></table></figure></li>\n<li>配置Mariadb<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql_secure_installation</span><br></pre></td></tr></table></figure>\n根据提示操作即可。</li>\n<li>创建数据库<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mariadb</span><br></pre></td></tr></table></figure>\n之后会显示<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Welcome to the MariaDB monitor.  Commands end with ; or \\g.</span><br><span class=\"line\">Your MariaDB connection <span class=\"built_in\">id</span> is 74</span><br><span class=\"line\">Server version: 10.3.15-MariaDB-1 Debian 10</span><br><span class=\"line\">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class=\"line\">Type <span class=\"string\">&#x27;help;&#x27;</span> or <span class=\"string\">&#x27;\\h&#x27;</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>. Type <span class=\"string\">&#x27;\\c&#x27;</span> to clear the current input statement.</span><br><span class=\"line\">MariaDB [(none)]&gt; </span><br></pre></td></tr></table></figure>\n接下来输入命令 <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> DATABASE [这里替换为数据库名] ;</span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">ON</span> [这里替换为数据库名].<span class=\"operator\">*</span> <span class=\"keyword\">TO</span> <span class=\"string\">&#x27;[这里替换为用户名]&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;[这里替换为密码]&#x27;</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">GRANT</span> OPTION;</span><br><span class=\"line\">FLUSH PRIVILEGES;</span><br><span class=\"line\">EXIT</span><br></pre></td></tr></table></figure></li>\n<li>安装PHP7.4<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install php php-fpm php-mysql php-gd php-zip php-opcache php-curl php-mbstring php-intl php-dom php-bcmath php-redis php-fileinfo</span><br></pre></td></tr></table></figure></li>\n<li>安装redis<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install redis</span><br></pre></td></tr></table></figure></li>\n<li>启用函数<br><code>nano /etc/php/7.4/fpm/php.ini</code>,<code>ctrl+w</code> 搜索 <code>putenv</code>，<code>proc_open</code>，<code>pcntl_signal</code>，<code>pcntl_alarm</code> 在<code>disable_functions</code> 一行 有就去掉。<br>之后 <code>/etc/init.d/php7.4-fpm reload</code></li>\n</ul>\n<h2 id=\"下载源代码\"><a href=\"#下载源代码\" class=\"headerlink\" title=\"下载源代码\"></a>下载源代码</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/www/dujiaoka</span><br><span class=\"line\">apt install git</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/assimon/dujiaoka.git </span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 777 -R /var/www/dujiaoka</span><br></pre></td></tr></table></figure>\n<h2 id=\"配置-nginx\"><a href=\"#配置-nginx\" class=\"headerlink\" title=\"配置 nginx\"></a>配置 nginx</h2><ul>\n<li>假设你的域名是：<code>domain.com</code></li>\n<li>假设你的网站目录是：<code>/home/wwwroot/dujiaoka</code></li>\n<li>配置文件的存放目录是：<code>/usr/local/nginx/conf/vhost</code></li>\n<li>按下文教程配置时，注意修改演示配置中的域名和目录</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/nginx/sites-enabled/dujiaoka </span><br></pre></td></tr></table></figure>\n<p>你可以参考我的配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">\tlisten [::]:80;</span><br><span class=\"line\">        server_name domain.com ;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> 301 https://$server_name<span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        listen 443 ssl http2;</span><br><span class=\"line\">\tlisten [::]:443 ssl http2;</span><br><span class=\"line\">        server_name domain.com ;</span><br><span class=\"line\">        index index.html index.htm index.php default.html default.htm default.php;</span><br><span class=\"line\">        root  /var/www/dujiaoka/public;</span><br><span class=\"line\">        ssl_certificate /etc/nginx/sslcert/cert.crt;</span><br><span class=\"line\">        ssl_certificate_key /etc/nginx/sslcert/key.key;</span><br><span class=\"line\">        <span class=\"comment\"># openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048</span></span><br><span class=\"line\">        <span class=\"comment\">#ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /index.php?<span class=\"variable\">$query_string</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        <span class=\"comment\">#error_page   404   /404.html;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Deny access to PHP files in specific directory</span></span><br><span class=\"line\">        <span class=\"comment\">#location ~ /(wp-content|uploads|wp-includes|images)/.*\\.php$ &#123; deny all; &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ [^/]\\.php(/|$)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          </span><br><span class=\"line\">            fastcgi_pass  unix:/var/run/php/php7.4-fpm.sock;</span><br><span class=\"line\">           </span><br><span class=\"line\">            include snippets/fastcgi-php.conf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            expires      30d;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ .*\\.(js|css)?$</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            expires      12h;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ /.well-known &#123;</span><br><span class=\"line\">            allow all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ /\\.</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            deny all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        access_log off;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>在 <code>/etc/nginx/sslcert/</code> 上传你的https证书 之后 <code>nginx -t</code> 没有报错就重启nginx <code>/etc/init.d/nginx restart</code></p>\n<h2 id=\"composer-安装\"><a href=\"#composer-安装\" class=\"headerlink\" title=\"composer 安装\"></a>composer 安装</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/www/dujiaoka</span><br><span class=\"line\">php -r <span class=\"string\">&quot;copy(&#x27;https://getcomposer.org/installer&#x27;, &#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class=\"line\">php composer-setup.php</span><br><span class=\"line\">php -r <span class=\"string\">&quot;unlink(&#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> composer.phar /usr/local/bin/composer</span><br><span class=\"line\">adduser user</span><br><span class=\"line\">su user</span><br><span class=\"line\">composer install</span><br><span class=\"line\">composer update</span><br><span class=\"line\">su</span><br></pre></td></tr></table></figure>\n<h2 id=\"访问安装页面\"><a href=\"#访问安装页面\" class=\"headerlink\" title=\"访问安装页面\"></a>访问安装页面</h2><p>访问你的域名，进行安装</p>\n<ul>\n<li>MySQL 数据库名：<code>dujiaoka</code></li>\n<li>MySQl 密码：<code>你设置的密码</code></li>\n<li>Redis 密码：<code>无需填写</code></li>\n<li>网站URL：你的域名，如 <code>https://domain.com</code></li>\n</ul>\n<p>##编辑配置文件</p>\n<p>编辑 <code>/var/www/dujiaoka/.env</code></p>\n<ul>\n<li>将 <code>APP_DEBUG=true</code> 改为 <code>APP_DEBUG=false</code></li>\n<li>另起一行，添加 <code>ADMIN_HTTPS=true</code></li>\n<li>尝试登入后台。如果提示 <code>0 error</code> ，刷新页面即可</li>\n</ul>\n<h2 id=\"配置-Supervisor\"><a href=\"#配置-Supervisor\" class=\"headerlink\" title=\"配置 Supervisor\"></a>配置 Supervisor</h2><p>先安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install supervisor</span><br></pre></td></tr></table></figure>\n<p>创建配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/supervisor/conf.d/dujiaoka.conf</span><br></pre></td></tr></table></figure>\n<p>写入配置文件</p>\n<ul>\n<li>注意修改网站目录<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:laravel-worker]</span><br><span class=\"line\">process_name=%(program_name)s_%(process_num)02d</span><br><span class=\"line\"><span class=\"built_in\">command</span>=php /home/wwwroot/dujiaoka/artisan queue:work</span><br><span class=\"line\">autostart=<span class=\"literal\">true</span></span><br><span class=\"line\">autorestart=<span class=\"literal\">true</span></span><br><span class=\"line\">user=www</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">redirect_stderr=<span class=\"literal\">true</span></span><br><span class=\"line\">stdout_logfile=/home/wwwlogs/worker.log</span><br></pre></td></tr></table></figure>\n启动<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">supervisorctl reread</span><br><span class=\"line\">supervisorctl update</span><br><span class=\"line\">supervisorctl start laravel-worker:*</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"参考来源\"><a href=\"#参考来源\" class=\"headerlink\" title=\"参考来源\"></a>参考来源</h2><p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mariadb-php-lemp-stack-on-debian-10\">https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mariadb-php-lemp-stack-on-debian-10</a><br><a href=\"https://github.com/assimon/dujiaoka/wiki/2.x_linux_install\">https://github.com/assimon/dujiaoka/wiki/2.x_linux_install</a></p>\n<h1 id=\"docker部署佰阅发卡卡密发卡系统kamifaka\"><a href=\"#docker部署佰阅发卡卡密发卡系统kamifaka\" class=\"headerlink\" title=\"docker部署佰阅发卡卡密发卡系统kamifaka\"></a>docker部署佰阅发卡卡密发卡系统kamifaka</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name kmfaka -itd -v /volume1/docker/kamifaka:/usr/src/app/public  -p 9200:8000 baiyuetribe/kamifaka:latest</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">    <span class=\"attr\">kamifaka:</span></span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">kmfaka</span></span><br><span class=\"line\">        <span class=\"attr\">stdin_open:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">tty:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">./:/usr/src/app/public</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"number\">4445</span><span class=\"string\">:8000</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">baiyuetribe/kamifaka:latest</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>后台地址ip地址:9200&#x2F;admin。默认管理员账号<a href=\"mailto:&#x61;&#x64;&#109;&#105;&#110;&#64;&#x71;&#113;&#46;&#x63;&#x6f;&#109;\">&#x61;&#x64;&#109;&#105;&#110;&#64;&#x71;&#113;&#46;&#x63;&#x6f;&#109;</a>，密码：123456。</p>\n<p>Reference</p>\n<p><a href=\"https://www.youtube.com/watch?v=UF24A3h2x3I\">NAS用docker部署佰阅发卡卡密发卡系统kamifaka</a></p>\n<p><a href=\"http://dacongyun.com/archives/635595.html\">球推荐一个发卡程序，除了独角风铃荔枝</a></p>\n","more":"<h1 id=\"有什么用\"><a href=\"#有什么用\" class=\"headerlink\" title=\"有什么用\"></a>有什么用</h1><p>自动售货系统-独角数卡<br>尝试按教材和视频搭建失败了（详见章节：搭建失败的历史记录），<br>鼓起勇气，重新选用新的方案：<a href=\"https://blog.dov.moe/posts/49102/\">https://blog.dov.moe/posts/49102/</a></p>\n<p>举个🌰例子：<a href=\"https://dovshop.net/\">https://dovshop.net/</a></p>\n<p><a href=\"https://ayangshop.com/buy/38\">https://ayangshop.com/buy/38</a></p>\n<div class=\"note danger\"><p>由于本人无法解决，反代以后的页面中链接没有自动携带端口好问题。放弃使用。</p>\n</div>\n\n<h1 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /www/server/panel/data/compose/dujiaoka/template</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir Shop &amp;&amp; cd Shop</span><br><span class=\"line\">mkdir storage uploads</span><br><span class=\"line\">chmod 777 storage uploads</span><br><span class=\"line\">❗注意此处文件夹权限一定要给！</span><br><span class=\"line\"></span><br><span class=\"line\">chmod -R 777 env.conf</span><br><span class=\"line\"># 重要步骤</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  faka:</span><br><span class=\"line\">    image: ghcr.io/apocalypsor/dujiaoka:latest</span><br><span class=\"line\">    <span class=\"comment\"># 国内服务器可以用 hkccr.ccs.tencentyun.com/apocalypsor/dujiaoka:latest</span></span><br><span class=\"line\">    container_name: faka</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        <span class=\"comment\"># - INSTALL=false</span></span><br><span class=\"line\">        - <span class=\"attr\">INSTALL</span>=<span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># - MODIFY=true</span></span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./env.conf:/dujiaoka/.env</span><br><span class=\"line\">      - ./uploads:/dujiaoka/public/uploads</span><br><span class=\"line\">      - ./storage:/dujiaoka/storage</span><br><span class=\"line\">      - ./start-hook.sh:/dujiaoka/start-hook.sh</span><br><span class=\"line\">      <span class=\"comment\"># 网站图标 32X32 favicon.ico 4kb，默认模版只需第一处，其他模版需要第二处</span></span><br><span class=\"line\">\t  <span class=\"comment\">#- ./favicon.ico:/dujiaoka/public/favicon.ico:ro</span></span><br><span class=\"line\">\t  <span class=\"comment\">#- ./favicon.ico:/dujiaoka/public/assets/style/favicon.ico:ro</span></span><br><span class=\"line\">\t  <span class=\"comment\"># 默认商品图片 512x512 default.jpg 18kb（网站 LOGO 共享此图，与后台自定义 LOGO 和商品图片不冲突）</span></span><br><span class=\"line\">\t  <span class=\"comment\"># - ./default.png:/dujiaoka/public/assets/common/images/default.jpg:ro</span></span><br><span class=\"line\">\t  <span class=\"comment\"># Luna 主题网站背景 1920x1224 background.png 198kb</span></span><br><span class=\"line\">\t  <span class=\"comment\">#- ./background.png:/dujiaoka/public/assets/luna/img/background.png:ro</span></span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 4444:80</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\"> </span><br><span class=\"line\">  db:</span><br><span class=\"line\">    image: mariadb:focal</span><br><span class=\"line\">    container_name: faka-data</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_ROOT_PASSWORD</span>=mariadb</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_DATABASE</span>=dujiaoka</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_USER</span>=dujiaoka</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_PASSWORD</span>=dujiaokapassword</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./data:/var/lib/mysql</span><br><span class=\"line\"></span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    image: redis:alpine</span><br><span class=\"line\">    container_name: faka-redis</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./redis:/data</span><br></pre></td></tr></table></figure>\n\n<p>编辑 .env 文件</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">APP_NAME</span>=Carl的小店</span><br><span class=\"line\"><span class=\"attr\">APP_ENV</span>=local</span><br><span class=\"line\"><span class=\"attr\">APP_KEY</span>=base64:hDVkYhfkUjaePiaI1tcBT7G8bh2A8RQxwWIGkq7BO18=</span><br><span class=\"line\"><span class=\"attr\">APP_DEBUG</span>=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">APP_URL</span>=http://<span class=\"number\">192.168</span>.<span class=\"number\">6.116</span>:<span class=\"number\">4444</span></span><br><span class=\"line\"><span class=\"comment\">#ADMIN_HTTPS=true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">LOG_CHANNEL</span>=stack</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据库配置</span></span><br><span class=\"line\"><span class=\"attr\">DB_CONNECTION</span>=mysql</span><br><span class=\"line\"><span class=\"attr\">DB_HOST</span>=db</span><br><span class=\"line\"><span class=\"attr\">DB_PORT</span>=<span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">DB_DATABASE</span>=dujiaoka</span><br><span class=\"line\"><span class=\"attr\">DB_USERNAME</span>=dujiaoka</span><br><span class=\"line\"><span class=\"attr\">DB_PASSWORD</span>=dujiaokapassword</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># redis 配置</span></span><br><span class=\"line\"><span class=\"attr\">REDIS_HOST</span>=redis</span><br><span class=\"line\"><span class=\"attr\">REDIS_PASSWORD</span>=</span><br><span class=\"line\"><span class=\"attr\">REDIS_PORT</span>=<span class=\"number\">6379</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">BROADCAST_DRIVER</span>=log</span><br><span class=\"line\"><span class=\"attr\">SESSION_DRIVER</span>=file</span><br><span class=\"line\"><span class=\"attr\">SESSION_LIFETIME</span>=<span class=\"number\">120</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 缓存配置</span></span><br><span class=\"line\"><span class=\"comment\"># file 为磁盘文件  redis 为内存级别</span></span><br><span class=\"line\"><span class=\"comment\"># redis 为内存需要安装好 redis 服务端并配置</span></span><br><span class=\"line\"><span class=\"attr\">CACHE_DRIVER</span>=redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 异步消息队列</span></span><br><span class=\"line\"><span class=\"comment\"># sync 为同步  redis 为异步</span></span><br><span class=\"line\"><span class=\"comment\"># 使用 redis 异步需要安装好 redis 服务端并配置</span></span><br><span class=\"line\"><span class=\"attr\">QUEUE_CONNECTION</span>=redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 后台语言</span></span><br><span class=\"line\"><span class=\"comment\">## zh_CN 简体中文</span></span><br><span class=\"line\"><span class=\"comment\">## zh_TW 繁体中文</span></span><br><span class=\"line\"><span class=\"comment\">## en    英文</span></span><br><span class=\"line\"><span class=\"attr\">DUJIAO_ADMIN_LANGUAGE</span>=zh_CN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 后台登录地址</span></span><br><span class=\"line\"><span class=\"attr\">ADMIN_ROUTE_PREFIX</span>=/admin</span><br></pre></td></tr></table></figure>\n\n<p>一直无法下载成功……<br>修改使用：stilleshan&#x2F;dujiaoka</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose+如何使用代理提速</span><br><span class=\"line\">\t\thttps://neucrack.com/p/286</span><br><span class=\"line\">\tworkaournd：手动让OpenClash不停在线（不在线就重新刷新取获取最新节点信息）</span><br></pre></td></tr></table></figure>\n\n<p>终于下载成功后，启动失败</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error mounting &quot;/www/server/panel/data/compose/dujiaoka/template/Shop/favicon.ico&quot; to rootfs at &quot;/dujiaoka/public/favicon.ico&quot;: mount /www/server/panel/data/compose/dujiaoka/template/Shop/favicon.ico:/dujiaoka/public/favicon.ico (via /proc/self/fd/6), flags: 0x5001: not a directory: unknown: Are you trying to mount a directory onto a file (or vice-versa)? Check if the specified host path exists and is the expected type</span><br></pre></td></tr></table></figure>\n<p>注释掉那几个自定义的文件映射，就好了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">faka        | The environment file is invalid!</span><br><span class=\"line\">faka        | Failed to parse dotenv file due to unexpected whitespace. Failed at [Carl Shop].</span><br></pre></td></tr></table></figure>\n<p>返回修改把前后加上引号。</p>\n<p>修改了端口映射出4444后，错误：<br>500<br>Server Error</p>\n<p>❗注意环境变量如果写的不对可能导致 500，可以开 APP_DEBUG&#x3D;true 看看具体是哪里写错了。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   throw new RuntimeException(&#x27;The only supported ciphers are AES-128-CBC and AES-256-CBC with the correct key lengths.&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">解决办法：修改APP_KEY=base64:hDVkYhfkUjaePiaI1tcBT7G8bh2A8RQxwWIGkq7BO18=</span><br><span class=\"line\">--------------</span><br><span class=\"line\"></span><br><span class=\"line\">file_put_contents(/dujiaoka/.env): failed to open stream: Permission denied</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>本地访问成功：<a href=\"http://192.168.6.116:4444/\">http://192.168.6.116:4444</a></p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://hub.docker.com/r/stilleshan/dujiaoka\">https://hub.docker.com/r/stilleshan/dujiaoka</a><br><a href=\"https://hub.docker.com/r/jiangjuhong/dujiaoka\">https://hub.docker.com/r/jiangjuhong/dujiaoka</a></p>\n<h2 id=\"搭配frpc\"><a href=\"#搭配frpc\" class=\"headerlink\" title=\"搭配frpc\"></a>搭配frpc</h2><p>20231203 NPM反代失败，几周后；终于找到解决方案了：发现可以用frpc反代出去就好</p>\n<p>配置完成frpc -c frpc.ini， 可是依旧是点击的链接没有携带端口号；非常郁闷</p>\n<hr>\n<hr>\n<h1 id=\"搭建失败的历史记录\"><a href=\"#搭建失败的历史记录\" class=\"headerlink\" title=\"搭建失败的历史记录\"></a>搭建失败的历史记录</h1><p>独角数卡<br>开源式站长自动化售货解决方案、高效、稳定、快速！</p>\n<p>徒手搭建独角数发卡网站 经营自己的小店！ - 六月 26, 2023<br><a href=\"https://kejilion.blogspot.com/2023/06/blog-post_26.html\">https://kejilion.blogspot.com/2023/06/blog-post_26.html</a></p>\n<p>配置docker-compose<br><a href=\"https://github.com/kejilion/docker/blob/main/LNMP-docker-compose.yml\">https://github.com/kejilion/docker/blob/main/LNMP-docker-compose.yml</a></p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;3.8&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  nginx:</span><br><span class=\"line\">    image: nginx:1.22</span><br><span class=\"line\">    container_name: nginx</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 882:80</span><br><span class=\"line\">      - 4444:443      </span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./nginx.conf:/etc/nginx/nginx.conf</span><br><span class=\"line\">      - ./certs:/etc/nginx/certs      </span><br><span class=\"line\">      - ./html:/var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\">  php:</span><br><span class=\"line\">    image: php:7.4.33-fpm</span><br><span class=\"line\">    container_name: php</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./html:/var/www/html</span><br><span class=\"line\"></span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    image: mysql:5.7.42</span><br><span class=\"line\">    container_name: mysql</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./mysql:/var/lib/mysql</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_ROOT_PASSWORD</span>=webroot</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_DATABASE</span>=web</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_USER</span>=carlZeng</span><br><span class=\"line\">      - <span class=\"attr\">MYSQL_PASSWORD</span>=carlZengYYDS</span><br><span class=\"line\"></span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    image: redis:latest</span><br><span class=\"line\">    container_name: redis</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./redis:/data</span><br></pre></td></tr></table></figure>\n<p>修改了独角数卡的端口</p>\n<p>申请证书, 下载证书;</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">直接去NPM中下载证书解压缩后重命名放到debian的目录：</span><br><span class=\"line\">/home/web/certs</span><br><span class=\"line\">    key.pem</span><br><span class=\"line\">    cert.pem</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>继续配置nginx.conf</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections 1024<span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    include       /etc/nginx/mime.types<span class=\"comment\">;</span></span><br><span class=\"line\">    default_type  application/octet-stream<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on<span class=\"comment\">;</span></span><br><span class=\"line\">    keepalive_timeout  65<span class=\"comment\">;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    client_max_body_size 1000m<span class=\"comment\">;  </span></span><br><span class=\"line\">    <span class=\"comment\">#上传限制参数1G以内文件可上传</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HTTP server</span></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 80<span class=\"comment\">;</span></span><br><span class=\"line\">        server_name shop.carlzeng.com<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Redirect all HTTP requests to HTTPS</span></span><br><span class=\"line\">        return 301 https://$host$request_uri<span class=\"comment\">;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HTTPS server</span></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 443 ssl http2<span class=\"comment\">;</span></span><br><span class=\"line\">        server_name shop.carlzeng.com<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># http2 on;</span></span><br><span class=\"line\">            </span><br><span class=\"line\">        ssl_certificate /etc/nginx/certs/cert.pem<span class=\"comment\">;</span></span><br><span class=\"line\">        ssl_certificate_key /etc/nginx/certs/key.pem<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        root /var/www/html/dujiaoka/public/<span class=\"comment\">;</span></span><br><span class=\"line\">        index index.php<span class=\"comment\">;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        try_files $uri $uri/ /index.php?$query_string<span class=\"comment\">;    </span></span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># PHP-FPM configuration</span></span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">            fastcgi_pass php:9000<span class=\"comment\">;</span></span><br><span class=\"line\">            fastcgi_index index.php<span class=\"comment\">;</span></span><br><span class=\"line\">            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name<span class=\"comment\">;</span></span><br><span class=\"line\">            include fastcgi_params<span class=\"comment\">;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>cd &#x2F;home&#x2F;web&#x2F;html &amp;&amp; wget <a href=\"https://ghproxy.com/https://github.com/assimon/dujiaoka/releases/download/2.0.6/2.0.6-antibody.tar.gz\">https://ghproxy.com/https://github.com/assimon/dujiaoka/releases/download/2.0.6/2.0.6-antibody.tar.gz</a> &amp;&amp; apt install -y tar &amp;&amp; tar -zxvf 2.0.6-antibody.tar.gz &amp;&amp; rm 2.0.6-antibody.tar.gz</p>\n<p>安装PHP扩展</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec php apt update &amp;&amp; docker exec php apt install -y libmariadb-dev-compat libmariadb-dev libzip-dev libmagickwand-dev imagemagick</span><br><span class=\"line\"></span><br><span class=\"line\">卡死在这一步，分解如下：</span><br><span class=\"line\">    docker exec php apt install -y libmariadb-dev-compat</span><br><span class=\"line\">    docker exec php apt install -y libmariadb-dev</span><br><span class=\"line\">    docker exec php apt install -y libzip-dev</span><br><span class=\"line\">    docker exec php apt install -y libmagickwand-dev</span><br><span class=\"line\">        libmagickwand-dev is already the newest version (8:6.9.11.60+dfsg-1.3+deb11u1).</span><br><span class=\"line\">    docker exec php apt install -y imagemagick</span><br><span class=\"line\">        Build process completed successfully</span><br><span class=\"line\">        Installing &#x27;/usr/local/lib/php/extensions/no-debug-non-zts-20190902/redis.so&#x27;</span><br><span class=\"line\">        install ok: channel://pecl.php.net/redis-6.0.2</span><br><span class=\"line\">        configuration option &quot;php_ini&quot; is not set to php.ini location</span><br><span class=\"line\">        You should add &quot;extension=redis.so&quot; to php.ini</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">docker exec php docker-php-ext-install pdo_mysql zip bcmath gd intl opcache &amp;&amp; docker exec php pecl install redis &amp;&amp; docker exec php sh -c &#x27;echo &quot;extension=redis.so&quot; &gt; /usr/local/etc/php/conf.d/docker-php-ext-redis.ini&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>如果登录时报错再使用该命令，解除HTTPS限制</p>\n<p>sed -i ‘s&#x2F;ADMIN_HTTPS&#x3D;false&#x2F;ADMIN_HTTPS&#x3D;true&#x2F;g’ &#x2F;home&#x2F;web&#x2F;html&#x2F;dujiaoka&#x2F;.env</p>\n<p>错误以及解决办法<br>不同时期再网页页面，点击安装后出现的错误</p>\n<h4 id=\"数据库配置错误-could-not-find-driver-SQL-select-1-limit-1\"><a href=\"#数据库配置错误-could-not-find-driver-SQL-select-1-limit-1\" class=\"headerlink\" title=\"数据库配置错误 :could not find driver (SQL: select 1 limit 1)\"></a>数据库配置错误 :could not find driver (SQL: select 1 limit 1)</h4><pre><code>解决：修改了nginx.conf，确保80和443端口（docker中的端口占用，默认即可）\n确认了php docker中的PHP扩展，确保所有插件都安装成功\n</code></pre>\n<h3 id=\"Redis配置错误-php-network-getaddresses-getaddrinfo-failed-Name-or-service-not-known\"><a href=\"#Redis配置错误-php-network-getaddresses-getaddrinfo-failed-Name-or-service-not-known\" class=\"headerlink\" title=\"Redis配置错误 :php_network_getaddresses: getaddrinfo failed: Name or service not known\"></a>Redis配置错误 :php_network_getaddresses: getaddrinfo failed: Name or service not known</h3><pre><code>解决：sed -i &#39;s/ADMIN_HTTPS=false/ADMIN_HTTPS=true/g&#39; /home/web/html/dujiaoka/.env\n核查了php docker中 安装PHP拓展部分于redis相关的；\ndocker-php-ext-redis.ini（已包含内容：extension=redis.so）\n\n原来是redis 写成了radis，纠正后重试\n</code></pre>\n<h3 id=\"数据库配置错误-SQLSTATE-HY000-1045-Access-denied-for-user-‘carlZEng‘-’172-24-0-5’-using-password-YES-SQL-select-1-limit-1\"><a href=\"#数据库配置错误-SQLSTATE-HY000-1045-Access-denied-for-user-‘carlZEng‘-’172-24-0-5’-using-password-YES-SQL-select-1-limit-1\" class=\"headerlink\" title=\"数据库配置错误 :SQLSTATE[HY000] [1045] Access denied for user ‘carlZEng‘@’172.24.0.5’ (using password: YES) (SQL: select 1 limit 1)\"></a>数据库配置错误 :SQLSTATE[HY000] [1045] Access denied for user ‘carlZEng‘@’172.24.0.5’ (using password: YES) (SQL: select 1 limit 1)</h3><pre><code>解决：MySQL用户名填写错误，纠正后重试\n</code></pre>\n<h4 id=\"数据库配置错误-could-not-find-driver-SQL-select-1-limit-1-1\"><a href=\"#数据库配置错误-could-not-find-driver-SQL-select-1-limit-1-1\" class=\"headerlink\" title=\"数据库配置错误 :could not find driver (SQL: select 1 limit 1)\"></a>数据库配置错误 :could not find driver (SQL: select 1 limit 1)</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">解决：</span><br><span class=\"line\">检测：docker exec -it php php -i |grep mysqlnd  排查是否启用了mysql驱动</span><br><span class=\"line\">    mysqlnd</span><br><span class=\"line\">    mysqlnd =&gt; enabled</span><br><span class=\"line\">    Version =&gt; mysqlnd 7.4.3</span><br><span class=\"line\"></span><br><span class=\"line\">docker exec -it php /bin/bash</span><br><span class=\"line\">docker-php-ext-install pdo pdo_mysql</span><br><span class=\"line\">docker-compose restart php</span><br><span class=\"line\"></span><br><span class=\"line\">这个好像没有被永久保存住，这导致每次docker-compose restart php都会出现这个错误,</span><br><span class=\"line\">按照上面解决好以后，紧接着就是下面这个Redis错误</span><br><span class=\"line\"></span><br><span class=\"line\">这次是修正后，最后是通过docker restart php 解决了错误</span><br><span class=\"line\">测试 docker-compose restart 会不会把数据在继续破坏了，重新拉取？</span><br><span class=\"line\">    也是正常的！ 那下一次怎么办？继续如此修复即可</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Please-make-sure-the-PHP-Redis-extension-is-installed-and-enabled\"><a href=\"#Please-make-sure-the-PHP-Redis-extension-is-installed-and-enabled\" class=\"headerlink\" title=\"Please make sure the PHP Redis extension is installed and enabled.\"></a>Please make sure the PHP Redis extension is installed and enabled.</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it php /bin/bash</span><br><span class=\"line\">pecl install redis</span><br><span class=\"line\">    checking for igbinary includes... configure: error: Cannot find igbinary.h</span><br><span class=\"line\">        ERROR: `/tmp/pear/temp/redis/configure --with-php-config=/usr/local/bin/php-config --enable-redis-igbinary=yes --enable-redis-lzf=yes --enable-redis-zstd=yes --enable-redis-msgpack=yes --enable-redis-lz4=yes --with-liblz4&#x27; failed</span><br><span class=\"line\">Build process completed successfully</span><br><span class=\"line\">Installing &#x27;/usr/local/lib/php/extensions/no-debug-non-zts-20190902/redis.so&#x27;</span><br><span class=\"line\">install ok: channel://pecl.php.net/redis-6.0.2</span><br><span class=\"line\">configuration option &quot;php_ini&quot; is not set to php.ini location</span><br><span class=\"line\">You should add &quot;extension=redis.so&quot; to php.ini</span><br><span class=\"line\"></span><br><span class=\"line\">解决：docker exec php docker-php-ext-install pdo_mysql zip bcmath gd intl opcache &amp;&amp; docker exec php pecl install redis &amp;&amp; docker exec php sh -c &#x27;echo &quot;extension=redis.so&quot; &gt; /usr/local/etc/php/conf.d/docker-php-ext-redis.ini&#x27;</span><br><span class=\"line\">解决分解，并逐一确认执行成功</span><br><span class=\"line\">    docker exec -it php /bin/bash</span><br><span class=\"line\">        docker-php-ext-install pdo_mysql zip bcmath gd intl opcache</span><br><span class=\"line\">        pecl install redis</span><br><span class=\"line\">        sh -c &#x27;echo &quot;extension=redis.so&quot; &gt; /usr/local/etc/php/conf.d/docker-php-ext-redis.ini&#x27;</span><br><span class=\"line\">在 bash 下，一一执行，检查结果</span><br><span class=\"line\"></span><br><span class=\"line\">最后，需要docker-compose restart</span><br><span class=\"line\">之前都是重启php容器docker restart php 无法解决问题。需要的是：docker-compose restart</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0-error\"><a href=\"#0-error\" class=\"headerlink\" title=\"0 error\"></a>0 error</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">安装成功后 redirect https://192.168.6.116:4444/admin/auth/login</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">后台登录出现0err或者其他登录异常问题，大概率是开启了https而后台没有开启，把下面的<span class=\"literal\">false</span>改为<span class=\"literal\">true</span>即可</span></span><br><span class=\"line\">ADMIN_HTTPS=false</span><br><span class=\"line\">解决：sed -i &#x27;s/ADMIN_HTTPS=false/ADMIN_HTTPS=true/g&#x27; /home/web/html/dujiaoka/.env</span><br><span class=\"line\"></span><br><span class=\"line\">成功了，本地局域网可访问。</span><br><span class=\"line\">下一步是为何无法NPM反代https://192.168.6.116:4444</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"outstanding-创建订单出错-Symfony-Component-Debug-Exception-FatalThrowableError\"><a href=\"#outstanding-创建订单出错-Symfony-Component-Debug-Exception-FatalThrowableError\" class=\"headerlink\" title=\"[outstanding]创建订单出错 Symfony\\Component\\Debug\\Exception\\FatalThrowableError\"></a>[outstanding]创建订单出错 Symfony\\Component\\Debug\\Exception\\FatalThrowableError</h4><pre><code>Call to undefined function App\\Service\\bcmul()\nhttps://192.168.6.116:4444/create-order\n</code></pre>\n<h4 id=\"outstanding-npm更换二级域名后反代成功-https-buy-carlzeng-com-4443-导致问题：所有的图片那些指向的链接-没有加端口号，导致图片全部失效-buy链接也没有端口号…\"><a href=\"#outstanding-npm更换二级域名后反代成功-https-buy-carlzeng-com-4443-导致问题：所有的图片那些指向的链接-没有加端口号，导致图片全部失效-buy链接也没有端口号…\" class=\"headerlink\" title=\"[outstanding]npm更换二级域名后反代成功 https://buy.carlzeng.com:4443/ 导致问题：所有的图片那些指向的链接 没有加端口号，导致图片全部失效, buy链接也没有端口号…\"></a>[outstanding]npm更换二级域名后反代成功 <a href=\"https://buy.carlzeng.com:4443/\">https://buy.carlzeng.com:4443/</a> 导致问题：所有的图片那些指向的链接 没有加端口号，导致图片全部失效, buy链接也没有端口号…</h4><h4 id=\"重命名install-lock-重装\"><a href=\"#重命名install-lock-重装\" class=\"headerlink\" title=\"重命名install.lock 重装\"></a>重命名install.lock 重装</h4><pre><code>重装后数据重新配置，导致设置的商品等等全部清零；上面问题待测试\nURL自动携带端口，没有解决。\n</code></pre>\n<p>​    </p>\n<h1 id=\"Debian-Manual\"><a href=\"#Debian-Manual\" class=\"headerlink\" title=\"Debian Manual\"></a>Debian Manual</h1><h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><ul>\n<li>此教程专为有洁癖的宝宝们准备。不使用任何一键安装脚本。面板党可以退散了！！</li>\n<li>本人测试环境是 Debian 11 其他的没测试。</li>\n</ul>\n<h2 id=\"手动安装lnmp\"><a href=\"#手动安装lnmp\" class=\"headerlink\" title=\"手动安装lnmp\"></a>手动安装lnmp</h2><ul>\n<li>更新源</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update  </span><br><span class=\"line\">apt upgrade</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>安装Nginx<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install nginx</span><br></pre></td></tr></table></figure></li>\n<li>安装Mariadb<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install mariadb-server</span><br></pre></td></tr></table></figure></li>\n<li>配置Mariadb<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql_secure_installation</span><br></pre></td></tr></table></figure>\n根据提示操作即可。</li>\n<li>创建数据库<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mariadb</span><br></pre></td></tr></table></figure>\n之后会显示<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Welcome to the MariaDB monitor.  Commands end with ; or \\g.</span><br><span class=\"line\">Your MariaDB connection <span class=\"built_in\">id</span> is 74</span><br><span class=\"line\">Server version: 10.3.15-MariaDB-1 Debian 10</span><br><span class=\"line\">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class=\"line\">Type <span class=\"string\">&#x27;help;&#x27;</span> or <span class=\"string\">&#x27;\\h&#x27;</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>. Type <span class=\"string\">&#x27;\\c&#x27;</span> to clear the current input statement.</span><br><span class=\"line\">MariaDB [(none)]&gt; </span><br></pre></td></tr></table></figure>\n接下来输入命令 <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> DATABASE [这里替换为数据库名] ;</span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">ON</span> [这里替换为数据库名].<span class=\"operator\">*</span> <span class=\"keyword\">TO</span> <span class=\"string\">&#x27;[这里替换为用户名]&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;[这里替换为密码]&#x27;</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">GRANT</span> OPTION;</span><br><span class=\"line\">FLUSH PRIVILEGES;</span><br><span class=\"line\">EXIT</span><br></pre></td></tr></table></figure></li>\n<li>安装PHP7.4<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install php php-fpm php-mysql php-gd php-zip php-opcache php-curl php-mbstring php-intl php-dom php-bcmath php-redis php-fileinfo</span><br></pre></td></tr></table></figure></li>\n<li>安装redis<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install redis</span><br></pre></td></tr></table></figure></li>\n<li>启用函数<br><code>nano /etc/php/7.4/fpm/php.ini</code>,<code>ctrl+w</code> 搜索 <code>putenv</code>，<code>proc_open</code>，<code>pcntl_signal</code>，<code>pcntl_alarm</code> 在<code>disable_functions</code> 一行 有就去掉。<br>之后 <code>/etc/init.d/php7.4-fpm reload</code></li>\n</ul>\n<h2 id=\"下载源代码\"><a href=\"#下载源代码\" class=\"headerlink\" title=\"下载源代码\"></a>下载源代码</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/www/dujiaoka</span><br><span class=\"line\">apt install git</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/assimon/dujiaoka.git </span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 777 -R /var/www/dujiaoka</span><br></pre></td></tr></table></figure>\n<h2 id=\"配置-nginx\"><a href=\"#配置-nginx\" class=\"headerlink\" title=\"配置 nginx\"></a>配置 nginx</h2><ul>\n<li>假设你的域名是：<code>domain.com</code></li>\n<li>假设你的网站目录是：<code>/home/wwwroot/dujiaoka</code></li>\n<li>配置文件的存放目录是：<code>/usr/local/nginx/conf/vhost</code></li>\n<li>按下文教程配置时，注意修改演示配置中的域名和目录</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/nginx/sites-enabled/dujiaoka </span><br></pre></td></tr></table></figure>\n<p>你可以参考我的配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">\tlisten [::]:80;</span><br><span class=\"line\">        server_name domain.com ;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> 301 https://$server_name<span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        listen 443 ssl http2;</span><br><span class=\"line\">\tlisten [::]:443 ssl http2;</span><br><span class=\"line\">        server_name domain.com ;</span><br><span class=\"line\">        index index.html index.htm index.php default.html default.htm default.php;</span><br><span class=\"line\">        root  /var/www/dujiaoka/public;</span><br><span class=\"line\">        ssl_certificate /etc/nginx/sslcert/cert.crt;</span><br><span class=\"line\">        ssl_certificate_key /etc/nginx/sslcert/key.key;</span><br><span class=\"line\">        <span class=\"comment\"># openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048</span></span><br><span class=\"line\">        <span class=\"comment\">#ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /index.php?<span class=\"variable\">$query_string</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        <span class=\"comment\">#error_page   404   /404.html;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Deny access to PHP files in specific directory</span></span><br><span class=\"line\">        <span class=\"comment\">#location ~ /(wp-content|uploads|wp-includes|images)/.*\\.php$ &#123; deny all; &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ [^/]\\.php(/|$)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          </span><br><span class=\"line\">            fastcgi_pass  unix:/var/run/php/php7.4-fpm.sock;</span><br><span class=\"line\">           </span><br><span class=\"line\">            include snippets/fastcgi-php.conf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            expires      30d;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ .*\\.(js|css)?$</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            expires      12h;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ /.well-known &#123;</span><br><span class=\"line\">            allow all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ /\\.</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            deny all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        access_log off;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>在 <code>/etc/nginx/sslcert/</code> 上传你的https证书 之后 <code>nginx -t</code> 没有报错就重启nginx <code>/etc/init.d/nginx restart</code></p>\n<h2 id=\"composer-安装\"><a href=\"#composer-安装\" class=\"headerlink\" title=\"composer 安装\"></a>composer 安装</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/www/dujiaoka</span><br><span class=\"line\">php -r <span class=\"string\">&quot;copy(&#x27;https://getcomposer.org/installer&#x27;, &#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class=\"line\">php composer-setup.php</span><br><span class=\"line\">php -r <span class=\"string\">&quot;unlink(&#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> composer.phar /usr/local/bin/composer</span><br><span class=\"line\">adduser user</span><br><span class=\"line\">su user</span><br><span class=\"line\">composer install</span><br><span class=\"line\">composer update</span><br><span class=\"line\">su</span><br></pre></td></tr></table></figure>\n<h2 id=\"访问安装页面\"><a href=\"#访问安装页面\" class=\"headerlink\" title=\"访问安装页面\"></a>访问安装页面</h2><p>访问你的域名，进行安装</p>\n<ul>\n<li>MySQL 数据库名：<code>dujiaoka</code></li>\n<li>MySQl 密码：<code>你设置的密码</code></li>\n<li>Redis 密码：<code>无需填写</code></li>\n<li>网站URL：你的域名，如 <code>https://domain.com</code></li>\n</ul>\n<p>##编辑配置文件</p>\n<p>编辑 <code>/var/www/dujiaoka/.env</code></p>\n<ul>\n<li>将 <code>APP_DEBUG=true</code> 改为 <code>APP_DEBUG=false</code></li>\n<li>另起一行，添加 <code>ADMIN_HTTPS=true</code></li>\n<li>尝试登入后台。如果提示 <code>0 error</code> ，刷新页面即可</li>\n</ul>\n<h2 id=\"配置-Supervisor\"><a href=\"#配置-Supervisor\" class=\"headerlink\" title=\"配置 Supervisor\"></a>配置 Supervisor</h2><p>先安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt install supervisor</span><br></pre></td></tr></table></figure>\n<p>创建配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nano /etc/supervisor/conf.d/dujiaoka.conf</span><br></pre></td></tr></table></figure>\n<p>写入配置文件</p>\n<ul>\n<li>注意修改网站目录<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:laravel-worker]</span><br><span class=\"line\">process_name=%(program_name)s_%(process_num)02d</span><br><span class=\"line\"><span class=\"built_in\">command</span>=php /home/wwwroot/dujiaoka/artisan queue:work</span><br><span class=\"line\">autostart=<span class=\"literal\">true</span></span><br><span class=\"line\">autorestart=<span class=\"literal\">true</span></span><br><span class=\"line\">user=www</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">redirect_stderr=<span class=\"literal\">true</span></span><br><span class=\"line\">stdout_logfile=/home/wwwlogs/worker.log</span><br></pre></td></tr></table></figure>\n启动<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">supervisorctl reread</span><br><span class=\"line\">supervisorctl update</span><br><span class=\"line\">supervisorctl start laravel-worker:*</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"参考来源\"><a href=\"#参考来源\" class=\"headerlink\" title=\"参考来源\"></a>参考来源</h2><p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mariadb-php-lemp-stack-on-debian-10\">https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mariadb-php-lemp-stack-on-debian-10</a><br><a href=\"https://github.com/assimon/dujiaoka/wiki/2.x_linux_install\">https://github.com/assimon/dujiaoka/wiki/2.x_linux_install</a></p>\n<h1 id=\"docker部署佰阅发卡卡密发卡系统kamifaka\"><a href=\"#docker部署佰阅发卡卡密发卡系统kamifaka\" class=\"headerlink\" title=\"docker部署佰阅发卡卡密发卡系统kamifaka\"></a>docker部署佰阅发卡卡密发卡系统kamifaka</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name kmfaka -itd -v /volume1/docker/kamifaka:/usr/src/app/public  -p 9200:8000 baiyuetribe/kamifaka:latest</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">    <span class=\"attr\">kamifaka:</span></span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">kmfaka</span></span><br><span class=\"line\">        <span class=\"attr\">stdin_open:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">tty:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">./:/usr/src/app/public</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"number\">4445</span><span class=\"string\">:8000</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">baiyuetribe/kamifaka:latest</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>后台地址ip地址:9200&#x2F;admin。默认管理员账号<a href=\"mailto:&#x61;&#x64;&#109;&#105;&#110;&#64;&#x71;&#113;&#46;&#x63;&#x6f;&#109;\">&#x61;&#x64;&#109;&#105;&#110;&#64;&#x71;&#113;&#46;&#x63;&#x6f;&#109;</a>，密码：123456。</p>\n<p>Reference</p>\n<p><a href=\"https://www.youtube.com/watch?v=UF24A3h2x3I\">NAS用docker部署佰阅发卡卡密发卡系统kamifaka</a></p>\n<p><a href=\"http://dacongyun.com/archives/635595.html\">球推荐一个发卡程序，除了独角风铃荔枝</a></p>","categories":[{"name":"Docker","path":"api/categories/Docker.json"}],"tags":[{"name":"docker","path":"api/tags/docker.json"},{"name":"NPM","path":"api/tags/NPM.json"},{"name":"debian","path":"api/tags/debian.json"},{"name":"docker-compose","path":"api/tags/docker-compose.json"},{"name":"家宽","path":"api/tags/家宽.json"},{"name":"自动售货系统","path":"api/tags/自动售货系统.json"},{"name":"独角数卡","path":"api/tags/独角数卡.json"}]}