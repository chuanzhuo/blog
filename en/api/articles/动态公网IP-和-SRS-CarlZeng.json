{"title":"动态公网IP 和 SRS-CarlZeng","slug":"动态公网IP-和-SRS-CarlZeng","date":"2023-04-13T09:36:00.000Z","updated":"2023-11-01T07:03:52.966Z","comments":true,"path":"api/articles/动态公网IP-和-SRS-CarlZeng.json","excerpt":"动态公网IP 和 SRS 简介和现实中的应用","covers":null,"content":"<p>动态公网IP（Dynamic Public IP）是指由互联网服务提供商（ISP）分配给用户的动态IP地址，该地址是公共的，可以在公共互联网上访问。<br>与静态公网IP不同，动态公网IP是临时分配的，并且在一段时间后可能会更改。这意味着每次重新连接到互联网时，用户可能会被分配一个新的动态公网IP地址。</p>\n<p>动态公网IP通常用于个人用户或小型企业，因为它们相对便宜，而且不需要用户进行任何配置或管理。但是，由于其不稳定性和易变性，动态公网IP可能不适合需要稳定和持久的互联网连接的大型企业或组织。</p>\n<p>联通的adsl用户可以打10010 叫客服打开“动态公网IP” + 路由器桥接。（<a href=\"https://www.mi-d.cn/1590\">缘由：需要动态公网ip做监控或者访问服务</a>）</p>\n<p>开启动态公网IP+路由器桥接以后, 路由器上拨号即可得到一个公网IP.</p>\n<p>OpenWRT 路由器 设置端口映射， 即可将局域网内主机的端口 映射到公网IP的特定上。</p>\n<p>题外话（弯路）：（Padavan的系统，在端口映射是使用单独的工具（socat耗内存）来实现端口数据转发，OpenWrt的iptables更可靠，扎实稳定）</p>\n<p>下面以mac电脑，架设SRS服务器 来：分享流媒体至互联网。</p>\n<h1 id=\"1-安装SRS步骤\"><a href=\"#1-安装SRS步骤\" class=\"headerlink\" title=\"1. 安装SRS步骤\"></a>1. 安装SRS步骤</h1><p>(安装Docker.dmg后, 运行下面的指令)</p>\n<p>SRS文档：<a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">https:&#x2F;&#x2F;</a><a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">ossrs.net&#x2F;lts&#x2F;zh-cn&#x2F;docs&#x2F;v4&#x2F;doc&#x2F;getting-started</a><br>首先要先把安装好的Docker启动，屏幕右上角会出现鲸鱼背楼的图标，确保其正在运行。<br> Steps to run docker: </p>\n<ol>\n<li>cd &#x2F;Users&#x2F;abc&#x2F;WebstormProjects&#x2F;srs&#x2F;srs&#x2F;trunk </li>\n<li>运行：  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com/ossrs/srs:4 ./objs/srs -c conf/docker.conf </span><br></pre></td></tr></table></figure></li>\n<li>推流（循环读取音视频文件，进行推送）<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -stream_loop -1 -i &#x27;./...&#x27; -c copy -f flv rtmp://localhost/live/livestream</span><br></pre></td></tr></table></figure>\n备注：-stream_loop 中 -1 表示无限循环；0表示 不循环；适合于小文件</li>\n</ol>\n<h1 id=\"4-播放观看\"><a href=\"#4-播放观看\" class=\"headerlink\" title=\"4. 播放观看\"></a>4. 播放观看</h1><p><a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<h1 id=\"5-外网映射\"><a href=\"#5-外网映射\" class=\"headerlink\" title=\"5. 外网映射\"></a>5. 外网映射</h1><p>注意: 映射的时候不能使用8080端口, 建议使用60000以上的端口 (因isp防火墙已封锁这些特殊的端口)<br>建议使用frp，具体的配置方法可参考<a href=\"https://freefrp.net/docs\">https://freefrp.net/docs</a>，<br>或后续的相关文字 ，运行命令：.&#x2F;frpc -c frpc.ini </p>\n<h1 id=\"2-推流方案\"><a href=\"#2-推流方案\" class=\"headerlink\" title=\"2. 推流方案\"></a>2. 推流方案</h1><h2 id=\"使用obs推流\"><a href=\"#使用obs推流\" class=\"headerlink\" title=\"使用obs推流\"></a>使用obs推流</h2><p>下载并安装 obs-studio-29.0.2-macos-arm64.dmg</p>\n<p>Obs 打开后右下角的设置 &gt;直播 &gt;服务选择自定义服务器为rtmp:&#x2F;&#x2F;localhost&#x2F;live&#x2F;, 推流码为1(可以是任意数字和字母，可理解为房间号)<br> 添加内容（音频，视频）后，点击开始直播。</p>\n<p>———播放部分———</p>\n<p>最终得到的 播放地址为： <a href=\"http://localhost:60080/live/1.flv\">http://localhost:60080/live/1.flv</a><br>工具可选用VLC或者网页形式<a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<p>经验：</p>\n<p>使用ffmpeg3流远程m3u8媒体时，经常会容易断流或电脑休眠后会断流， 这时我们最好使用 obs 转播来源为window capture的方案。</p>\n<p>20230419 Update</p>\n<p>问题：那如果我仅仅需要修改镜像文件中的某个特定的html，我要怎么做? 如果您只需要修改镜像文件中的某个特定的 HTML 文件，可以通过以下步骤来实现： 1. 下载 SRS 镜像文件并创建容器。<br>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com&#x2F;ossrs&#x2F;srs:4</p>\n<h3 id=\"2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\"><a href=\"#2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\" class=\"headerlink\" title=\"2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。\"></a>2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。</h3><p>docker exec -it <CONTAINER_ID> &#x2F;bin&#x2F;bash<br>cd &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;</p>\n<h3 id=\"3-使用文本编辑器修改-HTML-文件。\"><a href=\"#3-使用文本编辑器修改-HTML-文件。\" class=\"headerlink\" title=\"3. 使用文本编辑器修改 HTML 文件。\"></a>3. 使用文本编辑器修改 HTML 文件。</h3><p>vi index.html<br>保存修改并退出容器。 </p>\n<h3 id=\"4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\"><a href=\"#4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\" class=\"headerlink\" title=\"4. 使用 docker commit 命令将修改后的容器保存为新的镜像。\"></a>4. 使用 docker commit 命令将修改后的容器保存为新的镜像。</h3><p>docker commit <CONTAINER_ID> <NEW_IMAGE_TAG></p>\n<h3 id=\"5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\"><a href=\"#5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\" class=\"headerlink\" title=\"5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。\"></a>5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。</h3><p>docker push <NEW_IMAGE_TAG></p>\n<h3 id=\"6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\"><a href=\"#6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\" class=\"headerlink\" title=\"6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。\"></a>6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。</h3><p>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <NEW_IMAGE_TAG> 需要注意的是，这种方式只适用于修改镜像中的某个特定的文件。如果您需要对 SRS 的配置文件或者其他文件进行修改，建议使用 Dockerfile 来自定义 SRS 镜像。 ————————————————————————  </p>\n<h2 id=\"使用vMix推流\"><a href=\"#使用vMix推流\" class=\"headerlink\" title=\"使用vMix推流\"></a>使用vMix推流</h2><p>vMix: Live Video Streaming Software</p>\n<p>vMix<br><a href=\"https://www.vmix.com/\">https://www.vmix.com</a><br>vMix is a live streaming and live production software video mixer and switcher for Windows. Easily Produce, Record and Live Stream professional looking …</p>\n<p>VS OBS, it sounds like vMix is better</p>\n<p>状态：待测试</p>\n<h1 id=\"错误及解决方案\"><a href=\"#错误及解决方案\" class=\"headerlink\" title=\"错误及解决方案\"></a>错误及解决方案</h1><p>问题：vi index.html. 提示错误：bash: vi: command not found。 我要怎么办？<br>如果在容器中执行 vi 命令时提示 command not found 错误，说明容器中没有安装 vi 编辑器。</p>\n<p>您可以尝试使用其他文本编辑器来修改 HTML 文件，例如 nano 或者 emacs。这些编辑器通常已经包含在大多数 Linux 发行版中，也可以通过 apt-get 命令进行安装。</p>\n<p>例如，您可以使用以下命令来安装 nano 编辑器：</p>\n<p>apt-get update &amp;&amp; apt-get install -y nano<br>然后，使用 nano 命令来编辑 HTML 文件：</p>\n<p>nano &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;index.html<br>编辑完毕后，使用 CTRL + X 快捷键保存修改并退出编辑器。</p>\n","more":"<p>动态公网IP（Dynamic Public IP）是指由互联网服务提供商（ISP）分配给用户的动态IP地址，该地址是公共的，可以在公共互联网上访问。<br>与静态公网IP不同，动态公网IP是临时分配的，并且在一段时间后可能会更改。这意味着每次重新连接到互联网时，用户可能会被分配一个新的动态公网IP地址。</p>\n<p>动态公网IP通常用于个人用户或小型企业，因为它们相对便宜，而且不需要用户进行任何配置或管理。但是，由于其不稳定性和易变性，动态公网IP可能不适合需要稳定和持久的互联网连接的大型企业或组织。</p>\n<p>联通的adsl用户可以打10010 叫客服打开“动态公网IP” + 路由器桥接。（<a href=\"https://www.mi-d.cn/1590\">缘由：需要动态公网ip做监控或者访问服务</a>）</p>\n<p>开启动态公网IP+路由器桥接以后, 路由器上拨号即可得到一个公网IP.</p>\n<p>OpenWRT 路由器 设置端口映射， 即可将局域网内主机的端口 映射到公网IP的特定上。</p>\n<p>题外话（弯路）：（Padavan的系统，在端口映射是使用单独的工具（socat耗内存）来实现端口数据转发，OpenWrt的iptables更可靠，扎实稳定）</p>\n<p>下面以mac电脑，架设SRS服务器 来：分享流媒体至互联网。</p>\n<h1 id=\"1-安装SRS步骤\"><a href=\"#1-安装SRS步骤\" class=\"headerlink\" title=\"1. 安装SRS步骤\"></a>1. 安装SRS步骤</h1><p>(安装Docker.dmg后, 运行下面的指令)</p>\n<p>SRS文档：<a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">https:&#x2F;&#x2F;</a><a href=\"https://ossrs.net/lts/zh-cn/docs/v4/doc/getting-started\">ossrs.net&#x2F;lts&#x2F;zh-cn&#x2F;docs&#x2F;v4&#x2F;doc&#x2F;getting-started</a><br>首先要先把安装好的Docker启动，屏幕右上角会出现鲸鱼背楼的图标，确保其正在运行。<br> Steps to run docker: </p>\n<ol>\n<li>cd &#x2F;Users&#x2F;abc&#x2F;WebstormProjects&#x2F;srs&#x2F;srs&#x2F;trunk </li>\n<li>运行：  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --rm -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com/ossrs/srs:4 ./objs/srs -c conf/docker.conf </span><br></pre></td></tr></table></figure></li>\n<li>推流（循环读取音视频文件，进行推送）<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -stream_loop -1 -i &#x27;./...&#x27; -c copy -f flv rtmp://localhost/live/livestream</span><br></pre></td></tr></table></figure>\n备注：-stream_loop 中 -1 表示无限循环；0表示 不循环；适合于小文件</li>\n</ol>\n<h1 id=\"4-播放观看\"><a href=\"#4-播放观看\" class=\"headerlink\" title=\"4. 播放观看\"></a>4. 播放观看</h1><p><a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<h1 id=\"5-外网映射\"><a href=\"#5-外网映射\" class=\"headerlink\" title=\"5. 外网映射\"></a>5. 外网映射</h1><p>注意: 映射的时候不能使用8080端口, 建议使用60000以上的端口 (因isp防火墙已封锁这些特殊的端口)<br>建议使用frp，具体的配置方法可参考<a href=\"https://freefrp.net/docs\">https://freefrp.net/docs</a>，<br>或后续的相关文字 ，运行命令：.&#x2F;frpc -c frpc.ini </p>\n<h1 id=\"2-推流方案\"><a href=\"#2-推流方案\" class=\"headerlink\" title=\"2. 推流方案\"></a>2. 推流方案</h1><h2 id=\"使用obs推流\"><a href=\"#使用obs推流\" class=\"headerlink\" title=\"使用obs推流\"></a>使用obs推流</h2><p>下载并安装 obs-studio-29.0.2-macos-arm64.dmg</p>\n<p>Obs 打开后右下角的设置 &gt;直播 &gt;服务选择自定义服务器为rtmp:&#x2F;&#x2F;localhost&#x2F;live&#x2F;, 推流码为1(可以是任意数字和字母，可理解为房间号)<br> 添加内容（音频，视频）后，点击开始直播。</p>\n<p>———播放部分———</p>\n<p>最终得到的 播放地址为： <a href=\"http://localhost:60080/live/1.flv\">http://localhost:60080/live/1.flv</a><br>工具可选用VLC或者网页形式<a href=\"http://localhost:8080/players/srs_player.html\">http://localhost:8080/players/srs_player.html</a></p>\n<p>经验：</p>\n<p>使用ffmpeg3流远程m3u8媒体时，经常会容易断流或电脑休眠后会断流， 这时我们最好使用 obs 转播来源为window capture的方案。</p>\n<p>20230419 Update</p>\n<p>问题：那如果我仅仅需要修改镜像文件中的某个特定的html，我要怎么做? 如果您只需要修改镜像文件中的某个特定的 HTML 文件，可以通过以下步骤来实现： 1. 下载 SRS 镜像文件并创建容器。<br>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 registry.cn-hangzhou.aliyuncs.com&#x2F;ossrs&#x2F;srs:4</p>\n<h3 id=\"2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\"><a href=\"#2-进入容器，并找到您需要修改的-HTML-文件所在的路径。\" class=\"headerlink\" title=\"2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。\"></a>2. 进入容器，并找到您需要修改的 HTML 文件所在的路径。</h3><p>docker exec -it <CONTAINER_ID> &#x2F;bin&#x2F;bash<br>cd &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;</p>\n<h3 id=\"3-使用文本编辑器修改-HTML-文件。\"><a href=\"#3-使用文本编辑器修改-HTML-文件。\" class=\"headerlink\" title=\"3. 使用文本编辑器修改 HTML 文件。\"></a>3. 使用文本编辑器修改 HTML 文件。</h3><p>vi index.html<br>保存修改并退出容器。 </p>\n<h3 id=\"4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\"><a href=\"#4-使用-docker-commit-命令将修改后的容器保存为新的镜像。\" class=\"headerlink\" title=\"4. 使用 docker commit 命令将修改后的容器保存为新的镜像。\"></a>4. 使用 docker commit 命令将修改后的容器保存为新的镜像。</h3><p>docker commit <CONTAINER_ID> <NEW_IMAGE_TAG></p>\n<h3 id=\"5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\"><a href=\"#5-optional-将新的镜像推送到-Docker-镜像仓库中（如果需要）。\" class=\"headerlink\" title=\"5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。\"></a>5. [optional]将新的镜像推送到 Docker 镜像仓库中（如果需要）。</h3><p>docker push <NEW_IMAGE_TAG></p>\n<h3 id=\"6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\"><a href=\"#6-在部署-SRS-服务时，使用新的镜像标签来启动容器。\" class=\"headerlink\" title=\"6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。\"></a>6. 在部署 SRS 服务时，使用新的镜像标签来启动容器。</h3><p>docker run -it -p 1935:1935 -p 1985:1985 -p 8080:8080 <NEW_IMAGE_TAG> 需要注意的是，这种方式只适用于修改镜像中的某个特定的文件。如果您需要对 SRS 的配置文件或者其他文件进行修改，建议使用 Dockerfile 来自定义 SRS 镜像。 ————————————————————————  </p>\n<h2 id=\"使用vMix推流\"><a href=\"#使用vMix推流\" class=\"headerlink\" title=\"使用vMix推流\"></a>使用vMix推流</h2><p>vMix: Live Video Streaming Software</p>\n<p>vMix<br><a href=\"https://www.vmix.com/\">https://www.vmix.com</a><br>vMix is a live streaming and live production software video mixer and switcher for Windows. Easily Produce, Record and Live Stream professional looking …</p>\n<p>VS OBS, it sounds like vMix is better</p>\n<p>状态：待测试</p>\n<h1 id=\"错误及解决方案\"><a href=\"#错误及解决方案\" class=\"headerlink\" title=\"错误及解决方案\"></a>错误及解决方案</h1><p>问题：vi index.html. 提示错误：bash: vi: command not found。 我要怎么办？<br>如果在容器中执行 vi 命令时提示 command not found 错误，说明容器中没有安装 vi 编辑器。</p>\n<p>您可以尝试使用其他文本编辑器来修改 HTML 文件，例如 nano 或者 emacs。这些编辑器通常已经包含在大多数 Linux 发行版中，也可以通过 apt-get 命令进行安装。</p>\n<p>例如，您可以使用以下命令来安装 nano 编辑器：</p>\n<p>apt-get update &amp;&amp; apt-get install -y nano<br>然后，使用 nano 命令来编辑 HTML 文件：</p>\n<p>nano &#x2F;usr&#x2F;local&#x2F;srs&#x2F;objs&#x2F;nginx&#x2F;html&#x2F;index.html<br>编辑完毕后，使用 CTRL + X 快捷键保存修改并退出编辑器。</p>\n","categories":[{"name":"宽带","path":"api/categories/宽带.json"}],"tags":[{"name":"动态公网IP","path":"api/tags/动态公网IP.json"},{"name":"SRS","path":"api/tags/SRS.json"},{"name":"Obs","path":"api/tags/Obs.json"},{"name":"vMix","path":"api/tags/vMix.json"}]}