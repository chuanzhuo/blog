{"title":"Improving Artalk Comments to Version 2.8.3 and Resolving Error (Request Response 404)","slug":"升级Artalk评论至V2-8-3-解决Error-请求响应404","date":"2024-03-28T08:54:36.000Z","updated":"2024-10-25T14:42:55.667Z","comments":true,"path":"api/articles/升级Artalk评论至V2-8-3-解决Error-请求响应404.json","excerpt":" [Figure] Updating Artalk comments to version 2.8.3 and addressing the Artalk Error: Request Response 404, which prevented fetching the comment list data.","covers":["https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png","https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png"],"content":"<p><img data-src=\"https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png\" alt=\"image-20240328164913925\"></p>\n<p>Updating Artalk comments to version 2.8.3 and addressing the Artalk Error: Request Response 404, which prevented fetching the comment list data.</p>\n<span id=\"more\"></span>\n\n<div> \n<button onclick=\"synthesizeSpeech()\">Read</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n\n<h2 id=\"Purpose\"><a href=\"#Purpose\" class=\"headerlink\" title=\"Purpose\"></a>Purpose</h2><p>Upgrading Artalk comments to version 2.8.3.</p>\n<p>Resolving Artalk Error: Request Response 404, which hindered fetching the comment list data.</p>\n<h1 id=\"Related\"><a href=\"#Related\" class=\"headerlink\" title=\"Related\"></a>Related</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=artalk\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h2 id=\"Journey\"><a href=\"#Journey\" class=\"headerlink\" title=\"Journey\"></a>Journey</h2><p>Artalk’s SMTP configuration has consistently failed to send emails. The root cause remains unclear. Is it due to certificates or lack of logs? How can validation be bypassed? Hence, the immediate step is to attempt an upgrade. The current version in Docker output is:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Artalk (v2.6.4/8867eb2)     </span><br></pre></td></tr></table></figure>\n\n<p>Ref: <a href=\"https://github.com/ArtalkJS/Artalk/issues/748\">Artalk Issue #748</a></p>\n<p>The decision is made to upgrade Artalk to the latest version available!</p>\n<p>Upgrade Steps:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Start by shutting down Artalk service</span></span><br><span class=\"line\">docker-compose down</span><br><span class=\"line\"></span><br><span class=\"line\">docker-compose pull</span><br><span class=\"line\">docker-compose up --remove-orphans </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Clean up old versions of Artalk Docker images</span></span><br><span class=\"line\">docker image prune</span><br></pre></td></tr></table></figure>\n\n<p>With these commands, Artalk is upgraded to the latest version: Artalk (v2.8.3&#x2F;8af7136)</p>\n<p>However, upon upgrading, an error is encountered: Request Response 404.</p>\n<p>Artalk Error: Request Response 404 - Unable to fetch comment list data.<br>Click to retry | Open console</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png\" alt=\"image-20240328164913925\"></p>\n<p>Solution:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">404 (Not Found) - The server cannot find the requested page.</span><br></pre></td></tr></table></figure>\n\n<p>After thorough checks and testing, it’s confirmed that Docker startup is functioning normally.</p>\n<p>There’s a strong suspicion that the error stems from an outdated Hexo version, leading to page request errors.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">NexT</span>.<span class=\"property\">utils</span>.<span class=\"title function_\">loadComments</span>(<span class=\"variable constant_\">CONFIG</span>.<span class=\"property\">artalk</span>.<span class=\"property\">el</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">then</span>(<span class=\"function\">() =&gt;</span> <span class=\"title class_\">NexT</span>.<span class=\"property\">utils</span>.<span class=\"title function_\">getScript</span>(<span class=\"variable constant_\">CONFIG</span>.<span class=\"property\">artalk</span>.<span class=\"property\">jsUrl</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">condition</span>: <span class=\"variable language_\">window</span>.<span class=\"property\">Artalk</span> </span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">  .<span class=\"title function_\">then</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Artalk</span>.<span class=\"title function_\">init</span>(<span class=\"variable constant_\">CONFIG</span>.<span class=\"property\">artalk</span>);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>The problem transforms into: how to upgrade Hexo?</p>\n<p>Upon review the next day, it’s concluded that the server-side Artalk has been reinstalled with the latest version (while retaining the original data). Therefore, the issue likely lies in integrating with Hexo. It’s essentially a matter of Node installation on the server, Hexo-related configurations, and the JS client, each of which is examined:</p>\n<p>Attempting to update the Hexo Artalk plugin:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-next-artalk</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Returns <span class=\"string\">&#x27;up to date&#x27;</span>, indicating the plugin is already at the latest version</span></span><br></pre></td></tr></table></figure>\n\n<p>By chance, notice that the _config.yml file in Hexo references a specific version of Artalk (an older version):</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\">        <span class=\"comment\">#https://cdn.staticfile.org/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n<p>It’s imperative to update these references to the latest version pulled via docker-compose:</p>\n<p>Utilizing <a href=\"https://cdnjs.com/libraries/artalk\">cdnjs</a></p>\n<p>After modifying the _config.yml file in Hexo to reference the latest version of Artalk for both JS and CSS, and leveraging <a href=\"https://cdnjs.com/libraries/artalk\">cdnjs</a>, the following steps are executed:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\"></span><br><span class=\"line\">hexo g &amp;&amp; hexo s</span><br></pre></td></tr></table></figure>\n\n<p>The 404 error is successfully resolved.</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n<p>Next Step: Continue investigating and testing Artalk V2.8.3’s SMTP notification sending functionality.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com</span><br></pre></td></tr></table></figure>\n\n<p>ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead</p>\n<p>Even when changing the SMTP port to 25, the error persists:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com   </span><br></pre></td></tr></table></figure>\n\n<p>The suspicion grows: the next issue to tackle is the <code>artalk | FATAL tls: provide a valid cert or key path</code>.</p>\n<h2 id=\"Release-Notes\"><a href=\"#Release-Notes\" class=\"headerlink\" title=\"Release Notes\"></a>Release Notes</h2><p>Ensure that the modifications made to the JS and CSS files in the _config.yml are <strong>synced</strong> to the English version of the site under the &#x2F;en directory. Otherwise, the comment functionality in the English version might also encounter the Error: Request Response 404.</p>\n<h2 id=\"Sources-of-Inspiration\"><a href=\"#Sources-of-Inspiration\" class=\"headerlink\" title=\"Sources of Inspiration\"></a>Sources of Inspiration</h2><p>[Customizing Hexo for Broad Artalk Deployment](</p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">Read</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"ZH\";\n    var url = 'https://tts.carlzeng.com:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n\n<h2 id=\"Purpose\"><a href=\"#Purpose\" class=\"headerlink\" title=\"Purpose\"></a>Purpose</h2><p>Upgrading Artalk comments to version 2.8.3.</p>\n<p>Resolving Artalk Error: Request Response 404, which hindered fetching the comment list data.</p>\n<h1 id=\"Related\"><a href=\"#Related\" class=\"headerlink\" title=\"Related\"></a>Related</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.com:3/appsearch?q=artalk\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h2 id=\"Journey\"><a href=\"#Journey\" class=\"headerlink\" title=\"Journey\"></a>Journey</h2><p>Artalk’s SMTP configuration has consistently failed to send emails. The root cause remains unclear. Is it due to certificates or lack of logs? How can validation be bypassed? Hence, the immediate step is to attempt an upgrade. The current version in Docker output is:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Artalk (v2.6.4/8867eb2)     </span><br></pre></td></tr></table></figure>\n\n<p>Ref: <a href=\"https://github.com/ArtalkJS/Artalk/issues/748\">Artalk Issue #748</a></p>\n<p>The decision is made to upgrade Artalk to the latest version available!</p>\n<p>Upgrade Steps:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Start by shutting down Artalk service</span></span><br><span class=\"line\">docker-compose down</span><br><span class=\"line\"></span><br><span class=\"line\">docker-compose pull</span><br><span class=\"line\">docker-compose up --remove-orphans </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Clean up old versions of Artalk Docker images</span></span><br><span class=\"line\">docker image prune</span><br></pre></td></tr></table></figure>\n\n<p>With these commands, Artalk is upgraded to the latest version: Artalk (v2.8.3&#x2F;8af7136)</p>\n<p>However, upon upgrading, an error is encountered: Request Response 404.</p>\n<p>Artalk Error: Request Response 404 - Unable to fetch comment list data.<br>Click to retry | Open console</p>\n<p><img data-src=\"https://img.carlzeng.com:3/i/2024/03/28/66052f49a5cf8.png\" alt=\"image-20240328164913925\"></p>\n<p>Solution:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">404 (Not Found) - The server cannot find the requested page.</span><br></pre></td></tr></table></figure>\n\n<p>After thorough checks and testing, it’s confirmed that Docker startup is functioning normally.</p>\n<p>There’s a strong suspicion that the error stems from an outdated Hexo version, leading to page request errors.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">NexT</span>.<span class=\"property\">utils</span>.<span class=\"title function_\">loadComments</span>(<span class=\"variable constant_\">CONFIG</span>.<span class=\"property\">artalk</span>.<span class=\"property\">el</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">then</span>(<span class=\"function\">() =&gt;</span> <span class=\"title class_\">NexT</span>.<span class=\"property\">utils</span>.<span class=\"title function_\">getScript</span>(<span class=\"variable constant_\">CONFIG</span>.<span class=\"property\">artalk</span>.<span class=\"property\">jsUrl</span>, &#123;</span><br><span class=\"line\">    <span class=\"attr\">condition</span>: <span class=\"variable language_\">window</span>.<span class=\"property\">Artalk</span> </span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">  .<span class=\"title function_\">then</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Artalk</span>.<span class=\"title function_\">init</span>(<span class=\"variable constant_\">CONFIG</span>.<span class=\"property\">artalk</span>);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>The problem transforms into: how to upgrade Hexo?</p>\n<p>Upon review the next day, it’s concluded that the server-side Artalk has been reinstalled with the latest version (while retaining the original data). Therefore, the issue likely lies in integrating with Hexo. It’s essentially a matter of Node installation on the server, Hexo-related configurations, and the JS client, each of which is examined:</p>\n<p>Attempting to update the Hexo Artalk plugin:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-next-artalk</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Returns <span class=\"string\">&#x27;up to date&#x27;</span>, indicating the plugin is already at the latest version</span></span><br></pre></td></tr></table></figure>\n\n<p>By chance, notice that the _config.yml file in Hexo references a specific version of Artalk (an older version):</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\">        <span class=\"comment\">#https://cdn.staticfile.org/artalk/2.6.4/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.6.4/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n<p>It’s imperative to update these references to the latest version pulled via docker-compose:</p>\n<p>Utilizing <a href=\"https://cdnjs.com/libraries/artalk\">cdnjs</a></p>\n<p>After modifying the _config.yml file in Hexo to reference the latest version of Artalk for both JS and CSS, and leveraging <a href=\"https://cdnjs.com/libraries/artalk\">cdnjs</a>, the following steps are executed:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\"></span><br><span class=\"line\">hexo g &amp;&amp; hexo s</span><br></pre></td></tr></table></figure>\n\n<p>The 404 error is successfully resolved.</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">jsUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.js</span></span><br><span class=\"line\"><span class=\"attr\">cssUrl:</span> <span class=\"string\">https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.3/Artalk.min.css</span></span><br></pre></td></tr></table></figure>\n\n<p>Next Step: Continue investigating and testing Artalk V2.8.3’s SMTP notification sending functionality.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com</span><br></pre></td></tr></table></figure>\n\n<p>ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead</p>\n<p>Even when changing the SMTP port to 25, the error persists:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">artalk  | ERROR Email: Email sending failed via SMTP tls: failed to verify certificate: x509: certificate relies on legacy Common Name field, use SANs instead                                                        </span><br><span class=\"line\">artalk  | ERROR Email: Failed send email to addr: wangyouxiaosong@outlook.com   </span><br></pre></td></tr></table></figure>\n\n<p>The suspicion grows: the next issue to tackle is the <code>artalk | FATAL tls: provide a valid cert or key path</code>.</p>\n<h2 id=\"Release-Notes\"><a href=\"#Release-Notes\" class=\"headerlink\" title=\"Release Notes\"></a>Release Notes</h2><p>Ensure that the modifications made to the JS and CSS files in the _config.yml are <strong>synced</strong> to the English version of the site under the &#x2F;en directory. Otherwise, the comment functionality in the English version might also encounter the Error: Request Response 404.</p>\n<h2 id=\"Sources-of-Inspiration\"><a href=\"#Sources-of-Inspiration\" class=\"headerlink\" title=\"Sources of Inspiration\"></a>Sources of Inspiration</h2><p>[Customizing Hexo for Broad Artalk Deployment](</p>","categories":[{"name":"Artalk","path":"api/categories/Artalk.json"}],"tags":[{"name":"debian","path":"api/tags/debian.json"},{"name":"hexo","path":"api/tags/hexo.json"},{"name":"artalk","path":"api/tags/artalk.json"},{"name":"Nginx Proxy Manager","path":"api/tags/Nginx Proxy Manager.json"},{"name":"DDNS","path":"api/tags/DDNS.json"},{"name":"openwrt","path":"api/tags/openwrt.json"},{"name":"linux","path":"api/tags/linux.json"}]}