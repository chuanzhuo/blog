{"title":"Self-hosted Email Server with Docker - Private Mail System","slug":"Docker自建Email服务器-已购域名上私人邮件系统","date":"2024-03-01T03:30:00.000Z","updated":"2024-05-14T02:51:36.562Z","comments":true,"path":"api/articles/Docker自建Email服务器-已购域名上私人邮件系统.json","excerpt":" [Figure] Establishing an email service applicable for individuals, companies, or organizations.This chapter contains detailed technical documentation and troubleshooting steps encountered during the setup and maintenance of a self-hosted email server using Docker. If you have any further questions or encounter issues, feel free to refer back to this guide for assistance.","covers":["https://img.carlzeng.top:3/i/2024/03/01/65e1492380515.png","https://img.carlzeng.top:3/i/2024/02/29/65dfda2b7efb5.png","https://img.carlzeng.top:3/i/2024/02/29/65e0282f016cc.png","https://img.carlzeng.top:3/i/2024/02/29/65e0289fe89be.png","https://img.carlzeng.top:3/i/2024/03/21/65fc214953f21.png","https://img.carlzeng.top:3/i/2024/03/22/65fccd6f7a5fc.png","https://img.carlzeng.top:3/i/2024/03/01/65e139600f9ea.png","https://img.carlzeng.top:3/i/2024/03/01/65e140a62c982.png","https://img.carlzeng.top:3/i/2024/03/28/6605735e21430.png","https://img.carlzeng.top:3/i/2024/04/23/66271bd148a22.png","https://img.carlzeng.top:3/i/2024/04/23/662722fde4c91.png"],"content":"<img class=\"lozad\" data-src=\"https://img.carlzeng.top:3/i/2024/03/01/65e1492380515.png\">\n\n<p>Establishing an email service applicable for individuals, companies, or organizations.</p>\n<p>This chapter contains detailed technical documentation and troubleshooting steps encountered during the setup and maintenance of a self-hosted email server using Docker. If you have any further questions or encounter issues, feel free to refer back to this guide for assistance.</p>\n<span id=\"more\"></span>\n\n<p>Note: This is the only simplified and operational mail system I found. Please leave a comment to let me know if you have a better self-hosted solution.</p>\n<p>After encountering numerous challenges and investing around a month’s time, I eventually succeeded in testing email sending and receiving (some emails could not be delivered to their intended destinations due to anti-spam policies on the internet). Continuously updating and improving the system.</p>\n<p>On March 18, 2024 added a new section: “Maintenance Scheduled Tasks.”</p>\n<p>On March 22, 2024 added a new section: “SMTP Service Testing” and corrected the SPF DNS settings content; also noted an alternative solution: <a href=\"https://lala.im/8977.html\">Stalwart Mail Server (All-in-One Mail Server)</a>.</p>\n<p>Next step: A friend proposed a new requirement: How to send emails in batches?</p>\n<div> \n<button onclick=\"synthesizeSpeech()\">Read Full Article</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"EN\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n\n<h1 id=\"How-to-Use\"><a href=\"#How-to-Use\" class=\"headerlink\" title=\"How to Use\"></a>How to Use</h1><ul>\n<li><p>Sending and receiving emails daily</p>\n<ul>\n<li>Receive and send emails under your own domain by setting up an email service.</li>\n</ul>\n</li>\n<li><p>SMTP services to be configured on third-party platforms (or self-hosted services) for email notifications&#x2F;information.</p>\n</li>\n</ul>\n<h1 id=\"Related-Content\"><a href=\"#Related-Content\" class=\"headerlink\" title=\"Related Content\"></a>Related Content</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=email\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"Implementation-Method\"><a href=\"#Implementation-Method\" class=\"headerlink\" title=\"Implementation Method\"></a>Implementation Method</h1><h2 id=\"iRedMail-Docker-Setup\"><a href=\"#iRedMail-Docker-Setup\" class=\"headerlink\" title=\"iRedMail Docker Setup\"></a>iRedMail Docker Setup</h2><p>iRedMail docker-compose.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.9&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">        <span class=\"attr\">mariadb:</span></span><br><span class=\"line\">            <span class=\"attr\">image:</span> <span class=\"string\">&#x27;iredmail/mariadb:stable&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">volumes:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./postfix_queue:/var/spool/postfix&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./sa_rules:/var/lib/spamassassin&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./clamav:/var/lib/clamav&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mysql:/var/lib/mysql&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./ssl:/opt/iredmail/ssl&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./custom:/opt/iredmail/custom&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./imapsieve_copy:/var/vmail/imapsieve_copy&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mlmmj-archive:/var/vmail/mlmmj-archive&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mlmmj:/var/vmail/mlmmj&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mailboxes:/var/vmail/vmail1&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./backup-mysql:/var/vmail/backup/mysql&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&quot;/etc/localtime:/etc/localtime:ro&quot;</span> <span class=\"comment\"># This corrects the time zone of the mail system</span></span><br><span class=\"line\">            <span class=\"attr\">ports:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;587:587&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;465:465&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;25:25&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;993:993&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;143:143&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;995:995&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;110:110&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;4433:443&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;8093:80&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">env_file:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">./iredmail-docker.conf</span></span><br><span class=\"line\">            <span class=\"attr\">container_name:</span> <span class=\"string\">iRedMail</span></span><br></pre></td></tr></table></figure>\n\n<p>Upon Docker start-up, if everything is functioning correctly, the debug information will resemble:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/02/29/65dfda2b7efb5.png\" alt=\"Debug output after successfully starting iRedMail in Docker\"></p>\n<p>Once everything is running smoothly, proceed with setting up DNS records, followed by firewall port mappings.</p>\n<p>Finally, use the system’s built-in webmail client to send and receive emails, or configure SMTP&#x2F;POP3 in clients like Outlook for email communication.</p>\n<h2 id=\"Configure-DNS-Records\"><a href=\"#Configure-DNS-Records\" class=\"headerlink\" title=\"Configure DNS Records\"></a>Configure DNS Records</h2><p>Your DNS MX record should point to this value</p>\n<p>Example of DNS settings:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/02/29/65e0282f016cc.png\" alt=\"image-20240229144603695\"></p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/02/29/65e0289fe89be.png\" alt=\"image-20240229144758944\"></p>\n<table>\n<thead>\n<tr>\n<th>DNS Type</th>\n<th>DNS Record Name</th>\n<th>Content&#x2F;Value</th>\n<th>Comments&#x2F;Remarks</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>MX</td>\n<td>carlzeng.top.</td>\n<td>mail.carlzeng.top.</td>\n<td>Identifies the mail server name, DNS MX entry</td>\n</tr>\n<tr>\n<td>A</td>\n<td>mail.carlzeng.top.</td>\n<td>*.8.18.*</td>\n<td>IP address of the mail server</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>carlzeng.top.</td>\n<td>v&#x3D;spf1 mx -all</td>\n<td>SPF entry&#x2F;record</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>dkim._domainkey.carlzeng.top.</td>\n<td>v&#x3D;DKIM1; k&#x3D;rsm; p&#x3D;*</td>\n<td>DKIM entry&#x2F;record, includes the DKIM public key</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>dmarc.carlzeng.top</td>\n<td>v&#x3D;DMARC1; p&#x3D; reject; rua&#x3D;*</td>\n<td>DMARC entry&#x2F;record</td>\n</tr>\n</tbody></table>\n<p>Question: How to retrieve the three TXT records from the iRedMail mail system?</p>\n<p>Answer: After installation: <a href=\"https://docs.iredmail.org/setup.dns.html#mx\">Setup DNS records for your iRedMail server (A, PTR, MX, SPF, DKIM, DMARC)</a></p>\n<p>If you wish to validate the correctness of DNS records, you can use: <a href=\"https://mxtoolbox.com/\">https://mxtoolbox.com/</a></p>\n<h3 id=\"SPF-Record-Correction\"><a href=\"#SPF-Record-Correction\" class=\"headerlink\" title=\"SPF Record Correction\"></a>SPF Record Correction</h3><p>According to the SMTP test report, there might be an error in this record.</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/21/65fc214953f21.png\" alt=\"image-20240321195957875\"></p>\n<p>v&#x3D;spf1 mx a:mail.carlzeng.top -all</p>\n<p>After modifying the SPF record, it has not been updated even after about half an hour. Continuous monitoring in progress…</p>\n<p>After correcting the SPF-related DNS records and testing SMTP again, it showed successful:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/22/65fccd6f7a5fc.png\" alt=\"image-20240322081436077\"></p>\n<h3 id=\"DKIM-Record-Content-Acquisition\"><a href=\"#DKIM-Record-Content-Acquisition\" class=\"headerlink\" title=\"DKIM Record Content Acquisition\"></a>DKIM Record Content Acquisition</h3><p>When it comes to obtaining the content&#x2F;value of dkim._domainkey.mydomain.com, for example:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">docker <span class=\"built_in\">exec</span> -it iRedMail bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">root@cc9dd27b3e25:/etc/amavis/conf.d# amavisd-new showkeys</span><br><span class=\"line\">; key#1 1024 bits, i=dkim, d=carlzeng.top, /opt/iredmail/custom/amavisd/dkim/carlzeng.top.pem</span><br><span class=\"line\">dkim._domainkey.carlzeng.top.   3600 TXT (</span><br><span class=\"line\">  &quot;v=DKIM1; p=&quot;</span><br><span class=\"line\">  &quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDUF5BslOb2fARJjXK41xsAPSg&quot;</span><br><span class=\"line\">  &quot;hToQAkJzRuxp5pwaCyqPzIbFNxTZ66z9yw+rbeXYKdpu3bKemHhKVQ7rvnmVlFFL&quot;</span><br><span class=\"line\">  &quot;Nvef7Pk9ddT/nur2T1sfUY6yDu5QRcZArClAQRjfNCFRA11VgsD5q6OKS5GTNtE5&quot;</span><br><span class=\"line\">  &quot;dz3kJGpVdCllilo4OwIDAQAB&quot;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"DMARC-Record-Content\"><a href=\"#DMARC-Record-Content\" class=\"headerlink\" title=\"DMARC Record Content\"></a>DMARC Record Content</h3><figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">v</span>=DMARC1<span class=\"comment\">; p=reject; sp=none; adkim=s; aspf=s; rua=mailto:postmaster@carlzeng.top; ruf=mailto:postmaster@carlzeng.top</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Port-Mapping\"><a href=\"#Port-Mapping\" class=\"headerlink\" title=\"Port Mapping\"></a>Port Mapping</h3><p>The purpose of this step is to ensure that the data related to email received on the router is correctly forwarded to the appropriate mail service system.</p>\n<table>\n<thead>\n<tr>\n<th>External Port</th>\n<th>Internal NAS&#x2F;Mail Host Port</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>‘587:587’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘465:465’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘25:25’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘993:993’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘143:143’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘995:995’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘110:110’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>4433</td>\n<td>4433</td>\n<td>Access to port 443 may be added</td>\n</tr>\n</tbody></table>\n<p>Mapping these ports one by one, fortunately, these ports have not been blocked by the Internet Service Provider (ISP) yet.</p>\n<h3 id=\"Setup-for-SMTP-Email-Sending\"><a href=\"#Setup-for-SMTP-Email-Sending\" class=\"headerlink\" title=\"Setup for SMTP Email Sending\"></a>Setup for SMTP Email Sending</h3><p>For instance, setting up email information in <a href=\"https://bestbuy.carlzeng.top:3/admin#/smtp\">Bestbuy Purchase Cards Kamifaka</a> to be used for email notifications.</p>\n<p>Error: Unable to successfully reach the email destination</p>\n<p>Solution: Please refer to the section ‘SMTP Service Testing’ for details on resolving this issue. </p>\n<p>By adjusting the DNS record related to SPF (found it effective the next day), testing again; successfully sent a test email.</p>\n<h3 id=\"Errors-and-Solutions\"><a href=\"#Errors-and-Solutions\" class=\"headerlink\" title=\"Errors and Solutions\"></a>Errors and Solutions</h3><h4 id=\"Docker-Startup-Error-“Permission-denied”\"><a href=\"#Docker-Startup-Error-“Permission-denied”\" class=\"headerlink\" title=\"Docker Startup Error - “Permission denied”\"></a>Docker Startup Error - “Permission denied”</h4><p>iRedMail | &#x2F;usr&#x2F;sbin&#x2F;mysqld: Can’t create file ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysqld.err’ (errno: 13 “Permission denied”)<br>iRedMail | 2024-02-28 16:12:07 0 [ERROR] mysqld: Can’t create&#x2F;write to file ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;aria_log_control’ (Errcode: 13 “Permission denied”)</p>\n<p>Solution: Adjust permissions for the mentioned directories.</p>\n<h4 id=\"DNS-Configuration-Error-No-DMARC-Record-Found\"><a href=\"#DNS-Configuration-Error-No-DMARC-Record-Found\" class=\"headerlink\" title=\"DNS Configuration Error - No DMARC Record Found\"></a>DNS Configuration Error - No DMARC Record Found</h4><p>Solution: Ensure the correct DNS record name for DMARC DNS entry must include an underscore: _dmarc</p>\n<h4 id=\"iRedAdmin-Operates-Without-Carrying-Port-Error\"><a href=\"#iRedAdmin-Operates-Without-Carrying-Port-Error\" class=\"headerlink\" title=\"iRedAdmin Operates Without Carrying Port Error\"></a>iRedAdmin Operates Without Carrying Port Error</h4><p>Error: The backend operation <a href=\"https://iredmail.carlzeng.top:3/iredadmin\">https://iredmail.carlzeng.top:3/iredadmin</a>, when submitting a new confirmation operation, the page redirects without carrying the port status.</p>\n<p>Solution: Investigate and resolve the issue for automatic port retrieval.</p>\n<p>When submitting a new confirmation operation to the backend at <a href=\"https://iredmail.carlzeng.top:3/iredadmin\">https://iredmail.carlzeng.top:3/iredadmin</a>, the page redirects without carrying the port status.</p>\n<p>Error Resolution:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/01/65e139600f9ea.png\" alt=\"image-20240301101140381\"></p>\n<p>The issue of automatic port retrieval has not been resolved. I will continue to test after restarting Docker.</p>\n<h3 id=\"iCloud-Communication-Blockage-Rejected-Due-to-Listing-in-Spamhaus-PBL\"><a href=\"#iCloud-Communication-Blockage-Rejected-Due-to-Listing-in-Spamhaus-PBL\" class=\"headerlink\" title=\"iCloud Communication Blockage - Rejected Due to Listing in Spamhaus PBL\"></a>iCloud Communication Blockage - Rejected Due to Listing in Spamhaus PBL</h3><p>When attempting to send email to host mx01.mail.icloud.com[17.56.9.31], it was rejected due to listing in Spamhaus PBL.</p>\n<p>Solution:</p>\n<p>Submit an unblocking request on the provided <a href=\"https://check.spamhaus.org/\">IP AND DOMAIN REPUTATION CHECKER website</a>, and upon successful submission, results should reflect as shown in the image below:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/01/65e140a62c982.png\" alt=\"image-20240301104242813\"></p>\n<h3 id=\"Self-Blocking-of-Program-Emails-as-SPAM\"><a href=\"#Self-Blocking-of-Program-Emails-as-SPAM\" class=\"headerlink\" title=\"Self-Blocking of Program Emails as SPAM\"></a>Self-Blocking of Program Emails as SPAM</h3><p>The SMTP configuration from the website platform led to program emails being tagged as SPAM. The system mistakenly identified these emails as possible spam. </p>\n<p>Solution: The method to stop the excessive SPAM detection for self-sent emails is currently unknown.</p>\n<h3 id=\"Maintenance-of-Scheduled-Tasks\"><a href=\"#Maintenance-of-Scheduled-Tasks\" class=\"headerlink\" title=\"Maintenance of Scheduled Tasks\"></a>Maintenance of Scheduled Tasks</h3><p>Receiving 6 system automated backup emails daily led to managing the daily emails.</p>\n<p>Solution: Edited the Linux scheduled tasks and removed unnecessary backup tasks for a cleaner email experience. </p>\n<h3 id=\"Email-System-Time-Zone-Correction\"><a href=\"#Email-System-Time-Zone-Correction\" class=\"headerlink\" title=\"Email System Time Zone Correction\"></a>Email System Time Zone Correction</h3><p>Modified the docker-compose file to include a volume entry to rectify the email system’s time zone:</p>\n<p>“&#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime:ro” - This entry corrects the email system’s time zone.</p>\n<h3 id=\"SMTP-Service-Testing\"><a href=\"#SMTP-Service-Testing\" class=\"headerlink\" title=\"SMTP Service Testing\"></a>SMTP Service Testing</h3><p>Utilized SMTP Test Tool and Email Check Spam Score and Improve Quality to assess the SMTP service health and improve email quality.</p>\n<h3 id=\"iredMail-Certificate-Configuration\"><a href=\"#iredMail-Certificate-Configuration\" class=\"headerlink\" title=\"iredMail Certificate Configuration\"></a>iredMail Certificate Configuration</h3><p>Upon utilizing <a href=\"http://www.checktls.com/\">http://www.checktls.com/</a>, it became evident that the Zendesk TLS certificate lacks specificity for the mail.pod-4 host.</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/28/6605735e21430.png\" alt=\"image-20240328214042643\"></p>\n<p>From this observation, it appears to be an issue with the self-signed certificate. How can we replace and generate a new certificate?</p>\n<p>Here are the steps for testing the configuration:</p>\n<ol>\n<li>Download the wildcard domain certificate generated in NPM, resulting in a certificate.zip file containing four files.</li>\n<li>Upload fullchain.pem and privkey.pem to the mapped directory (&#x2F;KingchuxingSSD512G&#x2F;docker&#x2F;compose&#x2F;iRedMail&#x2F;ssl), renaming them to iRedMail.crt and iRedMail.key, respectively. Repeat this process for backup purposes.</li>\n<li>Test using <a href=\"https://www.ssllabs.com/ssltest/index.html\">https://www.ssllabs.com/ssltest/index.html</a> and <a href=\"https://www.checktls.com/\">https://www.checktls.com/</a>.</li>\n</ol>\n<p>Reference for this section:</p>\n<p><a href=\"https://docs.iredmail.org/use.a.bought.ssl.certificate.html\">Use a bought SSL certificate</a></p>\n<p><a href=\"https://docs.iredmail.org/letsencrypt.html\">Request a free cert from Let’s Encrypt (for servers deployed with downloadable iRedMail installer)</a></p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/23/66271bd148a22.png\" alt=\"image-20240423102406511\"></p>\n<p>Ensure that the certificate is for mail.carlzeng.top and use the dns challenge method with dns_cloudflare_api_token.</p>\n<p>Processing… This might take a few minutes.</p>\n<p>To obtain the certificate, it was discovered that using the Global API Key was incorrect; instead, the “API Token” section’s ‘Create Token’ was required. Edit the DNS zone accordingly.</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/23/662722fde4c91.png\" alt=\"image-20240423105448516\"></p>\n<p>Execute the following commands:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp mail.jbritian.com_bundle.crt cert.pem </span><br><span class=\"line\"></span><br><span class=\"line\">cp mail.jbritian.com_bundle.crt combined.pem </span><br><span class=\"line\"></span><br><span class=\"line\">cp mail.jbritian.com.key key.pem</span><br></pre></td></tr></table></figure>\n\n<p>Rename:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cert1.pem  to  cert.pem </span><br><span class=\"line\"></span><br><span class=\"line\">fullchain1.pem  to  combined.pem</span><br><span class=\"line\"></span><br><span class=\"line\">privkey1.pem  to  key.pem</span><br></pre></td></tr></table></figure>\n\n<p>Ensure all components are mapped correctly to the container’s &#x2F;opt&#x2F;iredmail&#x2F;ssl directory.</p>\n<p>Then, create symbolic links:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /etc/letsencrypt/live/mail.mydomain.com/fullchain.pem /etc/ssl/certs/iRedMail.crt</span><br><span class=\"line\">ln -s /etc/letsencrypt/live/mail.mydomain.com/privkey.pem /etc/ssl/private/iRedMail.key</span><br></pre></td></tr></table></figure>\n\n<p>Review these components to ensure they are correctly mapped within the container:</p>\n<ul>\n<li>Postfix: File &#x2F;etc&#x2F;postfix&#x2F;main.cf (on Linux&#x2F;OpenBSD)</li>\n<li>Dovecot: File <code>/etc/dovecot/dovecot.conf</code> (on Linux&#x2F;OpenBSD)</li>\n<li>Nginx: File &#x2F;etc&#x2F;nginx&#x2F;templates&#x2F;ssl.tmpl (on Linux&#x2F;OpenBSD)</li>\n<li>MySQL, MariaDB: On Debian and Ubuntu, it’s defined in &#x2F;etc&#x2F;mysql&#x2F;my.cnf.</li>\n</ul>\n<p>Modify TXT records:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v=spf1 a mx include:_spf.google.com ~all</span><br><span class=\"line\">v=spf1 mx -all</span><br></pre></td></tr></table></figure>\n\n<p>These are the instructions for configuring the iRedMail certificate.</p>\n<h1 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h1><p><a href=\"https://kydsj.vip/doku.php?id=wiki:%E8%87%AA%E6%89%98%E7%AE%A1-%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6\">Open Source Universe - Self-hosted - Email</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=qnnf3LWcUXA\">Running iRedMail E-Mail Server in Docker</a></p>\n<p><a href=\"https://docs.iredmail.org/setup.dns.html#mx\">Setup DNS records for your iRedMail server (A, PTR, MX, SPF, DKIM, DMARC)</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=ScarlmgD0dU\">From zero to full mail server in 20 minutes with Mailu Docker images!</a></p>\n<p><a href=\"%E5%BE%85%E7%BB%AD...\">HTTPS&#x2F;SSL Certificate Configuration</a></p>\n","more":"<p>Note: This is the only simplified and operational mail system I found. Please leave a comment to let me know if you have a better self-hosted solution.</p>\n<p>After encountering numerous challenges and investing around a month’s time, I eventually succeeded in testing email sending and receiving (some emails could not be delivered to their intended destinations due to anti-spam policies on the internet). Continuously updating and improving the system.</p>\n<p>On March 18, 2024 added a new section: “Maintenance Scheduled Tasks.”</p>\n<p>On March 22, 2024 added a new section: “SMTP Service Testing” and corrected the SPF DNS settings content; also noted an alternative solution: <a href=\"https://lala.im/8977.html\">Stalwart Mail Server (All-in-One Mail Server)</a>.</p>\n<p>Next step: A friend proposed a new requirement: How to send emails in batches?</p>\n<div> \n<button onclick=\"synthesizeSpeech()\">Read Full Article</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"EN\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n\n\n<h1 id=\"How-to-Use\"><a href=\"#How-to-Use\" class=\"headerlink\" title=\"How to Use\"></a>How to Use</h1><ul>\n<li><p>Sending and receiving emails daily</p>\n<ul>\n<li>Receive and send emails under your own domain by setting up an email service.</li>\n</ul>\n</li>\n<li><p>SMTP services to be configured on third-party platforms (or self-hosted services) for email notifications&#x2F;information.</p>\n</li>\n</ul>\n<h1 id=\"Related-Content\"><a href=\"#Related-Content\" class=\"headerlink\" title=\"Related Content\"></a>Related Content</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=email\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"Implementation-Method\"><a href=\"#Implementation-Method\" class=\"headerlink\" title=\"Implementation Method\"></a>Implementation Method</h1><h2 id=\"iRedMail-Docker-Setup\"><a href=\"#iRedMail-Docker-Setup\" class=\"headerlink\" title=\"iRedMail Docker Setup\"></a>iRedMail Docker Setup</h2><p>iRedMail docker-compose.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.9&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">        <span class=\"attr\">mariadb:</span></span><br><span class=\"line\">            <span class=\"attr\">image:</span> <span class=\"string\">&#x27;iredmail/mariadb:stable&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">volumes:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./postfix_queue:/var/spool/postfix&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./sa_rules:/var/lib/spamassassin&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./clamav:/var/lib/clamav&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mysql:/var/lib/mysql&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./ssl:/opt/iredmail/ssl&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./custom:/opt/iredmail/custom&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./imapsieve_copy:/var/vmail/imapsieve_copy&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mlmmj-archive:/var/vmail/mlmmj-archive&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mlmmj:/var/vmail/mlmmj&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./mailboxes:/var/vmail/vmail1&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./backup-mysql:/var/vmail/backup/mysql&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&quot;/etc/localtime:/etc/localtime:ro&quot;</span> <span class=\"comment\"># This corrects the time zone of the mail system</span></span><br><span class=\"line\">            <span class=\"attr\">ports:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;587:587&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;465:465&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;25:25&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;993:993&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;143:143&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;995:995&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;110:110&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;4433:443&#x27;</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">&#x27;8093:80&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">env_file:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">./iredmail-docker.conf</span></span><br><span class=\"line\">            <span class=\"attr\">container_name:</span> <span class=\"string\">iRedMail</span></span><br></pre></td></tr></table></figure>\n\n<p>Upon Docker start-up, if everything is functioning correctly, the debug information will resemble:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/02/29/65dfda2b7efb5.png\" alt=\"Debug output after successfully starting iRedMail in Docker\"></p>\n<p>Once everything is running smoothly, proceed with setting up DNS records, followed by firewall port mappings.</p>\n<p>Finally, use the system’s built-in webmail client to send and receive emails, or configure SMTP&#x2F;POP3 in clients like Outlook for email communication.</p>\n<h2 id=\"Configure-DNS-Records\"><a href=\"#Configure-DNS-Records\" class=\"headerlink\" title=\"Configure DNS Records\"></a>Configure DNS Records</h2><p>Your DNS MX record should point to this value</p>\n<p>Example of DNS settings:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/02/29/65e0282f016cc.png\" alt=\"image-20240229144603695\"></p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/02/29/65e0289fe89be.png\" alt=\"image-20240229144758944\"></p>\n<table>\n<thead>\n<tr>\n<th>DNS Type</th>\n<th>DNS Record Name</th>\n<th>Content&#x2F;Value</th>\n<th>Comments&#x2F;Remarks</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>MX</td>\n<td>carlzeng.top.</td>\n<td>mail.carlzeng.top.</td>\n<td>Identifies the mail server name, DNS MX entry</td>\n</tr>\n<tr>\n<td>A</td>\n<td>mail.carlzeng.top.</td>\n<td>*.8.18.*</td>\n<td>IP address of the mail server</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>carlzeng.top.</td>\n<td>v&#x3D;spf1 mx -all</td>\n<td>SPF entry&#x2F;record</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>dkim._domainkey.carlzeng.top.</td>\n<td>v&#x3D;DKIM1; k&#x3D;rsm; p&#x3D;*</td>\n<td>DKIM entry&#x2F;record, includes the DKIM public key</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>dmarc.carlzeng.top</td>\n<td>v&#x3D;DMARC1; p&#x3D; reject; rua&#x3D;*</td>\n<td>DMARC entry&#x2F;record</td>\n</tr>\n</tbody></table>\n<p>Question: How to retrieve the three TXT records from the iRedMail mail system?</p>\n<p>Answer: After installation: <a href=\"https://docs.iredmail.org/setup.dns.html#mx\">Setup DNS records for your iRedMail server (A, PTR, MX, SPF, DKIM, DMARC)</a></p>\n<p>If you wish to validate the correctness of DNS records, you can use: <a href=\"https://mxtoolbox.com/\">https://mxtoolbox.com/</a></p>\n<h3 id=\"SPF-Record-Correction\"><a href=\"#SPF-Record-Correction\" class=\"headerlink\" title=\"SPF Record Correction\"></a>SPF Record Correction</h3><p>According to the SMTP test report, there might be an error in this record.</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/21/65fc214953f21.png\" alt=\"image-20240321195957875\"></p>\n<p>v&#x3D;spf1 mx a:mail.carlzeng.top -all</p>\n<p>After modifying the SPF record, it has not been updated even after about half an hour. Continuous monitoring in progress…</p>\n<p>After correcting the SPF-related DNS records and testing SMTP again, it showed successful:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/22/65fccd6f7a5fc.png\" alt=\"image-20240322081436077\"></p>\n<h3 id=\"DKIM-Record-Content-Acquisition\"><a href=\"#DKIM-Record-Content-Acquisition\" class=\"headerlink\" title=\"DKIM Record Content Acquisition\"></a>DKIM Record Content Acquisition</h3><p>When it comes to obtaining the content&#x2F;value of dkim._domainkey.mydomain.com, for example:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">docker <span class=\"built_in\">exec</span> -it iRedMail bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">root@cc9dd27b3e25:/etc/amavis/conf.d# amavisd-new showkeys</span><br><span class=\"line\">; key#1 1024 bits, i=dkim, d=carlzeng.top, /opt/iredmail/custom/amavisd/dkim/carlzeng.top.pem</span><br><span class=\"line\">dkim._domainkey.carlzeng.top.   3600 TXT (</span><br><span class=\"line\">  &quot;v=DKIM1; p=&quot;</span><br><span class=\"line\">  &quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDUF5BslOb2fARJjXK41xsAPSg&quot;</span><br><span class=\"line\">  &quot;hToQAkJzRuxp5pwaCyqPzIbFNxTZ66z9yw+rbeXYKdpu3bKemHhKVQ7rvnmVlFFL&quot;</span><br><span class=\"line\">  &quot;Nvef7Pk9ddT/nur2T1sfUY6yDu5QRcZArClAQRjfNCFRA11VgsD5q6OKS5GTNtE5&quot;</span><br><span class=\"line\">  &quot;dz3kJGpVdCllilo4OwIDAQAB&quot;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"DMARC-Record-Content\"><a href=\"#DMARC-Record-Content\" class=\"headerlink\" title=\"DMARC Record Content\"></a>DMARC Record Content</h3><figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">v</span>=DMARC1<span class=\"comment\">; p=reject; sp=none; adkim=s; aspf=s; rua=mailto:postmaster@carlzeng.top; ruf=mailto:postmaster@carlzeng.top</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Port-Mapping\"><a href=\"#Port-Mapping\" class=\"headerlink\" title=\"Port Mapping\"></a>Port Mapping</h3><p>The purpose of this step is to ensure that the data related to email received on the router is correctly forwarded to the appropriate mail service system.</p>\n<table>\n<thead>\n<tr>\n<th>External Port</th>\n<th>Internal NAS&#x2F;Mail Host Port</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>‘587:587’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘465:465’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘25:25’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘993:993’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘143:143’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘995:995’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>‘110:110’</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>4433</td>\n<td>4433</td>\n<td>Access to port 443 may be added</td>\n</tr>\n</tbody></table>\n<p>Mapping these ports one by one, fortunately, these ports have not been blocked by the Internet Service Provider (ISP) yet.</p>\n<h3 id=\"Setup-for-SMTP-Email-Sending\"><a href=\"#Setup-for-SMTP-Email-Sending\" class=\"headerlink\" title=\"Setup for SMTP Email Sending\"></a>Setup for SMTP Email Sending</h3><p>For instance, setting up email information in <a href=\"https://bestbuy.carlzeng.top:3/admin#/smtp\">Bestbuy Purchase Cards Kamifaka</a> to be used for email notifications.</p>\n<p>Error: Unable to successfully reach the email destination</p>\n<p>Solution: Please refer to the section ‘SMTP Service Testing’ for details on resolving this issue. </p>\n<p>By adjusting the DNS record related to SPF (found it effective the next day), testing again; successfully sent a test email.</p>\n<h3 id=\"Errors-and-Solutions\"><a href=\"#Errors-and-Solutions\" class=\"headerlink\" title=\"Errors and Solutions\"></a>Errors and Solutions</h3><h4 id=\"Docker-Startup-Error-“Permission-denied”\"><a href=\"#Docker-Startup-Error-“Permission-denied”\" class=\"headerlink\" title=\"Docker Startup Error - “Permission denied”\"></a>Docker Startup Error - “Permission denied”</h4><p>iRedMail | &#x2F;usr&#x2F;sbin&#x2F;mysqld: Can’t create file ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysqld.err’ (errno: 13 “Permission denied”)<br>iRedMail | 2024-02-28 16:12:07 0 [ERROR] mysqld: Can’t create&#x2F;write to file ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;aria_log_control’ (Errcode: 13 “Permission denied”)</p>\n<p>Solution: Adjust permissions for the mentioned directories.</p>\n<h4 id=\"DNS-Configuration-Error-No-DMARC-Record-Found\"><a href=\"#DNS-Configuration-Error-No-DMARC-Record-Found\" class=\"headerlink\" title=\"DNS Configuration Error - No DMARC Record Found\"></a>DNS Configuration Error - No DMARC Record Found</h4><p>Solution: Ensure the correct DNS record name for DMARC DNS entry must include an underscore: _dmarc</p>\n<h4 id=\"iRedAdmin-Operates-Without-Carrying-Port-Error\"><a href=\"#iRedAdmin-Operates-Without-Carrying-Port-Error\" class=\"headerlink\" title=\"iRedAdmin Operates Without Carrying Port Error\"></a>iRedAdmin Operates Without Carrying Port Error</h4><p>Error: The backend operation <a href=\"https://iredmail.carlzeng.top:3/iredadmin\">https://iredmail.carlzeng.top:3/iredadmin</a>, when submitting a new confirmation operation, the page redirects without carrying the port status.</p>\n<p>Solution: Investigate and resolve the issue for automatic port retrieval.</p>\n<p>When submitting a new confirmation operation to the backend at <a href=\"https://iredmail.carlzeng.top:3/iredadmin\">https://iredmail.carlzeng.top:3/iredadmin</a>, the page redirects without carrying the port status.</p>\n<p>Error Resolution:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/01/65e139600f9ea.png\" alt=\"image-20240301101140381\"></p>\n<p>The issue of automatic port retrieval has not been resolved. I will continue to test after restarting Docker.</p>\n<h3 id=\"iCloud-Communication-Blockage-Rejected-Due-to-Listing-in-Spamhaus-PBL\"><a href=\"#iCloud-Communication-Blockage-Rejected-Due-to-Listing-in-Spamhaus-PBL\" class=\"headerlink\" title=\"iCloud Communication Blockage - Rejected Due to Listing in Spamhaus PBL\"></a>iCloud Communication Blockage - Rejected Due to Listing in Spamhaus PBL</h3><p>When attempting to send email to host mx01.mail.icloud.com[17.56.9.31], it was rejected due to listing in Spamhaus PBL.</p>\n<p>Solution:</p>\n<p>Submit an unblocking request on the provided <a href=\"https://check.spamhaus.org/\">IP AND DOMAIN REPUTATION CHECKER website</a>, and upon successful submission, results should reflect as shown in the image below:</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/01/65e140a62c982.png\" alt=\"image-20240301104242813\"></p>\n<h3 id=\"Self-Blocking-of-Program-Emails-as-SPAM\"><a href=\"#Self-Blocking-of-Program-Emails-as-SPAM\" class=\"headerlink\" title=\"Self-Blocking of Program Emails as SPAM\"></a>Self-Blocking of Program Emails as SPAM</h3><p>The SMTP configuration from the website platform led to program emails being tagged as SPAM. The system mistakenly identified these emails as possible spam. </p>\n<p>Solution: The method to stop the excessive SPAM detection for self-sent emails is currently unknown.</p>\n<h3 id=\"Maintenance-of-Scheduled-Tasks\"><a href=\"#Maintenance-of-Scheduled-Tasks\" class=\"headerlink\" title=\"Maintenance of Scheduled Tasks\"></a>Maintenance of Scheduled Tasks</h3><p>Receiving 6 system automated backup emails daily led to managing the daily emails.</p>\n<p>Solution: Edited the Linux scheduled tasks and removed unnecessary backup tasks for a cleaner email experience. </p>\n<h3 id=\"Email-System-Time-Zone-Correction\"><a href=\"#Email-System-Time-Zone-Correction\" class=\"headerlink\" title=\"Email System Time Zone Correction\"></a>Email System Time Zone Correction</h3><p>Modified the docker-compose file to include a volume entry to rectify the email system’s time zone:</p>\n<p>“&#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime:ro” - This entry corrects the email system’s time zone.</p>\n<h3 id=\"SMTP-Service-Testing\"><a href=\"#SMTP-Service-Testing\" class=\"headerlink\" title=\"SMTP Service Testing\"></a>SMTP Service Testing</h3><p>Utilized SMTP Test Tool and Email Check Spam Score and Improve Quality to assess the SMTP service health and improve email quality.</p>\n<h3 id=\"iredMail-Certificate-Configuration\"><a href=\"#iredMail-Certificate-Configuration\" class=\"headerlink\" title=\"iredMail Certificate Configuration\"></a>iredMail Certificate Configuration</h3><p>Upon utilizing <a href=\"http://www.checktls.com/\">http://www.checktls.com/</a>, it became evident that the Zendesk TLS certificate lacks specificity for the mail.pod-4 host.</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/03/28/6605735e21430.png\" alt=\"image-20240328214042643\"></p>\n<p>From this observation, it appears to be an issue with the self-signed certificate. How can we replace and generate a new certificate?</p>\n<p>Here are the steps for testing the configuration:</p>\n<ol>\n<li>Download the wildcard domain certificate generated in NPM, resulting in a certificate.zip file containing four files.</li>\n<li>Upload fullchain.pem and privkey.pem to the mapped directory (&#x2F;KingchuxingSSD512G&#x2F;docker&#x2F;compose&#x2F;iRedMail&#x2F;ssl), renaming them to iRedMail.crt and iRedMail.key, respectively. Repeat this process for backup purposes.</li>\n<li>Test using <a href=\"https://www.ssllabs.com/ssltest/index.html\">https://www.ssllabs.com/ssltest/index.html</a> and <a href=\"https://www.checktls.com/\">https://www.checktls.com/</a>.</li>\n</ol>\n<p>Reference for this section:</p>\n<p><a href=\"https://docs.iredmail.org/use.a.bought.ssl.certificate.html\">Use a bought SSL certificate</a></p>\n<p><a href=\"https://docs.iredmail.org/letsencrypt.html\">Request a free cert from Let’s Encrypt (for servers deployed with downloadable iRedMail installer)</a></p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/23/66271bd148a22.png\" alt=\"image-20240423102406511\"></p>\n<p>Ensure that the certificate is for mail.carlzeng.top and use the dns challenge method with dns_cloudflare_api_token.</p>\n<p>Processing… This might take a few minutes.</p>\n<p>To obtain the certificate, it was discovered that using the Global API Key was incorrect; instead, the “API Token” section’s ‘Create Token’ was required. Edit the DNS zone accordingly.</p>\n<p><img data-src=\"https://img.carlzeng.top:3/i/2024/04/23/662722fde4c91.png\" alt=\"image-20240423105448516\"></p>\n<p>Execute the following commands:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp mail.jbritian.com_bundle.crt cert.pem </span><br><span class=\"line\"></span><br><span class=\"line\">cp mail.jbritian.com_bundle.crt combined.pem </span><br><span class=\"line\"></span><br><span class=\"line\">cp mail.jbritian.com.key key.pem</span><br></pre></td></tr></table></figure>\n\n<p>Rename:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cert1.pem  to  cert.pem </span><br><span class=\"line\"></span><br><span class=\"line\">fullchain1.pem  to  combined.pem</span><br><span class=\"line\"></span><br><span class=\"line\">privkey1.pem  to  key.pem</span><br></pre></td></tr></table></figure>\n\n<p>Ensure all components are mapped correctly to the container’s &#x2F;opt&#x2F;iredmail&#x2F;ssl directory.</p>\n<p>Then, create symbolic links:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /etc/letsencrypt/live/mail.mydomain.com/fullchain.pem /etc/ssl/certs/iRedMail.crt</span><br><span class=\"line\">ln -s /etc/letsencrypt/live/mail.mydomain.com/privkey.pem /etc/ssl/private/iRedMail.key</span><br></pre></td></tr></table></figure>\n\n<p>Review these components to ensure they are correctly mapped within the container:</p>\n<ul>\n<li>Postfix: File &#x2F;etc&#x2F;postfix&#x2F;main.cf (on Linux&#x2F;OpenBSD)</li>\n<li>Dovecot: File <code>/etc/dovecot/dovecot.conf</code> (on Linux&#x2F;OpenBSD)</li>\n<li>Nginx: File &#x2F;etc&#x2F;nginx&#x2F;templates&#x2F;ssl.tmpl (on Linux&#x2F;OpenBSD)</li>\n<li>MySQL, MariaDB: On Debian and Ubuntu, it’s defined in &#x2F;etc&#x2F;mysql&#x2F;my.cnf.</li>\n</ul>\n<p>Modify TXT records:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v=spf1 a mx include:_spf.google.com ~all</span><br><span class=\"line\">v=spf1 mx -all</span><br></pre></td></tr></table></figure>\n\n<p>These are the instructions for configuring the iRedMail certificate.</p>\n<h1 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h1><p><a href=\"https://kydsj.vip/doku.php?id=wiki:%E8%87%AA%E6%89%98%E7%AE%A1-%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6\">Open Source Universe - Self-hosted - Email</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=qnnf3LWcUXA\">Running iRedMail E-Mail Server in Docker</a></p>\n<p><a href=\"https://docs.iredmail.org/setup.dns.html#mx\">Setup DNS records for your iRedMail server (A, PTR, MX, SPF, DKIM, DMARC)</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=ScarlmgD0dU\">From zero to full mail server in 20 minutes with Mailu Docker images!</a></p>\n<p><a href=\"%E5%BE%85%E7%BB%AD...\">HTTPS&#x2F;SSL Certificate Configuration</a></p>","categories":[{"name":"email","path":"api/categories/email.json"}],"tags":[{"name":"docker","path":"api/tags/docker.json"},{"name":"email","path":"api/tags/email.json"},{"name":"iRedMail","path":"api/tags/iRedMail.json"}]}