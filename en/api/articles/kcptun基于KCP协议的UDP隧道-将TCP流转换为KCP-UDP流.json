{"title":"Kcptun - A UDP Tunnel Based on KCP Protocol - Converting TCP Streams to KCP+UDP to Stream IPTV","slug":"kcptun基于KCP协议的UDP隧道-将TCP流转换为KCP-UDP流","date":"2024-01-04T12:40:33.000Z","updated":"2024-01-07T08:30:27.858Z","comments":true,"path":"api/articles/kcptun基于KCP协议的UDP隧道-将TCP流转换为KCP-UDP流.json","excerpt":" [Figure] Suited for applications with low latency and high speed requirements, it is reputed to double the transmission efficiency X2+.","covers":["https://github.com/xtaci/kcptun/raw/master/kcptun.png","https://www.evernote.com/shard/s122/sh/8fe8d1c0-8160-4ae9-aeb2-cddb0a087fca/iaCsI3nyQOjiBjCc1mRkhgmzaTDboELpmQBi05oXUyhXQRD40JIM0Wkyxg/deep/0/image.png"],"content":"<img class=\"lozad\" data-src=\"https://github.com/xtaci/kcptun/raw/master/kcptun.png\">\n\n<p>Suited for applications with low latency and high speed requirements, it is reputed to double the transmission efficiency X2+.</p>\n<span id=\"more\"></span>\n<div> \n<button onclick=\"synthesizeSpeech()\">Synthesize Speech</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"en\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n<h1 id=\"Target\"><a href=\"#Target\" class=\"headerlink\" title=\"Target\"></a>Target</h1><p>Accelerating end-to-end remote transmission (point-to-point p2p transmission, encapsulating TCP data as UDP KCP data) through UDP tunneling.</p>\n<p>Kcptun is a simple and fast UDP tunnel based on the KCP protocol, capable of converting TCP streams to KCP+UDP streams.</p>\n<h1 id=\"Application\"><a href=\"#Application\" class=\"headerlink\" title=\"Application\"></a>Application</h1><p>Simple deployment and configuration.</p>\n<p>Here’s an example:</p>\n<ol>\n<li>A certain application on a remote&#x2F;distant client needs to access a specific TCP service within the server’s network segment (such as a game or IPTV).</li>\n<li>By launching the kcptun client on the remote client’s router#1 (listening on a local port and then specifying the server’s IP and port, along with encryption information), this kcptun client’s listening port becomes the port the local application will use to connect.</li>\n<li>Connect to the specific kcp server (listening on the server’s port and then specifying the destination TCP service [IP address and port]) through the server (forwarded from router#2’s port).</li>\n<li>This encrypted and encapsulated entire chain is established over UDP, purportedly doubling transmission efficiency X2+.</li>\n</ol>\n<p>Below are two examples of using docker for kcptun applications.</p>\n<h2 id=\"Practical-Example-1\"><a href=\"#Practical-Example-1\" class=\"headerlink\" title=\"Practical Example 1:\"></a>Practical Example 1:</h2><p><a href=\"https://hub.docker.com/r/lowid/kcptun\">https://hub.docker.com/r/lowid/kcptun</a></p>\n<p>If the service to be encapsulated is a SOCKS proxy on the server:</p>\n<p>Server side (kcp+socks) compose file</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">kcp-server:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">lowid/kcptun:v20170329</span></span><br><span class=\"line\">  <span class=\"attr\">command:</span></span><br><span class=\"line\">    <span class=\"string\">--listen</span> <span class=\"string\">:29900</span></span><br><span class=\"line\">    <span class=\"string\">--target</span> <span class=\"string\">dante-server:1080</span></span><br><span class=\"line\">    <span class=\"string\">--mode</span> <span class=\"string\">fast2</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;30003:29900/udp&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">environment:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">KCPTUN_KEY=your_password</span></span><br><span class=\"line\">  <span class=\"attr\">links:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">dante-server</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">dante-server:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">vimagick/dante</span></span><br><span class=\"line\">  <span class=\"attr\">expose:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;1080&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">./sockd.conf:/etc/sockd.conf</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n\n<p>Server side sockd.conf</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">debug: 0</span><br><span class=\"line\">logoutput: stderr</span><br><span class=\"line\">internal: 0.0.0.0 <span class=\"attr\">port</span> = <span class=\"number\">1080</span></span><br><span class=\"line\">external: eth0</span><br><span class=\"line\">socksmethod: username none</span><br><span class=\"line\">clientmethod: none</span><br><span class=\"line\">user.privileged: root</span><br><span class=\"line\">user.unprivileged: nobody</span><br><span class=\"line\"></span><br><span class=\"line\">client pass &#123;</span><br><span class=\"line\">    from: 0.0.0.0/0 port 1-65535 to: 0.0.0.0/0</span><br><span class=\"line\">    log: error</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">socks pass &#123;</span><br><span class=\"line\">    from: 0.0.0.0/0 to: 0.0.0.0/0</span><br><span class=\"line\">    <span class=\"comment\">#socksmethod: username</span></span><br><span class=\"line\">    log: error</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Client side compose file</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">client:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">lowid/kcptun:v20170329</span></span><br><span class=\"line\">  <span class=\"attr\">entrypoint:</span> <span class=\"string\">client_linux_amd64</span></span><br><span class=\"line\">  <span class=\"attr\">command:</span></span><br><span class=\"line\">    <span class=\"string\">--localaddr</span> <span class=\"string\">:12948</span></span><br><span class=\"line\">    <span class=\"string\">--remoteaddr</span> <span class=\"string\">server_ip_address:30003</span></span><br><span class=\"line\">    <span class=\"string\">--mode</span> <span class=\"string\">fast2</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;12948:12948/tcp&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">environment:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">KCPTUN_KEY=your_password</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Practical-Example-2\"><a href=\"#Practical-Example-2\" class=\"headerlink\" title=\"Practical Example 2:\"></a>Practical Example 2:</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">docker</span> <span class=\"string\">pull</span> <span class=\"string\">chenhw2/kcptun</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">docker</span> <span class=\"string\">run</span> <span class=\"string\">-d</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-e</span> <span class=\"string\">&quot;ARGS=server -t 10.0.0.1:80&quot;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-p</span> <span class=\"number\">29900</span><span class=\"string\">:29900/udp</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chenhw2/kcptun</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Client</span></span><br><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">docker</span> <span class=\"string\">run</span> <span class=\"string\">-d</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-e</span> <span class=\"string\">&quot;ARGS=client -r [kcp_server]:29900&quot;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-p</span> <span class=\"number\">12948</span><span class=\"string\">:12948/tcp</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chenhw2/kcptun</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Related-Content\"><a href=\"#Related-Content\" class=\"headerlink\" title=\"Related Content\"></a>Related Content</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=kcp\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"Implementation-Approach\"><a href=\"#Implementation-Approach\" class=\"headerlink\" title=\"Implementation Approach\"></a>Implementation Approach</h1><p>Abandoning the docker approach.</p>\n<p>KCP Server:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./server_linux_amd64 -t &quot;192.168.6.243:8012&quot; -l &quot;:29900&quot; -mode fast3 -nocomp -dscp 46 --key op.carlzeng.top --crypt salsa20</span><br></pre></td></tr></table></figure>\n\n<p>Explanatory note: Because this service on port 29900 is configured on a specific server (not on the main router’s public IP), it requires port mapping on the main router’s public IP (i.e., to forward external 29900 UDP data to the same port on this specific server).</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Configuration <span class=\"keyword\">in</span> Padavan interface on K2P</span></span><br><span class=\"line\"></span><br><span class=\"line\">KCP Client: ./client_darwin_amd64 -r &quot;KCP_SERVER_IP:29900&quot; -l &quot;:8012&quot; -mode fast3 -nocomp -autoexpire 900 -sockbuf 16777217 -dscp 46</span><br><span class=\"line\"></span><br><span class=\"line\">/opt/bin/kcptun  -r &quot;@@@.@@@.@@@.@@@:29900&quot; -l &quot;:88012&quot; -key op.carlzeng.top -crypt salsa20 -mode fast3 -dscp 46 -autoexpire 900 -nocomp</span><br></pre></td></tr></table></figure>\n\n<p>A comprehensive diagram of the entire process</p>\n<p><img data-src=\"https://www.evernote.com/shard/s122/sh/8fe8d1c0-8160-4ae9-aeb2-cddb0a087fca/iaCsI3nyQOjiBjCc1mRkhgmzaTDboELpmQBi05oXUyhXQRD40JIM0Wkyxg/deep/0/image.png\" alt=\"An instance of the entire process using kcptun\"></p>\n<p>A peculiar testing method was used to play through frp to another location;<br>Testing experience: High definition is very smooth, 4K still experiences some lag;<br>TODO: Waiting for the next step to test local area network playback on the client side after KCP transmission.</p>\n<p>After such KCP transmission, as per reports, the transmission latency is halved, and the speed is doubled X2+; awaiting further practical testing to verify.</p>\n<h1 id=\"Source-of-Inspiration\"><a href=\"#Source-of-Inspiration\" class=\"headerlink\" title=\"Source of Inspiration\"></a>Source of Inspiration</h1><p>[Tutorial, project address: <a href=\"https://github.com/xtaci/kcptun/]\">https://github.com/xtaci/kcptun/]</a>(</p>\n","more":"<div> \n<button onclick=\"synthesizeSpeech()\">Synthesize Speech</button>\n</div>\n<audio controls id=\"audioPlayer\">Your browser does not support the audio element.</audio>      \n<script>\n  function synthesizeSpeech() { \n    var inputText = document.getElementsByClassName('post-block')[0].innerText;\n    var voice = \"en\";\n    var url = 'https://tts.carlzeng.top:3/speech?text=' + encodeURIComponent(inputText.substring(0,3000)) + '&voice=' + voice;\n    var audioPlayer = document.getElementById('audioPlayer');          \n    audioPlayer.src = url;\n    audioPlayer.load();\n    audioPlayer.play();\n  }\n</script>\n\n<h1 id=\"Target\"><a href=\"#Target\" class=\"headerlink\" title=\"Target\"></a>Target</h1><p>Accelerating end-to-end remote transmission (point-to-point p2p transmission, encapsulating TCP data as UDP KCP data) through UDP tunneling.</p>\n<p>Kcptun is a simple and fast UDP tunnel based on the KCP protocol, capable of converting TCP streams to KCP+UDP streams.</p>\n<h1 id=\"Application\"><a href=\"#Application\" class=\"headerlink\" title=\"Application\"></a>Application</h1><p>Simple deployment and configuration.</p>\n<p>Here’s an example:</p>\n<ol>\n<li>A certain application on a remote&#x2F;distant client needs to access a specific TCP service within the server’s network segment (such as a game or IPTV).</li>\n<li>By launching the kcptun client on the remote client’s router#1 (listening on a local port and then specifying the server’s IP and port, along with encryption information), this kcptun client’s listening port becomes the port the local application will use to connect.</li>\n<li>Connect to the specific kcp server (listening on the server’s port and then specifying the destination TCP service [IP address and port]) through the server (forwarded from router#2’s port).</li>\n<li>This encrypted and encapsulated entire chain is established over UDP, purportedly doubling transmission efficiency X2+.</li>\n</ol>\n<p>Below are two examples of using docker for kcptun applications.</p>\n<h2 id=\"Practical-Example-1\"><a href=\"#Practical-Example-1\" class=\"headerlink\" title=\"Practical Example 1:\"></a>Practical Example 1:</h2><p><a href=\"https://hub.docker.com/r/lowid/kcptun\">https://hub.docker.com/r/lowid/kcptun</a></p>\n<p>If the service to be encapsulated is a SOCKS proxy on the server:</p>\n<p>Server side (kcp+socks) compose file</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">kcp-server:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">lowid/kcptun:v20170329</span></span><br><span class=\"line\">  <span class=\"attr\">command:</span></span><br><span class=\"line\">    <span class=\"string\">--listen</span> <span class=\"string\">:29900</span></span><br><span class=\"line\">    <span class=\"string\">--target</span> <span class=\"string\">dante-server:1080</span></span><br><span class=\"line\">    <span class=\"string\">--mode</span> <span class=\"string\">fast2</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;30003:29900/udp&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">environment:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">KCPTUN_KEY=your_password</span></span><br><span class=\"line\">  <span class=\"attr\">links:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">dante-server</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">dante-server:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">vimagick/dante</span></span><br><span class=\"line\">  <span class=\"attr\">expose:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;1080&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">./sockd.conf:/etc/sockd.conf</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n\n<p>Server side sockd.conf</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">debug: 0</span><br><span class=\"line\">logoutput: stderr</span><br><span class=\"line\">internal: 0.0.0.0 <span class=\"attr\">port</span> = <span class=\"number\">1080</span></span><br><span class=\"line\">external: eth0</span><br><span class=\"line\">socksmethod: username none</span><br><span class=\"line\">clientmethod: none</span><br><span class=\"line\">user.privileged: root</span><br><span class=\"line\">user.unprivileged: nobody</span><br><span class=\"line\"></span><br><span class=\"line\">client pass &#123;</span><br><span class=\"line\">    from: 0.0.0.0/0 port 1-65535 to: 0.0.0.0/0</span><br><span class=\"line\">    log: error</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">socks pass &#123;</span><br><span class=\"line\">    from: 0.0.0.0/0 to: 0.0.0.0/0</span><br><span class=\"line\">    <span class=\"comment\">#socksmethod: username</span></span><br><span class=\"line\">    log: error</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Client side compose file</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">client:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">lowid/kcptun:v20170329</span></span><br><span class=\"line\">  <span class=\"attr\">entrypoint:</span> <span class=\"string\">client_linux_amd64</span></span><br><span class=\"line\">  <span class=\"attr\">command:</span></span><br><span class=\"line\">    <span class=\"string\">--localaddr</span> <span class=\"string\">:12948</span></span><br><span class=\"line\">    <span class=\"string\">--remoteaddr</span> <span class=\"string\">server_ip_address:30003</span></span><br><span class=\"line\">    <span class=\"string\">--mode</span> <span class=\"string\">fast2</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;12948:12948/tcp&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">environment:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">KCPTUN_KEY=your_password</span></span><br><span class=\"line\">  <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Practical-Example-2\"><a href=\"#Practical-Example-2\" class=\"headerlink\" title=\"Practical Example 2:\"></a>Practical Example 2:</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">docker</span> <span class=\"string\">pull</span> <span class=\"string\">chenhw2/kcptun</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">docker</span> <span class=\"string\">run</span> <span class=\"string\">-d</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-e</span> <span class=\"string\">&quot;ARGS=server -t 10.0.0.1:80&quot;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-p</span> <span class=\"number\">29900</span><span class=\"string\">:29900/udp</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chenhw2/kcptun</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Client</span></span><br><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">docker</span> <span class=\"string\">run</span> <span class=\"string\">-d</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-e</span> <span class=\"string\">&quot;ARGS=client -r [kcp_server]:29900&quot;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">-p</span> <span class=\"number\">12948</span><span class=\"string\">:12948/tcp</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chenhw2/kcptun</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Related-Content\"><a href=\"#Related-Content\" class=\"headerlink\" title=\"Related Content\"></a>Related Content</h1><iframe style=\"box-shadow: 0px 0px 20px -10px;\" src=\"https://query.carlzeng.top:3/appsearch?q=kcp\" frameborder=\"0\" scrolling=\"auto\" width=\"100%\" height=\"500\"></iframe>\n\n<h1 id=\"Implementation-Approach\"><a href=\"#Implementation-Approach\" class=\"headerlink\" title=\"Implementation Approach\"></a>Implementation Approach</h1><p>Abandoning the docker approach.</p>\n<p>KCP Server:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./server_linux_amd64 -t &quot;192.168.6.243:8012&quot; -l &quot;:29900&quot; -mode fast3 -nocomp -dscp 46 --key op.carlzeng.top --crypt salsa20</span><br></pre></td></tr></table></figure>\n\n<p>Explanatory note: Because this service on port 29900 is configured on a specific server (not on the main router’s public IP), it requires port mapping on the main router’s public IP (i.e., to forward external 29900 UDP data to the same port on this specific server).</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Configuration <span class=\"keyword\">in</span> Padavan interface on K2P</span></span><br><span class=\"line\"></span><br><span class=\"line\">KCP Client: ./client_darwin_amd64 -r &quot;KCP_SERVER_IP:29900&quot; -l &quot;:8012&quot; -mode fast3 -nocomp -autoexpire 900 -sockbuf 16777217 -dscp 46</span><br><span class=\"line\"></span><br><span class=\"line\">/opt/bin/kcptun  -r &quot;@@@.@@@.@@@.@@@:29900&quot; -l &quot;:88012&quot; -key op.carlzeng.top -crypt salsa20 -mode fast3 -dscp 46 -autoexpire 900 -nocomp</span><br></pre></td></tr></table></figure>\n\n<p>A comprehensive diagram of the entire process</p>\n<p><img data-src=\"https://www.evernote.com/shard/s122/sh/8fe8d1c0-8160-4ae9-aeb2-cddb0a087fca/iaCsI3nyQOjiBjCc1mRkhgmzaTDboELpmQBi05oXUyhXQRD40JIM0Wkyxg/deep/0/image.png\" alt=\"An instance of the entire process using kcptun\"></p>\n<p>A peculiar testing method was used to play through frp to another location;<br>Testing experience: High definition is very smooth, 4K still experiences some lag;<br>TODO: Waiting for the next step to test local area network playback on the client side after KCP transmission.</p>\n<p>After such KCP transmission, as per reports, the transmission latency is halved, and the speed is doubled X2+; awaiting further practical testing to verify.</p>\n<h1 id=\"Source-of-Inspiration\"><a href=\"#Source-of-Inspiration\" class=\"headerlink\" title=\"Source of Inspiration\"></a>Source of Inspiration</h1><p>[Tutorial, project address: <a href=\"https://github.com/xtaci/kcptun/]\">https://github.com/xtaci/kcptun/]</a>(</p>","categories":[{"name":"KCP","path":"api/categories/KCP.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"Kcptun","path":"api/tags/Kcptun.json"},{"name":"TCP","path":"api/tags/TCP.json"},{"name":"UDP","path":"api/tags/UDP.json"},{"name":"IPTV","path":"api/tags/IPTV.json"},{"name":"udprxy","path":"api/tags/udprxy.json"},{"name":"live streaming","path":"api/tags/live streaming.json"},{"name":"accelerator","path":"api/tags/accelerator.json"}]}